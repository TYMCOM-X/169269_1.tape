TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1
COM.MAC	23-MAR-79 11:41	

     1				00010	;COM    05/25/77
     2			000015	00020	VERSION==15
     3			000013	00030	VERPAT==13
     4			000000	00040	R0=     0
     5			000001	00050	R1=     1
     6			000002	00060	R2=     2
     7			000003	00070	R3=     3
     8			000004	00080	CH==    4                       ;CURRENT CHARACTER
     9			000007	00090	CT==    7                       ;CURRENT CHARACTER'S TYPE
    10				00100	;W=5                            ;USED BY CMD
    11				00110	;S=6                            ;USED BY CMD
    12			000010	00120	F=      10                      ;USED BY TAP
    13			000015	00130	U=15                            ;USED BY TAP
    14				00140	;W=16                           ;USED BY TAP
    15			000017	00150	P=      17
    16			000012	00160	UNIT== 12               ;USED BY TAP
    17			000006	00170	FIL==   6               ;CHANNEL FOR USER FILE
    18			000040	00180	RST==   40              ;DO NOT PUT FILE IN DIRECTORY ON A CLOSE
    19			000050	00190	LPAREN==50
    20			000051	00200	RPAREN==51
    21			000056	00210	DOTCHR= 56
    22			000014	00220	TOFCHR= 14
    23			000015	00230	CRCHR=  15
    24			000040	00240	SPACE=  40
    25			000000	00250	EOLIT== 0
    26			000137	00260	BARROW= 137
    27				00270	        SALL                    ;SUPPRESS ALL MACRO EXPANSIONS
    28				00280	IFDEF   UUOFLG  <UUOTAB: BLOCK 0>
    29				00290	DEFINE  OPD     (A,B) <X==X+1
    30				00300	OPDEF A [X*1000000000]
    31				00310	IFDEF UUOFLG<JRST B>>
    32			000000	00320	X==0
    33				00330	        OPD     TCI,TCIUUO;    001
    34				00340	        OPD     TCL,TCLUUO;    002
    35				00350	        OPD     RDLINE,RDUUO;  003
    36				00360	        OPD     GCI,GCIUUO;    004
    37				00370	        OPD     GCD,GCDUUO;    005
    38				00380	        OPD     WCI,WCIUUO;    006
    39				00390	        OPD     WCD,WCDUUO;    007
    40				00400	        OPD     TCO,TCOUU ;    010
    41				00410	        OPD     DEC,DECUUO;    011
    42				00420	        OPD     TYPE,TYPUUO;   012
    43				00430	        OPD     CLRIN,CLRUUO;  013
    44				00440	        OPD     SETTTY,TTYUUO; 014
    45				00450	        OPD     ERROR,ERRUUO;  015
    46				00460	        OPD     ENABLE,ENUUO;  016
    47				00470	        OPD     DISABL,DISUUO; 017
    48				00480	        OPD     SSKE,SSKUUO;   020
    49				00490	        OPD     TAB,TABUUO;    021
    50				00500	        OPD     ERO,EROUUO;    022
    51				00510	        OPD     ERT,ERTUUO;     023
    52				00520	        OPD     ERB,ERBUUO;     024
    53					;CHR    07/08/72
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1
CHR.MAC	23-MAR-79 11:41	

    54					DEFINE  CHARDO(A) <CHARC=0
    55					A'IC;;      ILLEGAL CHARACTER
    56					A'AL;;      ALPHABETIC CHARACTER
    57					A'NU;;      NUMERIC CHARACTER
    58					A'RP;;      LEAVE USER MODE ")"
    59					A'IG;;      IGNORED CHARACTER
    60					A'LP;;      ENTER USER NAME MODE "("
    61					A'AS;;      ALL FILES CHAR (*)
    62					A'EX;;      FILE EXTENSION DELIMITER (.)
    63					A'AT;;      COMMAND FILE CHAR (@)
    64					A'CO;;      COMMA
    65					A'TE;;      LINE TERMINATION (CR LF)
    66					A'SP;;      SPACE
    67					A'PO;;      POUND SIGN (#)
    68					A'QU;;      QUESTION MARK (?)
    69					A'PU;;      PUNCTUATION ALLOWED IN USER NAMES (/ ' $)
    70					A'DA>;      DASH (-)
    71					DEFINE  CHRDEF(C) <C=CHARC
    72					CHARC=CHARC+1>
    73			000020		        CHARDO  <CHRDEF >
    74
    75				00010	TITLE   TAP     03/26/74
    76				00020	;*CHECK OUT THE ESCAPE ROUTINE
    77				00030	;*IMPROVE TAPE ERROR LOGIC TO READ WHOLE FILE
    78				00040	;*DON'T ALWAYS CHECK FOR WRITE RING
    79				00050	;*PERHAPS HF LICENSE SHOULD BE RESTORED
    80				00060	;*REJECT "AFTER DATE" IF DATE AND TIME IS IN THE FUTURE
    81				00070	;*REENTER AND CONTINUE MAY NOT WORK
    82				00080	;*SHORTEN RESTORE OLD FILE MESSAGE
    83				00090	;*ACCEPT TIME WITH NO COLON 0100
    84				00100	;*ACCEPT DASH BETWEEN TIME AND DATE
    85				00110	;*LICENSE RESTORE LOGIC IS NONEXISTENT
    86				00120	;*ON RESTORE, TITO SHOULD NOT GO PAST LAST POSSIBLE FILE
    87				00130	;*TAPIN ERR SHOULD SAY WHAT KINDS OF ERRORS
    88				00140	;*DON'T RESTORE LICENSE TO FILES WITHOUT LICENSE - ?
    89				00150	;*HAVE OPERS RECOVER BAD FILES - ?
    90				00160	;*CHECK EACH TAPE TO BE SURE IT'S NOT THE ONE WE JUST DUMPED
    91				00170	;*CONTROL OVER TYPES OF ERROR MESSAGES WHICH GO TO TER AND COF FILE
    92				00180	;*SORT BY FILENAME WITHIN USER IN STORE
    93				00190	;*STORE SHOULD PUT USERNAME AS WELL AS PPN ON TAPE
    94				00200	;*TRANSLATE COMMAND NEEDED
    95				00210	;*NEED TO MAKE DIRECTORIES ON SYSTEMS OTHER THAN THE ORIGINAL
    96				00220	;*      OR ON SYSTEMS WHERE THE LUD HAS CHANGED
    97				00230	;*NEED TO SWITCH TO SYNCHRONOUS INPUT MODE AT VARIOUS ABORT
    98				00240	;*      POINTS AND LOOK FOR LOGICAL END OF TAPE
    99
   100			000137	00260	VERLOC= 137
   101	000137			00270	        LOC     VERLOC
   102	000137	000015	000013	00280	        XWD     VERSION,VERPAT          ;STORE VERSION NUMBER IN LOC 137
   103	000000'			00290	        RELOC
   104
   105				00310	;ACCUMULATOR ASSIGNMENTS
   106				00320	;U=     15      ;FIRST  WORD ON A READ OF MFD OR UFD
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1
TAP.MAC	23-MAR-79 11:41	

   107			000016	00330	W=      16      ;SECOND WORD ON A READ OF MFD OR UFD
   108			000005	00340	HA==    5       ;USED ONLY BY HASHER - REGISTER PRESERVED BY HASHER
   109			000006	00350	HB==    HA+1    ;USED ONLY BY HASHER - REGISTER PRESERVED BY HASHER
   110			000007	00360	HC==    HA+2    ;USED ONLY BY HASHER - REGISTER PRESERVED BY HASHER
   111			000010	00370	HD==    HA+3    ;USED ONLY BY HASHER - REGISTER PRESERVED BY HASHER
   112			000011	00380	HE==    HA+4    ;USED ONLY BY HASHER - REGISTER PRESERVED BY HASHER
   113
   114				00400	;CHARACTERS
   115			000121	00410	QCHR=   121
   116			000047	00420	PRIME=  47
   117			000054	00430	COMMA=  54
   118			000133	00440	LBRACK= 133
   119			000135	00450	RBRACK= 135
   120
   121				00470	;PARAMETER ASSIGNMENTS
   122			000010	00480	NDEV==10                ;NO. OF DEVICES IN DEVTBL
   123			000044	00490	XLOOKN==44              ;NO. OF ARGS FOR EXTENDED LOOKUP/ENTER
   124			000100	00500	XHDRN==100              ;LENGTH OF FILE HEADER BLOCK, WHICH INCLUDES
   125				00510	;       FILDM1 (SIXBIT /DSK/ IN LH AND TITO VERSION NO. IN RH)
   126				00520	;       ALL DISC FILE PARAMETERS (.RBARG + XLOOKN WDS), TAPE FILE
   127				00530	;       PARAMETERS (TPDEN,TPSER,TPTIM, AND TPPOS).  FILMRK IS
   128				00540	;       NOT INCLUDED.  THE DISC FILE PARAMETERS START AT THE BEGINNING
   129				00550	;       OF THE BLOCK AND GROW TOWARDS THE END.  THE TAPE FILE PARAMETERS
   130				00560	;       START AT THE END OF THE BLOCK AND GROW TOWARD THE BEGINNING.
   131			000102	00570	XHDR==XHDRN+2           ;LAST WORD IN HEADER RELATIVE TO BUFFER PTR
   132			200000	00580	UCHGBT==200000          ;CHANGED (DUMPED) BIT IN UFD (RH)
   133			020000	00590	RCHGBT==20000           ;CHANGED (DUMPED) BIT IN RIB (LH)
   134			100000	00600	FILCTD==100000          ;(LH) FILE CONTINUED ON NEXT TAPE BIT IN TRAILER
   135			200000	00610	USRCTD==200000          ;(LH) USER CONTINUED ON NEXT TAPE BIT IN TRAILER
   136			400000	00620	TAPCTD==400000          ;(LH) CONTINUATION TAPE(S) FOLLOW BIT IN TRAILER
   137			700000	00630	MSKCTD==TAPCTD!USRCTD!FILCTD    ;MASK FOR CONTINUED BITS
   138
   139				00650	;CALLI ADDRESSES
   140			000004	00660	DEVCHR==4
   141			000000	00670	RESET== 0
   142			000010	00680	WAIT==  10
   143			000014	00690	DATE==  14
   144			000023	00700	MSTIME==23
   145
   146				00720	;DEVICE ASSIGNMENTS
   147			000004	00730	MFD==   4               ;DISK FOR MASTER FILE DIRECTORY
   148			000005	00740	UFD==   5               ;DISK FOR USER FILE DIRECTORY (MUST BE MFD+1)
   149				00750	;FIL==   6               ;DISC FOR USER FILE
   150			000010	00760	LUD==   10              ;LUD
   151			000011	00770	DUL==   11              ;DUL
   152			000012	00780	TP0==   12              ;TAPE READ OR WRITE 
   153			000013	00790	TP1==   13              ;TAPE READ OR WRITEN 
   154
   155				00810	;NUMBER OF BUFFERS/CHANNEL
   156			000001	00820	TAPN==  1
   157			000002	00830	MFDN==  2
   158			000002	00840	UFDN==  2
   159			000007	00850	FILN==: 7
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-2
TAP.MAC	23-MAR-79 11:41	

   160			000001	00860	LUDN==  1
   161			000001	00870	DULN==  1
   162
   163				00890	;SIZE OF BUFFERS/DEVICE
   164			007237	00900	TAPSIZ==^D3740+3
   165			000203	00910	DSKSIZ==203
   166
   167				00930	;I/O STATUS BIT ASSIGNMENTS
   168			000014	00940	BUFBIN==14              ;BUFFERED BINARY MODE
   169			000020	00950	DVMTA== 20              ;DEVICE IS MAGTAPE
   170			000020	00960	NOCNT== 20              ;MONITOR IS NOT TO COMPUTE BUFFER WORD COUNT
   171			000040	00970	SYNCIN==40              ;SYNCHRONOUS INPUT
   172			0	00980	IOEND== 20000           ;END OF FILE
   173			004000	00990	BOTBIT==4000                    ;BEGINNING OF TAPE
   174			002000	01000	IOTEND==2000                    ;END OF TAPE
   175			740000	01010	IOBAD== 740000                  ;I/O ERROR
   176			040000	01020	BTL==   40000                   ;BLOCK TOO LARGE FOR BUFFER
   177			000004	01030	DLL==   4                       ;DO NOT DEALLOCATE EXCESS BLOCKS
   178			000010	01040	DNC==   10                      ;DO NOT CHG ACCESS DATE
   179				01050	;RST==   40                      ;DISCARD THIS FILE AND KEEP OLD ONE
   180
   181				01070	;CHANIO CONTROL BITS FOR READING UFD'S
   182			040000	01080	RCD== 040000    ;READ CREATION DATE
   183			020000	01090	RSB== 020000    ;READ STATUS BITS
   184
   185				01110	;EXTENDED LOOKUP FILE STATUS BITS
   186			040000	01120	.RPNFS==40000           ;(RH) DO-NOT-SAVE BIT
   187			000001	01130	.RPBAD==1               ;(RH) FILE MARKED BAD BY DSKFIX
   188
   189				01150	;MISC PARAMETERS
   190
   191			000001	01170	CUTS==1 ;1=SYNCHRONOUS MODE FOR CUT COMMAND, -1 OTHERWISE TRY ASYNCHRONOUS
   192				01180	;FLAG ASSIGNMENTS (LH OF AC F)
   193			000001	01190	EOTFND==1                       ;EOT HAS BEEN READ
   194			000002	01200	EOFFND==2                       ;END OF DISC FILE HAS BEEN READ
   195			000004	01210	BOTFLG==4                       ;AT BEGINNING OF TAPE
   196			000010	01220	FILFND==10                      ;A FILE WAS SAVED FOR THIS USER
   197			000020	01230	CTDFLG==20                      ;TAPE CONTINUED AT EITHER END
   198			000040	01240	UFDFLG==40                      ;ON IF PROG HAS LICENSE TO SET UP UFDS
   199			000100	01250	LUDFLG==100                     ;ON IF LUD IS OPEN
   200			000200	01260	DULFLG==200                     ;ON IF DUL IS OPEN
   201			000400	01270	STOFLG==400                     ;ON FOR STORE.  OFF FOR RESTORE
   202			001000	01280	DIRFLG==1000                    ;ON FOR DIRECTORY.
   203			002000	01290	INIFLG==: 2000                    ;TAPE INITIALIZED FOR STORE IF ON
   204			004000	01300	P12FLG=:4000                    ;MONITOR P012 OR LATER IF ON
   205			010000	01310	T12FLG=:10000                   ;TAPE CREATED ON P012 OR LATER
   206			020000	01320	CUTFLG==20000           ;ON FOR CUT.  OFF FOR OTHER.
   207			040000	01330	RPTFLG==:40000                   ;REPEATED STORE FLAG
   208			100000	01340	RPTFIL==:100000 ;TURNED ON BY TAPE WRITE ERROR TO REPEAT FILE AT UFD2
   209			200000	01350	PRPFLG== 200000 ;INDICATES THAT TAPE SAVESET HAS BEGUN
   210			400000	01360	FAIFLG== 400000 ;INDICATES THAT DIRECTORY IS IN FAILSAFE FORMAT
   211				01370	; FLAGS IN RH OF ACCUM F
   212			000001	01380	NEWFLG==1       ;TAPE VERSION 14 OR GREATER
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-3
TAP.MAC	23-MAR-79 11:41	

   213			000002	01390	HDRFLG==2       ;DELAYED HEADER MESSAGES PENDING
   214			000004	01400	FNDFLG==4       ;INDICATES TAPE HAS BEEN POSITIONED TO RANFST
   215			000010	01410	RANFLG==10      ;INDICATES RANGE OF TAPE POSITIONS MUST BE ENTERED
   216			000020	01420	EOFFLG==20      ;AN EOF HAS JUST BEEN READ
   217			000040	01430	EOTFLG==:40     ;TWO CONSECUTIVE EOF'S HAVE BEEN READ
   218			000100	01440	UNMFLG==100     ;DIR RECORD HAS BEEN FOUND WITH NEW USER NAME
   219			000200	01450	SSCFLG==200     ;COMMAND STARTED AT BEGINNING OF TAPE, CAN USE
   220				01460	;               SAVE SET NOS.
   221			000400	01470	IGNFLG==400     ;IGNORE DATA RECORDS IF SET
   222				01480	;               ;WILL BE RESET IF WE ARE PROCESSING A FILE
   223			001000	01490	HDRMSG==1000    ;SUPPRESS HEADER MESSAGES IF SET
   224			002000	01500	HDRFND==2000    ;FOUND HEADER (NEEDED TO RESTORE OLD FILES)
   225			004000	01510	RANCMD==:4000   ;RANGE PRE-ENTERED FROM COMMAND DISPATCHER
   226			010000	01520	TRTFLG==:10000  ;TRANSLATIONS IN EFFECT
   227			020000	01530	TRTFG2==:20000  ;PARTWAY THROUGH ENTERING OF DISC/TAPE USERNAME PRS
   228			040000	01540	TRTFG3==:40000  ;CLEAR TRT AT COMMAND DISPATCH IF NOT SET
   229			100000	01550	LPTFLG==:100000 ;INDICATES THAT LPT: IS OUTPUT MEDIUM
   230			200000	01560	FSTFLG==:200000 ;USE DUL INSTEAD OF FAST DUL WHEN SET
   231			400000	01570	NWFLG==:400000 ;NO WAIT FLAG.  AVOID MTCLS AT CDISP.
   232
   233			000004	01590	SRTOT==:4                       ;STORE/RESTORE PRINT TOTALS
   234			000002	01600	SRUSR==:2                       ;STORE/RESTORE PRINT USERS
   235			000001	01610	SRFIL==:1                       ;STORE/RESTORE PRINT FILES
   236			000007	01620	SRMSK== SRTOT+SRUSR+SRFIL       ;STORE/RESTORE MASK
   237			000010	01630	OSNEW==:10                      ;OLD FILE/SYS RESTORE NEWEST FILE
   238			000020	01640	OSTAP==:20                      ;OLD FILE/SYS RESTORE FILE FROM TAPE
   239			000040	01650	OSDSK==:40                      ;OLD FILE/SYS IGNORE FILE FROM TAPE
   240			000100	01660	OSCON==:100                     ;OLD FILE/SYS ASK FOR CONFIRMATION
   241			000170	01670	OSMSK== OSNEW+OSTAP+OSDSK+OSCON ;OLD FILE/SYS MASK
   242
   243	000000'	200740	000000*	01690	START:  MOVE    P,STACK##       ;INITIALIZE THE STACK
   244	000001'	047000	000000	01700	        CALLI   RESET           ;CLEAR ALL I/O
   245	000002'	402000	000000*	01710	        SETZM COUT##
   246	000003'	260740	000000*	01720	        PUSHJ P,COFRLS
   247	000004'	476000	000000*	01730	        SETOM EROSW##
   248	000005'	400500	000000	01740	        SETZ    UNIT,           ;CLEAR UNIT
   249	000006'	400400	000000	01750	        SETZ    F,              ;CLEAR ALL FLAGS
   250	000007'	402000	016614'	01760	        SETZM DEVTBL    ;ZERO THE DEVICE TABLE
   251	000010'	505040	016614'	01770	        HRLI R1,DEVTBL
   252	000011'	541040	016615'	01780	        HRRI R1,DEVTBL+1
   253	000012'	251040	016643'	01790	        BLT 1,DEVTBL+3*NDEV-1
   254	000013'	260740	021716'	01800	        PUSHJ   P,GETDUL        ;OPEN THE DUL BEFORE THROWING AWAY LIC
   255	000014'	561040	777760	01810	        HRROI   R1,-20          ;LOOK FOR OPERATOR LICENSE
   256	000015'	047040	000041	01820	        GETTAB  R1,             ;READ JOB AND PROCESS LICENSE
   257	000016'	201040	000000	01830	        MOVEI   R1,0            ;CANNOT READ LICENSE SO SET TO ZERO
   258	000017'	516040	013766'	01840	        HRLZM   R1,JBLIC#       ;SAVE THE JOB'S LICENSE
   259	000020'	606040	100000	01850	        TRNN    R1,100000       ;SKIP IF OPER LICENSE SET
   260	000021'	507000	000001	01860	        HRLS    R1              ;THROW AWAY PROGRAM'S LICENSE
   261	000022'	606040	100000	01870	        TRNN    R1,100000       ;SKIP IF OPER LICENSE SET
   262	000023'	012000	022007'	01880	        TYPE    [ASCIZ "$OPERATOR LICENSE IS NOT SET."]
   263	000024'	661400	000040	01890	        TLO     F,UFDFLG        ;ASSUME WE HAVE LIC TO SET UP UFDS
   264	000025'	641040	005002	01900	        TLC     R1,5002         ;COMPLEMENT WF JL ST LICENSE BITS
   265	000026'	643040	005002	01910	        TLCE    R1,5002         ;PUT LIC BACK AND SKIP IF ENOUGH LIC
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-4
TAP.MAC	23-MAR-79 11:41	

   266	000027'	621400	000040	01920	        TLZ     F,UFDFLG        ;NOT ENOUGH LICENSE TO SET UP UFDS
   267	000030'	047040	777770	01930	        SETLIC  R1,             ;SET APPROPRIATE LICENSE
   268	000031'	200040	022015'	01940	        MOVE    R1,[XWD -1,2]   ;NEED PPN FOR THIS JOB
   269	000032'	047040	000041	01950	        GETTAB  R1,             ;GET PPN FOR THIS JOB
   270	000033'	201040	000000	01960	        MOVEI   R1,0            ;SHOULD NEVER FAIL LIKE THIS
   271	000034'	202040	013767'	01970	        MOVEM   R1,JBPPN#       ;SAVE PPN FOR THIS JOB
   272	000035'	402000	013365'	01980	        SETZM   CNVDAT          ;ZERO THE CREATION DATE
   273	000036'	402000	013366'	01990	        SETZM   CNVTIM          ;ZERO THE CREATION TIME
   274	000037'	402000	013367'	02000	        SETZM   CNVFMT          ;ZERO THE CREATION FORMAT
   275	000040'	402000	013733'	02005		SETZM	ALLFSW		;ZERO THE "ALL FILES" SWITCH
   276	000041'	201040	013365'	02010	        MOVEI   R1,CNVDAT       ;GET ADDRESS OF TABLE FOR DATUUO
   277	000042'	661400	004000	02020	        TLO     F,P12FLG        ;ASSUME THIS IS MONITOR P012 OR LATER
   278	000043'	047040	777723	02030	        DATUUO  R1,             ;SKIP IF MONITOR P012 OR LATER
   279	000044'	621400	004000	02040	        TLZ     F,P12FLG        ;TURN OFF FLAG - MONITOR P11 OR EARLIER
   280	000045'	200040	022016'	02050	        MOVE    R1,[XWD 26,11]  ;CONFIG TABLE - JIFFIES PER SEC ENTRY
   281	000046'	047040	000041	02060	        GETTAB  R1,             ;GET JIFFIES PER SECOND
   282	000047'	201040	000074	02070	        MOVEI   R1,74           ;SHOULD NEVER FAIL, BUT ASSUME 60/SEC
   283	000050'	202040	013374'	02080	        MOVEM   R1,JIFFPS       ;SAVE JIFFIES PER SECOND
   284	000051'	221040	000074	02090	        IMULI   R1,74           ;COMPUTE JIFFIES PER MINUTE
   285	000052'	202040	013375'	02100	        MOVEM   R1,JIFFPM       ;SAVE JIFFIES PER MINUTE
   286	000053'	260740	015776'	02110	        PUSHJ P,NHDAT   ;GET TODAY'S DATE
   287	000054'	012000	022017'	02120	        TYPE [ASCIZ"$TITO (V"]
   288	000055'	200040	000137	02130	        MOVE    R1,VERLOC       ;GET VERSION NUMBER
   289	000056'	556040	013770'	02140	        HLRZM   R1,VERTMP#      ;SAVE PRIMARY VERSION NUMBER
   290	000057'	023000	022023'	02150	        ERT     [XWD [VERTMP],[ASCIZ "_H"]]
   291	000060'	552040	013770'	02160	        HRRZM   R1,VERTMP       ;SAVE MINOR CHANGE NUMBER
   292	000061'	332000	013770'	02170	        SKIPE   VERTMP          ;DON'T PRINT MINOR CHANGE IF ZERO
   293	000062'	023000	022025'	02180	        ERT     [XWD [VERTMP],[ASCIZ "._H"]]
   294	000063'	023000	022032'	02190	        ERT [XWD[DAYTIM#],[ASCIZ") HERE AT _L"]]
   295	000064'	260740	016011'	02200	        PUSHJ P,TPID    ;GET SYSTEM ID
   296	000065'	200000	022033'	02210	        MOVE R0,[XWD 712,TPID1-1]
   297	000066'	202000	021755'	02220	        MOVEM ID
   298	000067'	023000	022040'	02230	        ERT [XWD[ID],[ASCIZ"$SYSTEM _P"]]
   299	000070'	010000	022041'	02240	UNIROU:  TCO [CRCHR]
   300	000071'	012000	022042'	02250	        TYPE [ASCIZ "DEVICE: "]
   301	000072'	201040	000070'	02260	        MOVEI R1,UNIROU
   302	000073'	202040	013674'	02270	        MOVEM R1,UNISW          ;ERROR UUO JUMP INDIRECT THRU HERE
   303	000074'	202740	013675'	02280	        MOVEM P,ERRSTP
   304	000075'	260740	000000*	02290	        PUSHJ P,RDUNI##         ;READ UNIT NAME IN SIXBIT
   305	000076'	202000	016060'	02300	        MOVEM   FS6BIT          ;STORE DEVICE NAME
   306	000077'	260740	016022'	02310	        PUSHJ   P,SETIN         ;ASSIGN THE TAPE UNIT
   307	000100'	402000	021772'	02320	        SETZM SER
   308	000101'	260740	016734'	02330	        PUSHJ P,GDC             ;GET DEVICE CHARACTERISTICS
   309	000102'	260740	016726'	02340	        PUSHJ P,PTRK    ;PRINT NO. OF TRACKS
   310	000103'	200040	013667'	02350	        MOVE R1,TRK1
   311	000104'	202040	013666'	02360	        MOVEM R1,TRK
   312	000105'	476000	013664'	02370	        SETOM BPI1
   313	000106'	260740	016577'	02380	        PUSHJ P,FINDEV          ;FIND SLOT IN DEVTBL FOR FS6BIT
   314				02390	;                               SHOULD NOT SKIP
   315	000107'	260740	016653'	02400	SETB:   PUSHJ P,SETBPI          ;SET DENSITY
   316	000110'	254000	000117'	02410	        JRST SETC               ;ERROR
   317	000111'	331000	016776'	02420	        SKIPL SENTAB+1
   318				02430	        TYPE [ASCIZ"TAPE NOT WRITE PROTECTED
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-5
TAP.MAC	23-MAR-79 11:41	

   319	000112'	012000	022044'	02440	"]
   320	000113'	335000	016776'	02450	        SKIPGE SENTAB+1
   321				02460	        TYPE [ASCIZ"TAPE IS WRITE PROTECTED
   322	000114'	012000	022052'	02470	"]
   323	000115'	476000	013674'	02480	        SETOM   UNISW           ;UNIT PROPERLY ENTERED
   324	000116'	254000	000000*	02490	        JRST    SCDISP##        ;START UP THE COMMAND DISPATCHER
   325	000117'	260740	016777'	02500	SETC:   PUSHJ P,DDI
   326	000120'	254000	000107'	02510	        JRST SETB
   327
   328				02530	; BUFFERS AND VARIABLE STORAGE
   329
   330				02550	;I/O BUFFERS
   331
   332	000121'			02570	MFDBUF: BLOCK   MFDN*DSKSIZ     ;BUFFERS FOR MFD
   333	000527'			02580	UFDBUF: BLOCK   UFDN*DSKSIZ     ;BUFFERS FOR UFD
   334	001135'			02590	FILBUF::BLOCK   FILN*DSKSIZ     ;BUFFERS FOR USER FILE
   335	002762'			02600	TAPBUF: BLOCK   TAPN*TAPSIZ
   336	012221'			02610	LUDBUF: BLOCK   LUDN*DSKSIZ
   337	012424'			02620	DULBUF: BLOCK   DULN*DSKSIZ
   338
   339	012627'	000000	000017	02640	LUDTAB: XWD     0,17            ;DUMP MODE
   340	012630'	637163	000000	02650	        SIXBIT  /SYS/           ;DEVICE SYS
   341	012631'	000000	000000	02660	        0                       ;NO BUFFERS
   342
   343	012632'	546544	000000	02680	LOKLUD: SIXBIT  /LUD/           ;FILE NAME
   344	012633'	637163	000000	02690	        SIXBIT  /SYS/           ;EXTENSION
   345	012634'	000000	000000	02700	        0
   346	012635'	000000	000000	02710	        0
   347
   348	012636'	000000	000000	02730	        0
   349	012637'	777600	012640'	02740	LUDLST: IOWD    200,LUDBLK      ;BUFFER
   350	012640'	000000	000000	02750	        0
   351	012641'			02760	LUDBLK: BLOCK   200
   352	013041'	777777	777777	02770	LUDL::  -1                      ;BLOCK NO. IN LUD (SEE USRPPN)
   353
   354	013042'	000000	000017	02790	DULTAB: XWD     0,17            ;DUMP MODE
   355	013043'	637163	000000	02800	        SIXBIT  /SYS/           ;DEVICE SYS
   356	013044'	000000	000000	02810	        0                       ;NO BUFFERS
   357
   358	013045'	446554	000000	02830	LOKDUL: SIXBIT  /DUL/           ;FILE NAME
   359	013046'	637163	000000	02840	        SIXBIT  /SYS/           ;EXTENSION
   360	013047'	000000	000000	02850	        0
   361	013050'	000000	000000	02860	        0
   362
   363	013051'	000000	000000	02880	        0
   364	013052'	777600	013053'	02890	DULLST: IOWD    200,DULBLK      ;BUFFER
   365	013053'	000000	000000	02900	        0
   366	013054'			02910	DULBLK: BLOCK   200
   367	013254'	777777	777777	02920	DULL::  -1                      ;BLOCK NO. IN DUL (SEE PPNUSR)
   368
   369				02940	;BUFFER HEADERS
   370
   371	013255'			02960	TAPHED::BLOCK   3               ;MAGTAP INPUT OR OUTPUT BUFFER HEADER**2
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-6
TAP.MAC	23-MAR-79 11:41	

   372			013256'	02970	TAPHD1= TAPHED+1
   373			013257'	02980	TAPHD2= TAPHED+2 
   374
   375	013260'			03000	MFDHED: BLOCK   3               ;DISK MFD BUFFER HEADER**2
   376			013261'	03010	MFDHD1= MFDHED+1
   377			013262'	03020	MFDHD2= MFDHED+2
   378
   379	013263'			03040	UFDHED: BLOCK   3               ;DISK UFD BUFFER HEADER**2
   380			013264'	03050	UFDHD1= UFDHED+1
   381			013265'	03060	UFDHD2= UFDHED+2
   382
   383	013266'			03080	FILHED::BLOCK   3               ;DISK USER FILE BUFFER HEADER**2
   384			013267'	03090	FILHD1==:FILHED+1
   385			013270'	03100	FILHD2==:FILHED+2
   386
   387	013271'			03120	COFHED::BLOCK   3               ;OUTPUT FILE
   388			013272'	03130	COFHD1=:COFHED+1
   389			013273'	03140	COFHD2=:COFHED+2
   390
   391	013274'			03160	LUDHED: BLOCK   3               ;LOCAL USER DIRECTORY HEADER
   392	013277'			03170	DULHED: BLOCK   3               ;INVERSE LUD HEADER
   393
   394				03190	;MTA HEADER BLOCK
   395	013302'	000015	000004	03200	FIRBLK: XWD     VERSION,4       ;WD0=XWD HEADER FLAG,BLK WDCT
   396	013303'	124641	515463	03210	        SIXBIT  /*FAILS/        ;WD1
   397	013304'	414645	000000	03220	FIRBL2: SIXBIT  /AFE   /        ;WD2=XWD SIXBIT "AFE",TAPE SEQ#
   398				03230	                                ;NEGATIVE TAPE SEQ# MEANS TRAILER
   399	013305'	000000	000000	03240	FIRBL3: EXP     0               ;WD3=TAPCTD BIT (B0), USRCTD BIT (B1)
   400				03250	                                ;    FILCTD BIT (B2)
   401				03260	                                ;    CRTIME (B11-21), CRDATE (B22-35)
   402	013306'	000001	000002	03270	        XWD     1,2             ;WD4=TITO PROJ,PROG #
   403
   404	013307'	000001	000001	03290	SYSPP:  XWD     1,1
   405
   406	013310'	000000	000000	03310	STRPPN::0                       ;STARTING PPN
   407	013311'	000000	000000	03320	STRFIL::0                       ;STARTING FILE
   408	013312'	000000	000000	03330	STREXT::0                       ;STARTING EXTENSION
   409	013313'	000000	000000	03340	STRBLK::0                       ;STARTING BLOCK
   410	013314'			03350	STRUSR: BLOCK   2               ;STARTING USER NAME
   411
   412				03370	; CURRENT AND LAST FILE.  SEE TRCL.
   413
   414	013316'	000000	000000	03390	CURPPN::0                       ;CURRENT PPN
   415	013317'	000000	000000	03400	CURFIL: 0                       ;CURRENT FILE NAME
   416	013320'	000000	000000	03410	CUREXT: 0                       ;CURRENT EXTENSION
   417	013321'	000000	000000	03420	CURPOS: 0       ;FILE NO. ON TAPE
   418	013322'	000000	000000	03430	CURUN1::0       ;FIRST HALF OF USER NAME
   419	013323'	000000	000000	03440	CURUN2::0       ;SECOND HALF OF USER NAME
   420	013324'	000000	000000	03450	CURTRK: 0       ;TRACKS AND DENSITY
   421	013325'	000000	000000	03460	CURVER::0       ;TITO VERSION NO.
   422	013326'	000000	000000	03470	CURDAT: 0       ;TIME-DATE WRITTEN
   423	013327'	000000	000000	03480	CURSER: 0       ;TAPE UNIT SERIAL NO.
   424	013330'	000000	000000	03490	CURNUM: 0       ;SAVE SET REEL NO.
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-7
TAP.MAC	23-MAR-79 11:41	

   425	013331'	000000	000000	03500	DATTIM: 0       ;CURDAT BACKWARDS FOR COMPARISON
   426
   427	013332'	000000	000000	03520	LSTPPN::0                       ;LAST PPN
   428	013333'	000000	000000	03530	LSTFIL: 0                       ;LAST FILE
   429	013334'	000000	000000	03540	LSTEXT: 0                       ;LAST EXTENSION
   430	013335'	000000	000000	03550	LSTPOS: 0
   431	013336'	000000	000000	03560	LSTUN1::0
   432	013337'	000000	000000	03570	LSTUN2::0
   433	013340'	000000	000000	03580	LSTTRK: 0
   434	013341'	000000	000000	03590	LSTVER::0
   435	013342'	000000	000000	03600	LSTDAT: 0
   436	013343'	000000	000000	03610	LSTSER: 0
   437	013344'	000000	000000	03620	LSTNUM: 0
   438	013345'	000000	000000	03630	LSTTIM: 0
   439
   440	013346'			03650	CUTPPN: BLOCK 14
   441			013361'	03660	CUTTIM==CUTPPN+13
   442	013362'	000000	000000	03670	UFDBLK: 0                       ;FUNCTION FOR UFD INTERLOCK
   443	013363'	000000	000000	03680	UFDBL1: 0                       ;STRUCTURE FOR UFD INTERLOCK
   444	013364'	000000	000000	03690	UFDBL2: 0                       ;PPN FOR UFD INTERLOCK
   445
   446	013365'	000000	000000	03710	CNVDAT::0                       ;CREATION DATE - DAYS SINCE 1964
   447	013366'	000000	000000	03720	CNVTIM::0                       ;CREATION TIME - SECONDS LSH 12 (JIFFIES?)
   448	013367'	000000	000000	03730	CNVFMT::0                       ;CONVERSION FORMAT FOR DATUUO
   449	013370'	000000	000000	03740	CREDAT::0                       ;CREATION DATE FOR ST CRE AFTER
   450	013371'	000000	000000	03750	CRETIM::0                       ;CREATION TIME FOR ST CRE AFTER
   451	013372'	000000	000000	03760	CRTION: 0                       ;CREATION DATE AND TIME FROM UFD
   452	013373'	000000	000000	03770	CHANGD::0                       ;NON-ZERO IF CHECKING FOR CHANGED FILES
   453	013374'	000000	000000	03780	JIFFPS::0                       ;JIFFIES PER SECOND (US=60, EUROPE=50)
   454	013375'	000000	000000	03790	JIFFPM::0                       ;JIFFIES PER MINUTE
   455	013376'	000000	000000	03800	FILCNT::0                       ;NUMBER OF FILES TRANSFERED FOR THIS USER
   456	013377'	000000	000000	03810	TOTCNT::0                       ;NUMBER OF FILES TRANSFERED FOR THIS SAVE SET
   457	013400'			03820	CKLICT: BLOCK   3               ;TABLE FOR CHKLIC UUO
   458
   459				03840	;LOOKUP & ENTER SPECS
   460				03850	                                ;EXT LOOKUP     -    OLD LOOKUP
   461	013403'	000000	000000	03860	MFDDIR: 0                       ;0,XLOOKN       -     FILNAM
   462	013404'	000000	000000	03870	MFDDI1: 0                       ;PPN            -     EXT.,ACC.DAT.
   463	013405'	000000	000000	03880	        0                       ;FILNAM         -     PROT,MODE,CREAT
   464	013406'	000000	000000	03890	MFDDI3: 0                       ;EXT.,ACC.DAT.   -    PPN
   465	013407'	000000	000000	03900	        0                       ;PROT,MODE,CREAT
   466	013410'			03910	        BLOCK   1+XLOOKN+MFDDIR-.
   467
   468	013450'	000000	000000	03930	UFDDIR: 0                       ;0,XLOOKN       -     FILNAM
   469	013451'	000000	000000	03940	UFDDI1: 0                       ;PPN            -     EXT.,ACC.DAT.
   470	013452'	000000	000000	03950	UFDDI2: 0                       ;FILNAM         -     PROT,MODE,CREAT
   471	013453'	000000	000000	03960	UFDDI3: 0                       ;EXT.,ACC.DAT.   -    PPN
   472	013454'	000000	000000	03970	UFDDI4: 0                       ;PROT,MODE,CREAT
   473	013455'	000000	000000	03980	URBSIZ: 0
   474	013456'			03990	        BLOCK   2               ;--NEVER TOUCH--
   475	013460'	000000	000000	04000	URBEST: 0
   476	013461'	000000	000000	04010	URBALC: 0
   477	013462'	000000	000000	04020	URBPOS: 0                       ;--CLR BEFORE RESTORE--
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-8
TAP.MAC	23-MAR-79 11:41	

   478	013463'	000000	000000	04030	URBNXT: 0                       ;   "    "       "
   479	013464'	000000	000000	04040	URBPRD: 0                       ;   "    "       "
   480	013465'			04050	        BLOCK   2
   481	013467'	000000	000000	04052	URBSTS:	0			;FILE STATUS WORD
   482	013470'			04054		BLOCK	5
   483	013475'			04060	URBCSZ: BLOCK   1               ;CURRENT SIZE
   484	013476'			04070	        BLOCK   1+XLOOKN+UFDDIR-. ;---NEVER TOUCH ON SAVE OR RESTORE--
   485
   486
   487				04100	; FILE HEADER BLOCK, LENGTH XHDRN+1
   488
   489	013515'	777777	000100	04120	FILMRK: XWD     -1,XHDRN        ;RH CONTAINS COUNT OF WORDS BELOW
   490	013516'	446353	000000	04130	FILDM1: SIXBIT  /DSK/   ;CURRENT FILE STRUCTURE (MUST PRECEDE FILDIR)
   491	013517'	000000	000000	04140	FILDIR::0                       ;0,XLOOKN       -     FILNAM
   492	013520'	000000	000000	04150	FILDI1::0                       ;PPN            -     EXT.,ACC.DAT.
   493	013521'	000000	000000	04160	FILDI2::0                       ;FILNAM         -     PROT,MODE,CREAT
   494	013522'	000000	000000	04170	FILDI3::0                       ;EXT.,ACC.DAT.   -    PPN
   495	013523'	000000	000000	04180	FILDI4: 0                       ;PROT,MODE,CREAT
   496	013524'	000000	000000	04190	FRBSIZ: 0                       ;FILE SIZE IN WORDS
   497	013525'			04200	        BLOCK   2               ;--NEVER TOUCH--
   498	013527'	000000	000000	04210	FRBEST: 0                       ;ESTIMATED SIZE OF FILE
   499	013530'	000000	000000	04220	FRBALC: 0                       ;# OF BLKS NEEDED
   500	013531'	000000	000000	04230	FRBPOS: 0                       ;--CLR BEFORE RESTORE--
   501	013532'	000000	000000	04240	FRBNXT: 0                       ;   "    "       "
   502	013533'	000000	000000	04250	FRBNCA: 0                       ;   "    "       " (DUMPED BIT)/LICENSE
   503	013534'	000000	000000	04260	        0                       ;
   504	013535'	000000	000000	04270	        0
   505	013536'	000000	000000	04280	FRBSTS: 0                       ;FILE STATUS WORD
   506	013537'			04290	        BLOCK XHDRN-8+FILDM1-.
   507	013606'	000000	000000	04300	TPUN1: 0        ;USER NAME (SIXBIT) FIRST HALF
   508	013607'	000000	000000	04310	TPUN2: 0        ;USER NAME (SIXBIT) SECOND HALF
   509	013610'	000000	000000	04320	TPID1: 0        ;SYSTEM NAME IN ASCII WORD 1
   510	013611'	000000	000000	04330	TPID2: 0        ;SYSTEM NAME IN ASCII WORD 2
   511	013612'	000000	000000	04340	TPDEN::0        ;LH IS TAPE DENSITY, RH IS NO. OF TRACKS
   512	013613'	000000	000000	04350	TPSER: 0        ;LH IS CUSTOMER TAPE NO., RH IS TAPE DRIVE SERIAL NO.
   513	013614'	000000	000000	04360	TPTIM: 0        ;TIME IN BITS 11-21, DATE IN BITS 22-35 TAPE WRITTEN
   514	013615'	000000	000000	04370	TPPOS: 0        ;LH IS TAPE SEQUENCE NO., RH IS FILE NO. ON TAPE
   515	013616'			04380	SAVBUF: BLOCK   XLOOKN+1
   516			013623'	04390	TRBSIZ= SAVBUF+5        ;TAPE FILE WORD COUNT
   517				04400	;MISCELLANEOUS DATA
   518
   519	013663'	000000	000000	04420	CKSUM:: 0       ;FOLDED CHECKSUM OF FILE BEING PROCESSED
   520	013664'	000000	000000	04430	BPI1::  0       ;DESIRED DENSITY BPI
   521	013665'	000000	000000	04440	BPI:    0       ;ACTUAL DENSITY
   522	013666'	000000	000000	04450	TRK:    0       ;ACTUAL NO. OF TRACKS
   523	013667'	000000	000000	04460	TRK1:   0       ;DESIRED NO. OF TRACKS
   524	013670'	000000	000000	04470	TPSZM2: 0       ;TAPE RECORD SIZE - 2
   525	013671'	000000	000000	04480	TPSZM3: 0       ;TAPE RECORD SIZE -3
   526	013672'	000000	000000	04490	TPSZM4: 0       ;TAPE RECORD SIZE -4
   527	013673'	000000	000000	04500	ESCDI:: 0       ;NEG. IF ESCAPE TRAP DISABLED (SEE NXTTAP)
   528	013674'	000000	000000	04510	UNISW:: 0       ;NEG. IF STILL IN UNIROU
   529	013675'	000000	000000	04520	ERRSTP:: 0      ;SAVED STACK PTR FOR ERRUUO WHEN UNISW SET
   530	013676'	000000	000000	04530	STO23:   0      ;PTR TO COMMAND LIST FOR INDIVIDUAL FILES OR USERS
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-9
TAP.MAC	23-MAR-79 11:41	

   531	013677'	000000	000000	04540	CSTATE: 0       ;COMMAND STATE 0=ALL,1=GANS,2=USERS,3=FILES
   532	013700'	000000	000000	04550	RPTCNT:: 0      ;REPEAT COUNT FOR STORE
   533	013701'	000000	000000	04560	SCOUNT:: 0      ;COUNT OF FILES STORED
   534	013702'	000000	000000	04570	RCOUNT:: 0      ;COUNT OF FILES RESTORED
   535	013703'	000000	000000	04580	UCOUNT: 0       ;COUNT OF UFD'S SET UP
   536	013704'	000000	000000	04590	CPPN:: 0        ;LAST PPN REFERENCED IN COMMAND DISPATCHER.  SEE FINGAN.
   537	013705'	000000	000000	04600	PPN:: 0         ;PPN OF USER TO RECEIVE FILES WHEN USING TRANSLATE OPTION
   538	013706'	000000	000000	04610	ERC:    0       ;EXCESSIVE RECORD COUNT
   539	013707'	000000	000000	04620	UPDMOD: 0       ;UPDATE MODE IF NON-ZERO
   540	013710'	000000	000000	04630	SEXT:   0       ;SAVED FILE EXT
   541	013711'	000000	000000	04640	ORBALC: 0       ;FORMER RIB ALLOCATION
   542	013712'	000000	000000	04650	ORBSIZ: 0       ;FORMER RBSIZ
   543	013713'	000000	000000	04660	TAPCNT: 0       ;EXPECTED TAPE WORD COUNT+1
   544	013714'	000000	000000	04670	WDCNT:  0       ;NO. DATA WORDS WRITTEN TO FILE
   545	013715'	000000	000000	04680	TRBALC: 0       ;TAPE FILE SIZE ALLOCATION, BLOCKS
   546	013716'	000000	000000	04690	FILCOD: 0       ;ERROR BITS ON DATA TRANSMISSION ERROR
   547	013717'	000000	000000	04700	FILPOS: 0       ;USED BY TRUNCATE
   548	013720'	000000	000000	04710	SAVHED: 0       ;USED BY TRUNCATE
   549	013721'	000000	000000	04720	SAVBYT: 0       ;USED BY TRUNCATE
   550	013722'	000000	000000	04730	CREDSC: 0       ;CREATION DATE SAVED BY GCREDAT
   551	013723'	000000	000000	04740	SAVDI4: 0       ;  "  "
   552	013724'	000000	000000	04750	ERCODE: 0       ;ERROR CODE FROM EXTENDED LOOKUP,ENTER, OR RENAME
   553	013725'	000000	000000	04760	EXTPPN:	0	;EITHER CURRENT PPN OR LOGGED-IN PPN
   554	013726'	000000	000000	04770	EXTFIL:	0
   555	013727'	000000	000000	04780	EXTEXT:	0
   556	013730'	000000	000000	04790	UPDFLG:: 0
   557	013731'	000000	000000	04800	PRAFLG:: 0
   558	013732'	000000	000000	04810	FLGOFF:: 0      ;MARK FILES NOT CHANGED IF UNEQUAL ZERO
   559	013733'	000000	000000	04815	ALLFSW:: 0	;"ALL FILES" SWITCH.
   560
   561	013734'	000000	000014	04830	MFDSPK: BUFBIN
   562	013735'	446353	000000	04840	        SIXBIT  /DSK/           ;MUST BE MFDSPK+1
   563	013736'	000000	000000	04850	IOBUF:  0                       ;OBUF,IBUF FOR MFD - MUST BE MFDSPK+2
   564
   565				04870	; CHANIO ARGLIST AND BUFFERS
   566	013737'	777776	013747'	04880	MFDARG: -2,,MFDTAB
   567	013740'	030303	030303	04890	        SIXBIT /######/
   568	013741'	654644	000000	04900	        SIXBIT /UFD   /
   569	013742'	000000	000000	04910	        0
   570	013743'			04920	MFDMON: BLOCK 4 ;WRITTEN BY MONITOR
   571	013747'	000000	000000	04930	MFDTAB: 0       ;PPN
   572	013750'	000000	000000	04940	        0       ;EXTENSION
   573
   574	013751'	777774	013761'	04960	UFDARG: -4,,UFDTAB
   575	013752'	030303	030303	04970	        SIXBIT /######/
   576	013753'	030303	000000	04980	        SIXBIT /###   /
   577	013754'	060000	000000	04990	        RCD!RSB,,0
   578	013755'			05000	UFDMON: BLOCK 4 ;WRITTEN BY MONITOR
   579	013761'	000000	000000	05010	UFDTAB: 0       ;FILENAME
   580	013762'	000000	000000	05020	        0       ;EXT
   581	013763'	000000	000000	05030	UFDCRE: 0       ;CREATION DATE
   582	013764'	000000	000000	05040	UFDBTS: 0       ;STATUS BITS
   583	013765'			05050	        VAR
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-10
TAP.MAC	23-MAR-79 11:41	

   584
   585
   586				05080	; TABLE OF MAGTAPE INSTRUCTIONS TO XCT INDEXED BY UNIT
   587	013771'	072500	000000	05090	MF0:    MTAPE TP0,0     ;WAIT FOR COMPLETION
   588	013772'	072540	000000	05100	        MTAPE TP1,0     ;WAIT FOR COMPLETION
   589	013773'	072500	000001	05110	MF1:    MTAPE TP0,1     ;REWIND WITHOUT WAIT
   590	013774'	072540	000001	05120	        MTAPE TP1,1
   591	013775'	072500	000007	05130	MF7:    MTAPE TP0,7     ;BACKSPACE RECORD
   592	013776'	072540	000007	05140	        MTAPE TP1,7
   593	013777'	072500	000011	05150	MF11:   MTAPE TP0,11    ;UNLOAD WITHOUT WAIT
   594	014000'	072540	000011	05160	        MTAPE TP1,11
   595	014001'	072500	000013	05170	MF13:   MTAPE TP0,13    ;ERASE 3 INCH GAP
   596	014002'	072540	000013	05180	        MTAPE TP1,13
   597	014003'	072500	000017	05190	MF17:   MTAPE TP0,17    ;BACKSPACE FILE
   598	014004'	072540	000017	05200	        MTAPE TP1,17
   599	014005'	057500	000000	05210	MOUT:   OUT TP0,        ;WRITE TAPE
   600	014006'	057540	000000	05220	        OUT TP1,
   601	014007'	067500	000000	05230	MOUTPUT: OUTPUT TP0,    ;WRITE TAPE
   602	014010'	067540	000000	05240	        OUTPUT TP1,
   603	014011'	056500	000000	05250	MIN:    IN TP0,         ;READ TAPE
   604	014012'	056540	000000	05260	        IN TP1,
   605	014013'	066500	000000	05270	MINPUT: INPUT TP0,      ;READ TAPE
   606	014014'	066540	000000	05280	        INPUT TP1,
   607	014015'	071500	000000	05290	MRELS:  RELEASE TP0,    ;RELEASE TAPE
   608	014016'	071540	000000	05300	        RELEASE TP1,
   609	014017'	070500	000000	05310	MCLOS:: CLOSE TP0,      ;CLOSE TAPE
   610	014020'	070540	000000	05320	        CLOSE TP1,
   611	014021'	050500	016057'	05330	MOPEN:  OPEN TP0,TAPOPN ;OPEN TAPE
   612	014022'	050540	016057'	05340	        OPEN TP1,TAPOPN
   613	014023'	201040	000012	05350	MCHNL1: MOVEI R1,TP0    ;LOAD CHANNEL NO. INTO R1
   614	014024'	201040	000013	05360	        MOVEI R1,TP1
   615	014025'	073500	016775'	05370	MUGETF: UGETF TP0,SENTAB ;GET DEVICE CHARACTERISTICS
   616	014026'	073540	016775'	05380	        UGETF TP1,SENTAB
   617	014027'	062500	000001	05390	MGET1:  GETSTS TP0,R1   ;LOAD CHANNEL STATUS INTO R1
   618	014030'	062540	000001	05400	        GETSTS TP1,R1
   619	014031'	062500	000002	05410	MGET2:  GETSTS TP0,R2   ;LOAD CHANNEL STATUS INTO R2
   620	014032'	062540	000002	05420	        GETSTS TP1,R2
   621	014033'	060501	000000	05430	MSET1:  SETSTS TP0,(R1) ;SET CHANNEL STATUS FROM R1
   622	014034'	060541	000000	05440	        SETSTS TP1,(R1) 
   623	014035'	060502	000000	05450	MSET2:  SETSTS TP0,(R2) ;SET CHANNEL STATUS FROM R2
   624	014036'	060542	000000	05460	        SETSTS TP1,(R2)
   625	014037'	063500	200000	05470	MSTPDE: STATZ TP0,200000        ;PHYSICAL DEVICE ERROR
   626	014040'	063540	200000	05480	        STATZ TP1,200000
   627	014041'	063500	400000	05490	MSTWRL: STATZ TP0,400000        ;WRITE LOCKED TAPE
   628	014042'	063540	400000	05500	        STATZ TP1,400000
   629	014043'	061500	002000	05510	MSTEOT: STATO TP0,IOTEND        ;TEST END OF TAPE
   630	014044'	061540	002000	05520	        STATO TP1,IOTEND
   631	014045'	063500	740000	05530	MSTERR: STATZ TP0,740000        ;TEST WRITE ERROR
   632	014046'	063540	740000	05540	        STATZ TP1,740000
   633	014047'	061500	760000	05550	MSTALL: STATO TP0,760000        ;TEST ALL ERROR BITS
   634	014050'	061540	760000	05560	        STATO TP1,760000
   635	014051'	061500	020000	05570	MSTOEND: STATO TP0,IOEND        ;END OF FILE
   636	014052'	061540	020000	05580	        STATO TP1,IOEND
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-11
TAP.MAC	23-MAR-79 11:41	

   637	014053'	047500	000010	05590	MTWAIT: CALLI TP0,WAIT          ;WAIT FOR I/O TO STOP
   638	014054'	047540	000010	05600	        CALLI TP1,WAIT
   639
   640
   641	014055'	260740	000000*	05630	STOROU::PUSHJ P,CRLS##          ;CLOSE NAMES FILE IF OPEN
   642	014056'	602400	004000	05640	        TRNE F,RANCMD
   643	014057'	015000	022060'	05650	        ERROR [ASCIZ"COMMAND ERROR--RANGE NOT NEEDED"]
   644	014060'	602400	020000	05660	        TRNE F,TRTFG2
   645	014061'	015000	022067'	05670	        ERROR [ASCIZ"COMMAND ERROR--TRANSLATE MEANINGLESS FOR STORE"]
   646	014062'	336000	013310'	05680	        SKIPN STRPPN           ;SKIP IF CONTINUED FILE
   647	014063'	603400	002000	05690	        TLNE    F,INIFLG        ;SKIP IF TAPE NOT INITIALIZED
   648	014064'	254000	014066'	05700	        JRST    .+2
   649	014065'	015000	022101'	05710	        ERROR   [ASCIZ"TAPE NOT INITIALIZED."]
   650	014066'	202740	021774'	05720	        MOVEM   P,STOSTP#       ;SAVE STACK POINTER
   651	014067'	621400	021000	05730	        TLZ F,DIRFLG+CUTFLG     ;NOT DIR OR CUT
   652	014070'	661400	000400	05740	        TLO     F,STOFLG        ;THIS IS A STORE AND NOT A RESTORE
   653	014071'	332040	013310'	05750	        SKIPE   R1,STRPPN       ;SKIP IF NO STARTING PPN
   654	014072'	012000	022106'	05760	        TYPE    [ASCIZ "REEL NUMBER: "]
   655	014073'	402000	013701'	05770	        SETZM   SCOUNT          ;ZERO COUNT OF FILES STORED
   656	014074'	402000	013376'	05780	        SETZM   FILCNT          ;TOTAL FILES THIS USER
   657	014075'	402000	022001'	05790	        SETZM   TAPNUM          ;STARTING REEL IS ONE IF NO STARTING PPN
   658	014076'	322040	014104'	05800	        JUMPE   R1,CONSTO       ;JUMP IF NO STARTING PPN
   659	014077'	260740	000000*	05810	        PUSHJ   P,RDDNUM##      ;READ DECIMAL NUMBER
   660	014100'	302340	000012	05820	        CAIE    CT,TE           ;SKIP IF NUMBER TERMINATED BY A CR
   661	014101'	015000	022111'	05830	        ERROR   [ASCIZ "INVALID REEL NUMBER"]
   662	014102'	360000	000000	05840	        SOJ     R0,             ;DECREMENT REEL NUMBER
   663	014103'	202000	022001'	05850	        MOVEM   R0,TAPNUM#      ;INITIALIZE THE TAPE SEQ NUMBER
   664	014104'	402000	014241'	05860	CONSTO: SETZM   USRPTR          ;MARK AS NOTHING IN SORT TABLE
   665	014105'	402000	014240'	05870	        SETZM   USRGPT          ;INITIALIZE POINTER FOR GETTING ENTRIES
   666	014106'	201040	000003	05880	        MOVEI   R1,3            ;NO. OF RECORDS WHICH CAN BE WRITTEN
   667	014107'	202040	013706'	05890	        MOVEM   R1,ERC          ;PAST EOT MARKER (EXCESS RECORD COUNT)
   668	014110'	202040	013517'	05900	        MOVEM   R1,FILDIR       ;SET UP FILDIR FOR CKTY3
   669	014111'	402000	013676'	05910	        SETZM   STO23           ;INITIALIZE STO23 PTR.
   670	014112'	201040	000002	05920	        MOVEI   R1,2
   671	014113'	200041	000000*	05930	        MOVE    R1,CTABL2(R1)   ;FETCH COMMAND STATE
   672	014114'	556040	013677'	05940	        HLRZM   R1,CSTATE       ;SAVE STATE
   673	014115'	317040	022115'	05950	        CAMG    R1,[1,,777777]
   674	014116'	254000	014175'	05960	        JRST    STAT01          ;STATE 0 OR 1
   675	014117'	552040	013676'	05970	        HRRZM   R1,STO23        ;PTR. TO FIRST ITEM ON COMMAND LIST
   676	014120'	317040	022116'	05980	        CAMG    R1,[2,,777777]
   677	014121'	254000	014175'	05990	        JRST    STAT02          ;USERS
   678	014122'	135100	022117'	06000	        LDB     R2,[XWD CNTFP+R1,0]
   679	014123'	302100	000002	06010	        CAIE    R2,CNTFT        ;LOOK FOR CR TERMINATOR ON PPN
   680	014124'	344040	014122'	06020	        AOJA    R1,.-2
   681	014125'	550641	000000	06030	        HRRZ   U,(R1)          ;FETCH UUN
   682	014126'	260740	021610'	06040	        PUSHJ   P,FINGAN        ;GET GAN FOR THIS UUN FROM LUD
   683	014127'	202640	013520'	06050	        MOVEM   U,FILDI1
   684	014130'	041300	000014	06060	        INIT    FIL,BUFBIN
   685	014131'	446353	000000	06070	        SIXBIT  /DSK/
   686	014132'	000000	000000	06080	        XWD     0,0
   687	014133'	015000	022120'	06090	        ERROR   [ASCIZ "DISC NOT AVAILABLE."]
   688	014134'	201140	000011	06100	CKTY3:  MOVEI   R3,11
   689	014135'	202140	022003'	06110	        MOVEM   R3,TMP#         ;COUNT OF CHARS TO EXAMINE
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-12
TAP.MAC	23-MAR-79 11:41	

   690	014136'	514141	000002	06120	        HRLZ    R3,2(R1)        ;FETCH EXTENSION (RH OF COMMAND WD)
   691	014137'	204101	000001	06130	        MOVS    R2,1(R1)        ;FETCH FILENAME BACKWARDS
   692	014140'	306100	415454	06140	        CAIN    R2,(SIXBIT/ALL/)
   693	014141'	254000	014174'	06150	        JRST CKTY3C             ;LIST ENDS WITH "ALL"
   694	014142'	204100	000002	06160	        MOVS    R2,R2           ;FILENAME FORWARDS
   695	014143'	202100	013521'	06170	        MOVEM   R2,FILDI2
   696	014144'	202140	013522'	06180	        MOVEM   R3,FILDI3
   697	014145'	430100	022124'	06190	CKTY3B: XOR     R2,[SIXBIT /#/]
   698	014146'	607100	770000	06200	        TLNN    R2,770000
   699	014147'	254000	014170'	06210	        JRST    CKTY3A          ;BYPASS FILE WITH WILD CARD
   700	014150'	430100	022125'	06220	        XOR     R2,[BYTE (6)34] ;XOR OF "#" AND "?"
   701	014151'	607100	770000	06230	        TLNN    R2,770000
   702	014152'	254000	014170'	06240	        JRST    CKTY3A          ;FOUND QM
   703	014153'	430100	022126'	06250	        XOR     R2,[BYTE (6)25] ;XOR OF "?" AND "*"
   704	014154'	607100	770000	06260	        TLNN    R2,770000
   705	014155'	254000	014170'	06270	        JRST    CKTY3A          ;FOUND ASTERISK
   706	014156'	246100	000006	06280	        LSHC    R2,6
   707	014157'	372000	022003'	06290	        SOSE    TMP
   708	014160'	254000	014145'	06300	        JRST    CKTY3B
   709	014161'	076300	013517'	06310	        LOOKUP  FIL,FILDIR      ;TRY TO FIND FILE
   710	014162'	254000	014165'	06320	        JRST    .+3
   711	014163'	070300	000010	06330	        CLOSE   FIL,DNC
   712	014164'	254000	014170'	06340	        JRST    CKTY3A          ;VALIDATE NEXT FILE
   713	014165'	023000	022134'	06350	        ERT [XWD[FILDI1],[ASCIZ"$NO SUCH FILE: _J$"]]
   714	014166'	071300	000000	06360	        RELEASE FIL,
   715	014167'	254000	000000*	06370	        JRST    CLDSP
   716	014170'	350000	000001	06380	CKTY3A: AOS     R1
   717	014171'	135100	022135'	06390	        LDB     R2,[XWD CNTFP+R1,1]
   718	014172'	302100	000002	06400	        CAIE    R2,CNTFT        ;CHECK FOR TERMINATOR
   719	014173'	344040	014134'	06410	        AOJA    R1,CKTY3        ;MORE TO EXAMINE
   720	014174'	071300	000000	06420	CKTY3C: RELEASE FIL,
   721	014175'			06430	STAT01:
   722	014175'	621400	200000	06440	STAT02: TLZ F,PRPFLG    ;SAVESET HEADER NOT YET CREATED
   723	014176'	260740	015015'	06450	MORE1:  PUSHJ   P,MFD2          ;GET ENTRY FROM MFD - SKIP IF NOT DONE
   724	014177'	254000	014223'	06460	        JRST    MORE4           ;DONE WITH SAVE SET
   725	014200'	260740	015103'	06470	MORE2:  PUSHJ   P,UFD2          ;GET ENTRY FROM UFD - SKIP IF NOT DONE
   726	014201'	254000	014176'	06480	        JRST    MORE1           ;DONE WITH THIS UFD
   727	014202'	336000	013313'	06490	        SKIPN STRBLK    ;DON'T ZERO FOR CONTINUED FILE
   728	014203'	402000	013663'	06500	        SETZM CKSUM
   729	014204'	260740	015715'	06510	        PUSHJ   P,DIRBLT        ;BLT DIRECTORY INTO TAPE BUFFER
   730	014205'	373000	013270'	06520	MORE3:  SOSLE   FILHD2          ;GET A WORD FROM USER FILE
   731	014206'	254000	014211'	06530	        JRST    .+3             ;NOT OUT OF WORDS
   732	014207'	260740	015247'	06540	        PUSHJ   P,FILIN         ;INPUT A BUFFER - SKIP IF NOT END OF FILE
   733	014210'	254000	014200'	06550	        JRST    MORE2           ;DONE WITH THIS FILE SO GET NEXT
   734	014211'	377000	013257'	06560	        SOSG    TAPHD2          ;STASH IT AWAY ON TAPE
   735	014212'	260740	015351'	06570	        PUSHJ   P,TAPOUT
   736	014213'	134040	013267'	06580	        ILDB    R1,FILHD1       ;GET NEXT WORD FROM DISC FILE
   737	014214'	136040	013256'	06590	        IDPB    R1,TAPHD1       ;PUT NEXT WORD IN TAPE BUFFER
   738	014215'	200000	013663'	06600	        MOVE CKSUM
   739	014216'	241000	000007	06610	        ROT R0,7
   740	014217'	430000	000001	06620	        XOR R0,R1
   741	014220'	271000	000001	06630	        ADDI R0,1
   742	014221'	202000	013663'	06640	        MOVEM CKSUM
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-13
TAP.MAC	23-MAR-79 11:41	

   743	014222'	254000	014205'	06650	        JRST    MORE3           ;CONTINUE FILLING BUFFER
   744	014223'	603400	040000	06660	MORE4:  TLNE    F,RPTFLG        ;TEST REPEAT FLAG
   745	014224'	377000	013700'	06670	        SOSG    RPTCNT          ;DECREMENT COUNT IF SET
   746	014225'	254000	000000*	06680	        JRST    CDISP##         ;REALLY DONE
   747	014226'	402000	013310'	06690	        SETZM   STRPPN
   748	014227'	402000	013311'	06700	        SETZM   STRFIL
   749	014230'	402000	013313'	06710	        SETZM   STRBLK
   750	014231'	402000	013316'	06720	        SETZM   CURPPN
   751	014232'	402000	013376'	06730	        SETZM   FILCNT
   752	014233'	402000	013377'	06740	        SETZM   TOTCNT
   753	014234'	254000	014055'	06750	        JRST    STOROU          ;HAVE ANOTHER GO AT IT
   754
   755				06770	;                               ^OVERFLOW
   756				06780	;USRTAB:                Z
   757				06790	;USRPTR:
   758				06800	;               ^ USRSRS
   759				06810	;               ^ USRSRE
   760				06820	;USRGPT:
   761				06830	;USRTBE:                A
   762
   763	014235'			06850	TMPUSR: BLOCK   2               ;USER NAME OF USER JUST READ FROM MFD
   764	014237'			06860	TMPPPN: BLOCK   1               ;PPN OF USER JUST READ FROM MFD
   765
   766			000100	06880	USRSC== 100                     ;NUMBER OF USERS TO SORT AT A TIME
   767
   768	014240'	000000	000000	06900	USRGPT: 0                       ;POINTER USED TO GET ENTRIES FROM TABLE
   769	014241'	000000	000000	06910	USRPTR: 0                       ;POINTER TO VARIABLE END OF SORT TABLE
   770	014242'	000000	000000	06920	USRSRS: 0                       ;STARTING RANGE FOR PLACING NEW USER
   771	014243'	000000	000000	06930	USRSRE: 0                       ;ENDING RANGE FOR PLACING NEW USER
   772
   773	014244'			06950	        BLOCK   3               ;EXTRA OVERFLOW ENTRY - THROWN AWAY
   774	014247'			06960	USROVF: BLOCK   3               ;FIRST USER OVERFLOWED FROM TABLE
   775				06970	                                ;USRTAB MUST FOLLOW USROVF
   776	014252'			06980	USRTAB: BLOCK   3*USRSC         ;USER SORT TABLE
   777	014552'			06990	USRTBE: BLOCK   3               ;END OF USER SORT TABLE
   778
   779	014555'	200040	014240'	07010	CMPLP:  MOVE    R1,USRGPT       ;POINTER TO NEXT ENTRY
   780	014556'	313040	014241'	07020	        CAMLE   R1,USRPTR       ;SKIP IF NO ENTRIES LEFT
   781	014557'	254000	016256'	07030	        JRST    CPOPJ1          ;SUCESS RETURN IF ENTRIES LEFT
   782	014560'	200000	013310'	07040	        MOVE    R0,STRPPN       ;GET PPN OF STARTING USER
   783	014561'	332000	014241'	07050	        SKIPE   USRPTR          ;SKIP IF FIRST TIME THROUGH CMPLP
   784	014562'	322000	016257'	07060	        JUMPE   R0,CPOPJ        ;FAIL RETURN IF DONE
   785	014563'	201040	014552'	07070	        MOVEI   R1,USRTBE       ;ADDR OF END OF TABLE
   786	014564'	202040	014240'	07080	        MOVEM   R1,USRGPT       ;SAVE POINTER FOR GETTING ENTRIES
   787	014565'	202040	014241'	07090	        MOVEM   R1,USRPTR       ;SAVE POINTER TO VARIABLE END OF TABLE
   788	014566'	400040	000000	07100	        SETZ    R1,             ;ZERO NAME IN CASE IT'S 0,0
   789	014567'	322000	014573'	07110	        JUMPE   R0,CMPLP6       ;JUMP IF NO STARTING USER
   790	014570'	260740	021511'	07120	        PUSHJ   P,PPNUSR        ;CONVERT PPN TO USER NAME
   791				07130	        ERT [XWD [STRPPN
   792	014571'	023000	022147'	07140	CLDSP],[ASCIZ "CANNOT CONVERT STARTING PPN _K._E"]]
   793	014572'	260740	015004'	07150	        PUSHJ   P,SHFTUN        ;FIX USER NAME FOR COMPARING WITH OTHERS
   794	014573'	202000	013314'	07160	CMPLP6: MOVEM   R0,STRUSR       ;SAVE 1ST HALF OF USER NAME
   795	014574'	202040	013315'	07170	        MOVEM   R1,STRUSR+1     ;SAVE 2ND HALF OF USER NAME
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-14
TAP.MAC	23-MAR-79 11:41	

   796	014575'	402000	014251'	07180	        SETZM   USROVF+2        ;SET DEFAULT PPN TO ZERO
   797	014576'	200040	022150'	07190	        MOVE    R1,[XWD 377777,-1];LARGEST POSSIBLE NUMBER
   798	014577'	202040	014247'	07200	        MOVEM   R1,USROVF       ;SET NAMES TO LARGEST POSSIBLE VALUE
   799	014600'	202040	014250'	07210	        MOVEM   R1,USROVF+1     ;SET NAMES TO LARGEST POSSIBLE VALUE
   800	014601'	515040	014247'	07220	        HRLZI   R1,USROVF       ;ADDR OF START OF SORT TABLE
   801	014602'	541040	014252'	07230	        HRRI    R1,USROVF+3     ;SHIFT ALL WORDS BY THREE
   802	014603'	251040	014554'	07240	        BLT     R1,USRTBE+2     ;ZERO THE SORT TABLE
   803	014604'	260740	014703'	07250	        PUSHJ   P,OPNMFD        ;OPEN THE MFD
   804	014605'	254000	014622'	07260	        JRST    CMPLP3          ;START SORTING
   805	014606'	200040	014241'	07270	CMPLP2: MOVE    R1,USRPTR       ;ADDR OF VARIABLE END OF SEARCH TABLE
   806	014607'	507000	000001	07280	        HRLS    R1              ;ADDR IN BOTH HALVES FOR BLT
   807	014610'	275040	000003	07290	        SUBI    R1,3            ;SHIFT EVERYTHING BY THREE WORDS
   808	014611'	200100	014242'	07300	        MOVE    R2,USRSRS       ;LAST ENTRY TO BE MOVED
   809	014612'	251042	777777	07310	        BLT     R1,-1(R2)       ;MAKE ROOM FOR NEW ENTRY
   810	014613'	505040	014235'	07320	        HRLI    R1,TMPUSR       ;ADDRESS OF NEW ENTRY
   811	014614'	541042	000000	07330	        HRRI    R1,(R2)         ;ADDR OF SLOT FOR NEW ENTRY
   812	014615'	251042	000002	07340	        BLT     R1,2(R2)        ;PUT NEW ENTRY INTO THE TABLE
   813	014616'	200040	014241'	07350	        MOVE    R1,USRPTR       ;ADDRESS OF VARIABLE END OF TABLE
   814	014617'	303040	014247'	07360	        CAILE   R1,USROVF       ;SKIP IF TABLE IS FULL
   815	014620'	275040	000003	07370	        SUBI    R1,3            ;ADD ONE ENTRY TO TABLE
   816	014621'	202040	014241'	07380	        MOVEM   R1,USRPTR       ;SAVE NEW END OF TABLE POINTER
   817	014622'	200040	014241'	07390	CMPLP3: MOVE    R1,USRPTR       ;POINTER TO VARIABLE END OF SORT TABLE
   818	014623'	202040	014242'	07400	        MOVEM   R1,USRSRS       ;STARTING RANGE FOR PLACING NEW USER
   819	014624'	201040	014552'	07410	        MOVEI   R1,USRTBE       ;FIXED END OF SORT TABLE
   820	014625'	202040	014243'	07420	        MOVEM   R1,USRSRE       ;ENDING RANGE FOR PLACING NEW USER
   821	014626'	260740	014723'	07430	        PUSHJ   P,GMFD          ;GET NEXT ENTRY
   822	014627'	254000	014655'	07440	        JRST    CMPLP4          ;RETURN FROM CMPLP IF STRPPN FOUND
   823	014630'	201040	014235'	07450	        MOVEI   R1,TMPUSR       ;ADDR OF NAME JUST READ
   824	014631'	201100	014247'	07460	        MOVEI   R2,USROVF       ;ADDR OF OVERFLOWED NAME
   825	014632'	260740	014671'	07470	        PUSHJ   P,USRCMP        ;SKIP IF TMPUSR NOT GREATER
   826	014633'	254000	014622'	07480	        JRST    CMPLP3          ;GET NEXT ENTRY CAUSE THIS WOULD OVERFLOW
   827	014634'	200040	014243'	07490	CMPLP1: MOVE    R1,USRSRE       ;ENDING RANGE FOR PLACING NEW USER
   828	014635'	274040	014242'	07500	        SUB     R1,USRSRS       ;FIND POSSIBLE RANGE FOR NEW USER
   829	014636'	322040	014606'	07510	        JUMPE   R1,CMPLP2       ;JUMP IF PLACE HAS BEEN FOUND
   830	014637'	231040	000006	07520	        IDIVI   R1,6            ;3 WRDS/ENTRY AND 2 FOR BINARY SEARCH
   831	014640'	221040	000003	07530	        IMULI   R1,3            ;3 WORDS/ENTRY
   832	014641'	270040	014242'	07540	        ADD     R1,USRSRS       ;STARTING RANGE FOR NEW USER
   833	014642'	334100	022151'	07550	        SKIPA   R2,[TMPUSR]     ;ADDR OF USER NAME JUST READ
   834	014643'	271040	000003	07560	CMPLP5: ADDI    R1,3            ;BUMP R1 IF NO PROGRESS BEING MADE
   835	014644'	201140	014243'	07570	        MOVEI   R3,USRSRE       ;ASSUME END RANGE MUST BE CHANGED
   836	014645'	260740	014671'	07580	        PUSHJ   P,USRCMP        ;SKIP IF TMPUSR GREATER
   837	014646'	201140	014242'	07590	        MOVEI   R3,USRSRS       ;MUST CHANGE STARTING RANGE
   838	014647'	306140	014243'	07600	        CAIN    R3,USRSRE       ;SKIP IF NOT CHANGING END OF RANGE
   839	014650'	275040	000003	07610	        SUBI    R1,3            ;WE CAN MOVE IT UP BY ONE ENTRY
   840	014651'	316043	000000	07620	        CAMN    R1,(R3)         ;SKIP IF PROGRESS STILL BEING MADE
   841	014652'	254000	014643'	07630	        JRST    CMPLP5          ;NO PROGRESS SO TRY ANOTHER ADDR
   842	014653'	202043	000000	07640	        MOVEM   R1,(R3)         ;SET NEW USRSRS OR USRSRE
   843	014654'	254000	014634'	07650	        JRST    CMPLP1          ;NEXT ITERATION OF SEARCH
   844	014655'	200040	014554'	07660	CMPLP4: MOVE    R1,USRTBE+2     ;GET FIRST PPN TO BE STORED
   845	014656'	336000	013310'	07670	        SKIPN   STRPPN          ;SKIP IF LOOKING FOR A STARTING PPN
   846	014657'	400040	000000	07680	        SETZ    R1,             ;FORCE STARTING PPN'S TO BE EQUAL
   847	014660'	312040	013310'	07690	        CAME    R1,STRPPN       ;SKIP IF STARTING PPN FOUND
   848				07700	        ERT [XWD [STRPPN
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-15
TAP.MAC	23-MAR-79 11:41	

   849	014661'	023000	022161'	07710	CLDSP],[ASCIZ "CANNOT FIND STARTING USER _A._E"]]
   850	014662'	200040	014251'	07720	        MOVE    R1,USROVF+2     ;GET FIRST OVERFLOW FROM TABLE
   851	014663'	202040	013310'	07730	        MOVEM   R1,STRPPN       ;SET NEW STARTING PPN
   852	014664'	200040	014241'	07740	        MOVE    R1,USRPTR       ;POINTER TO END OF TABLE
   853	014665'	307040	014241'	07750	        CAIG    R1,USRPTR       ;SKIP IF NO OVERFLOW
   854	014666'	201040	014252'	07760	        MOVEI   R1,USRTAB       ;PUT IT BACK IN RANGE
   855	014667'	202040	014241'	07770	        MOVEM   R1,USRPTR       ;PUT BACK THE END OF TABLE POINTER
   856	014670'	254000	016256'	07780	        JRST    CPOPJ1          ;SKIP RETURN FROM CMPLP
   857
   858	014671'	200001	000000	07800	USRCMP: MOVE    R0,(R1)         ;GET NAME FROM TABLE
   859	014672'	316002	000000	07810	        CAMN    R0,(R2)         ;SKIP IF NOT EQUAL TO NAME READ IN
   860	014673'	254000	014677'	07820	        JRST    .+4             ;EQUAL SO COMPARE SECOND HALF
   861	014674'	317002	000000	07830	        CAMG    R0,(R2)         ;SKIP IF NAME IN TABLE GREATER
   862	014675'	350017	000000	07840	        AOS     (P)             ;SKIP RETURN
   863	014676'	263740	000000	07850	        POPJ    P,              ;RETURN
   864	014677'	200001	000001	07860	        MOVE    R0,1(R1)        ;GET 2ND HALF OF NAME FROM TABLE
   865	014700'	317002	000001	07870	        CAMG    R0,1(R2)        ;SKIP IF GREATER THAN NAME READ IN
   866	014701'	350017	000000	07880	        AOS     (P)             ;SKIP RETURN
   867	014702'	263740	000000	07890	        POPJ    P,              ;RETURN SKIPPING IF R1 .LE. R2
   868
   869	014703'	201040	013260'	07910	OPNMFD: MOVEI   R1,MFDHED
   870	014704'	202040	013736'	07920	        MOVEM   R1,IOBUF
   871	014705'	050200	013734'	07930	        OPEN    MFD,MFDSPK      ;WANT TO READ MFD FOR THIS STR
   872	014706'	015000	022162'	07940	        ERROR   [ASCIZ "UNABLE TO INIT DEVICE DSK."]
   873	014707'	201040	000121'	07950	        MOVEI   R1,MFDBUF       ;SET UP BUFFERS
   874	014710'	202040	000000*	07960	        MOVEM   R1,JOBFF##      ;TELL SYSTEM WHERE TO PUT THE BUFFERS
   875	014711'	064200	000002	07970	        INBUF   MFD,MFDN
   876	014712'	200040	013307'	07980	        MOVE    R1,SYSPP        ;LOOK FOR MFD
   877	014713'	202040	013406'	07990	        MOVEM   R1,MFDDI3       ;IN THE MFD
   878	014714'	202040	013403'	08000	        MOVEM   R1,MFDDIR
   879	014715'	205040	654644	08010	        MOVSI   R1,(SIXBIT /UFD/)
   880	014716'	202040	013404'	08020	        MOVEM   R1,MFDDI1
   881	014717'	076200	013403'	08030	        LOOKUP  MFD,MFDDIR      ;(OLD STYLE LOOKUP)
   882	014720'	015000	022170'	08040	        ERROR   [ASCIZ "UNABLE TO DO LOOKUP ON MFD."]
   883	014721'	402000	013743'	08050	        SETZM   MFDMON          ;READ SEQUENTIALLY THROUGH MFD
   884	014722'	263740	000000	08060	        POPJ    P,              ;RETURN FROM OPNMFD
   885
   886				08080	;READ MFD
   887
   888	014723'	332040	013676'	08100	GMFD:   SKIPE   R1,STO23        ;FETCH STO23 AND CK IF NONZERO
   889	014724'	254000	014754'	08110	        JRST    GMFD2           ;SPEED-UP CODE FOR COMMAND STATES 2-3
   890	014725'	200040	022176'	08120	        MOVE R1,[33,,MFD]
   891	014726'	043040	013737'	08130	        CHANIO R1,MFDARG
   892	014727'	254000	015060'	08140	        JRST MFDEND             ;MUST HAVE REACHED END OF MFD
   893	014730'	200640	013747'	08150	        MOVE U,MFDTAB           ;SAVE PPN IN REGISTER U
   894	014731'	554700	013750'	08160	        HLRZ W,MFDTAB+1         ;SAVE EXTENSION IN RH OF W FOR EASY COMPARE
   895	014732'	302700	654644	08170	GMFD1:  CAIE    W,(SIXBIT /UFD/);SKIP IF THIS IS A UFD
   896	014733'	254000	014723'	08180	        JRST    GMFD            ;LOOK FOR NEXT UFD
   897	014734'	202640	014237'	08190	        MOVEM   U,TMPPPN        ;SAVE PPN
   898	014735'	200000	014237'	08200	        MOVE    R0,TMPPPN       ;GET PPN FOR COVERSION TO USER NAME
   899	014736'	260740	021511'	08210	        PUSHJ   P,PPNUSR        ;CONVERT PPN TO USER NAME AND SKIP IF OK
   900	014737'	254000	014723'	08220	        JRST    GMFD            ;IGNORE STRAY UFD'S
   901	014740'	260740	015004'	08230	        PUSHJ   P,SHFTUN        ;FIX USER NAME FOR COMPARING WITH OTHERS
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-16
TAP.MAC	23-MAR-79 11:41	

   902	014741'	202000	014235'	08240	        MOVEM   R0,TMPUSR       ;SAVE 1ST HALF OF USER NAME
   903	014742'	202040	014236'	08250	        MOVEM   R1,TMPUSR+1     ;SAVE 2ND HALF OF USER NAME
   904	014743'	201040	013314'	08260	        MOVEI   R1,STRUSR       ;ADDR OF NAME OF STARTING USER
   905	014744'	201100	014235'	08270	        MOVEI   R2,TMPUSR       ;USER JUST READ
   906	014745'	336000	013310'	08280	        SKIPN   STRPPN          ;SKIP IF LOOKING FOR STARTING PPN
   907	014746'	254000	014751'	08290	        JRST    .+3             ;DON'T CHECK FOR PAST STARTING PPN
   908	014747'	260740	014671'	08300	        PUSHJ   P,USRCMP        ;SKIP IF STARTING USER OR PAST IT
   909	014750'	254000	014723'	08310	        JRST    GMFD            ;IGNORE THIS USER
   910	014751'	260740	015562'	08320	        PUSHJ   P,CKNPPN        ;SKIP IF THIS USER SHOULD BE DUMPED
   911	014752'	254000	014723'	08330	        JRST    GMFD            ;NOT THIS USER, TRY THE NEXT
   912	014753'	254000	016256'	08340	        JRST    CPOPJ1          ;SKIP RETURN FROM GMFD
   913	014754'	607040	400000	08350	GMFD2:  TLNN    R1,400000       ;TEST LAST ITEM FLAG
   914	014755'	254000	014761'	08360	        JRST GMFD3              ;MORE TO DO
   915	014756'	070200	000010	08370	        CLOSE MFD,DNC
   916	014757'	071200	000000	08380	        RELEASE MFD,
   917	014760'	263740	000000	08390	        POPJ P,
   918	014761'	201700	654644	08400	GMFD3:  MOVEI   W,(SIXBIT/UFD/)
   919	014762'	550641	000000	08410	        HRRZ U,(R1)
   920	014763'	260740	021610'	08420	        PUSHJ   P,FINGAN
   921	014764'	200100	013677'	08430	        MOVE R2,CSTATE
   922	014765'	302100	000003	08440	        CAIE R2,3
   923	014766'	254000	014775'	08450	        JRST GMFD6              ;BETTER BE STATE 2 (USERS)
   924	014767'	135100	022117'	08460	        LDB R2,[XWD CNTFP+R1,0] ;TERMINATION BETTER BE CRCH
   925	014770'	302100	000002	08470	        CAIE R2,CNTFT
   926	014771'	015000	022177'	08480	GMFD4:  ERROR [ASCIZ"PROG. ERROR-GMFD4"]
   927	014772'	661040	400000	08490	GMFD5:  TLO     R1,400000       ;NO MORE PPNS TO GET
   928	014773'	202040	013676'	08500	        MOVEM R1,STO23          ;SET LAST ITEM FLAG IN STO23
   929	014774'	254000	014732'	08510	        JRST GMFD1
   930	014775'	302100	000002	08520	GMFD6:  CAIE R2,2
   931	014776'	015000	022203'	08530	        ERROR [ASCIZ"PROG. ERROR-GMFD6"]
   932	014777'	135100	022117'	08540	        LDB R2,[XWD CNTFP+R1,0] ;LOOKING FOR CRCH TO END LIST OF PPNS
   933	015000'	306100	000002	08550	        CAIN R2,CNTFT
   934	015001'	254000	014772'	08560	        JRST GMFD5              ;LAST PPN IN LIST
   935	015002'	350000	013676'	08570	        AOS     STO23           ;ADVANCE STO23 TO NEXT ITEM
   936	015003'	254000	014732'	08580	        JRST    GMFD1           ;AND RETURN
   937
   938	015004'	400100	000000	08600	SHFTUN: SETZ    R2,             ;ASSUME SHIFT OF ZERO
   939	015005'	316000	022207'	08610	        CAMN    R0,[SIXBIT /UFD/] ;SKIP IF NOT USER 1,1 (UFD)
   940	015006'	551100	777764	08620	        HRRZI   R2,-14          ;PUT (UFD) ON THE TAPE FIRST
   941	015007'	316000	022210'	08630	        CAMN    R0,[SIXBIT /SYS/] ;SKIP IS NOT USER 1,4 (SYS)
   942	015010'	551100	777772	08640	        HRRZI   R2,-6           ;PUT (SYS) ON THE TAPE SECOND
   943	015011'	246002	000000	08650	        LSHC    R0,(R2)         ;SHIFT IF (UFD) OR (SYS)
   944	015012'	641000	400000	08660	        TLC     R0,400000       ;COMPLEMENT SIGN BIT FOR COMPARE
   945	015013'	641040	400000	08670	        TLC     R1,400000       ;COMPLEMENT SIGN BIT FOR COMPARE
   946	015014'	263740	000000	08680	        POPJ    P,              ;RETURN FROM SHFTUN
   947
   948	015015'	260740	014555'	08700	MFD2:   PUSHJ   P,CMPLP         ;GET NEXT BATCH OF ENTRIES
   949	015016'	254000	015065'	08710	        JRST    STODON          ;DONE WITH THE STORE
   950	015017'	200040	014240'	08720	        MOVE    R1,USRGPT       ;GET POINTER TO NEXT ENTRY
   951	015020'	200641	000002	08730	        MOVE    U,2(R1)         ;GET NEXT PPN
   952	015021'	275040	000003	08740	        SUBI    R1,3            ;POINT TO NEXT ENTRY
   953	015022'	202040	014240'	08750	        MOVEM   R1,USRGPT       ;SAVE POINTER TO NEXT ENTRY
   954	015023'	551700	654644	08760	        HRRZI   W,(SIXBIT /UFD/);THE EXTENSION "UFD"
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-17
TAP.MAC	23-MAR-79 11:41	

   955	015024'	041240	000014	08770	        INIT    UFD,BUFBIN      ;IS IT AVAILABLE
   956	015025'	446353	000000	08780	        SIXBIT  /DSK/
   957	015026'	000000	013263'	08790	        XWD     0,UFDHED        ;INPUT ONLY
   958	015027'	015000	022211'	08800	        ERROR   [ASCIZ "UNABLE TO INIT DSK"]
   959	015030'	201040	000527'	08810	        MOVEI   R1,UFDBUF       ;SETUP BUFFERING
   960	015031'	202040	014710*	08820	        MOVEM   R1,JOBFF
   961	015032'	064240	000002	08830	        INBUF   UFD,UFDN
   962	015033'	200040	013307'	08840	        MOVE    R1,SYSPP        ;LOOK FOR UFD
   963	015034'	202040	013451'	08850	        MOVEM   R1,UFDDI1       ;IN THE UFD
   964	015035'	201040	000044	08860	        MOVEI   R1,XLOOKN       ;EXT. LOOKUP
   965	015036'	202040	013450'	08870	        MOVEM   R1,UFDDIR
   966	015037'	202640	013452'	08880	        MOVEM   U,UFDDI2        ;PPN FOR THIS USER
   967	015040'	516700	013453'	08890	        HRLZM   W,UFDDI3        ;THE EXTENSION "UFD"
   968	015041'	076240	013450'	08900	        LOOKUP  UFD,UFDDIR      ;IS IT STILL THERE
   969				08910	        ERB [XWD [UFDDI2
   970	015042'	024000	022236'	08912	MFD2],[ASCIZ "$UNABLE TO DO LOOKUP ON UFD FOR USER _A.  CONTINUING WITH NEXT USER.$_E"]]
   971	015043'	336000	013733'	08918		SKIPN	ALLFSW		;IS THIS AN "ALL FILES"?
   972	015044'	254000	015050'	08920		JRST	MFD3		;NO - LOOK AT ALL DIRECTORIES.
   973	015045'	200040	013467'	08922		MOVE	R1,URBSTS	;IF "NO FAILSAFE" BIT IS ON,
   974	015046'	602040	040000	08924		TRNE	R1,.RPNFS	;IGNORE THIS WHOLE DIRECTORY.
   975				08926		ERB	[XWD [UFDDI2
   976	015047'	024000	022253'	08928	MFD2],[ASCIZ "$IGNORING FILES FOR USER _A.  CONTINUING WITH NEXT USER.$_E"]]
   977	015050'	621400	000010	08930	MFD3:	TLZ     F,FILFND        ;NO FILES FOUND YET FOR THIS USER
   978				08940	; PUT USER NAME INTO FILE HEADER RECORDS
   979	015051'	200000	000015	08950	        MOVE R0,U
   980	015052'	260740	021511'	08960	        PUSHJ P,PPNUSR
   981				08970	        ERB [XWD[UFDDI2
   982	015053'	024000	022271'	08980	MFD2],[ASCIZ"$UNABLE TO FIND USER _K IN DUL.  CONTINUING WITH NEXT USER.$_E"]]
   983	015054'	202000	013606'	08990	        MOVEM TPUN1
   984	015055'	202040	013607'	09000	        MOVEM R1,TPUN2
   985	015056'	402000	013755'	09010	        SETZM   UFDMON          ;READ SEQUENTIALLY THROUGH UFD
   986	015057'	254000	016256'	09020	        JRST    CPOPJ1          ;WE READ SOMETHING SO SKIP RET FROM MFD2
   987
   988	015060'	063200	740000	09040	MFDEND: STATZ   MFD,IOBAD       ;SKIP IF NO ERROR (END OF BUFFER)
   989	015061'	015000	022272'	09050	        ERROR   [ASCIZ "ERROR IN READING MFD"];*
   990	015062'	070200	000010	09060	        CLOSE   MFD,DNC
   991	015063'	071200	000000	09070	        RELEASE MFD,
   992	015064'	263740	000000	09080	        POPJ    P,              ;FAIL RETURN FROM GMFD
   993
   994	015065'	402000	013733'	09095	STODON:	SETZM	ALLFSW		;ZERO OUT "ALL FILES" SWITCH
   995	015066'	607400	200000	09100		TLNN 	F,PRPFLG   	;DID WE DO ANYTHING
   996	015067'	015000	022277'	09110	        ERROR [ASCIZ "NOTHING WRITTEN ON TAPE"]
   997	015070'	332000	013310'	09120	        SKIPE   STRPPN          ;SKIP IF NOT LOOKING FOR STARTING PPN
   998	015071'	015000	022304'	09130	        ERROR   [ASCIZ "CANNOT FIND STARTING USER."]
   999	015072'	256012	013771'	09140	        XCT MF0(UNIT)
  1000	015073'	256012	013775'	09150	        XCT MF7(UNIT)           ;BACK SPACE OVER EOF
  1001	015074'	256012	013771'	09160	        XCT MF0(UNIT)           ;WAIT FOR OPERATION TO COMPLETE
  1002	015075'	260740	015625'	09170	        PUSHJ   P,TRLOUT        ;WRITE TRAILER RECORD
  1003	015076'	660400	000040	09180	        TRO F,EOTFLG            ;POSITIONED AT LOGICAL EOT
  1004	015077'	023000	022320'	09190	        ERT [XWD[CURPOS],[ASCIZ"LAST FILE AT POS _H$"]]
  1005	015100'	024000	022330'	09200	        ERB [XWD[SCOUNT],[ASCIZ"STORE COMPLETE, _C FILES.$$"]]
  1006	015101'	402000	013701'	09210	        SETZM SCOUNT
  1007	015102'	263740	000000	09220	        POPJ    P,              ;FAIL RETURN FROM GMFD
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-18
TAP.MAC	23-MAR-79 11:41	

  1008
  1009				09240	;READ UFD
  1010
  1011	015103'	402000	021734'	09260	UFD2:   SETZM   BLKCNT#         ;SET BLOCK COUNT FOR FILE TO ZERO
  1012	015104'	402000	021775'	09270	        SETZM   STRER#          ;ZERO ERROR CODE FOR STARTING FILE
  1013	015105'	621400	000002	09280	        TLZ     F,EOFFND        ;END OF FILE NOT YET FOUND
  1014	015106'	623400	100000	09290	        TLZE    F,RPTFIL        ;ARE WE REPEATING LAST FILE
  1015	015107'	254000	015144'	09300	        JRST  UFD2A     ;YES
  1016	015110'	200040	022331'	09310	        MOVE R1,[33,,UFD]
  1017	015111'	043040	013751'	09320	        CHANIO R1,UFDARG
  1018	015112'	254000	015225'	09330	        JRST UFDEND     ;MUST HAVE REACHED END OF UFD
  1019	015113'	200640	013761'	09340	        MOVE U,UFDTAB   ;FILENAME IN U
  1020	015114'	554700	013762'	09350	        HLRZ W,UFDTAB+1 ;EXT IN RH OF W FOR EZ COMPARE
  1021	015115'	200040	013763'	09360	        MOVE R1,UFDCRE  ;GET CREATION DATE
  1022	015116'	202040	013372'	09370	        MOVEM R1,CRTION ;SAVE FOR CKNCRE
  1023	015117'	306700	645560	09380	        CAIN    W,(SIXBIT /TMP/);IGNORE TEMP FILES
  1024	015120'	254000	015103'	09390	        JRST    UFD2            ;GET NEXT ENTRY FROM UFD
  1025	015121'	200040	013312'	09400	        MOVE    R1,STREXT       ;HAS EXT IN LEFT HALF
  1026	015122'	556040	021776'	09410	        HLRZM   R1,STRJNK#      ;MOVE TO RH FOR COMPARE
  1027	015123'	200040	013311'	09420	        MOVE    R1,STRFIL       ;ZERO IF NOT LOOKING FOR STARTING FILE
  1028	015124'	316700	021776'	09430	        CAMN    W,STRJNK        ;SKIP IF NOT STARTING EXTENSION
  1029	015125'	312640	013311'	09440	        CAME    U,STRFIL        ;SKIP IF THIS IS THE STARTING FILE
  1030	015126'	326040	015103'	09450	        JUMPN   R1,UFD2         ;JUMP IF STARTING FILE NOT YET FOUND
  1031	015127'	402000	013311'	09460	        SETZM   STRFIL          ;MARK STARTING FILE AS FOUND
  1032	015130'	260740	015520'	09470	        PUSHJ   P,CKNFIL        ;SKIP IF THIS FILE SHOULD BE STORED
  1033	015131'	254000	015210'	09480	        JRST    UFD3            ;NO - TRY ANOTHER
  1034	015132'	260740	015501'	09490	        PUSHJ   P,CKNCRE        ;SKIP IF CREATION DATE OK TO DUMP
  1035	015133'	254000	015211'	09500	        JRST    UFD4            ;NO - TRY ANOTHER
  1036	015134'	260740	015512'	09510	        PUSHJ   P,CKNCHG        ;SKIP IF CHANGED OR IF WE DON'T CARE
  1037	015135'	254000	015212'	09520	        JRST    UFD5            ;NOT CHANGED
  1038	015136'	201040	000044	09530	        MOVEI   R1,XLOOKN       ;EXT. LOOKUP
  1039	015137'	202040	013517'	09540	        MOVEM   R1,FILDIR
  1040	015140'	202640	013521'	09550	        MOVEM   U,FILDI2        ;FILE NAME
  1041	015141'	516700	013522'	09560	        HRLZM   W,FILDI3        ;EXTENSION
  1042	015142'	200040	013452'	09570	        MOVE    R1,UFDDI2       ;PROJ-PROG NUMBER
  1043	015143'	202040	013520'	09580	        MOVEM   R1,FILDI1
  1044	015144'	041300	000014	09590	UFD2A:  INIT    FIL,BUFBIN      ;SET TO GET FILE
  1045	015145'	446353	000000	09600	        SIXBIT  /DSK/
  1046	015146'	000000	013266'	09610	        XWD     0,FILHED        ;INPUT ONLY
  1047	015147'	015000	022332'	09620	        ERROR   [ASCIZ "UNABLE TO INIT DSK."]
  1048	015150'	201040	001135'	09630	        MOVEI   R1,FILBUF       ;SETUP BUFFERS
  1049	015151'	202040	015031*	09640	        MOVEM   R1,JOBFF
  1050	015152'	064300	000007	09650	        INBUF   FIL,FILN
  1051	015153'	076300	013517'	09660	        LOOKUP  FIL,FILDIR      ;IS IT THERE?
  1052				09670	        ERB [XWD [FILDI1
  1053	015154'	024000	022355'	09680	UFD6],[ASCIZ "$UNABLE TO DO LOOKUP ON FILE _J. CONTINUING WITH NEXT FILE.$_E"]]
  1054	015155'	200040	013536'	09690	        MOVE    R1,FRBSTS       ;GET FILE STATUS
  1055	015156'	602040	040001	09700	        TRNE    R1,.RPNFS!.RPBAD;DO-NOT-SAVE BIT OR BAD BIT ON?
  1056	015157'	254000	015214'	09710	        JRST    UFD7            ;YES
  1057				09720	; WRITE SAVESET HEADER IF NECESSARY.
  1058	015160'	603400	200000	09730	        TLNE F,PRPFLG
  1059	015161'	254000	015165'	09740	        JRST .+4
  1060	015162'	260740	015752'	09750	        PUSHJ P,WPREP           ;SET UP SAVESET HEADER
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-19
TAP.MAC	23-MAR-79 11:41	

  1061				09760	        ERB [XWD[TAPNUM
  1062	015163'	024000	022365'	09770	DAYTIM],[ASCIZ"$$TAPE NUMBER _C FOR _L$"]]
  1063	015164'	260740	015630'	09780	        PUSHJ P,LABBLT          ;WRITE OUT HEADER
  1064	015165'	661400	200010	09790	        TLO F,FILFND+PRPFLG     ;FILE FOUND, AND SAVESET HEADER WRITTEN
  1065	015166'	260740	016247'	09800	        PUSHJ   P,TRCL          ;TRANSFER CURPPN-FIL-EXT TO LST...
  1066	015167'	350000	013321'	09810	        AOS CURPOS              ;ADVANCE CURRENT POSITION
  1067				09820	; UPDATE TEMPORARY TAPE PARAMETERS FOR FILE HDR BLOCK
  1068	015170'	550040	013321'	09830	        HRRZ R1,CURPOS
  1069	015171'	303040	000000*	09840	        CAILE R1,RANSIZ*44-1
  1070	015172'	015000	022366'	09850	        ERROR [ASCIZ"EXCEEDED PROG LIMIT FOR NO. OF FILES ON TAPE"]
  1071	015173'	504040	022001'	09860	        HRL  R1,TAPNUM          ;REEL NO. IN SAVE SET
  1072	015174'	202040	013615'	09870	        MOVEM R1,TPPOS
  1073	015175'	516700	013320'	09880	        HRLZM   W,CUREXT        ;SAVE NEW EXTENSION
  1074	015176'	202640	013317'	09890	        MOVEM   U,CURFIL        ;SAVE NEW FILE NAME
  1075	015177'	200040	013452'	09900	        MOVE    R1,UFDDI2       ;GET NEW PPN
  1076	015200'	202040	013316'	09910	        MOVEM   R1,CURPPN       ;SAVE NEW PPN
  1077	015201'	201040	000015	09920	        MOVEI R1,VERSION
  1078	015202'	202040	013325'	09930	        MOVEM R1,CURVER
  1079	015203'	200000	013606'	09940	        MOVE TPUN1
  1080	015204'	202000	013322'	09950	        MOVEM CURUN1
  1081	015205'	200000	013607'	09960	        MOVE TPUN2
  1082	015206'	202000	013323'	09970	        MOVEM CURUN2
  1083	015207'	254000	016256'	09980	        JRST    CPOPJ1          ;SKIP RETURN FROM UFD2
  1084	015210'	350000	021775'	09990	UFD3:   AOS STRER ;ERCODE=34
  1085	015211'	350000	021775'	10000	UFD4:   AOS STRER ;ERCODE=33
  1086	015212'	350000	021775'	10010	UFD5:   AOS STRER ;ERCODE=32
  1087	015213'	350000	021775'	10020	UFD6:   AOS STRER ;ERCODE=31
  1088	015214'	336000	013313'	10030	UFD7:   SKIPN STRBLK ;ERCODE=30
  1089	015215'	254000	015103'	10040	        JRST UFD2 ;WE WEREN'T LOOKING FOR STARTING FILE
  1090	015216'	023000	022406'	10050	        ERT [XWD 0,[ASCIZ"$UNABLE TO ACCESS STARTING FILE--"]]
  1091	015217'	402000	013313'	10060	        SETZM STRBLK
  1092	015220'	200000	021775'	10070	        MOVE STRER
  1093	015221'	271000	000030	10080	        ADDI 30
  1094	015222'	202000	013724'	10090	        MOVEM ERCODE
  1095	015223'	260740	021165'	10100	        PUSHJ P,WHY
  1096	015224'	015000	022407'	10110	        ERROR [ASCIZ"TRY MANUAL RESTART"]
  1097
  1098	015225'	061240	740000	10130	UFDEND: STATO   UFD,IOBAD       ;END OF FILE?
  1099	015226'	254000	015233'	10140	        JRST    ENDUFD          ;YES, GO DO WRAPUP
  1100	015227'	063240	040000	10150	        STATZ   UFD,BTL         ;SKIP IF BLOCK NOT TOO LARGE
  1101	015230'	024000	022417'	10160	        ERB [XWD 0,[ASCIZ "BLOCK TOO LARGE$"]]
  1102	015231'	024000	022426'	10170	        ERB [XWD[UFDDI2],[ASCIZ"ERROR READING UFD FOR _A$"]]
  1103	015232'	263740	000000	10180	        POPJ P,                 ;UFD2 FAIL RETURN
  1104	015233'	332000	013311'	10190	ENDUFD: SKIPE   STRFIL          ;SKIP IF NOT LOOKING FOR STARTING FILE
  1105				10200	        ERT [XWD [STRFIL
  1106	015234'	023000	022440'	10210	CLDSP##],[ASCIZ "CANNOT FIND STARTING FILE _B._E"]]
  1107	015235'	627400	000010	10220	        TLZN    F,FILFND        ;ANY FILES FOR THIS USER?
  1108	015236'	254000	015243'	10230	        JRST    NULUFD          ;NOPE
  1109	015237'	260740	015655'	10240	        PUSHJ   P,CLSUSR        ;WRITE EOFS ON TAPE
  1110	015240'	260740	016247'	10250	        PUSHJ   P,TRCL          ;FINISH UP THE LAST FILE
  1111	015241'	260740	021122'	10260	        PUSHJ   P,SPRTU         ;PRINT USER TOTALS IF WE SHOULD
  1112	015242'	334000	000000	10270	        SKIPA   
  1113	015243'	260740	015656'	10280	NULUFD: PUSHJ   P,NULTAP        ;RESET BUFFER
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-20
TAP.MAC	23-MAR-79 11:41	

  1114	015244'	070240	000010	10290	        CLOSE   UFD,DNC
  1115	015245'	071240	000000	10300	        RELEASE UFD,            ;GIVE UP UFD DDB
  1116	015246'	263740	000000	10310	        POPJ P,         ;FAIL RETURN FROM UFD2
  1117
  1118				10330	;DISK FILE INPUT
  1119
  1120	015247'	607400	100000	10350	FILIN:  TLNN F,RPTFIL
  1121	015250'	254000	015253'	10360	        JRST .+3
  1122	015251'	402000	021762'	10370	        SETZM OLDBLK
  1123	015252'	254000	015313'	10380	        JRST NOTDMP
  1124	015253'	302700	654644	10390	        CAIE W,(SIXBIT/UFD/)
  1125	015254'	254000	015260'	10400	        JRST FILIN0
  1126	015255'	200000	013316'	10410	        MOVE CURPPN
  1127	015256'	316000	013307'	10420	        CAMN SYSPP
  1128	015257'	254000	015271'	10430	        JRST FILIN1     ;PRETEND EOF ON UFD FILES
  1129	015260'	332000	013313'	10440	FILIN0: SKIPE   STRBLK          ;SKIP IF NO SPECIAL STARTING BLOCK
  1130	015261'	260740	015337'	10450	        PUSHJ   P,FSTWRD        ;FIX UP FIRST BLOCK OF FILE
  1131	015262'	200000	013663'	10460	        MOVE CKSUM
  1132	015263'	202000	021764'	10470	        MOVEM PCKSUM#           ;CHECKSUM OF LAST COMPLETE BLOCK
  1133	015264'	350000	021734'	10480	        AOS     BLKCNT          ;INCREMENT NUMBER OF BLOCKS READ
  1134	015265'	056300	000000	10490	        IN      FIL,            ;GET NEXT BUFFER
  1135	015266'	254000	016256'	10500	        JRST    CPOPJ1          ;SUCCESSFUL - SKIP RETURN
  1136	015267'	063300	740000	10510	        STATZ   FIL,IOBAD       ;SKIP IF NO ERROR
  1137	015270'	024000	022450'	10520	        ERB [XWD[CURPPN],[ASCIZ "$ERROR IN READING FILE: _J$"]]
  1138	015271'	402000	021762'	10530	FILIN1: SETZM   OLDBLK          ;FILE CANNOT BE SPLIT OVER 3 TAPES NOW
  1139	015272'	201040	000001	10540	        MOVEI   R1,1
  1140	015273'	603400	040000	10550	        TLNE    F,RPTFLG
  1141	015274'	316040	013700'	10560	        CAMN    R1,RPTCNT
  1142	015275'	336000	013373'	10570	        SKIPN CHANGD    ;*CHANGE TO JRST NOTDMP IN PRELIMINARY RELEASES
  1143	015276'	254000	015313'	10580	        JRST NOTDMP             ;NOT TIME TO MARK FILES DUMPED
  1144	015277'	201040	000002	10590	        MOVEI   R1,2            ;SECOND PART OF COMMAND
  1145	015300'	200041	014113*	10600	        MOVE    R1,CTABL2(R1)   ;GET SECOND PART OF COMMAND
  1146	015301'	306040	015443'	10610	        CAIN    R1,ALLLST       ;SKIP IF NOT THE WORD "ALL"
  1147	015302'	201040	000000	10620	        MOVEI   R1,0            ;CHANGE ALL TO ZERO
  1148	015303'	434040	013370'	10630	        OR      R1,CREDAT       ;MERGE IN CREATION DATE TO CHECK
  1149	015304'	326040	015313'	10640	        JUMPN   R1,NOTDMP       ;DON'T MARK DUMPED EXCEPT FOR BACKUP (ALL CHANGED)
  1150	015305'	515040	020000	10650	        HRLZI   R1,RCHGBT       ;GET THE RIB CHANGED BIT
  1151	015306'	612040	013533'	10660	        TDNE    R1,FRBNCA       ;SKIP IF NOT ALREADY MARKED AS DUMPED
  1152	015307'	254000	015313'	10670	        JRST    NOTDMP          ;DON'T BOTHER TO DO IT AGAIN
  1153	015310'	436040	013533'	10680	        ORM     R1,FRBNCA       ;MARK FILE AS DUMPED
  1154	015311'	055300	013517'	10690	        RENAME  FIL,FILDIR      ;DO A RENAME ON THE FILE TO MARK IT DUMPED
  1155	015312'	024000	022460'	10700	        ERB [XWD[CURPPN],[ASCIZ "UNABLE TO MARK FILE _J AS DUMPED.$"]]
  1156	015313'			10710	NOTDMP:
  1157				10720	; PUT CHECKSUM PAST LAST DATA WORD
  1158	015313'	377000	013257'	10730	FILL:   SOSG TAPHD2
  1159	015314'	260740	015351'	10740	        PUSHJ P,TAPOUT          ;WRITE FULL BUFFER
  1160	015315'	200100	013671'	10750	        MOVE R2,TPSZM3 ;TAPE RECORD SIZE-3    CALC. NO. WDS IN BUFFER
  1161	015316'	274100	013257'	10760	        SUB R2,TAPHD2
  1162	015317'	200000	013663'	10770	        MOVE CKSUM
  1163	015320'	136000	013256'	10780	        IDPB R0,TAPHD1          ;DEPOSIT CKSUM
  1164	015321'	307100	000004	10790	        CAIG R2,4               ;LAST RECORD TO CONTAIN AT LEAST 5 WDS
  1165	015322'	254000	015313'	10800	        JRST FILL               ;STATISTICS HERE WOULD BE NICE
  1166	015323'	661400	000002	10810	        TLO F,EOFFND            ;END OF FILE HAS BEEN FOUND
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-21
TAP.MAC	23-MAR-79 11:41	

  1167	015324'	370000	013257'	10820	        SOS     TAPHD2          ;FIXUP SINCE TAPHD2 IS OFF BY
  1168				10830	;                               ONE DUE TO MORE3:+4 LOGIC
  1169	015325'	260740	015351'	10840	        PUSHJ   P,TAPOUT        ;OUTPUT LAST BUFFER (USES EOFFND FLAG)
  1170	015326'	070300	000010	10850	        CLOSE   FIL,DNC
  1171	015327'	071300	000000	10860	        RELEASE FIL,            ;GIVE UP USER FILE
  1172	015330'	350000	013376'	10870	        AOS     FILCNT          ;INCR. TOT FILES DUMPED THIS USER
  1173	015331'	350000	013701'	10880	        AOS     SCOUNT          ;INCR. TOT FILES DUMPED
  1174	015332'	201040	000000*	10890	        MOVEI   R1,MSPTR##      ;GET STORE MODE
  1175	015333'	135041	000000	10900	        LDB     R1,(R1)
  1176	015334'	602040	000001	10910	        TRNE    R1,1            ;PRINT FILENAME IF DESIRED
  1177				10920	        ERO [XWD[CURPOS
  1178				10930	XWD 10,5
  1179	015335'	022000	022466'	10940	CURPPN],[ASCIZ"_N  _J$"]]
  1180	015336'	263740	000000	10950	        POPJ    P,              ;FAIL RETURN FROM FILIN
  1181
  1182	015337'	261740	000001	10970	FSTWRD: PUSH    P,R1            ;SAVE R1 ON STACK
  1183	015340'	261740	000002	10980	        PUSH    P,R2            ;SAVE R2 ON STACK
  1184				10990	        ERB [XWD[STRBLK
  1185	015341'	024000	022501'	11000	CURPPN],[ASCIZ "STARTING WITH BLOCK _C OF FILE _J.$"]]
  1186	015342'	200040	013313'	11010	        MOVE    R1,STRBLK       ;GET THE STARTING WORD
  1187	015343'	202040	021762'	11020	        MOVEM   R1,OLDBLK#      ;SAVE IN CASE FILE IS SPLIT TWICE
  1188	015344'	402000	013313'	11030	        SETZM   STRBLK          ;SET STARTING BLOCK TO ZERO
  1189	015345'	074301	000000	11040	        USETI   FIL,(R1)        ;SET FILE AT STARTING BLOCK
  1190	015346'	262740	000002	11050	        POP     P,R2            ;RESTORE R2 FROM STACK
  1191	015347'	262740	000001	11060	        POP     P,R1            ;RESTORE R1 FROM STACK
  1192	015350'	263740	000000	11070	        POPJ    P,              ;RETURN FROM FSTWRD
  1193
  1194				11090	;MAG TAPE OUTPUT
  1195
  1196	015351'	200100	013672'	11110	TAPOUT: MOVE R2,TPSZM4 ;TAPE RECORD SIZE-4    DATA WDS/BUFFER
  1197	015352'	277100	013257'	11120	        SUBB    R2,TAPHD2       ;COMPUTE WORDS USED
  1198	015353'	322100	015656'	11130	        JUMPE   R2,NULTAP       ;NONE USED, DONT OUTPUT
  1199	015354'	550040	013255'	11140	        HRRZ    R1,TAPHED       ;ADDR OF BUFFER CURRENTLY IN USE
  1200	015355'	542101	000002	11150	        HRRM    R2,2(R1)        ;BUFFERED BINARY WORD COUNT FOR TITO
  1201	015356'	350000	000002	11160	        AOS     R2
  1202	015357'	552101	000001	11170	        HRRZM   R2,1(R1)        ;TOTAL DATA WORD COUNT FOR MONITOR
  1203	015360'	256012	014005'	11180	TAPOU1: XCT MOUT(UNIT)          ;WRITE ANOTHER RECORD
  1204	015361'	254000	015662'	11190	        JRST    TAPOU3           ;WRITE OK
  1205	015362'	256012	014045'	11200	        XCT MSTERR(UNIT)        ;CHECK ERROR BITS
  1206	015363'	254000	015412'	11210	        JRST    BADTAP          ;SOME KIND OF ERROR
  1207	015364'	256012	014043'	11220	TPROC:  XCT MSTEOT(UNIT)        ;PHYSICAL END OF TAPE
  1208	015365'	254000	015662'	11230	        JRST    TAPOU3          ;POST-RECORD CLEANUP
  1209	015366'	603400	000001	11240	        TLNE    F,EOTFND        ;POST EOT
  1210	015367'	254000	015662'	11250	        JRST    TAPOU3           ;IGNORE EOT LOGIC
  1211	015370'	623400	000002	11260	        TLZE    F,EOFFND        ;TEST FOR LAST BUFFER IN FILE
  1212	015371'	254000	015406'	11270	        JRST    ETNF            ;EOF--GET NEXT FILE
  1213	015372'	371000	013706'	11280	        SOSL    ERC             ;DECREMENT EXCESSIVE RECORD COUNT
  1214	015373'	254000	015662'	11290	        JRST    TAPOU3           ;KEEP WRITING PAST EOT INDICATOR
  1215	015374'	260740	015725'	11300	ETNF2:  PUSHJ   P,SETSTR        ;SET UP STARTING FILE PARAMETERS
  1216	015375'	332000	013313'	11310	        SKIPE   STRBLK          ;SKIP IF FILE NOT SPLIT
  1217	015376'	254000	015401'	11320	        JRST    SPLIT           ;FILE CONTINUED ON NEXT TAPE
  1218	015377'	024000	022512'	11330	        ERB [XWD[LSTPPN],[ASCIZ"THE LAST FILE ON THIS TAPE IS: _J$"]]
  1219	015400'	024000	022524'	11340	        ERB [XWD[CURPPN],[ASCIZ"THE FIRST FILE ON THE NEXT TAPE WILL BE: _J$"]]
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-22
TAP.MAC	23-MAR-79 11:41	

  1220	015401'	661400	000001	11350	SPLIT:  TLO     F,EOTFND        ;IGNORE EOT LOGIC HENCEFORTH
  1221	015402'	254000	015741'	11360	        JRST    ETBRET          ;SETUP NEXT RECORD (TRAILER)
  1222	015403'	661400	000001	11370	ETNF1:  TLO     F,EOTFND        ;IGNORE EOT LOGIC
  1223	015404'	260740	015015'	11380	        PUSHJ   P,MFD2          ;GET NEXT USER
  1224	015405'	254000	014225*	11390	        JRST    CDISP           ;STORE COMPLETE--MFD2 WRITES TRAILER
  1225	015406'	260740	015103'	11400	ETNF:   PUSHJ   P,UFD2          ;GET NEXT FILE
  1226	015407'	254000	015403'	11410	        JRST    ETNF1           ;NO MORE FILES--UFD2 DOES CLSUSR
  1227	015410'	402000	021734'	11420	        SETZM   BLKCNT          ;FILE NOT SPLIT
  1228	015411'	254000	015374'	11430	        JRST    ETNF2           ;THERE WILL BE NO EOF BEFORE TRAILER
  1229				11440	                                ;SINCE LSTPPN=CURPPN
  1230	015412'	256012	014041'	11450	BADTAP: XCT MSTWRL(UNIT)        ;WRITE-LOCKED TAPE?
  1231	015413'	254000	015424'	11460	        JRST    TAPNWR          ;NEED WRITE RING IN TAPE
  1232	015414'	332000	013316'	11470	        SKIPE CURPPN
  1233	015415'	024000	022531'	11480	        ERB [XWD[CURPPN],[ASCIZ"ERROR WRITING _J--"]]
  1234	015416'	256012	014037'	11490	        XCT MSTPDE(UNIT)        ;PHYSICAL DEVICE ERROR?
  1235	015417'	254000	015422'	11500	        JRST    TAPPDE          ;YES
  1236	015420'	024000	022537'	11510	        ERB [XWD 0,[ASCIZ"TAPE WRITE PARITY ERROR$"]]
  1237	015421'	254000	015425'	11520	        JRST TAPCON
  1238				11530	TAPPDE: ERB [XWD 0,[ASCIZ "PHYSICAL DEVICE ERROR
  1239	015422'	024000	022557'	11540	THIS SECTION OF TAPE MAY BE HOPELESSLY UNREADABLE.$"]]
  1240	015423'	254000	015425'	11550	        JRST    TAPCON          ;ACCEPT CARRIAGE RETURN AND RETRY
  1241	015424'	015000	022560'	11560	TAPNWR: ERROR   [ASCIZ "TAPE NEEDS A WRITE RING. "]
  1242	015425'	332000	013316'	11570	TAPCON: SKIPE CURPPN
  1243	015426'	661400	100000	11580	        TLO F,RPTFIL            ;SET TO REPEAT SAME FILE AT BEGINNING
  1244	015427'	256012	014031'	11590	        XCT MGET2(UNIT)         ;CLEAR ERROR BITS FOR RETRY
  1245	015430'	421100	760000	11600	        ANDCMI  R2,760000       ;CLEAR THE BITS
  1246	015431'	256012	014035'	11610	        XCT MSET2(UNIT)         ;PUT STATUS BACK
  1247				11620	        ERT [XWD[TPROC
  1248	015432'	023000	022574'	11630	ABORTA],[ASCIZ "CONTINUE? _F_G_E"]]
  1249
  1250	015433'	400100	000000	11650	AGUFO:  SETZ    R2,             ;ALL
  1251	015434'	554100	000015	11660	        HLRZ    R2,U            ;GANS
  1252	015435'	260740	015444'	11670	        PUSHJ P,CKTR            ;USERS
  1253	015436'	260740	015444'	11680	        PUSHJ P,CKTR            ;FILES
  1254
  1255				11700	DEFINE  CNTF    (X) <
  1256				11710	CNTF'X==:.-CNTTAB
  1257				11720	        CNTF'X'R>
  1258
  1259			400100	11740	TRTF==:(POINT 1,0,3)            ;INDICATES THAT TAPE USER NAME
  1260				11750	;       WILL BE FOUND IN TRANSLATION TABLE.  UUN AND LUD LOCATOR
  1261				11760	;       IN COMMAND LIST ARE THOSE OF THE USER TO RECEIVE THE FILES.
  1262			410100	11770	SUCS==:(POINT 1,0,2)            ;SUCCESS MATCH BY CKNFIL
  1263			221200	11780	LUDLC==:(POINT 10,0,17)          ;POINTER FOR LUD LOCATOR
  1264			420200	11790	CNTFP==:(POINT 2,0,1)           ;POINTER USED TO GET THIS FIELD
  1265	015437'			11800	CNTTAB: BLOCK   0               ;TABLE FOR CONTROL FIELD OF LIST
  1266	015437'	000000	015601'	11810	        CNTF    (C)             ;ITEM TERMINATED WITH A COMMA
  1267	015440'	000000	015605'	11820	        CNTF    (D)             ;ITEM TERMINATED WITH A DASH
  1268	015441'	000000	015621'	11830	        CNTF    (T)             ;ITEM TERMINATED WITH A CR
  1269	015442'	000000	015577'	11840	        CNTF    (N)             ;NOT
  1270
  1271	015443'	400000	000000	11860	ALLLST::BYTE(2)CNTFT            ;DUMMY LIST FOR ALL FILES
  1272
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-23
TAP.MAC	23-MAR-79 11:41	

  1273	015444'	135100	022575'	11880	CKTR:   LDB R2,[XWD TRTF+R1,0]  ;CHECK TRANSLATE BIT
  1274	015445'	302100	000001	11890	        CAIE R2,1               ;ARE WE TRANSLATING
  1275	015446'	254000	015464'	11900	        JRST CKTR2              ;NO
  1276	015447'	200100	000000	11910	        MOVE R2,R0              ;NOTE THAT WE CANNOT GET HERE WITH OLD
  1277				11920	;                               TAPE FILES.  FHDR7 WILL NOT ALLOW US TO
  1278				11930	;                               PROCESS TEX FILES WHILE TRANSLATE IS IN EFFECT.
  1279	015450'	200002	000001	11940	        MOVE R0,1(R2)
  1280	015451'	312000	013322'	11950	        CAME CURUN1
  1281	015452'	254000	015462'	11960	        JRST CKTR1
  1282	015453'	200002	000002	11970	        MOVE R0,2(R2)
  1283	015454'	312000	013323'	11980	        CAME CURUN2
  1284	015455'	254000	015462'	11990	        JRST CKTR1
  1285	015456'	200002	000000	12000	        MOVE R0,(R2)
  1286	015457'	202000	013705'	12010	        MOVEM PPN
  1287	015460'	200000	000002	12020	        MOVE R0,R2
  1288	015461'	263740	000000	12030	        POPJ P,
  1289	015462'	210000	000002	12040	CKTR1:  MOVN R0,R2
  1290	015463'	263740	000000	12050	        POPJ P,
  1291	015464'	550100	000015	12060	CKTR2:  HRRZ R2,U
  1292	015465'	263740	000000	12070	        POPJ P,
  1293	015466'	430100	022124'	12080	CKNCHR: XOR     R2,[SIXBIT /#/] ;CHECK FOR POUND SIGN CHAR
  1294	015467'	607100	770000	12090	        TLNN    R2,770000       ;SKIP IF IT'S NOT A POUND SIGN
  1295	015470'	621140	770000	12100	        TLZ     R3,770000       ;THAT CHAR OF FILE MATCHES
  1296	015471'	430100	022125'	12110	        XOR     R2,[BYTE (6)34] ;EXCLUSIVE OR OF QUESTION AND POUND
  1297	015472'	627100	770000	12120	        TLZN    R2,770000       ;SKIP IF IT'S NOT A QUESTION MARK
  1298	015473'	621140	770000	12130	        TLZ     R3,770000       ;MAKE THAT CHAR OF FILE MATCH
  1299	015474'	623140	770000	12140	        TLZE    R3,770000       ;SKIP IF CHARS MATCH
  1300	015475'	263740	000000	12150	        POPJ    P,              ;FAIL RETURN
  1301	015476'	246100	000006	12160	        LSHC    R2,6            ;SHIFT TO NEXT CHAR
  1302	015477'	326140	015466'	12170	        JUMPN   R3,CKNCHR       ;LOOP IF OTHER CHARS DON'T MATCH
  1303	015500'	254000	016256'	12180	        JRST    CPOPJ1          ;SUCCESS RETURN
  1304
  1305
  1306	015501'	554040	013372'	12210	CKNCRE: HLRZ R1,CRTION  ;CHECK THE DATE BITS
  1307	015502'	313040	013370'	12220	        CAMLE   R1,CREDAT       ;SKIP IF DATE OF FILE NOT GREATER
  1308	015503'	254000	016256'	12230	        JRST    CPOPJ1          ;SKIP RETURN
  1309	015504'	312040	013370'	12240	        CAME    R1,CREDAT       ;SKIP IF DATES ARE EQUAL
  1310	015505'	263740	000000	12250	        POPJ    P,              ;FAIL RETURN
  1311	015506'	550040	013372'	12260	        HRRZ R1,CRTION  ;GET THE TIME BITS
  1312	015507'	311040	013371'	12270	        CAML    R1,CRETIM       ;SKIP IF FILE TIME IS TOO OLD
  1313	015510'	254000	016256'	12280	        JRST    CPOPJ1          ;SKIP RETURN
  1314	015511'	263740	000000	12290	        POPJ    P,              ;FAIL RETURN
  1315	015512'	336000	013373'	12300	CKNCHG: SKIPN   CHANGD          ;SKIP IF WE'RE CHECKING FOR CHANGED FILES
  1316	015513'	254000	016256'	12310	        JRST    CPOPJ1          ;SUCCESS RETURN FROM CKNCHG IF NOT CHECKING
  1317	015514'	200040	013764'	12320	        MOVE    R1,UFDBTS       ;GET STATUS BITS FROM UFD
  1318	015515'	606040	200000	12330	        TRNN    R1,UCHGBT       ;SKIP IF FILE NOT CHANGED
  1319	015516'	350017	000000	12340	        AOS     (P)             ;CHANGED SO SKIP RET AND DUMP IT
  1320	015517'	263740	000000	12350	        POPJ    P,              ;RETURN FROM CKNCHG
  1321
  1322	015520'	476000	021740'	12370	CKNFIL: SETOM CKNFP     ;NOT STATE 3 OR ALL FILES
  1323	015521'	201040	000002	12380	        MOVEI   R1,2            ;SECOND PART OF COMMAND
  1324	015522'	554101	015300*	12390	        HLRZ    R2,CTABL2(R1)   ;GET STATE FOR SECOND PART OF COMMAND
  1325	015523'	302100	000000*	12400	        CAIE    R2,FF2##        ;SKIP IF CHECKING FOR INDIVIDUAL FILES
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-24
TAP.MAC	23-MAR-79 11:41	

  1326	015524'	254000	016256'	12410	        JRST    CPOPJ1          ;SUCCESS RETURN - ALL FILES ARE OK
  1327	015525'	550041	015522*	12420	        HRRZ    R1,CTABL2(R1)   ;ADDRESS OF LIST
  1328	015526'	135100	022117'	12430	        LDB     R2,[XWD CNTFP+R1,0]
  1329	015527'	302100	000002	12440	        CAIE    R2,CNTFT        ;SKIP IF THIS IS END OF USER NAME ETC
  1330	015530'	344040	015526'	12450	        AOJA    R1,.-2          ;LOOK AT THE NEXT ENTRY
  1331	015531'	550101	000002	12460	CKNNX1: HRRZ    R2,2(R1)        ;GET THE EXTENSION
  1332	015532'	204141	000001	12470	        MOVS    R3,1(R1)        ;GET FILE NAME BACKWARDS
  1333	015533'	306140	415454	12480	        CAIN    R3,(SIXBIT /ALL/)
  1334	015534'	322100	016256'	12490	        JUMPE   R2,CPOPJ1       ;SUCCESS RETURN IF FILE "ALL"
  1335	015535'	306140	120000	12500	        CAIN    R3,(SIXBIT /*/) ;SKIP IF NOT WILD CARD
  1336	015536'	204140	000015	12510	        MOVS    R3,U            ;MAKE THE FILE NAMES MATCH
  1337	015537'	204140	000003	12520	        MOVS    R3,R3           ;PUT THE FILE NAME BACK THE WAY IT SHOULD BE
  1338	015540'	200100	000003	12530	        MOVE    R2,R3           ;ALSO PUT FILE NAME IN R2
  1339	015541'	430140	000015	12540	        XOR     R3,U            ;EXCLUSIVE OR THE NAMES TO FIND DIFF
  1340	015542'	260740	015466'	12550	        PUSHJ   P,CKNCHR        ;SKIP IF NAMES MATCH
  1341	015543'	344040	015556'	12560	        AOJA    R1,CKNNXT       ;DON'T MATCH SO TRY THE NEXT
  1342	015544'	550141	000002	12570	        HRRZ    R3,2(R1)        ;EXTENSION IN RH FOR EASY COMPARE
  1343	015545'	306140	120000	12580	        CAIN    R3,(SIXBIT /*/) ;SKIP IF IT'S NOT A WILD CARD
  1344	015546'	550140	000016	12590	        HRRZ    R3,W            ;MAKE THE EXTENSIONS MATCH
  1345	015547'	200100	000003	12600	        MOVE    R2,R3           ;ALSO PUT EXTENSION IN R2
  1346	015550'	430140	000016	12610	        XOR     R3,W            ;EXCLUSIVE OR THE EXTENSIONS TO FIND DIFF
  1347	015551'	246100	000022	12620	        LSHC    R2,22           ;THIS ISN'T NECESSARY BUT SPEEDS UP CKNCHR
  1348	015552'	260740	015466'	12630	        PUSHJ   P,CKNCHR        ;SKIP IF NAMES MATCH
  1349	015553'	344040	015556'	12640	        AOJA    R1,CKNNXT       ;DON'T MATCH SO TRY THE NEXT
  1350	015554'	202040	021740'	12650	        MOVEM R1,CKNFP#         ;POS. WHEN CONTAINING ADDRESS OF A
  1351				12660	;                               FILENAME MATCH OTHER THAN "ALL"
  1352	015555'	254000	016256'	12670	        JRST    CPOPJ1          ;SUCCESS RETURN FOR MATCH
  1353	015556'	135100	022135'	12680	CKNNXT: LDB     R2,[XWD CNTFP+R1,1]
  1354	015557'	306100	000002	12690	        CAIN    R2,CNTFT        ;SKIP IF NOT THE LAST FILE IN LIST
  1355	015560'	263740	000000	12700	        POPJ    P,              ;FAIL RETURN
  1356	015561'	344040	015531'	12710	        AOJA    R1,CKNNX1       ;CHECK THE NEXT FILE NAME
  1357
  1358	015562'	476000	021756'	12730	CKNPPN: SETOM   NOTWRD#         ;-1 FOR NORMAL, 0 FOR NOT
  1359	015563'	201040	000002	12740	        MOVEI   R1,2            ;SECOND PART OF COMMAND
  1360	015564'	200041	015525*	12750	        MOVE    R1,CTABL2##(R1) ;GET PARAMETERS FOR COMMAND
  1361	015565'	554140	000001	12760	        HLRZ    R3,R1           ;SAVE STATE IN R3
  1362	015566'	322040	016256'	12770	        JUMPE   R1,CPOPJ1       ;SUCCESS RET IF NOT SET UP
  1363	015567'	135100	022117'	12780	        LDB     R2,[XWD CNTFP+R1,0]
  1364	015570'	550001	000000	12790	        HRRZ    R0,(R1)
  1365	015571'	260762	015437'	12800	        PUSHJ   P,@CNTTAB(R2)
  1366	015572'	344040	015567'	12810	        AOJA    R1,.-3          ;LOOP
  1367	015573'	312100	022576'	12820	        CAME    R2,[-1]         ;SKIP IF NO MATCH
  1368	015574'	400100	000000	12830	        SETZ    R2,             ;ZERO FOR MATCH
  1369	015575'	430100	021756'	12840	        XOR     R2,NOTWRD       ;INVERT IF NORMAL, DO NOTHING IF NOT
  1370	015576'	254002	016257'	12850	        JRST    CPOPJ(R2)       ;ADD ONE FOR SUCCESS RETURN
  1371
  1372	015577'	462000	021756'	12870	CNTFNR: SETCMM  NOTWRD          ;INVERT THE OPERATION
  1373	015600'	263740	000000	12880	        POPJ    P,
  1374	015601'	256003	015433'	12890	CNTFCR: XCT     AGUFO(R3)
  1375	015602'	316000	000002	12900	        CAMN    R0,R2           ;SKIP IF NOT DONE
  1376	015603'	350017	000000	12910	        AOS     (P)             ;DONE - DON'T LOOP ANYMORE
  1377	015604'	263740	000000	12920	        POPJ    P,
  1378	015605'	256003	015433'	12930	CNTFDR: XCT     AGUFO(R3)
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-25
TAP.MAC	23-MAR-79 11:41	

  1379	015606'	340040	000000	12940	        AOJ     R1,
  1380	015607'	313000	000002	12950	        CAMLE   R0,R2
  1381	015610'	254000	015614'	12960	        JRST    CNTFTT
  1382	015611'	550001	000000	12970	        HRRZ    R0,(R1)
  1383	015612'	311000	000002	12980	        CAML    R0,R2
  1384	015613'	254000	016256'	12990	        JRST    CPOPJ1 
  1385	015614'	135100	022117'	13000	CNTFTT: LDB     R2,[XWD CNTFP+R1,0]
  1386	015615'	474000	000000	13010	        SETO    R0,
  1387	015616'	306100	000002	13020	        CAIN    R2,CNTFT        ;SKIP IF NOT A TERMINATOR
  1388	015617'	350017	000000	13030	        AOS     (P)             ;TERMINATOR, SO STOP LOOPING
  1389	015620'	263740	000000	13040	        POPJ    P,
  1390	015621'	256003	015433'	13050	CNTFTR: XCT     AGUFO(R3)
  1391	015622'	312000	000002	13060	        CAME    R0,R2           ;SKIP IF MATCH
  1392	015623'	474100	000000	13070	        SETO    R2,             ;TERMINATE WITHOUT MATCH
  1393	015624'	254000	016256'	13080	        JRST    CPOPJ1          ;DONE LOOPING NO MATTER WHAT HAPPENED
  1394
  1395				13100	;OUTPUT TRAILER BLOCK
  1396
  1397	015625'	210040	022001'	13120	TRLOUT: MOVN    R1,TAPNUM       ;NEGATE TAPE #
  1398	015626'	542040	013304'	13130	        HRRM    R1,FIRBL2       ;RESET TRAILER
  1399	015627'	660400	000040	13140	        TRO F,EOTFLG            ;SET FLAG  TO REMIND DIR OR RES
  1400				13150	                                ;TO BACKSPACE FILE AT THIS POINT
  1401				13160	                                ;FALL INTO LABBLT
  1402
  1403				13180	;WRITE HEADER OR TRAILER ON TAPE
  1404
  1405	015630'	200040	013765'	13200	LABBLT: MOVE    R1,DAYTIM       ;GET DATE ETC
  1406	015631'	621040	700000	13210	        TLZ     R1,MSKCTD       ;TURN OFF CONTINUED BITS
  1407	015632'	332000	013310'	13220	        SKIPE   STRPPN          ;SKIP IF NO STARTING PPN
  1408	015633'	661040	400000	13230	        TLO     R1,TAPCTD       ;THIS IS A CONTINUATION TAPE
  1409	015634'	332000	013311'	13240	        SKIPE   STRFIL          ;SKIP IF NO STARTING FILE
  1410	015635'	661040	200000	13250	        TLO     R1,USRCTD       ;USER IS CONTINUED FROM PREVIOUS TAPE
  1411	015636'	332000	013313'	13260	        SKIPE   STRBLK          ;SKIP IF NO STARTING BLOCK
  1412	015637'	661040	100000	13270	        TLO     R1,FILCTD       ;FILE IS CONTINUED FROM PREVIOUS TAPE
  1413	015640'	202040	013305'	13280	        MOVEM   R1,FIRBL3       ;SAVE WORD IN TAPE HEADER
  1414	015641'	201040	000010	13290	        MOVEI   R1,10           ;ASSUME TAPE VERSION 10
  1415	015642'	607400	004000	13300	        TLNN    F,P12FLG        ;SKIP IF MON P012 OR LATER
  1416	015643'	506040	013302'	13310	        HRLM    R1,FIRBLK       ;CREATING OLD FORMAT TAPE
  1417	015644'	205040	013302'	13320	        MOVSI   R1,FIRBLK       ;ADDR OF HEADER
  1418	015645'	540040	013256'	13330	        HRR     R1,TAPHD1       ;GET BUFFER DATA ADDR FROM BYTE PTR
  1419	015646'	201101	000004	13340	        MOVEI   R2,4(R1)        ;SET STOP AT 5TH DATA WORD
  1420	015647'	251042	000000	13350	        BLT     R1,(R2)         ;BLT HEADER INTO BUFFER
  1421	015650'	542100	013256'	13360	        HRRM    R2,TAPHD1       ;RESET BYTE POINTER
  1422	015651'	211040	000003	13370	        MOVNI   R1,3            ;RESET COUNT
  1423	015652'	272040	013257'	13380	        ADDM    R1,TAPHD2
  1424	015653'	370000	013257'	13390	        SOS     TAPHD2          ;ADJUST FOR NON-LOOP CALL
  1425	015654'	260740	015351'	13400	        PUSHJ   P,TAPOUT        ;WRITE ONE RECORD
  1426	015655'	260740	015666'	13410	CLSUSR: PUSHJ P,MTCLS           ;CLOSE TAPE
  1427	015656'	205040	400000	13420	NULTAP: MOVSI   R1,400000       ;TURN OFF VIRGIN BIT
  1428	015657'	413040	013255'	13430	        ANDCAB  R1,TAPHED
  1429	015660'	350000	000001	13440	        AOS     R1              ;SET BYTE POINTER TO BEG OF BUFFER
  1430	015661'	542040	013256'	13450	        HRRM    R1,TAPHD1
  1431	015662'	200040	013672'	13460	TAPOU3: MOVE R1,TPSZM4 ;TAPE RECORD SIZE-4   DATA WDS/BUFFER -1
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-26
TAP.MAC	23-MAR-79 11:41	

  1432	015663'	552040	013257'	13470	        HRRZM   R1,TAPHD2       ;BUFFER COUNT
  1433	015664'	136040	013256'	13480	        IDPB    R1,TAPHD1       ;BUFFER COUNT TO 1ST DATA WORD
  1434	015665'	263740	000000	13490	        POPJ    P,              ;RETURN
  1435
  1436				13510	; CLOSE TAPE.  ASSURE USE BIT TURNED OFF IN BUFFER HEADER
  1437	015666'	256012	014017'	13520	MTCLS:: XCT MCLOS(UNIT)         ;ASK THE MONITOR TO CLOSE
  1438	015667'	256012	014053'	13530	        XCT MTWAIT(UNIT)        ;WAIT UNTIL OUTPUT FINISHED
  1439	015670'	256012	014027'	13540	        XCT MGET1(UNIT)
  1440	015671'	606040	740000	13550	        TRNN R1,740000
  1441	015672'	263740	000000	13560	        POPJ P,
  1442	015673'	602040	400000	13570	        TRNE R1,400000
  1443	015674'	024000	022605'	13580	        ERB [XWD 0,[ASCIZ"$TAPE WRITE LOCKED AT CLOSE"]]
  1444	015675'	602040	200000	13590	        TRNE R1,200000
  1445	015676'	024000	022613'	13600	        ERB [XWD 0,[ASCIZ"$PHYS DEV ERR AT CLOSE"]]
  1446	015677'	602040	100000	13610	        TRNE R1,100000
  1447	015700'	024000	022621'	13620	        ERB [XWD 0,[ASCIZ"$PARITY ERR AT CLOSE"]]
  1448	015701'	421040	740000	13630	        ANDCMI R1,740000
  1449	015702'	256012	014033'	13640	        XCT MSET1(UNIT)
  1450	015703'	205040	400000	13650	        MOVSI R1,400000
  1451	015704'	412040	002763'	13660	        ANDCAM R1,TAPBUF+1
  1452	015705'	436040	013255'	13670	        IORM R1,TAPHED
  1453	015706'	200040	016061'	13680	        MOVE R1,INOUT
  1454	015707'	602040	777777	13690	        TRNE R1,777777
  1455	015710'	254000	015713'	13700	        JRST .+3
  1456	015711'	256012	014007'	13710	        XCT MOUTPUT(UNIT) ;VACUOUS TO REINITIALIZE DEVOAD
  1457	015712'	263740	000000	13720	        POPJ P,
  1458	015713'	256012	014013'	13730	        XCT MINPUT(UNIT)
  1459	015714'	263740	000000	13740	        POPJ P,
  1460
  1461				13760	;BLT HEADERS INTO TAPE BUFFER
  1462
  1463	015715'	205040	013515'	13780	DIRBLT: MOVSI   R1,FILMRK       ;HEADER WORD FOR DIRECTORY
  1464	015716'	540040	013256'	13790	        HRR     R1,TAPHD1       ;GET BUFFER DATA ADDR FROM BYTE PTR
  1465	015717'	201101	000100	13800	        MOVEI   R2,XHDRN(R1)    ;SET STOP AT LAST RETRIEVAL WORD
  1466	015720'	251042	000000	13810	        BLT     R1,(R2)         ;BLT HEADER INTO BUFFER
  1467	015721'	542100	013256'	13820	        HRRM    R2,TAPHD1       ;RESET BYTE POINTER
  1468	015722'	211040	000077	13830	        MOVNI   R1,XHDRN-1      ;RESET COUNT
  1469				13840	; IF THIS LOOKS STRANGE CONSIDER XHDRN=776 SO THAT THERE IS
  1470				13850	; ROOM FOR ONE DATA WORD PAST THE HEADER.  THEN TAPHD2 WILL BE =
  1471				13860	; TWO SO THAT ONE WORD CAN BE DEPOSITED INTO THE BUFFER AT MORE3
  1472	015723'	272040	013257'	13870	        ADDM    R1,TAPHD2
  1473	015724'	263740	000000	13880	        POPJ    P,              ;RETURN
  1474
  1475	015725'	200040	013316'	13900	SETSTR: MOVE    R1,CURPPN       ;GET CURRENT PPN - ONLY RH COUNTS
  1476	015726'	202040	013310'	13910	        MOVEM   R1,STRPPN       ;MAKE IT THE STARTING PPN FOR NEXT TAPE
  1477	015727'	200040	013317'	13920	        MOVE    R1,CURFIL       ;GET CURRENT FILE NAME
  1478	015730'	202040	013311'	13930	        MOVEM   R1,STRFIL       ;MAKE IT THE STARTING FILE FOR NEXT TAPE
  1479	015731'	200040	013320'	13940	        MOVE    R1,CUREXT       ;GET CURRENT EXTENSION
  1480	015732'	512040	013312'	13950	        HLLZM   R1,STREXT       ;MAKE IT THE STARTING EXT FOR NEXT TAPE
  1481	015733'	200040	021734'	13960	        MOVE    R1,BLKCNT       ;GET REAL BLOCK COUNT IF ENOUGH TAPE USED
  1482	015734'	270040	021762'	13970	        ADD     R1,OLDBLK       ;ADD IN PREVIOUS STRT BLK IF ANY
  1483	015735'	202040	013313'	13980	        MOVEM   R1,STRBLK       ;SAVE STARTING BLOCK OF FILE
  1484	015736'	332000	013313'	13990	        SKIPE   STRBLK          ;SKIP IF FILE IS NOT SPLIT
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-27
TAP.MAC	23-MAR-79 11:41	

  1485	015737'	260740	020566'	14000	        PUSHJ P,PCFM    ;PRINT CONTINUED FILE MESSAGES AND FIX CKSUM
  1486	015740'	263740	000000	14010	        POPJ    P,              ;RETURN FROM SETSTR
  1487
  1488	015741'	260740	015662'	14030	ETBRET: PUSHJ   P,TAPOU3        ;SET UP TRAILER
  1489	015742'	260740	015625'	14040	        PUSHJ   P,TRLOUT        ;WRITE TRAILER
  1490	015743'	070200	000010	14050	        CLOSE   MFD,DNC         ;CLOSE THE MFD
  1491	015744'	071200	000000	14060	        RELEASE MFD,
  1492	015745'	070300	000010	14070	        CLOSE FIL,DNC
  1493	015746'	071300	000000	14080	        RELEASE FIL,
  1494	015747'	260740	016377'	14090	        PUSHJ   P,NXTTAP        ;REWIND CURRENT TAPE, GET NEXT MTD
  1495	015750'	200740	021774'	14100	        MOVE    P,STOSTP        ;FIX STACK FOR BRANCH OUT OF SUBROUTINE
  1496	015751'	254000	014104'	14110	        JRST    CONSTO          ;CONTINUE THE STORE
  1497
  1498				14130	; PREPARE TAPE FOR OUTPUT.  USED BY STORE AND CUT COMMANDS
  1499
  1500	015752'	260740	016024'	14150	WPREP:  PUSHJ   P,SETOUT        ;INIT TAPE AND SET UP HEADER AS VIRGIN
  1501	015753'	256012	014007'	14160	        XCT MOUTPUT(UNIT)       ;DUMMY OUTPUT TO SET UP TAPHED
  1502	015754'	260740	015662'	14170	        PUSHJ   P,TAPOU3        ;SET UP BUFFER COUNTS
  1503	015755'	607400	020000	14180	        TLNN F,CUTFLG           ;CUT PERMITTED PAST REFLECTIVE SPOT
  1504	015756'	607400	000001	14190	        TLNN F,EOTFND           ;AT END OF TAPE MARKER OR BEYOND
  1505	015757'	254000	015761'	14200	        JRST .+2                ;EITHER NOT THERE OR CUT COMMAND
  1506	015760'	015000	022622'	14210	        ERROR [ASCIZ"ATTEMPT TO STORE PAST PHYSICAL EOT"]
  1507	015761'	620400	000040	14220	        TRZ F,EOTFLG            ;NOT POSITIONED AT LOGICAL EOT
  1508				14230	;*      TLNE    F,BOTFLG        ;SKIP IF NOT AT BEGINNING OF TAPE
  1509	015762'	256012	014001'	14240	        XCT MF13(UNIT)          ;ERASE 3 INCHES TO GET OFF LOAD POINT
  1510	015763'	256012	013771'	14250	        XCT MF0(UNIT)           ;WAIT FOR OPERATION TO COMPLETE
  1511	015764'	350040	022001'	14260	        AOS     R1,TAPNUM       ;INCREMENT AND LOAD TAPE SEQ NUMBER
  1512	015765'	542040	013304'	14270	        HRRM    R1,FIRBL2       ;PLACE IN HEADER
  1513	015766'	260740	015776'	14280	        PUSHJ P,NHDAT
  1514				14290	; MOVE PERMANENT TAPE PARAMETERS TO FILE HDR BLOCK
  1515	015767'	200000	013765'	14300	        MOVE DAYTIM
  1516	015770'	202000	013614'	14310	        MOVEM TPTIM
  1517	015771'	541000	000015	14320	        HRRI R0,VERSION
  1518	015772'	505000	446353	14330	        HRLI R0,(SIXBIT/DSK/)
  1519	015773'	202000	013516'	14340	        MOVEM FILDM1
  1520	015774'	260740	016011'	14350	        PUSHJ P,TPID
  1521	015775'	263740	000000	14360	        POPJ P,
  1522
  1523	015776'	661400	010000	14380	NHDAT:  TLO     F,T12FLG        ;WRITING NEW FORMAT TAPE
  1524	015777'	200040	022631'	14390	        MOVE    R1,[XWD 11,11]  ;GETTAB FOR DATE IN DAYS SINCE 1964 GMT
  1525	016000'	047040	000041	14400	        GETTAB  R1,
  1526	016001'	400040	000000	14410	        SETZ    R1,             ;SHOULD NEVER FAIL BUT DEFAULT TO 0
  1527	016002'	202040	013765'	14420	        MOVEM   R1,DAYTIM       ;SAVE THE DATE
  1528	016003'	200040	022632'	14430	        MOVE    R1,[XWD 10,11]  ;GETTAB FOR TIME IN JIFFIES GMT
  1529	016004'	047040	000041	14440	        GETTAB  R1,
  1530	016005'	400040	000000	14450	        SETZ    R1,             ;SHOULD NEVER FAIL BUT DEFAULT TO 0
  1531	016006'	230040	013375'	14460	        IDIV    R1,JIFFPM       ;CONVERT JIFFIES TO MINUTES
  1532	016007'	137040	022633'	14470	        DPB     R1,[POINT 11,DAYTIM,21] ;SAVE TIME
  1533	016010'	263740	000000	14480	        POPJ P,
  1534
  1535				14500	; GET SYSTEM IDENT AND SAVE IN TPID1,2
  1536
  1537	016011'	200000	022634'	14520	TPID:   MOVE R0,[XWD 0,11]
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-28
TAP.MAC	23-MAR-79 11:41	

  1538	016012'	047000	000041	14530	        GETTAB R0,
  1539	016013'	400000	000000	14540	        SETZ R0,
  1540	016014'	202000	013610'	14550	        MOVEM TPID1     ;SYSTEM NAME IN ASCII
  1541	016015'	200000	022635'	14560	        MOVE R0,[XWD 1,11]
  1542	016016'	047000	000041	14570	        GETTAB R0,
  1543	016017'	400000	000000	14580	        SETZ R0,
  1544	016020'	202000	013611'	14590	        MOVEM TPID2     ;2ND WD OF SYSTEM NAME
  1545	016021'	263740	000000	14600	        POPJ P,
  1546
  1547				14620	;INITIALIZE MAGNETIC TAPE
  1548
  1549	016022'	551040	013255'	14640	SETIN:  HRRZI   R1,TAPHED       ;SET UP FOR INPUT
  1550	016023'	334000	000000	14650	        SKIPA
  1551	016024'	515040	013255'	14660	SETOUT: HRLZI   R1,TAPHED       ;SET UP FOR OUTPUT
  1552	016025'	202040	016061'	14670	        MOVEM   R1,INOUT        ;SET HEADER
  1553	016026'	256012	014021'	14680	        XCT MOPEN(UNIT)         ;OPEN UNIT 0 OR 1
  1554	016027'	015000	022636'	14690	        ERROR   [ASCIZ "CAN'T ACCESS TAPE DEVICE"]
  1555	016030'	256012	014023'	14700	        XCT MCHNL1(UNIT)
  1556	016031'	047040	000004	14710	        CALLI   R1,4            ;GET DEVICE CHARACTERISTICS
  1557	016032'	603040	000020	14720	        TLNE    R1,DVMTA        ;SKIP IF NOT MAGTAPE
  1558	016033'	254000	016037'	14730	        JRST    SETTP
  1559	016034'	256012	014017'	14740	        XCT MCLOS(UNIT)
  1560	016035'	256012	014015'	14750	        XCT MRELS(UNIT)
  1561	016036'	015000	022643'	14760	        ERROR   [ASCIZ "DEVICE NOT MAGTAPE."]
  1562	016037'	200040	022647'	14770	SETTP:  MOVE R1,[TAPBUF+1+1B0]
  1563	016040'	202040	013255'	14780	        MOVEM R1,TAPHED
  1564	016041'	260740	016062'	14790	        PUSHJ P,SETBUF  ;SET UP RING BUFFER
  1565	016042'	621400	000005	14800	        TLZ     F,EOTFND!BOTFLG ;CLEAR EOT AND BOT FLAGS
  1566				14810	        IFL -CUTS,<
  1567	016043'	256012	014027'	14820	        XCT MGET1(UNIT)
  1568	016044'	603400	020000	14830	        TLNE F,CUTFLG
  1569	016045'	435040	000040	14840	        IORI R1,SYNCIN
  1570	016046'	256012	014033'	14850	        XCT MSET1(UNIT)  
  1571				14860	        >
  1572	016047'	256012	014025'	14870	        XCT MUGETF(UNIT)        ;SENSE DEVICE CHARACTERISTICS
  1573	016050'	200040	016776'	14880	        MOVE R1,SENTAB+1
  1574	016051'	603040	040000	14890	        TLNE    R1,040000       ;SKIP IF NOT BEGINNING OF TAPE
  1575	016052'	661400	000004	14900	        TLO     F,BOTFLG        ;AT BEGINNING OF TAPE
  1576	016053'	603040	020000	14910	        TLNE    R1,020000       ;SKIP IF NOT AT END OF TAPE
  1577	016054'	661400	000001	14920	        TLO     F,EOTFND        ;AT END OF TAPE
  1578	016055'	260740	016644'	14930	        PUSHJ P,SETDEN          ;SET TAPE DENSITY
  1579	016056'	263740	000000	14940	        POPJ    P,              ;RETURN
  1580
  1581	016057'	400000	000074	14960	TAPOPN: EXP BUFBIN!NOCNT!1B0!SYNCIN
  1582	016060'	556441	700000	14970	FS6BIT: SIXBIT /MTAX/           ;STORED INTO BY START ROUTINE
  1583	016061'	000000	000000	14980	INOUT:  XWD     0,0             ;STORED INTO BY SETIN/SETOUT
  1584
  1585				15000	; SETBUF SETS UP THE BUFFER RING
  1586	016062'	504040	013670'	15010	SETBUF: HRL R1,TPSZM2 ;TAPE RECORD SIZE-2
  1587	016063'	402000	002762'	15020	        SETZM TAPBUF
  1588	016064'	541040	002763'	15030	        HRRI R1,TAPBUF+1
  1589	016065'	202040	002763'	15040	        MOVEM R1,TAPBUF+1
  1590	016066'	263740	000000	15050	        POPJ P,
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-29
TAP.MAC	23-MAR-79 11:41	

  1591
  1592				15070	; CLRTAP CLOSES TAPE AND CLEARS EOF AND ERROR BITS.  SYSTEM
  1593				15080	; IS NOT CONSISTENT ABOUT DOING THIS.
  1594
  1595	016067'	256012	014017'	15100	CLRTAP: XCT MCLOS(UNIT)
  1596	016070'	256012	014027'	15110	        XCT MGET1(UNIT)
  1597	016071'	620040	760000	15120	        TRZ R1,760000
  1598	016072'	256012	014033'	15130	        XCT MSET1(UNIT)
  1599	016073'	263740	000000	15140	        POPJ P,
  1600
  1601				15160	; TAPIN READS ONE RECORDS FROM TAPE AND RETURNS TO:
  1602				15170	;  CALL+1 IF END OF FILE READ
  1603				15180	;  CALL+2 IF DIRECTORY, HEADER, OR TRAILER IS READ
  1604				15190	;  CALL+3 IF DATA RECORD READ
  1605				15200	; IF IT RETURNS TO CALL+2, R1 TELLS WHAT WAS READ:
  1606				15210	;  TRAILER=-1, HEADER=0, DIRECTORY=1
  1607
  1608	016074'	201000	013316'	15230	TAPIN:  MOVEI R0,CURPPN         ;SET UP FOR ERROR PRINTOUTS
  1609	016075'	202000	021747'	15240	        MOVEM R0,ERRPPN#        ;WILL BE SET TO LSTPPN BY TINDIR
  1610	016076'	476000	000000	15250	        SETOM   R0              ;INITIALIZE ERROR COUNT TO 0-1
  1611	016077'	256012	014011'	15260	TAPINE: XCT MIN(UNIT)           ;READ ANOTHER BUFFER
  1612	016100'	254000	016110'	15270	        JRST    TAPIN2          ;READ OK
  1613	016101'	256012	014051'	15280	        XCT MSTOEND(UNIT)       ;END OF FILE?
  1614	016102'	254000	016145'	15290	        JRST    ERRTIN          ;GO TO ERROR ROUTINE
  1615	016103'	260740	016067'	15300	        PUSHJ P,CLRTAP  ;CLOSE TAPE AND CLEAR END BIT
  1616	016104'	602400	000020	15310	        TRNE F,EOFFLG
  1617	016105'	660400	000040	15320	        TRO F,EOTFLG            ;TWO EOF'S IN A ROW
  1618	016106'	660400	000020	15330	        TRO F,EOFFLG            ;AT LEAST ONE EOF READ
  1619	016107'	263740	000000	15340	        POPJ    P,              ;RETURN CALL+1 (EOF)
  1620
  1621	016110'	620400	000020	15360	TAPIN2: TRZ F,EOFFLG
  1622	016111'	200040	013255'	15370	        MOVE    R1,TAPHED       ;LOOK AT PHYS. EOT BIT
  1623	016112'	200041	777777	15380	        MOVE    R1,-1(R1)       ;IN BFR HDR (NOT RING BFR HDR)
  1624	016113'	602040	002000	15390	        TRNE    R1,IOTEND       ;SKIP IF NOT END OF TAPE FOUND
  1625	016114'	661400	000001	15400	        TLO     F,EOTFND        ;MARK END OF TAPE FOUND
  1626	016115'	134100	013256'	15410	        ILDB    R2,TAPHD1       ;PICKUP WORD COUNT
  1627	016116'	370000	013257'	15420	        SOS     TAPHD2          ;ADJUST WD CT BELOW THIS WORD
  1628	016117'	554100	000002	15430	        HLRZ    R2,R2           ;0 FOR DATA, -1 FOR DIR
  1629	016120'	322100	016255'	15440	        JUMPE   R2,CPOPJ2       ;JUMP IF IT'S A DATA RECORD
  1630	016121'	200040	013255'	15450	        MOVE    R1,TAPHED       ;GET ADDRESS OF CURRENT BUFFER
  1631	016122'	306100	777777	15460	        CAIN    R2,-1           ;SKIP IF NOT A DIR RECORD
  1632	016123'	254000	016201'	15470	        JRST    TINDIR          ;DIRECTORY FOUND
  1633	016124'	504041	000004	15480	        HRL     R1,4(R1)        ;GET THE TAPE NUMBER
  1634	016125'	576040	013304'	15490	        HLREM   R1,FIRBL2       ;SAVE THE TAPE NUMBER
  1635	016126'	217000	013304'	15500	        MOVMS   FIRBL2          ;WE WANT THE MAGNITUDE OF THE NUMBER
  1636	016127'	200041	000005	15510	        MOVE    R1,5(R1)        ;GET FLAGS AND DATE
  1637	016130'	202040	013305'	15520	        MOVEM   R1,FIRBL3       ;SAVE FLAGS AND DATE
  1638	016131'	200040	013255'	15530	        MOVE    R1,TAPHED       ;GET ADDRESS OF CURRENT BUFFER
  1639	016132'	504041	000004	15540	        HRL     R1,4(R1)        ;-=TRAILER, +=HEADER
  1640	016133'	306100	777772	15550	        CAIN    R2,-6
  1641	016134'	015000	022650'	15560	        ERROR   [ASCIZ "FAILSAFE LEVEL C FORMAT TAPE"];*
  1642	016135'	331000	000001	15570	        SKIPL   R1              ;SKIP IF TRAILER
  1643	016136'	621400	000020	15580	        TLZ     F,CTDFLG        ;TURN OF CONTINUED FLAG IF HEADER
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-30
TAP.MAC	23-MAR-79 11:41	

  1644	016137'	335001	000005	15590	        SKIPGE  5(R1)           ;SKIP IF CONTINUED BIT OFF
  1645	016140'	661400	000020	15600	        TLO     F,CTDFLG        ;SET CONTINUED FLAG
  1646	016141'	530040	000001	15610	        HLLE    R1,R1           ;-=TRAILER, +=HEADER; 0 OR -1 IN ADDR
  1647	016142'	327100	016256'	15620	        JUMPG   R2,CPOPJ1       ;HEADER/TRAILER
  1648	016143'	024000	022656'	15630	        ERB [ASCIZ"$UNRECOGNIZABLE TAPE DATA.$"]
  1649	016144'	254000	016152'	15640	        JRST    FAKERR          ;FAKE ERROR--BYPASS QUESTIONABLE RECORD
  1650
  1651	016145'	256012	014027'	15660	ERRTIN: XCT MGET1(UNIT)
  1652	016146'	606040	760000	15670	        TRNN R1,760000
  1653	016147'	254000	016110'	15680	        JRST    TAPIN2          ;NO, FURTHER ALONG IN RING
  1654	016150'	620040	760000	15690	        TRZ     R1,760000       ;CLEAR ERROR BITS
  1655	016151'	256012	014033'	15700	        XCT MSET1(UNIT)         ;SET NEW STATUS
  1656	016152'	347000	016077'	15710	FAKERR: AOJG    R0,TAPINE       ;INC ERR CNT - JUMP IF NOT 1ST ERROR
  1657	016153'	260740	016077'	15720	        PUSHJ   P,TAPINE        ;NOTE THAT THIS IS CALLED RECURSIVELY
  1658	016154'	254000	016164'	15730	        JRST    ETIEOF          ;EOF - TELL OPERATOR AND RETURN
  1659	016155'	254000	016160'	15740	        JRST    ETIDIR          ;DIR - TELL OPERATOR AND RETURN
  1660	016156'	260740	016167'	15750	        PUSHJ P,PFN             ;PRINT FILENAME AND ERROR COUNT
  1661	016157'	254000	016255'	15760	        JRST    CPOPJ2          ;RETURN CALL+3 AS IF NOTHING HAPPENED
  1662	016160'	260740	016167'	15770	ETIDIR: PUSHJ P,PFN
  1663	016161'	306040	000001	15780	        CAIN    R1,1
  1664	016162'	024000	022672'	15790	        ERB [XWD[CURPPN],[ASCIZ"$CONTINUING WITH FILE _J$"]]
  1665	016163'	254000	016256'	15800	        JRST CPOPJ1
  1666	016164'	260740	016167'	15810	ETIEOF: PUSHJ P,PFN
  1667	016165'	024000	022701'	15820	        ERB [XWD 0,[ASCIZ"$CONTINUING WITH NEXT USER.$"]]
  1668	016166'	263740	000000	15830	        POPJ P,
  1669	016167'	350000	000000	15840	PFN:    AOS R0                  ;INCREMENT ERROR CNT BEFORE PRINTING
  1670	016170'	202000	022000'	15850	        MOVEM   R0,TAPERR#      ;SAVE ERROR COUNT FOR PRINTING
  1671	016171'	024000	022707'	15860	        ERB [XWD [TAPERR],[ASCIZ"$_C TAPE ERRORS"]]
  1672	016172'	505100	021747'	15870	        HRLI R2,ERRPPN          ;POINTS TO CURPPN OR LSTPPN
  1673	016173'	541100	022710'	15880	        HRRI R2,[ASCIZ" READING FILE _J"]
  1674	016174'	202100	021766'	15890	        MOVEM R2,PFNE#
  1675	016175'	332020	021747'	15900	        SKIPE @ERRPPN
  1676	016176'	024000	021766'	15910	        ERB PFNE
  1677	016177'	010000	022041'	15920	        TCO [CRCHR]     ;OUTPUT CHAR TO BOTH COF AND TER
  1678	016200'	263740	000000	15930	        POPJ P,
  1679
  1680	016201'	260740	016247'	15950	TINDIR: PUSHJ P,TRCL            ;MOVE CURPPN TO LST
  1681	016202'	200040	013255'	15960	        MOVE R1,TAPHED          ;CURRENT BUFFER
  1682	016203'	205101	000005	15970	        MOVSI   R2,5(R1)        ;ADDRESS OF NEW PPN-FIL-EXT
  1683	016204'	541100	013316'	15980	        HRRI    R2,CURPPN       ;ADDRESS OF CURRENT PPN
  1684	016205'	251100	013320'	15990	        BLT     R2,CUREXT       ;SET UP NEW CURRENT PPN-FIL-EXT
  1685	016206'	620400	000001	16000	        TRZ F,NEWFLG            ;ASSUME NO POSITION NOS.
  1686	016207'	402000	013325'	16010	        SETZM CURVER            ;ASSUME OLD TAPE
  1687	016210'	402000	013331'	16020	        SETZM DATTIM
  1688	016211'	554101	000003	16030	        HLRZ R2,3(R1) ;LOGICAL NAME
  1689	016212'	302100	446353	16040	        CAIE R2,(SIXBIT /DSK/)
  1690	016213'	254000	016243'	16050	        JRST TIND1
  1691	016214'	550101	000003	16060	        HRRZ R2,3(R1)
  1692	016215'	307100	000037	16070	        CAIG R2,37
  1693	016216'	307100	000013	16080	        CAIG R2,13
  1694	016217'	254000	016243'	16090	        JRST TIND1
  1695	016220'	660400	000001	16100	        TRO F,NEWFLG            ;POSITION NOS.
  1696	016221'	661400	010000	16110	        TLO F,T12FLG            ;CERTAINLY > 11
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-31
TAP.MAC	23-MAR-79 11:41	

  1697	016222'	202100	013325'	16120	        MOVEM R2,CURVER        ;TITO VERSION NO. THAT WROTE TAPE
  1698	016223'	200101	000102	16130	        MOVE R2,XHDR(R1)        ;TPPOS
  1699	016224'	556100	013330'	16140	        HLRZM   R2,CURNUM      ;REEL NO.
  1700	016225'	552100	013321'	16150	        HRRZM   R2,CURPOS      ;FILE POS. NO.
  1701	016226'	200101	000101	16160	        MOVE R2,XHDR-1(R1)      ;TPTIM
  1702	016227'	202100	013326'	16170	        MOVEM R2,CURDAT        ;TIME-DATE WRITTEN
  1703	016230'	137100	022714'	16180	        DPB R2,[POINT 14,DATTIM,24]
  1704	016231'	242100	777762	16190	        LSH R2,-16              ;SHIFT OUT DATE
  1705	016232'	137100	022715'	16200	        DPB R2,[POINT 11,DATTIM,35]
  1706	016233'	200101	000100	16210	        MOVE R2,XHDR-2(R1)      ;TPSER
  1707	016234'	202100	013327'	16220	        MOVEM R2,CURSER         ;SERIAL NO. OF DRIVE THAT WROTE TAPE
  1708	016235'	200101	000077	16230	        MOVE R2,XHDR-3(R1)      ;TPDEN
  1709	016236'	202100	013324'	16240	        MOVEM R2,CURTRK
  1710	016237'	200101	000073	16250	        MOVE R2,XHDR-7(R1)      ;TPUN1
  1711	016240'	202100	013322'	16260	        MOVEM R2,CURUN1
  1712	016241'	200101	000074	16270	        MOVE R2,XHDR-6(R1)      ;TPUN2
  1713	016242'	202100	013323'	16280	        MOVEM R2,CURUN2
  1714	016243'	201040	013332'	16290	TIND1:  MOVEI   R1,LSTPPN
  1715	016244'	202040	021747'	16300	        MOVEM   R1,ERRPPN       ;SAVE FOR ERROR MESSAGE
  1716	016245'	201040	000001	16310	        MOVEI   R1,1            ;JUST READ A DIRECTORY
  1717	016246'	254000	016256'	16320	        JRST    CPOPJ1          ;SKIP RETURN FROM TAPIN
  1718
  1719	016247'	336000	013316'	16340	TRCL:   SKIPN   CURPPN          ;SKIP IF THERE IS A CURRENT FILE
  1720	016250'	263740	000000	16350	        POPJ    P,              ;*RETURN FROM TRCL DOING NOTHING (KLUDGE)
  1721	016251'	200040	022716'	16360	        MOVE    R1,[XWD CURPPN,LSTPPN]
  1722	016252'	251040	013345'	16370	        BLT     R1,LSTTIM       ;MOVE CURPPN-FIL-EXT TO LSTPPN-FIL-EXT
  1723	016253'	402000	013316'	16380	        SETZM   CURPPN          ;MARK AS NO CURRENT FILE
  1724	016254'	263740	000000	16390	        POPJ    P,              ;RETURN FROM TRCL
  1725
  1726	016255'	350017	000000	16410	CPOPJ2: AOS     (P)             ;RETURN TWO SKIPS
  1727	016256'	350017	000000	16420	CPOPJ1: AOS     (P)             ;RETURN +1
  1728	016257'	263740	000000	16430	CPOPJ:: POPJ    P,              ;RETURN
  1729
  1730	016260'	202000	021773'	16450	SKITRM::MOVEM   R0,SKICNT#      ;SAVE THE SKIP COUNT
  1731	016261'	202100	021771'	16460	        MOVEM R2,SAV2#
  1732	016262'	260740	016022'	16470	        PUSHJ   P,SETIN         ;SET TAPE FOR INPUT
  1733	016263'	620400	003320	16480	        TRZ F,HDRFND+HDRMSG+EOFFLG+SSCFLG+UNMFLG
  1734	016264'	602400	000040	16490	        TRNE F,EOTFLG           ;ARE WE ALREADY AT END OF TAPE
  1735	016265'	254000	016320'	16500	        JRST  SKIEO             ;YES
  1736	016266'	260740	017022'	16510	        PUSHJ P,ZPOS            ;ZERO ALL POSITIONAL INFORMATION
  1737	016267'	260740	016074'	16520	SKITIN: PUSHJ   P,TAPIN         ;READ A RECORD
  1738	016270'	254000	016267'	16530	        JRST    SKITIN          ;IGNORE END OF FILE
  1739	016271'	254001	016274'	16540	        JRST    .+3(R1)         ;TRAILER=-1, HEADER=0, DIR=1
  1740	016272'	254000	016267'	16550	        JRST    SKITIN          ;IGNORE DATA
  1741	016273'	254000	016302'	16560	        JRST    SKITRL          ;TRAILER
  1742	016274'	254000	016267'	16570	        JRST    SKITIN          ;IGNORE HEADER
  1743	016275'	606400	000001	16580	        TRNN F,NEWFLG
  1744	016276'	254000	016267'	16590	        JRST    SKITIN          ;OLD TAPE--IGNORE DIRECTORIES
  1745	016277'	260740	017026'	16600	        PUSHJ P,COMPA           ;COMPATIBILITY CHECKS
  1746	016300'	015000	022717'	16610	        ERROR [ASCIZ"ABORT"]
  1747	016301'	254000	016267'	16620	        JRST SKITIN
  1748	016302'	260740	020471'	16630	SKITRL: PUSHJ  P,VERFLG
  1749	016303'	023000	022726'	16640	        ERT [XWD[SKITIN],[ASCIZ"BAD TRAILER FOUND_E"]]
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-32
TAP.MAC	23-MAR-79 11:41	

  1750	016304'	260740	016074'	16650	        PUSHJ   P,TAPIN         ;READ EOF FOLLOWING TRAILER
  1751	016305'	254000	016310'	16660	        JRST    .+3             ;EOF - CONTINUE
  1752	016306'	320000	000000	16670	        JUMP                    ;TRAILER, HEADER, OR DIR - ERROR
  1753	016307'	015000	022727'	16680	        ERROR   [ASCIZ "END OF FILE NOT FOUND AFTER TRAILER"];**CHANGE THIS
  1754	016310'	377000	021773'	16690	        SOSG    SKICNT          ;DECREMENT COUNT AND SKIP IF NOT DONE
  1755	016311'	254000	016322'	16700	        JRST    SKINI
  1756	016312'	260740	016074'	16710	        PUSHJ   P,TAPIN         ;READ EOF OR HEADER AFTER LAST EOF
  1757	016313'	254000	016316'	16720	        JRST    SKIEOT          ;END OF TAPE
  1758	016314'	254000	016267'	16730	        JRST    SKITIN          ;PROBABLY HEADER SO CONTINUE LOOPING
  1759	016315'	254000	016267'	16740	        JRST    SKITIN          ;SHOULDN'T BE DATA HERE BUT IGNORE IT
  1760	016316'	256012	014003'	16750	SKIEOT: XCT MF17(UNIT)          ;BACKSPACE OVER LAST EOF
  1761	016317'	256012	013771'	16760	        XCT MF0(UNIT)           ;WAIT FOR OPERATION TO COMPLETE
  1762	016320'	660400	000040	16770	SKIEO:  TRO F,EOTFLG
  1763	016321'	012000	022737'	16780	        TYPE    [ASCIZ "LOGICAL EOT$"]
  1764	016322'	023000	022746'	16790	SKINI:  ERT [XWD[CURPPN],[ASCIZ"LAST FILE WAS _J"]]
  1765	016323'	606400	000001	16800	        TRNN F,NEWFLG
  1766	016324'	023000	022753'	16810	        ERT [XWD[FIRBL3],[ASCIZ" WRITTEN _L."]]
  1767	016325'	602400	000001	16820	        TRNE F,NEWFLG
  1768	016326'	023000	022757'	16830	        ERT [XWD[CURPOS],[ASCIZ" AT POS _H."]]
  1769	016327'	200100	021771'	16840	        MOVE R2,SAV2
  1770	016330'	302100	000000*	16850	        CAIE R2,SKI2## ;INITIALIZE FOR SKIP WRITE OR
  1771	016331'	306100	000000*	16860	        CAIN    R2,APPROU##     ;APPEND ONLY
  1772	016332'	661400	002000	16870	        TLO     F,INIFLG        ;TAPE NOW INITIALIZED
  1773	016333'	254000	015405*	16880	        JRST    CDISP           ;RETURN TO COMMAND DISPATCHER
  1774
  1775				16900	; NOUPDATE, UPDATE, QUIT, RWN, REW, UNL
  1776
  1777	016334'	334040	022037'	16920	NFLROU::SKIPA R1,[0]
  1778	016335'	571040	777777	16930	FLGROU::HRREI R1,-1
  1779	016336'	202040	013732'	16940	        MOVEM R1,FLGOFF
  1780	016337'	254000	016333*	16950	        JRST CDISP
  1781
  1782	016340'	334040	022037'	16970	NPRROU::SKIPA R1,[0]
  1783	016341'	571040	777777	16980	PRROU:: HRREI R1,-1
  1784	016342'	202040	013731'	16990	        MOVEM R1,PRAFLG         ;PREALLOCATE STORAGE IF NON-ZERO
  1785	016343'	254000	016337*	17000	        JRST CDISP
  1786	016344'	334040	022037'	17010	NUPROU::SKIPA R1,[0]
  1787	016345'	571040	777777	17020	UPDROU::HRREI	R1,-1
  1788	016346'	202040	013730'	17030		MOVEM	R1,UPDFLG
  1789	016347'	254000	016343*	17040		JRST	CDISP
  1790
  1791	016350'	260740	000003*	17060	QUIROU::PUSHJ P,COFRLS## ;GET COF FILE CLOSED
  1792	016351'	047000	000000	17070	        CALLI   RESET           ;TERMINATE ALL I/O
  1793	016352'	047000	000012	17080	        EXIT                    ;RETURN TO EXEC
  1794	016353'	260740	016374'	17090	REWROU::PUSHJ   P,REWWAI        ;REWIND THE TAPE AND WAIT
  1795	016354'	254000	016347*	17100	        JRST    CDISP           ;RETURN TO COMMAND DISPATCHER
  1796	016355'	260740	016364'	17110	RWNROU::PUSHJ P,REWTAP          ;REWIND THE TAPE
  1797	016356'	254000	016360'	17120	        JRST .+2
  1798	016357'	260740	016362'	17130	UNLROU::PUSHJ P,UNLTAP
  1799	016360'	660400	400000	17140	        TRO F,NWFLG             ;DON'T DO MTCLS AT CDISP
  1800	016361'	254000	016354*	17150	        JRST CDISP
  1801
  1802				17170	; UNLOAD TAPE WITHOUT WAIT
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-33
TAP.MAC	23-MAR-79 11:41	

  1803	016362'	256012	013777'	17180	UNLTAP: XCT MF11(UNIT)
  1804	016363'	254000	016365'	17190	        JRST REWTAP+1
  1805				17200	; REWIND TAPE WITHOUT WAIT
  1806	016364'	256012	013773'	17210	REWTAP: XCT MF1(UNIT)           ;REWIND WITHOUT WAIT FOR COMPLETION
  1807	016365'	621400	000001	17220	        TLZ     F,EOTFND        ;NOT AT END OF TAPE
  1808	016366'	661400	000004	17230	        TLO     F,BOTFLG        ;AT BEGINNING OF TAPE
  1809				17240	; FORGET ANYTHING WE MAY HAVE READ
  1810	016367'	260740	017022'	17250	        PUSHJ P,ZPOS            ;ZERO POSITIONAL INFORMATION
  1811	016370'	620400	003160	17260	        TRZ F,EOTFLG+EOFFLG+UNMFLG+HDRMSG+HDRFND
  1812	016371'	660400	000200	17270	        TRO F,SSCFLG    ;CAN PRINT SAVE SET NOS.
  1813	016372'	402000	021745'	17280	        SETZM   DIRSSC#         ;NO SAVE SETS FOUND YET
  1814	016373'	263740	000000	17290	        POPJ    P,              ;RETURN FROM REWTAP
  1815
  1816				17310	; REWIND AND WAIT
  1817	016374'	260740	016364'	17320	REWWAI:: PUSHJ   P,REWTAP        ;REWIND THE TAPE
  1818	016375'	256012	013771'	17330	        XCT MF0(UNIT)
  1819	016376'	263740	000000	17340	        POPJ    P,              ;RETURN FROM REWWAI
  1820
  1821				17360	; REWIND CURRENT TAPE AND GET NEXT TAPE MOUNTED
  1822
  1823	016377'	260740	016364'	17380	NXTTAP: PUSHJ P,REWTAP  ;REWIND WITHOUT WAIT
  1824	016400'	200000	013665'	17390	        MOVE BPI
  1825	016401'	202000	013664'	17400	        MOVEM BPI1      ;REMEMBER DENSITY SETTING
  1826	016402'	476000	013673'	17410	        SETOM ESCDI     ;DISABLE ESCAPES
  1827	016403'	200000	016060'	17420	        MOVE FS6BIT
  1828	016404'	202000	021760'	17430	        MOVEM OFS6
  1829	016405'	202500	021763'	17440	        MOVEM UNIT,OUNIT        ;SAVE UNIT ASSIGNMENT
  1830	016406'	200000	016061'	17450	        MOVE INOUT
  1831	016407'	202000	021761'	17460	        MOVEM OINOUT#           ;SAVE FOR I/O DIRECTION TEST
  1832	016410'	012000	022760'	17470	        TYPE [ASCIZ"$MOUNT NEXT TAPE"]
  1833	016411'	201040	016472'	17480	NXTT1:  MOVEI R1,NXTT5
  1834	016412'	202040	013674'	17490	        MOVEM R1,UNISW  ;GO TO NXTT5 IN ERROR UUO
  1835	016413'	202740	013675'	17500	        MOVEM P,ERRSTP
  1836	016414'	010000	022041'	17510	        TCO [CRCHR]
  1837	016415'	012000	022764'	17520	NXTT1A: TYPE [ASCIZ"CONTINUE ON DEVICE: "]
  1838	016416'	260740	000075*	17530	        PUSHJ P,RDUNI   ;READ SIXBIT DEVICE NAME
  1839	016417'	204000	000000	17540	        MOVS R0,R0      ;SWAP HALVES FOR EASY COMPARE
  1840	016420'	302000	655654	17550	        CAIE R0,(SIXBIT /UNL/)
  1841	016421'	306000	650000	17560	        CAIN R0,(SIXBIT/U/)
  1842	016422'	254000	016436'	17570	        JRST NXTT2      ;UNLOAD
  1843	016423'	306000	655600	17580	        CAIN R0,(SIXBIT/UN/)
  1844	016424'	254000	016436'	17590	        JRST NXTT2       ;UNLOAD
  1845	016425'	302000	565700	17600	        CAIE R0,(SIXBIT/NO/)
  1846	016426'	306000	560000	17610	        CAIN R0,(SIXBIT/N/)
  1847	016427'	254000	000000*	17620	        JRST ABORTA##   ;DISPATCHER TO CLEAR ESCDI AND UNISW
  1848	016430'	302000	370000	17630	        CAIE R0,(SIXBIT/?/)
  1849	016431'	254000	016440'	17640	        JRST NXTT3      ;DEVICE NAME
  1850	016432'	013000	000000	17650	        CLRIN
  1851				17660	        TYPE [ASCIZ"$TYPE U TO UNLOAD CURRENT TAPE.  TYPE A MAGTAPE
  1852	016433'	012000	022771'	17670	DEVICE WHEN NEXT TAPE IS MOUNTED AND YOU WISH TO PROCEED."]
  1853	016434'	012000	023017'	17680	        TYPE [ASCIZ"$TYPE NO TO ABORT."]
  1854	016435'	254000	016411'	17690	        JRST NXTT1
  1855				17700	; UNLOAD CURRENT TAPE
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-34
TAP.MAC	23-MAR-79 11:41	

  1856	016436'	256012	013777'	17710	NXTT2:  XCT MF11(UNIT)
  1857	016437'	254000	016415'	17720	        JRST NXTT1A
  1858				17730	; GET DEVICE
  1859	016440'	206000	016060'	17740	NXTT3:  MOVSM R0,FS6BIT
  1860	016441'	640500	000001	17750	        TRC UNIT,1      ;CHANGE UNITS
  1861	016442'	260740	016022'	17760	        PUSHJ P,SETIN
  1862	016443'	402000	021772'	17770	        SETZM SER       ;DEMAND DEVICE SERIAL NO.
  1863	016444'	260740	016734'	17780	        PUSHJ P,GDC     ;GET CHARACTERISTICS OF NEW DEVICE
  1864	016445'	200000	013667'	17790	        MOVE TRK1
  1865	016446'	312000	013666'	17800	        CAME TRK        ;DO NOT PERMIT NO. OF TRACKS TO CHANGE
  1866	016447'	015000	023023'	17810	        ERROR [ASCIZ"CANNOT CHANGE NO. OF TRACKS IN PROCESS"]
  1867	016450'	260740	016577'	17820	        PUSHJ P,FINDEV  ;LOOKUP FS6BIT IN DEVICE TABLE
  1868	016451'	254000	016455'	17830	        JRST NXTT4      ;NOT FOUND
  1869	016452'	200001	000001	17840	        MOVE R0,1(R1)   ;GET SERIAL FROM DEVICE TABLE
  1870	016453'	202000	021772'	17850	        MOVEM SER
  1871	016454'	254000	016456'	17860	        JRST NXTT4A     ;DON'T PRINT TRACKS
  1872	016455'	260740	016726'	17870	NXTT4:  PUSHJ P,PTRK    ;PRINT TRACKS
  1873	016456'	260740	016653'	17880	NXTT4A: PUSHJ P,SETBPI  ;KEEP SAME DENSITY
  1874	016457'	015000	023033'	17890	        ERROR [ASCIZ"CANNOT CHANGE DENSITY IN PROCESS"]
  1875	016460'	200000	021761'	17900	        MOVE OINOUT
  1876	016461'	603000	777777	17910	        TLNE R0,777777          ;WERE WE WRITING TAPE
  1877	016462'	331000	016776'	17920	        SKIPL SENTAB+1          ;YES, IS IT WRITE LOCKED
  1878	016463'	254000	016465'	17930	        JRST .+2                ;NO
  1879	016464'	015000	023042'	17940	        ERROR [ASCIZ"TAPE NEEDS WRITE RING"]
  1880	016465'	476000	013674'	17950	        SETOM UNISW
  1881	016466'	402000	013673'	17960	        SETZM ESCDI
  1882	016467'	260740	016374'	17970	        PUSHJ P,REWWAI  ;REWIND NEW TAPE
  1883	016470'	022000	023050'	17980	        ERO [XWD 0,[14B6]]      ;OUTPUT TOP OF FORM
  1884	016471'	263740	000000	17990	        POPJ P,         ;RETURN FROM NXTTAP
  1885	016472'	200000	021760'	18000	NXTT5:  MOVE OFS6
  1886	016473'	202000	016060'	18010	        MOVEM FS6BIT
  1887	016474'	200500	021763'	18020	        MOVE UNIT,OUNIT# ;RESTORE UNIT 
  1888	016475'	476000	013674'	18030	        SETOM UNISW
  1889	016476'	260740	016022'	18040	        PUSHJ P,SETIN
  1890	016477'	254000	016411'	18050	        JRST NXTT1
  1891
  1892
  1893				18080	; DEVICE COMMAND.  SYNTAX IS *DEV <DEVNAM> <DENSITY>(CR)
  1894				18090	;       IF DEVNAM IS MISSING THE CURRENT DEVICE IS USED.
  1895				18100	;       IF DEVNAM IS PRESENT DEVNAM BECOMES THE NEW TAPE DEVICE.
  1896				18110	;       IF DENSITY IS MISSING THE DEVICE CHARACTERISTICS ARE PRINTED.
  1897				18120	;       IF DENSITY IS PRESENT THE GIVEN DENSITY REPLACES THE EXISTING
  1898				18130	;       DENSITY (PROVIDING THE UNIT IS CAPABLE OF THE NEW SETTING)
  1899
  1900	016500'	402000	021770'	18150	DEVROU::SETZM PSW#
  1901	016501'	200000	013666'	18160	        MOVE TRK
  1902	016502'	202000	013667'	18170	        MOVEM TRK1
  1903	016503'	476000	013664'	18180	        SETOM BPI1      ;SET TO DEMAND DENSITY IF NOT IN DEVTBL
  1904	016504'	402000	021772'	18190	        SETZM SER       ;SET TO DEMAND SERIAL NO.
  1905	016505'	476000	013673'	18200	        SETOM ESCDI     ;DISABLE ESCAPES
  1906	016506'	201000	016572'	18210	        MOVEI DEVERR
  1907	016507'	202000	013674'	18220	        MOVEM UNISW
  1908	016510'	202740	013675'	18230	        MOVEM P,ERRSTP
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-35
TAP.MAC	23-MAR-79 11:41	

  1909	016511'	200000	016060'	18240	        MOVE FS6BIT
  1910	016512'	202000	021760'	18250	        MOVEM OFS6#             ;SAVE OLD DEVICE NAME FOR DEVERR
  1911	016513'	302340	000013	18260	        CAIE CT,SP
  1912	016514'	254000	016554'	18270	        JRST DEVR4              ;PRINT CHARACTERISTICS OF CURRENT DEVICE
  1913	016515'	260740	016565'	18280	        PUSHJ P,DEVR5           ;CONSUME SPACES
  1914	016516'	306340	000002	18290	        CAIN CT,NU              ;SKIP IF NOT A DIGIT
  1915	016517'	254000	016532'	18300	        JRST DEVR1              ;SET DENSITY OF CURRENT DEVICE
  1916	016520'	260740	016416*	18310	        PUSHJ P,RDUNI           ;GET NAME
  1917	016521'	202000	016060'	18320	        MOVEM FS6BIT
  1918	016522'	256012	014015'	18330	        XCT MRELS(UNIT)
  1919	016523'	260740	016022'	18340	        PUSHJ P,SETIN           ;IOPEN DEVICE
  1920	016524'	260740	016734'	18350	        PUSHJ P,GDC             ;GET DEVICE CHARACTERISTICS
  1921	016525'	302340	000013	18360	        CAIE CT,SP              ;DENSITY ENTERED TOO
  1922	016526'	254000	016562'	18370	        JRST DEVR4B     ;NO, PRINT KNOWN CHARACTERISTICS OR COMPLETE DEVTBL
  1923	016527'	260740	016565'	18380	        PUSHJ P,DEVR5
  1924	016530'	302340	000002	18390	        CAIE CT,NU
  1925	016531'	015000	023051'	18400	        ERROR [ASCIZ"EXPECTED DIGIT"]
  1926	016532'	260740	014077*	18410	DEVR1:  PUSHJ P,RDDNUM
  1927	016533'	303000	000000	18420	        CAILE R0,0
  1928	016534'	302340	000012	18430	        CAIE CT,TE
  1929	016535'	015000	023054'	18440	        ERROR [ASCIZ"EXPECTED TERMINATOR"]
  1930	016536'	202000	013664'	18450	        MOVEM BPI1
  1931	016537'	260740	016577'	18460	        PUSHJ P,FINDEV
  1932	016540'	254000	016544'	18470	        JRST DEVR2              ;NOT IN DEVTBL
  1933	016541'	200001	000001	18480	DEVR1A: MOVE R0,1(R1)           ;SERIAL
  1934	016542'	202000	021772'	18490	        MOVEM SER
  1935	016543'	254000	016545'	18500	        JRST DEVR2A     ;DON'T PRINT TRACKS
  1936	016544'	260740	016726'	18510	DEVR2:  PUSHJ P,PTRK    ;PRINT TRACKS
  1937	016545'	260740	016653'	18520	DEVR2A: PUSHJ P,SETBPI
  1938	016546'	254000	016552'	18530	        JRST DEVR3              ;INCAPABLE OF THIS DENSITY
  1939	016547'	332000	021770'	18540	        SKIPE PSW
  1940				18550	        ERT [XWD[SER
  1941	016550'	023000	023064'	18560	TPDEN],[ASCIZ"_S: _O"]]
  1942	016551'	254000	016361*	18570	        JRST CDISP
  1943	016552'	260740	016777'	18580	DEVR3:  PUSHJ P,DDI
  1944	016553'	254000	016545'	18590	        JRST DEVR2A
  1945	016554'			18600	DEVR4:
  1946	016554'	260740	016577'	18610	        PUSHJ P,FINDEV
  1947	016555'	015000	023065'	18620	        ERROR [ASCIZ"CANNOT FIND CURRENT DEVICE IN DEVTBL"]
  1948	016556'	476000	021770'	18630	DEVR4A: SETOM PSW
  1949	016557'	554001	000002	18640	        HLRZ R0,2(R1)           ;DENSITY FROM DEVTBL
  1950	016560'	202000	013664'	18650	        MOVEM BPI1
  1951	016561'	254000	016541'	18660	        JRST DEVR1A
  1952				18670	; PRINT CHARACTERISTICS IF IN DEVTBL
  1953				18680	; DEMAND CHARACTERISTICS IF THIS IS A NEW DEVICE
  1954	016562'	260740	016577'	18690	DEVR4B: PUSHJ P,FINDEV
  1955	016563'	254000	016544'	18700	        JRST DEVR2  ;DEMAND
  1956	016564'	254000	016556'	18710	        JRST DEVR4A ;PRINT
  1957	016565'	002340	000004	18720	DEVR5:  TCL CT,CH
  1958	016566'	302340	000013	18730	        CAIE CT,SP
  1959	016567'	263740	000000	18740	        POPJ P,
  1960	016570'	001340	000004	18750	        TCI CT,CH
  1961	016571'	254000	016565'	18760	        JRST .-4
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-36
TAP.MAC	23-MAR-79 11:41	

  1962	016572'	200000	021760'	18770	DEVERR: MOVE OFS6
  1963	016573'	202000	016060'	18780	        MOVEM FS6BIT
  1964	016574'	476000	013674'	18790	        SETOM UNISW
  1965	016575'	260740	016022'	18800	        PUSHJ P,SETIN           ;OPEN ORIGINAL DEVICE
  1966	016576'	254000	016551*	18810	        JRST CDISP
  1967
  1968				18830	; FINDEV SEARCHES DEVTBL FOR A MATCH ON DEVICE NAME IN FS6BIT.
  1969				18840	; THE SEARCH ENDS ON A ZERO NAME WITH A NONSKIP RETURN AND
  1970				18850	; WITH R1 POINTING AT THE ZERO ENTRY.  IF A MATCH IS FOUND
  1971				18860	; R1 POINTS AT THE MATCHING ENTRY WITH A SKIP RETURN GIVEN.
  1972
  1973	016577'	200040	023075'	18880	FINDEV: MOVE R1,[-NDEV,,DEVTBL]
  1974	016600'	200001	000000	18890	FIND1:  MOVE R0,(R1)
  1975	016601'	316000	016060'	18900	        CAMN R0,FS6BIT
  1976	016602'	254000	016611'	18910	        JRST FIND2
  1977	016603'	306000	000000	18920	        CAIN R0,0
  1978	016604'	254000	016612'	18930	        JRST FIND3
  1979	016605'	350000	000001	18940	        AOS R1
  1980	016606'	350000	000001	18950	        AOS R1
  1981	016607'	253040	016600'	18960	        AOBJN R1,FIND1
  1982	016610'	015000	023076'	18970	        ERROR [ASCIZ"DEVICE TABLE FULL"]
  1983	016611'	350017	000000	18980	FIND2:  AOS (P)
  1984	016612'	202040	021743'	18990	FIND3:  MOVEM R1,DEVTX#
  1985	016613'	263740	000000	19000	        POPJ P,
  1986
  1987				19020	; DEVTBL CONTAINS 3 WORDS PER ENTRY.  WORD 0 IS THE SIXBIT DEVICE NAME.
  1988				19030	; [WORD 1]RH CONTAINS THE UNIT SERIAL NO.  [WORD 2]LH CONTAINS THE
  1989				19040	; DENSITY SETTING (DECIMAL) AND [WORD 2]RH CONTAINS THE NO. OF TRACKS
  1990
  1991	016614'			19060	DEVTBL: BLOCK 3*NDEV
  1992
  1993				19080	; SET DENSITY BITS IN CHANNEL STATUS
  1994
  1995	016644'	256012	014031'	19100	SETDEN: XCT MGET2(UNIT)
  1996	016645'	200040	021742'	19110	        MOVE R1,DEN
  1997	016646'	430040	000002	19120	        XOR R1,R2
  1998	016647'	405040	000600	19130	        ANDI R1,600
  1999	016650'	430040	000002	19140	        XOR R1,R2
  2000	016651'	256012	014033'	19150	        XCT MSET1(UNIT)
  2001	016652'	263740	000000	19160	        POPJ P,
  2002
  2003				19180	; SETBPI CHECKS TO SEE IF UNIT IS CAPABLE OF DENSITY BPI1.
  2004				19190	;   IF UNIT IS CAPABLE STORE BPI1 INTO BPI AND SKIP RETURN
  2005				19200	; WE ALSO SET THE DRIVE TO THE CORRECT HI, MEDIUM, OR LOW SETTING.
  2006
  2007	016653'	200100	023102'	19220	SETBPI::MOVE R2,[-3,,0]
  2008	016654'	200042	016772'	19230	        MOVE R1,DENTAB(R2)
  2009	016655'	316040	013664'	19240	        CAMN R1,BPI1
  2010	016656'	254000	016661'	19250	        JRST .+3
  2011	016657'	253100	016654'	19260	        AOBJN R2,.-3
  2012	016660'	263740	000000	19270	        POPJ P,         ;UNIT NOT CAPABLE OF BPI1
  2013	016661'	200000	013667'	19280	        MOVE TRK1
  2014	016662'	202000	013666'	19290	        MOVEM TRK
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-37
TAP.MAC	23-MAR-79 11:41	

  2015	016663'	202040	013665'	19300	        MOVEM R1,BPI
  2016	016664'	201000	001003	19310	        MOVEI ^D512+3   ;RECORD SIZE FOR 800 BPI OR LESS
  2017	016665'	306040	003100	19320	        CAIN R1,^D1600
  2018	016666'	201000	003577	19330	        MOVEI ^D1916+3
  2019	016667'	306040	014152	19340	        CAIN R1,^D6250
  2020	016670'	201000	007237	19350	        MOVEI ^D3740+3
  2021	016671'	275000	000002	19360	        SUBI 2
  2022	016672'	202000	013670'	19370	        MOVEM TPSZM2
  2023	016673'	275000	000001	19380	        SUBI 1
  2024	016674'	202000	013671'	19390	        MOVEM TPSZM3
  2025	016675'	275000	000001	19400	        SUBI 1
  2026	016676'	202000	013672'	19410	        MOVEM TPSZM4
  2027	016677'	260740	016062'	19420	        PUSHJ P,SETBUF ;SET RECORD SIZE INTO BUFFER
  2028	016700'	550100	000002	19430	        HRRZ R2,R2
  2029	016701'	275100	000003	19440	        SUBI R2,3
  2030	016702'	242100	000007	19450	        LSH R2,7
  2031	016703'	212100	021742'	19460	        MOVNM R2,DEN#   ;DEN=(3-R2)*200
  2032	016704'	260740	016644'	19470	        PUSHJ P,SETDEN  ;SET DENSITY BITS IN CHANNEL STATUS
  2033	016705'	336000	021772'	19480	        SKIPN SER
  2034	016706'	260740	016723'	19490	        PUSHJ P,SERROU  ;GET SERIAL NO. OF DRIVE IF REQ'D
  2035	016707'	350017	000000	19500	        AOS (P)         ;FOR SKIP RETURN
  2036				19510	; STOBPI STORES PERMANENT TAPE PARAMETERS INTO FILE HEADER BLOCK
  2037	016710'	200100	021743'	19520	STOBPI::MOVE R2,DEVTX   ;INDEX INTO DEVICE TBL
  2038	016711'	504040	013665'	19530	        HRL R1,BPI
  2039	016712'	540040	013666'	19540	        HRR R1,TRK
  2040	016713'	202040	013612'	19550	        MOVEM R1,TPDEN  ;DENSITY TO LH, TRKS TO RH
  2041	016714'	202042	000002	19560	        MOVEM R1,2(R2)  ;DEN AND TRKS TO DEVTBL
  2042	016715'	200040	021772'	19570	        MOVE R1,SER
  2043	016716'	202040	013613'	19580	        MOVEM R1,TPSER  ;SERIAL TO RH
  2044	016717'	202042	000001	19590	        MOVEM R1,1(R2)  ;SERIAL TO DEVTBL
  2045	016720'	200040	016060'	19600	        MOVE R1,FS6BIT
  2046	016721'	202042	000000	19610	        MOVEM R1,0(R2)  ;DEVICE NAME TO DEVTBL
  2047	016722'	263740	000000	19620	        POPJ P,
  2048
  2049				19640	; INPUT DRIVE SERIAL NO. TO R0 AND SER
  2050
  2051	016723'	200000	016060'	19660	SERROU: MOVE FS6BIT
  2052	016724'	202000	021772'	19670	        MOVEM SER#
  2053	016725'	263740	000000	19680	        POPJ P,
  2054
  2055				19700	; PRINT NO. OF TRACKS FROM TRK1
  2056
  2057	016726'	012000	023103'	19720	PTRK:   TYPE [ASCIZ"TRACKS: "]
  2058	016727'	200000	013667'	19730	        MOVE TRK1
  2059	016730'	271000	000060	19740	        ADDI R0,60
  2060	016731'	010000	000000	19750	        TCO R0
  2061	016732'	010000	022041'	19760	        TCO [15]
  2062	016733'	263740	000000	19770	        POPJ P,
  2063
  2064
  2065				19800	; GET DEVICE CAPABILITIES.  HI, MED, AND LOW DENSITY SETTINGS
  2066				19810	; ARE RETURNED IN DENTAB.  NO. OF TRACKS IS RETURNED IN TRK1.
  2067
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-38
TAP.MAC	23-MAR-79 11:41	

  2068	016734'	200040	016776'	19830	GDC:    MOVE R1,SENTAB+1        ;UGETF DONE BY SETIN OR SETOUT
  2069	016735'	201000	000011	19840	        MOVEI R0,11
  2070	016736'	603040	000040	19850	        TLNE R1,40
  2071	016737'	201000	000007	19860	        MOVEI R0,7
  2072	016740'	202000	013667'	19870	        MOVEM TRK1#     ;7 OR 9 TRACKS
  2073	016741'	200100	023105'	19880	        MOVE R2,[-5,,0]
  2074	016742'	476000	000003	19890	        SETOM R3
  2075	016743'	603040	000020	19900	GDC1:  TLNE R1,20      ;SKIP IF DRIVE CANNOT HANDLE THIS DENSITY
  2076	016744'	254000	016757'	19910	        JRST GDC3
  2077	016745'	242040	000001	19920	GDC2:  LSH R1,1
  2078	016746'	253100	016743'	19930	        AOBJN R2,GDC1
  2079				19940	; GUARANTEE MEDIUM AND LOW SETTINGS FOR DRIVES WITH FEWER THAN
  2080				19950	; THREE SETTINGS
  2081	016747'	305140	000000	19960	        CAIGE R3,0
  2082	016750'	015000	023106'	19970	        ERROR [ASCIZ"DRIVE DENSITY CANNOT BE SENSED"]
  2083	016751'	505043	016772'	19980	        HRLI R1,DENTAB(R3)
  2084	016752'	544040	000001	19990	        HLR R1,R1
  2085	016753'	350000	000001	20000	        AOS R1
  2086	016754'	302140	000002	20010	        CAIE R3,2
  2087	016755'	251040	016774'	20020	        BLT R1,DENTAB+2
  2088	016756'	263740	000000	20030	        POPJ P,
  2089	016757'	350000	000003	20040	GDC3:  AOS R3
  2090	016760'	306140	000003	20050	        CAIN R3,3
  2091	016761'	015000	023115'	20060	        ERROR [ASCIZ"DRIVE DENSITY CAPABILITIES AMBIGUOUS"]
  2092	016762'	200002	016765'	20070	        MOVE R0,BPICOD(R2)
  2093	016763'	202003	016772'	20080	        MOVEM R0,DENTAB(R3)
  2094	016764'	254000	016745'	20090	        JRST GDC2
  2095	016765'	000000	014152	20100	BPICOD: EXP ^D6250,^D1600,^D800,^D556,^D200
	016766'	000000	003100
	016767'	000000	001440
	016770'	000000	001054
	016771'	000000	000310
  2096	016772'			20110	DENTAB: BLOCK 3
  2097	016775'	000000	000002	20120	SENTAB:: XWD 0,2
  2098	016776'	000000	000000	20130	        EXP 0
  2099
  2100				20150	; DISPLAY AND INPUT DENSITY.  UNIT CAPABILITIES ARE DISPLAYED
  2101				20160	; IN PARENTHESES TO PROMPT OPERATOR
  2102
  2103	016777'	012000	023125'	20180	DDI:: TYPE [ASCIZ"DENSITY("]
  2104	017000'	200100	023102'	20190	        MOVE R2,[-3,,0]
  2105	017001'	402000	000003	20200	        SETZM R3
  2106	017002'	200042	016772'	20210	DDI1:    MOVE R1,DENTAB(R2)
  2107	017003'	316040	000003	20220	        CAMN R1,R3
  2108	017004'	254000	017012'	20230	        JRST DDI2        ;THIS NO. HAS ALREADY PRINTED
  2109	017005'	332000	000003	20240	        SKIPE R3
  2110	017006'	010000	023127'	20250	        TCO [54]
  2111	017007'	202040	000003	20260	        MOVEM R1,R3
  2112	017010'	202040	022003'	20270	        MOVEM R1,TMP
  2113	017011'	023000	023132'	20280	        ERT [XWD[TMP],[ASCIZ"_C"]]
  2114	017012'	253100	017002'	20290	DDI2:    AOBJN R2,DDI1
  2115	017013'	012000	023133'	20300	        TYPE [ASCIZ"): "]
  2116	017014'	260740	016532*	20310	        PUSHJ P,RDDNUM
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-39
TAP.MAC	23-MAR-79 11:41	

  2117	017015'	303000	000000	20320	        CAILE R0,0
  2118	017016'	302340	000012	20330	        CAIE CT,TE
  2119	017017'	013000	000000	20340	        CLRIN
  2120	017020'	202000	013664'	20350	        MOVEM BPI1
  2121	017021'	263740	000000	20360	        POPJ P,
  2122
  2123				20380	; ZERO POSITIONAL INFORMATION TO DEFEAT COMPATIBILITY TESTS.
  2124				20390	; CALL WHEN TAPE SCAN IS REVERSED
  2125
  2126	017022'	402000	013316'	20410	ZPOS:   SETZM CURPPN
  2127	017023'	200040	023134'	20420	        MOVE R1,[CURPPN,,CURFIL]
  2128	017024'	251040	013345'	20430	        BLT R1,LSTTIM
  2129	017025'	263740	000000	20440	        POPJ P,
  2130
  2131
  2132				20470	; COMPATIBILITY CHECKS.  CHECKS NO. OF TRACKS AND DENSITY,
  2133				20480	;       TAPE POSITION, AND RECORDED DATE.  IF AN ERROR IS
  2134				20490	;       DETECTED THE OPERATOR MUST CONFIRM TO CONTINUE OR ELSE
  2135				20500	;       THIS ROUTINE GIVES A NONSKIP RETURN
  2136
  2137				20520	; TRACK AND DENSITY
  2138	017026'	332040	013340'	20530	COMPA:  SKIPE R1,LSTTRK
  2139	017027'	316040	013324'	20540	        CAMN R1,CURTRK
  2140	017030'	254000	017034'	20550	        JRST COMPA1     ;SAME OR LSTTRK=0
  2141	017031'	023000	023146'	20560	        ERT [XWD[CURPPN],[ASCIZ"$COMPATIBILITY ERROR AT FILE HEADER FOR _J"]]
  2142				20570	        ERT [XWD[LSTTRK
  2143				20580	CURTRK
  2144				20590	COMPA1],[ASCIZ"$PREVIOUS FILE WRITTEN _O
  2145				20600	CURRENT FILE WRITTEN _O
  2146	017032'	023000	023170'	20610	CONTINUE OK?_F_G"]]
  2147	017033'	254000	017063'	20620	        JRST COMPA5
  2148				20630	; TAPE TRACK AND DENSITY AND DRIVE TRACK AND DENSITY
  2149	017034'	200040	013324'	20640	COMPA1: MOVE R1,CURTRK
  2150	017035'	336000	022006'	20650	        SKIPN TRKSW
  2151	017036'	316040	013612'	20660	        CAMN R1,TPDEN
  2152	017037'	254000	017044'	20670	        JRST COMPA2
  2153	017040'	023000	023146'	20680	        ERT [XWD[CURPPN],[ASCIZ"$COMPATIBILITY ERROR AT FILE HEADER FOR _J"]]
  2154				20690	        ERT [XWD[CURTRK
  2155				20700	TPDEN
  2156				20710	COMP2A],[ASCIZ"$CURRENT FILE WRITTEN _O
  2157				20720	TAPE DRIVE SET TO _O
  2158	017041'	023000	023211'	20730	CONTINUE OK?_F_G"]]
  2159	017042'	254000	017063'	20740	        JRST COMPA5
  2160	017043'	476000	022006'	20750	COMP2A: SETOM TRKSW#
  2161				20760	; TAPE POSITION
  2162	017044'	200040	013335'	20770	COMPA2: MOVE R1,LSTPOS
  2163	017045'	271040	000001	20780	        ADDI R1,1
  2164	017046'	332000	013335'	20790	        SKIPE LSTPOS
  2165	017047'	316040	013321'	20800	        CAMN R1,CURPOS
  2166	017050'	254000	017054'	20810	        JRST COMPA3     ;TAPE SEQUENCE OK OR LSTPOS=0
  2167	017051'	023000	023224'	20820	        ERT [XWD[CURPPN],[ASCIZ"$TAPE POSITIONING ERROR AT FILE HEADER FOR _J"]]
  2168				20830	        ERT [XWD[LSTPOS
  2169				20840	XWD 10,5
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-40
TAP.MAC	23-MAR-79 11:41	

  2170				20850	CURPOS
  2171				20860	XWD 10,5
  2172				20870	COMPA3],[ASCIZ"$LAST TAPE POSITION WAS _N
  2173				20880	CURRENT TAPE POS IS _N
  2174	017052'	023000	023250'	20890	CONTINUE OK?_F_G"]]
  2175	017053'	254000	017063'	20900	        JRST COMPA5
  2176				20910	; CHECK DATE FILE RECORDED
  2177	017054'	332040	013345'	20920	COMPA3: SKIPE R1,LSTTIM
  2178	017055'	317040	013331'	20930	        CAMG R1,DATTIM
  2179	017056'	254000	017062'	20940	        JRST COMPA4
  2180	017057'	023000	023146'	20950	        ERT [XWD[CURPPN],[ASCIZ"$COMPATIBILITY ERROR AT FILE HEADER FOR _J"]]
  2181				20960	        ERT [XWD[LSTDAT
  2182				20970	CURDAT
  2183				20980	COMPA4],[ASCIZ"$PREVIOUS FILE WRITTEN _L
  2184				20990	CURRENT FILE WRITTEN _L
  2185	017060'	023000	023272'	21000	CONTINUE OK?_F_G"]]
  2186	017061'	254000	017063'	21010	        JRST COMPA5
  2187	017062'	350017	000000	21020	COMPA4: AOS (P)
  2188	017063'	263740	000000	21030	COMPA5: POPJ P,
  2189
  2190
  2191
  2192				21070	; POSITION TAPE TO FILE POS. RANFST.  INPUT RANGE OF POS. NOS.
  2193				21080	;       IF NOT ALREADY DONE.
  2194				21090	;       SKIP RETURN IF TAPE ALREADY POSITIONED.
  2195
  2196	017064'	606400	000010	21110	POSTAP: TRNN F,RANFLG   ;HAVE WE ENTERED RANGE YET
  2197	017065'	260740	017112'	21120	        PUSHJ P,RAN     ;NO
  2198	017066'	606400	000004	21130	        TRNN F,FNDFLG   ;HAVE WE FOUND RANFST FILE YET
  2199	017067'	254000	017072'	21140	        JRST POST2      ;FIND IT
  2200	017070'	350017	000000	21150	POST1:  AOS (P)
  2201	017071'	263740	000000	21160	        POPJ P,         ;RETURN FROM POSTAP
  2202	017072'	200040	013321'	21170	POST2:  MOVE R1,CURPOS
  2203	017073'	317040	000000*	21180	        CAMG R1,RANFST##;HAVE WE GONE PAST FIRST
  2204	017074'	254000	017106'	21190	        JRST POST3      ;NO
  2205				21200	; FORGET ANYTHING WE READ IN FORWARD DIRECTION
  2206	017075'	620400	003360	21210	        TRZ F,HDRFND+HDRMSG+EOFFLG+EOTFLG+SSCFLG+UNMFLG
  2207	017076'	260740	017022'	21220	        PUSHJ P,ZPOS            ;ZERO ALL POSITIONAL INFORMATION
  2208	017077'	256012	014053'	21230	        XCT MTWAIT(UNIT)        ;WAIT FOR INPUT TO STOP
  2209	017100'	256012	014003'	21240	        XCT MF17(UNIT)  ;BACK USER
  2210	017101'	256012	014003'	21250	        XCT MF17(UNIT)  ;BACK USER
  2211	017102'	256012	014003'	21260	        XCT MF17(UNIT)  ;BACK USER
  2212	017103'	256012	013771'	21270	        XCT MF0(UNIT)
  2213	017104'	260740	016067'	21280	        PUSHJ P,CLRTAP  ;CLOSE TAPE AND CLEAR FLAGS
  2214	017105'	263740	000000	21290	        POPJ P,         ;NONSKIP RETURN FROM POSTAP
  2215	017106'	312040	017073*	21300	POST3:  CAME R1,RANFST  ;HAVE WE GOTTEN THERE YET
  2216	017107'	263740	000000	21310	        POPJ P,         ;NO
  2217	017110'	660400	000004	21320	        TRO F,FNDFLG
  2218	017111'	254000	017070'	21330	        JRST POST1      ;RETURN FROM POSTAP SKIPPING
  2219
  2220				21350	; INPUT RANGE OF TAPE POS. NOS.
  2221
  2222	017112'	622400	004000	21370	RAN:    TRZE F,RANCMD           ;RANGE ALREADY ENTERED FROM CMD
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-41
TAP.MAC	23-MAR-79 11:41	

  2223	017113'	254000	017140'	21380	        JRST RAN3               ;YES, MARK RANGE AS ENTERED NOW
  2224				21390	;                               (RANFLG ALSO INDICATES WE HAVE
  2225				21400	;                               LOCATED OUR FIRST FILE BUT HAVE NOT
  2226				21410	;                               YET POSITIONED TAPE)
  2227	017114'	012000	023273'	21420	        TYPE [ASCIZ"INPUT TAPE POS RANGE: "]
  2228	017115'	002340	000004	21430	        TCL CT,CH               ;LOOKAHEAD FOR CR OR ?
  2229	017116'	306340	000012	21440	        CAIN CT,TE
  2230	017117'	254000	017200'	21450	        JRST RAN8
  2231	017120'	306200	000077	21460	        CAIN CH,77
  2232	017121'	254000	017173'	21470	        JRST RAN7               ;HELP THEM SOME
  2233	017122'	306200	000127	21480	        CAIN CH,127
  2234	017123'	254000	017203'	21490	        JRST RAN9
  2235	017124'	260740	000000*	21500	        PUSHJ P,RANZ##          ;SET RANGE TO ZEROES
  2236	017125'	260740	000000*	21510	RAN1:   PUSHJ P,RDONUM##
  2237	017126'	202000	000000*	21520	        MOVEM N1##
  2238	017127'	306340	000011	21530	        CAIN CT,CO
  2239	017130'	254000	017145'	21540	        JRST RAN4               ;COMMA
  2240	017131'	306340	000017	21550	        CAIN CT,DA
  2241	017132'	254000	017151'	21560	        JRST RAN5               ;HYPHEN
  2242	017133'	302340	000012	21570	        CAIE CT,TE
  2243	017134'	254000	017171'	21580	        JRST RAN6               ;IMPROPER TERMINATOR
  2244	017135'	202000	000000*	21590	RAN2:   MOVEM N2##
  2245	017136'	260740	000000*	21600	        PUSHJ P,SETN12##        ;SET BITS CORRESPONDING TO SELECTED RANGE
  2246	017137'	254000	017171'	21610	        JRST RAN6               ;ILL. POSITION
  2247	017140'	660400	000010	21620	RAN3:   TRO F,RANFLG            ;RANGE ENTERED
  2248	017141'	607400	020000	21630	        TLNN F,CUTFLG
  2249	017142'	263740	000000	21640	RAN3A:  POPJ P,                 ;RETURN FROM RAN
  2250	017143'	023000	023305'	21650	        ERT [XWD[RAN3A],[ASCIZ"ARE YOU SURE?_F_G"]]
  2251	017144'	254000	000000*	21660	        JRST NEWR1A##           ;YOU SAID NO
  2252	017145'	202000	017135*	21670	RAN4:   MOVEM N2                ;ONE POS. SELECTED BUT DON'T STOP HERE
  2253	017146'	260740	017136*	21680	        PUSHJ P,SETN12
  2254	017147'	254000	017171'	21690	        JRST RAN6               ;ILL. POSITION
  2255	017150'	254000	017125'	21700	        JRST RAN1               ;GET NEXT POS.
  2256	017151'	260740	017125*	21710	RAN5:   PUSHJ P,RDONUM
  2257	017152'	302000	000000	21720	        CAIE R0,0               ;PERHAPS THEY TYPED "E"
  2258	017153'	254000	017156'	21730	        JRST .+3                ;NOPE
  2259	017154'	306200	000000*	21740	        CAIN CH,ECHR##
  2260	017155'	201000	000000*	21750	        MOVEI R0,RANSIZ##*44-1    ;ASSUME END
  2261	017156'	306340	000017	21760	        CAIN CT,DA
  2262	017157'	254000	017171'	21770	        JRST RAN6               ;MAY NOT TERMINATE WITH DASH
  2263	017160'	306340	000012	21780	RAN5A:  CAIN CT,TE
  2264	017161'	254000	017135'	21790	        JRST RAN2               ;END OR RANGE TERM. BY CR
  2265	017162'	306340	000011	21800	        CAIN CT,CO
  2266	017163'	254000	017145'	21810	        JRST RAN4
  2267	017164'	306000	000000*	21820	        CAIN R0,RANSIZ*44-1
  2268	017165'	302200	017154*	21830	        CAIE CH,ECHR
  2269	017166'	254000	017171'	21840	        JRST RAN6
  2270	017167'	001340	000004	21850	        TCI CT,CH               ;GET REAL DELIMITER AFTER "E"
  2271	017170'	254000	017160'	21860	        JRST RAN5A
  2272	017171'	013000	000000	21870	RAN6:   CLRIN
  2273	017172'	254000	017112'	21880	        JRST RAN
  2274				21890	RAN7:   TYPE [ASCIZ"
  2275				21900	TAPE POSITION NOS. MAY BE ENTERED SEPARATED BY COMMAS OR SPACES.
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-42
TAP.MAC	23-MAR-79 11:41	

  2276				21910	A HYPHEN MAY BE USED TO SEPARATE A RANGE OF TAPE POS. NUMBERS.
  2277				21920	THE NUMBER SPECIFIED AS THE END OF THE RANGE MUST BE GREATER
  2278	017173'	012000	023306'	21930	"]
  2279				21940	        TYPE [ASCIZ"THAN THE START OF THE RANGE.  AN 'E' MAY BE USED TO DENOTE
  2280	017174'	012000	023355'	21950	THE GREATEST POSSIBLE END OF RANGE."]
  2281				21960	        TYPE [ASCIZ"  A CARRIAGE RETURN MAY BE USED
  2282				21970	TO DEFAULT TO ALL POSSIBLE TAPE POSITIONS, LIKE '1-E'.
  2283	017175'	012000	023401'	21980	"]
  2284				21990	        TYPE [ASCIZ"A 'W' PRINTS THE LAST KNOWN TAPE POSITION.
  2285				22000	A '?' OR 'H' REPRINTS THIS MESSAGE.
  2286	017176'	012000	023423'	22010	"]
  2287	017177'	254000	017171'	22020	        JRST RAN6
  2288	017200'	001340	000004	22030	RAN8:   TCI CT,CH       ;EAT CR
  2289	017201'	260740	000000*	22040	        PUSHJ P,RANO##          ;SET RANGE TO ONE'S
  2290	017202'	254000	017140'	22050	        JRST RAN3
  2291	017203'	001340	000004	22060	RAN9:   TCI CT,CH
  2292	017204'	302340	000012	22070	        CAIE CT,TE
  2293	017205'	254000	017203'	22080	        JRST RAN9
  2294	017206'	260740	017220'	22090	        PUSHJ P,WHERE
  2295	017207'	254000	017112'	22100	        JRST RAN
  2296
  2297				22120	; CHECK TO SEE IF FILE SELECTED.  FILE NO. IN R1
  2298				22130	; SKIP IF BIT SET (FILE SELECTED)
  2299
  2300	017210'	231040	000044	22150	CKNRAN: IDIVI R1,44
  2301	017211'	201000	000001	22160	        MOVEI R0,1
  2302	017212'	242002	000000	22170	        LSH 0,(R2)
  2303	017213'	612001	000000*	22180	        TDNE R0,RANGE##(R1)
  2304	017214'	350017	000000	22190	        AOS (P)
  2305	017215'	263740	000000	22200	        POPJ P,
  2306
  2307				22220	; PRINT LAST TAPE POSITION SCANNED
  2308
  2309	017216'	260740	017220'	22240	WHEROU::PUSHJ P,WHERE
  2310	017217'	254000	016576*	22250	        JRST CDISP
  2311	017220'	332000	013321'	22260	WHERE:  SKIPE CURPOS
  2312	017221'	023000	023451'	22270	        ERT [XWD[CURPOS],[ASCIZ"LAST KNOWN POS WAS _H$"]]
  2313	017222'	336000	013321'	22280	        SKIPN CURPOS
  2314	017223'	012000	023452'	22290	        TYPE [ASCIZ"POSITION UNKNOWN$"]
  2315	017224'	263740	000000	22300	        POPJ P,
  2316
  2317				22320	; CUT TAPE.  USES RESTORE CODE TO POSITION FILE.
  2318
  2319	017225'	201040	000002	22340	CUTROU::MOVEI R1,2
  2320	017226'	200041	015564*	22350	        MOVE R1,CTABL2(R1)      ;FETCH COMMAND STATE
  2321	017227'	336000	013311'	22360	        SKIPN STRFIL
  2322	017230'	317040	022116'	22370	        CAMG R1,[2,,777777]     ;CHECK INDIVIDUAL FILES
  2323	017231'	015000	023456'	22380	CUTT0:  ERROR [ASCIZ"COMMAND ERROR--EXPECTED FILENAME"]
  2324	017232'	135100	022117'	22390	        LDB R2,[XWD CNTFP+R1,0]
  2325	017233'	302100	000002	22400	        CAIE R2,CNTFT           ;LOOK FOR CR TERMINATOR ON PPN
  2326	017234'	344040	017232'	22410	        AOJA R1,.-2
  2327	017235'	204101	000001	22420	        MOVS R2,1(R1)           ;FETCH FILENAME BACKWARDS
  2328	017236'	135040	023465'	22430	        LDB R1,[XWD CNTFP+R1,2] ;LOOK AT TERMINATOR
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-43
TAP.MAC	23-MAR-79 11:41	

  2329	017237'	306040	000002	22440	        CAIN R1,CNTFT           ;MUST BE TERMINATOR (SINGLE FILE)
  2330	017240'	306100	415454	22450	        CAIN R2,(SIXBIT/ALL/)
  2331	017241'	254000	017231'	22460	        JRST CUTT0
  2332	017242'	335000	016776'	22470	        SKIPGE SENTAB+1
  2333	017243'	015000	023466'	22480	        ERROR [ASCIZ"TAPE NEEDS A WRITE RING"]
  2334	017244'	571040	777777	22490	        HRREI R1,-1             ;USE RESTORE CODE
  2335	017245'	621400	001400	22500	        TLZ F,DIRFLG+STOFLG     ;NOT DIR AND NOT STORE
  2336	017246'	661400	020000	22510	        TLO F,CUTFLG            ;CUT
  2337	017247'	254000	017305'	22520	        JRST DIRENT
  2338				22530	; JUMP BACK HERE AFTER LOCATING FILE ON TAPE
  2339	017250'			22540	CUTT2:
  2340				22550	        IFL CUTS,<
  2341				22560	        XCT MTWAIT(UNIT)        ;WAIT UNTIL INPUT FINISHED
  2342				22570	        XCT MGET2(UNIT)
  2343				22580	        TRZ R2,760000
  2344				22590	        IORI R2,SYNCIN  ;CHANGE TO SYNCHRONOUS INPUT
  2345				22600	        XCT MSET2(UNIT)
  2346				22610	        MOVEI R1,1
  2347				22620	FWD:    CAIN R1,TAPN
  2348				22630	        JRST BACK
  2349				22640	        AOS R1
  2350				22650	        XCT MIN(UNIT)
  2351				22660	        JRST .+1
  2352				22670	        STATO TAP,760000
  2353				22680	        JRST FWD
  2354				22690	; EOF, ERROR, OR TAPN REACHED
  2355				22700	BACK:   XCT MF7(UNIT)   ;BACK RECORD
  2356				22710	        XCT MF0(UNIT)
  2357				22720	        SOJG R1,BACK
  2358				22730	        XCT MCLOS(UNIT)
  2359				22740	        XCT MGET2(UNIT)
  2360				22750	        TRZ R2,760000
  2361				22760	        IORI R2,SYNCIN
  2362				22770	        XCT MSET2(UNIT)
  2363				22780	; SKIP FORWARD TO FILE HDR
  2364				22790	CUTT3:  PUSHJ P,TAPIN
  2365				22800	        JRST CUTT7
  2366				22810	        JRST CUTT4(R1)          ;TRAILER, HEADER OR FILE HDR
  2367				22820	        JRST CUTT3
  2368				22830	CUTT4:  JRST CUTT3
  2369				22840	        MOVE R2,TAPHED
  2370				22850	        MOVE U,5(R2)
  2371				22860	        PUSHJ P,CKNPPN
  2372				22870	        JRST CUTT3
  2373				22880	        MOVE R2,TAPHED
  2374				22890	        MOVE U,6(R2)
  2375				22900	        HLRZ W,7(R2)
  2376				22910	        PUSHJ P,CKNFIL
  2377				22920	        JRST CUTT3
  2378				22930	; FOUND CUT FILE.  NOW POSITION JUST PAST LAST RECORD
  2379				22940	        >
  2380	017250'	200040	023473'	22950	CUTT5:  MOVE R1,[XWD CURPPN,CUTPPN]
  2381	017251'	251040	013361'	22960	        BLT R1,CUTTIM
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-44
TAP.MAC	23-MAR-79 11:41	

  2382	017252'	260740	016074'	22970	CUTT5A: PUSHJ P,TAPIN
  2383	017253'	254000	017256'	22980	        JRST CUTT6      ;EOF
  2384	017254'	254000	017256'	22990	        JRST CUTT6      ;OTHER
  2385	017255'	254000	017252'	23000	        JRST CUTT5A     ;DATA
  2386				23010	; BACK EXACTLY ONE RECORD
  2387	017256'	256012	013775'	23020	CUTT6:  XCT MF7(UNIT)
  2388	017257'	256012	013771'	23030	        XCT MF0(UNIT)
  2389	017260'	200040	023474'	23040	        MOVE R1,[XWD CUTPPN,CURPPN]
  2390	017261'	251040	013331'	23050	        BLT R1,DATTIM
  2391				23060	; SET UP TO WRITE TRAILER
  2392	017262'	402000	013310'	23070	        SETZM STRPPN
  2393	017263'	402000	013311'	23080	        SETZM STRFIL
  2394	017264'	402000	013313'	23090	        SETZM STRBLK
  2395	017265'	402000	022001'	23100	        SETZM TAPNUM
  2396	017266'	260740	015752'	23110	        PUSHJ P,WPREP           ;OPENS TAPE FOR WRITE
  2397	017267'	661400	000001	23120	        TLO F,EOTFND            ;IGNORE EOT LOGIC IN TAPOUT
  2398				23130	;                               WILL BE SET PROPERLY BY NEXT OPEN 
  2399	017270'	260740	015625'	23140	        PUSHJ P,TRLOUT          ;SETS EOTFLG, DOES CLOSE
  2400	017271'	012000	023475'	23150	        TYPE [ASCIZ"CUT FINISHED--NOW POSITIONED AT LOGICAL END OF TAPE."]
  2401	017272'	254000	017217*	23160	        JRST CDISP
  2402				23170	        IFL CUTS,<
  2403				23180	CUTT7:  TRNN F,EOTFLG   ;SECOND EOF IN A ROW
  2404				23190	        JRST CUTT3
  2405				23200	        XCT MF7(UNIT)
  2406				23210	        XCT MF0(UNIT)
  2407				23220	        ERROR [ASCIZ"UNABLE TO RELOCATE CUT FILE"]
  2408				23230	        >
  2409
  2410
  2411				23260	; DIRECTORY, GET, RESTORE
  2412
  2413	017273'	571040	777777	23280	DIRROU::HRREI R1,-1             ;SAME AS RESTORE
  2414	017274'	621400	020400	23290	        TLZ F,STOFLG+CUTFLG     ;NOT STORE AND NOT CUT
  2415	017275'	661400	001000	23300	        TLO     F,DIRFLG
  2416	017276'	254000	017305'	23310	        JRST DIRENT
  2417	017277'	200040	013766'	23320	GETROU::MOVE	R1,JBLIC	;GET JOB'S LICENSE
  2418	017300'	607040	100000	23330		TLNN	R1,100000	;OP LICENSE SET?
  2419	017301'	015000	023510'	23340		ERROR	[ASCIZ "OPERATOR LICENSE IS NOT SET.$"]
  2420	017302'	334040	022037'	23350		SKIPA   R1,[0]          ;GET ROUTINE
  2421	017303'	571040	777777	23360	RESROU::HRREI   R1,-1           ;RESTORE ROUTINE
  2422	017304'	621400	021400	23370	        TLZ F,STOFLG+DIRFLG+CUTFLG ;NOT STORE,DIRECTORY, OR CUT
  2423	017305'	202040	021750'	23380	DIRENT: MOVEM R1,GETFLG#        ;FLAG TO DISTINGUISH GET AND RES
  2424	017306'	260740	014055*	23390	        PUSHJ P,CRLS            ;CLOSE NAMES FILE IF OPEN
  2425	017307'	602400	020000	23400	        TRNE F,TRTFG2  ;HAVE TRANSLATIONS BEEN ENTERED
  2426	017310'	660400	010000	23410	        TRO F,TRTFLG    ;YES, NOW IN EFFECT
  2427	017311'	402000	021751'	23420	        SETZM GTBLOCK
  2428	017312'	402000	013703'	23430	        SETZM UCOUNT            ;COUNT OF UFD'S SET UP
  2429	017313'	402000	013377'	23440	        SETZM TOTCNT
  2430	017314'	402000	013376'	23450	        SETZM   FILCNT          ;ZERO COUNT OF FILES RESTORED FOR USER
  2431	017315'	402000	022005'	23460	        SETZM TOTBLK            ;ZERO TOTAL BLOCKS IN USER FILES
  2432	017316'	402000	013702'	23470	        SETZM   RCOUNT          ;ZERO COUNT OF FILES RESTORED
  2433	017317'	606400	000040	23480	        TRNN F,EOTFLG
  2434	017320'	254000	017326'	23490	        JRST CONRES
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-45
TAP.MAC	23-MAR-79 11:41	

  2435				23500	; IF AT LOGICAL EOT BACKSPACE 1 USER AFTER DIR OR RES COMMAND
  2436	017321'	260740	016022'	23510	        PUSHJ P,SETIN
  2437	017322'	256012	014003'	23520	        XCT MF17(UNIT)
  2438	017323'	256012	014003'	23530	        XCT MF17(UNIT)
  2439	017324'	256012	013771'	23540	        XCT MF0(UNIT)
  2440	017325'	260740	016067'	23550	        PUSHJ P,CLRTAP  ;CLOSE TAPE AND CLEAR FLAGS
  2441	017326'	201040	000015	23560	CONRES: MOVEI R1,15
  2442	017327'	202040	013706'	23570	        MOVEM R1,ERC
  2443	017330'	260740	016022'	23580	        PUSHJ   P,SETIN         ;ENSURE BUFFERS
  2444	017331'	620400	003374	23590	        TRZ F,FNDFLG+RANFLG+EOFFLG+EOTFLG+SSCFLG+UNMFLG+HDRMSG+HDRFND
  2445	017332'	603400	000004	23600	        TLNE F,BOTFLG           ;ARE WE AT BEGINNING OF TAPE
  2446	017333'	660400	000200	23610	        TRO F,SSCFLG            ;YES, DIR CAN PRINT SAVE SET NOS.
  2447	017334'	660400	000400	23620	        TRO F,IGNFLG            ;IGNORE DATA RECORDS FOR AWHILE
  2448	017335'	621400	002000	23630	        TLZ F,INIFLG            ;TAPE NO LONGER INITIALIZED
  2449	017336'	402000	021757'	23640	        SETZM NULSW#            ;SWITCH USED BY CKNNUL
  2450	017337'	402000	021745'	23650	        SETZM DIRSSC            ;WORKING ON SAVE SET ZERO
  2451	017340'	260740	017022'	23660	        PUSHJ P,ZPOS            ;ZERO POSITIONAL INFORMATION
  2452
  2453				23680	; LOOP FOR READING TAPE, DRIVEN BY RECORD TYPE
  2454
  2455	017341'	260740	016074'	23700	READTAP:PUSHJ P,TAPIN
  2456	017342'	254000	020557'	23710	        JRST EOFRD      ;READ EOF
  2457	017343'	254000	017410'	23720	        JRST HTDRD      ;READ HEADER,TRAILER,OR DIR RECORD
  2458
  2459				23740	; DATA RECORD RECEIVED
  2460
  2461	017344'	602400	000400	23760	        TRNE F,IGNFLG           ;SKIP IF WE ARE NOT IGNORING THIS FILE
  2462	017345'	254000	017341'	23770	        JRST READTAP            ;GET NEXT RECORD
  2463				23780	; ENTRY PT. FROM DIR RECORD
  2464	017346'	200000	013663'	23790	XFER1:  MOVE R0,CKSUM
  2465	017347'	350000	013257'	23800	        AOS TAPHD2
  2466	017350'	373000	013257'	23810	XFER2:  SOSLE TAPHD2
  2467	017351'	254000	017354'	23820	        JRST XFER2A     ;DATA REMAINING IN TAPE BUFFER
  2468	017352'	202000	013663'	23830	        MOVEM R0,CKSUM
  2469	017353'	254000	017341'	23840	        JRST READTAP    ;GET NEXT RECORD
  2470	017354'	134040	013256'	23850	XFER2A: ILDB R1,TAPHD1  ;FETCH TAPE DATA WD
  2471	017355'	603400	001000	23860	        TLNE F,DIRFLG   ;DIRECTORY COMMAND
  2472	017356'	254000	017400'	23870	        JRST XFER2E     ;YES
  2473	017357'	373000	013270'	23880	        SOSLE FILHD2    ;IS DISC BUFFER FULL
  2474	017360'	254000	017365'	23890	        JRST XFER2B     ;NO
  2475	017361'	202000	021764'	23900	        MOVEM PCKSUM            ;CHECKSUM OF LAST COMPLETE BLOCK
  2476	017362'	057300	000000	23910	        OUT FIL,
  2477	017363'	354000	021734'	23920	        AOSA BLKCNT     ;SUCCESSFUL
  2478				23930	        ERB [XWD[FILDI1
  2479	017364'	024000	023534'	23940	WRITER],[ASCIZ"ERROR WRITING TO FILE _Z.$SKIPPING REMAINDER OF FILE--_E"]]
  2480	017365'	371000	013713'	23950	XFER2B: SOSL TAPCNT
  2481	017366'	136040	013267'	23960	        IDPB R1,FILHD1
  2482	017367'	331000	013713'	23970	XFER2D: SKIPL TAPCNT
  2483	017370'	254000	017374'	23980	        JRST XFER2C     ;NOT YET REACHED END
  2484	017371'	602400	000001	23990	        TRNE F,NEWFLG   ;TAPE FORMAT 14 OR GREATER
  2485	017372'	202040	021777'	24000	        MOVEM R1,TAPCK# ;SAVE LAST WORD WRITTEN PAST END OF DATA
  2486	017373'	254000	017350'	24010	        JRST XFER2
  2487	017374'	350000	013714'	24020	XFER2C: AOS WDCNT
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-46
TAP.MAC	23-MAR-79 11:41	

  2488	017375'	241000	000007	24030	        ROT R0,7
  2489	017376'	430000	000001	24040	        XOR R0,R1
  2490	017377'	344000	017350'	24050	        AOJA R0,XFER2
  2491				24060	; FAKE DISC OUTPUT FOR DIR
  2492	017400'	373000	013270'	24070	XFER2E: SOSLE FILHD2    ;FAKE DISC OUTPUT
  2493	017401'	254000	017406'	24080	        JRST XFER2F
  2494	017402'	202000	021764'	24090	        MOVEM PCKSUM            ;CHECKSUM OF LAST COMPLETE BLOCK
  2495	017403'	201100	000200	24100	        MOVEI R2,200
  2496	017404'	202100	013270'	24110	        MOVEM R2,FILHD2
  2497	017405'	350000	021734'	24120	        AOS BLKCNT
  2498	017406'	370000	013713'	24130	XFER2F: SOS TAPCNT
  2499	017407'	254000	017367'	24140	        JRST XFER2D
  2500
  2501				24160	; HEADER, TRAILER, OR DIR. RECORD READ
  2502
  2503	017410'	254001	017412'	24180	HTDRD:  JRST .+2(R1)
  2504	017411'	254000	020342'	24190	        JRST TRLRD              ;(-1) TRAILER
  2505	017412'	254000	020441'	24200	        JRST HDRRD              ;( 0) HEADER
  2506				24210	; FILE HEADER (DIR)              (+1) DIR
  2507	017413'	606400	000001	24220	        TRNN F,NEWFLG           ;TAPE VERSION 14 OR GREATER
  2508	017414'	254000	017417'	24230	        JRST FHDR0              ;OLD TAPE FILE
  2509	017415'	260740	017064'	24240	        PUSHJ P,POSTAP          ;SKIP IF TAPE POSITIONED
  2510	017416'	254000	017341'	24250	        JRST READTAP            ;KEEP READING UNTIL TAPE POSITIONED
  2511				24260	; FINISH UP FILE
  2512	017417'	606400	000400	24270	FHDR0:  TRNN F,IGNFLG           ;ARE WE PROCESSING A FILE
  2513	017420'	260740	020602'	24280	        PUSHJ P,CLTFIL          ;YES, CLOSE, TRUNCATE, AND SET IGNFLG
  2514				24290	; FINISH UP USER
  2515	017421'	200040	013316'	24300	        MOVE R1,CURPPN
  2516	017422'	332000	013332'	24310	        SKIPE LSTPPN    ;IF LSTPPN=0 THERE CAN BE NO USER TOTAL
  2517	017423'	316040	013332'	24320	        CAMN R1,LSTPPN          ;DID WE FIND A NEW USER
  2518	017424'	254000	017426'	24330	        JRST .+2        ;NO
  2519	017425'	260740	021123'	24340	        PUSHJ P,RPRTU           ;YES, TOTAL USER AND CLEAR UNMFLG
  2520				24350	; DO WE HAVE ANYTHING TO DO
  2521	017426'	260740	021043'	24360	        PUSHJ P,CKNNUL
  2522	017427'	254000	020370'	24370	        JRST EOT4               ;FINISHED
  2523				24380	; CHECK TO SEE IF RANGE SELECTED
  2524	017430'	606400	000001	24390	        TRNN F,NEWFLG
  2525	017431'	254000	017467'	24400	        JRST FHDR7              ;OLD TAPE--DON'T CHECK RANGE
  2526				24410	; COMPATIBILITY CHECKS FOR NEW TAPE
  2527	017432'	260740	017026'	24420	        PUSHJ P,COMPA
  2528	017433'	254000	020370'	24430	        JRST EOT4               ;INCOMPATIBLE--OPERATOR ABORT
  2529	017434'	200040	013321'	24440	        MOVE R1,CURPOS
  2530	017435'	313040	000000*	24450	        CAMLE R1,RANLAS##       ;GONE PAST LAST OF RANGE
  2531	017436'	254000	020370'	24460	        JRST EOT4               ;YES--TREAT LIKE LOGICAL EOT
  2532	017437'	260740	017210'	24470	        PUSHJ P,CKNRAN          ;SKIP IF FILE IN SELECTED RANGE
  2533	017440'	254000	017341'	24480	        JRST READTAP            ;BYPASS
  2534				24490	; CHECK TO SEE IF FILE SELECTED
  2535	017441'	402000	013705'	24500	FHDR1:  SETZM PPN               ;ZERO TRANSLATE PPN
  2536	017442'	200100	013255'	24510	        MOVE R2,TAPHED          ;CURRENT BUFFER PTR
  2537	017443'	200642	000005	24520	        MOVE    U,5(R2)         ;GET PPN
  2538	017444'	201040	000002	24530	        MOVEI R1,2
  2539	017445'	554041	017226*	24540	        HLRZ R1,CTABL2(R1)      ;GET STATE
  2540	017446'	307040	000000	24550	        CAIG R1,0       ;SKIP UNLESS ALL FILES INTENDED
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-47
TAP.MAC	23-MAR-79 11:41	

  2541	017447'	606400	010000	24560	        TRNN F,TRTFLG   ;ARE WE TRANSLATING
  2542	017450'	254000	017455'	24570	        JRST FHDR8      ;MATCH TAPE PPN AGAINST COMMAND LIST
  2543	017451'	260740	000000*	24580	        PUSHJ P,FINUN## ;LOOK FOR TAPE NAME IN TRANSLATION TABLE
  2544	017452'	254000	017341'	24590	        JRST READTAP    ;NOT FOUND
  2545	017453'	202000	013705'	24600	        MOVEM PPN       ;RESTORE FILE TO DIRECTORY SPECIFIED BY TABLE
  2546	017454'	254000	017457'	24610	        JRST FHDR9
  2547	017455'	260740	015562'	24620	FHDR8:  PUSHJ   P,CKNPPN        ;SEE IF THIS PPN SHOULD BE RESTORED
  2548	017456'	254000	017341'	24630	        JRST    READTAP          ;IGNORE THIS USER
  2549	017457'	200100	013255'	24640	FHDR9:  MOVE    R2,TAPHED       ;GET ADDRESS OF CURRENT BUFFER
  2550	017460'	200642	000006	24650	        MOVE    U,6(R2)         ;GET FILE NAME
  2551	017461'	554702	000007	24660	        HLRZ    W,7(R2)         ;GET EXTENSION
  2552	017462'	260740	015520'	24670	        PUSHJ   P,CKNFIL        ;SKIP IF THIS FILE SHOULD BE RESTORED
  2553	017463'	254000	017341'	24680	        JRST    READTAP          ;IGNORE THIS FILE
  2554				24690	; CUT COMMAND EXITS HERE, HAVING LOCATED THE CUT FILE
  2555	017464'	603400	020000	24700	        TLNE F,CUTFLG
  2556	017465'	254000	017250'	24710	        JRST CUTT2
  2557	017466'	254000	017517'	24720	        JRST FHDR6
  2558				24730	; BYPASS OLD TAPE FILES FOR CUT COMMAND OR WHILE POSITIONING TAPE
  2559				24740	; TO A NEW SECTION.  IF TAPE HAS BEEN POSITIONED, WE HAVE HIT
  2560				24750	; AN OLDER SECTION FOLLOWING A NEWER SECTION (PROBABLY PUT ON BY TEX 12)
  2561				24760	; IN THIS CASE IT IS NOT SAFE TO RESTORE THE FILE SINCE IT MAY
  2562				24770	; OVERWRITE A FILE ALREADY RESTORED.  PRINT IN DIRECTORY, HOWEVER.
  2563	017467'	606400	010000	24780	FHDR7:  TRNN F,TRTFLG           ;TRANSLATE TOO DANGEROUS FOR OLD TAPE FILES
  2564	017470'	603400	020000	24790	        TLNE F,CUTFLG
  2565	017471'	254000	017341'	24800	        JRST READTAP            ;CUT TOO DANGEROUS FOR OLD TAPE FILES
  2566	017472'	606400	000010	24810	        TRNN F,RANFLG           ;TAPE IS NOT POSITIONED BUT RANGE HAS
  2567				24820	;                               BEEN ENTERED.  WE SOMEHOW GOT ONTO
  2568				24830	;                               AN OLDER SECTION OF TAPE.
  2569	017473'	254000	017514'	24840	        JRST FHDR7C             ;TAPE NOT BEING POSITIONED
  2570	017474'	602400	000004	24850	        TRNE F,FNDFLG
  2571	017475'	607400	001000	24860	        TLNN F,DIRFLG
  2572	017476'	254000	017341'	24870	        JRST READTAP            ;EITHER NOT POSITIONED OR RESTORE COMMAND
  2573				24880	; OLD TAPES MUST HAVE READ HEADER IN ORDER TO CORRECTLY
  2574				24890	; DO DATE CONVERSION.  HERE WE REWIND TAPE IF NO HEADER WAS FOUND.
  2575	017477'	602400	002000	24900	FHDR7A: TRNE F,HDRFND
  2576	017500'	254000	017511'	24910	        JRST FHDR7B             ;PRINT HEADER MESSAGE IF NOT DIR
  2577				24920	        TYPE [ASCIZ"MISSED SAVE SET HEADER NEEDED TO DO DATE CONVERSION
  2578	017501'	012000	023535'	24930	"]
  2579				24940	        TYPE [ASCIZ"TYPE CR TO PROCEED ASSUMING P012 STYLE DATES
  2580	017502'	012000	023550'	24950	"]
  2581	017503'	012000	023562'	24960	        TYPE [ASCIZ"TYPE NO TO REWIND TAPE AND ABORT:"]
  2582	017504'	660400	003000	24970	        TRO F,HDRFND+HDRMSG
  2583	017505'	661400	010000	24980	        TLO F,T12FLG
  2584	017506'	022000	023572'	24990	        ERO [XWD[FHDR1],[ASCIZ"_F_G"]]
  2585	017507'	260740	016374'	25000	        PUSHJ P,REWWAI
  2586	017510'	254000	020370'	25010	        JRST EOT4
  2587	017511'	607400	001000	25020	FHDR7B: TLNN F,DIRFLG
  2588	017512'	260740	020507'	25030	        PUSHJ P,HDRPRI          ;HELPS OPER TO KNOW WHERE TAPE IS POSITIONED
  2589	017513'	254000	017441'	25040	        JRST FHDR1              ;CHECK TO SEE IF FILE SELECTED
  2590	017514'	602400	004000	25050	FHDR7C: TRNE F,RANCMD           ;HAS RANGE BEEN PRE-ENTERED FROM DISPATCHER
  2591	017515'	254000	017341'	25060	        JRST READTAP            ;YES, IGNORE TEX FILES UNTIL WE REACH
  2592				25070	;                               FIRST TITO FILE AND SET RANFLG
  2593	017516'	254000	017477'	25080	        JRST FHDR7A             ;NO, CHECK THE FILE
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-48
TAP.MAC	23-MAR-79 11:41	

  2594				25090	; ZERO CKSUM IF FILE NOT SPLIT
  2595	017517'	336000	013313'	25100	FHDR6:  SKIPN STRBLK
  2596	017520'	402000	013663'	25110	        SETZM CKSUM
  2597	017521'	607400	001000	25120	        TLNN F,DIRFLG
  2598	017522'	254000	017547'	25130	        JRST FHDR3              ;RESTORE OR GET
  2599				25140	; PRINT DIRECTORY INFO
  2600				25150	; PRINT HEADER MESSAGES FOR DIR
  2601	017523'	260740	020507'	25160	        PUSHJ P,HDRPRI
  2602	017524'	336000	013313'	25170	        SKIPN STRBLK            ;ARE WE LOOKING FOR SPLIT FILE
  2603	017525'	254000	017533'	25180	        JRST FHDR1A                 ;NO
  2604	017526'	260740	020146'	25190	        PUSHJ P,XFER4E          ;CHECK FILE PPN AGAINST STRPPN, ETC.
  2605				25200	        ERB [XWD[STRBLK
  2606	017527'	024000	022501'	25210	CURPPN],[ASCIZ"STARTING WITH BLOCK _C OF FILE _J.$"]]
  2607	017530'	200040	013313'	25220	        MOVE R1,STRBLK
  2608	017531'	202040	021762'	25230	        MOVEM R1,OLDBLK
  2609	017532'	402000	013313'	25240	        SETZM STRBLK
  2610	017533'	666400	000100	25250	FHDR1A: TRON F,UNMFLG           ;HAS USER HEADING PRINTED
  2611				25260	        ERO [XWD 0,[ASCIZ"$POSITION    FILE NAME      USER NAME     CREATION DATE     DATE WRIT
  2612	017534'	022000	023615'		TEN  SIZE CHECKSUM$"]]
  2613	017535'	200040	013255'	25270	        MOVE R1,TAPHED
  2614	017536'	200041	000037	25280	        MOVE R1,37(R1)
  2615	017537'	202040	021735'	25290	        MOVEM R1,BLKSIZ#        ;ALLOCATED FILE SIZE IN BLOCKS
  2616	017540'	336000	021762'	25300	        SKIPN OLDBLK    ;IS FILE SPLIT
  2617	017541'	272040	022005'	25310	        ADDM R1,TOTBLK          ;NO, TOTAL BLKS ALLOCATED TO THIS USER
  2618	017542'	602400	000001	25320	        TRNE F,NEWFLG
  2619	017543'	254000	017546'	25330	        JRST FHDR2
  2620				25340	        ERO [XWD[TAPHED
  2621				25350	TAPHED
  2622				25360	TAPHED
  2623				25370	BLKSIZ
  2624	017544'	022000	023634'	25380	XWD 12,5],[ASCIZ"           _Q     _M  _R                 _N$"]]
  2625	017545'	254000	017547'	25390	        JRST FHDR3
  2626				25400	FHDR2:  ERO [XWD[CURPOS
  2627				25410	XWD 10,5
  2628				25420	CURNUM
  2629				25430	XWD 12,3
  2630				25440	TAPHED
  2631				25450	TAPHED
  2632				25460	TAPHED
  2633				25470	CURDAT
  2634				25480	BLKSIZ
  2635	017546'	022000	023655'	25490	XWD 12,5],[ASCIZ"_N_N   _Q     _M  _R  _L_N "]]
  2636				25500	; CHECK FOR PPN.UFD FILES IN [1,1]
  2637	017547'	535000	000000	25510	FHDR3:  HRLEI R0,0
  2638	017550'	602400	000001	25520	        TRNE F,NEWFLG
  2639	017551'	200000	013321'	25530	        MOVE CURPOS
  2640	017552'	202000	021767'	25540	        MOVEM POSITION#         ;SAVE FOR CLTFI2
  2641	017553'	200100	013255'	25550	        MOVE R2,TAPHED          ;CURRENT BUFFER PTR
  2642	017554'	200642	000005	25560	        MOVE U,5(R2)            ;GET THE PPN
  2643	017555'	554042	000007	25570	        HLRZ    R1,7(R2)        ;GET THE EXTENSION
  2644	017556'	316640	013307'	25580	        CAMN    U,SYSPP         ;SKIP IF NOT USER 1,1 (UFD)
  2645	017557'	302040	654644	25590	        CAIE    R1,(SIXBIT /UFD/)
  2646	017560'	334000	000000	25600	        SKIPA                   ;NOT A UFD IN 1,1
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-49
TAP.MAC	23-MAR-79 11:41	

  2647	017561'	254000	020163'	25610	        JRST    SETST1          ;MAKE SURE THE UFD IS SET UP
  2648				25620	; FILE IS SELECTED FOR RESTORE OR GET
  2649	017562'	402000	013714'	25630	        SETZM WDCNT
  2650	017563'	402000	021734'	25640	        SETZM BLKCNT
  2651	017564'	402000	013270'	25650	        SETZM FILHD2
  2652	017565'	402000	021777'	25660	        SETZM TAPCK
  2653	017566'	402000	013712'	25670	        SETZM ORBSIZ            ;ZERO ORBSIZ FOR ENTER
  2654				25680	; REMOVE HEADER WORDS FROM BEGINNING OF FILE
  2655	017567'	201040	000042	25690	        MOVEI   R1,42
  2656	017570'	602400	000001	25700	        TRNE F,NEWFLG
  2657	017571'	201040	000100	25710	        MOVEI R1,XHDRN
  2658	017572'	272040	013256'	25720	        ADDM    R1,TAPHD1
  2659	017573'	210040	000001	25730	        MOVN R1,R1
  2660	017574'	272040	013257'	25740	        ADDM    R1,TAPHD2
  2661				25750	; MOVE HEADER WORDS TO FILDIR
  2662	017575'	200100	013255'	25760	        MOVE R2,TAPHED
  2663	017576'	205042	000004	25770	        MOVSI R1,4(R2)
  2664	017577'	541040	013517'	25780	        HRRI R1,FILDIR
  2665				25790	; DIRECTORY.  JUST CALCULATE OLDBLK, TAPCNT
  2666	017600'	603400	001000	25800	        TLNE F,DIRFLG
  2667	017601'	254000	017760'	25810	        JRST FHDR5              ;FAKE FILE OPENING
  2668				25820	; FILE.  SETUP FILE OPENING AND POSITIONING TO CORRECT BLOCK.
  2669	017602'	251040	013563'	25830	        BLT     R1,FILDIR+XLOOKN
  2670	017603'	200040	013730'	25840	        MOVE    R1,UPDFLG       ;SAVE UPDFLG
  2671	017604'	202040	013707'	25850	        MOVEM   R1,UPDMOD       ;IN UPDATE MODE SWITCH
  2672	017605'	402000	013531'	25860	        SETZM   FRBPOS          ;DON'T WORRY ABOUT TRACKS AND CYLINDERS
  2673	017606'	402000	013532'	25870	        SETZM   FRBNXT          ;RESERVED FOR FUTURE USE
  2674	017607'	200040	013524'	25880	        MOVE R1,FRBSIZ
  2675	017610'	271040	000177	25890	        ADDI R1,177
  2676	017611'	242040	777771	25900	        LSH R1,-7
  2677	017612'	313040	013530'	25910	        CAMLE R1,FRBALC
  2678	017613'	202040	013530'	25920	        MOVEM R1,FRBALC         ;ASSURE ESTIMATED SIZE IS SUFFICIENT
  2679	017614'	200040	013530'	25930	        MOVE    R1,FRBALC       ;GET NUMBER OF ALLOCATED BLOCKS
  2680	017615'	402000	013530'	25940	        SETZM   FRBALC          ;DON'T NEED STORAGE IN ONE BIG BLOCK
  2681	017616'	202040	013527'	25950	        MOVEM   R1,FRBEST       ;GET THE STORAGE IN ANY WAY POSSIBLE
  2682	017617'	307040	000005	25960	        CAIG    R1,5            ;IGNORE UPD FLAG ON SMALL FILES
  2683	017620'	402000	013707'	25970	        SETZM   UPDMOD          ;SMALLER THAN 6 BLOCKS
  2684	017621'	202040	013715'	25980	        MOVEM   R1,TRBALC       ;REMEMBER FILE SIZE
  2685	017622'	607400	004000	25990	        TLNN    F,P12FLG        ;SKIP IF MONITOR P012 OR LATER
  2686	017623'	254000	020012'	26000	        JRST    RP11            ;RUNNING ON MONITOR P011
  2687	017624'	603400	010000	26010	        TLNE    F,T12FLG        ;SKIP IF OLD FORMAT TAPE
  2688	017625'	254000	017665'	26020	        JRST    DCDONE          ;NEW MONITOR AND NEW TAPE - NO CONVERSION
  2689	017626'	135040	023656'	26030	        LDB     R1,[POINT 12,FILDI4,35] ;NEW MONITOR AND OLD TAPE
  2690	017627'	202040	013365'	26040	        MOVEM   R1,CNVDAT       ;SAVE LOW ORDER BIT OF CREATION DATE
  2691	017630'	135040	023657'	26050	        LDB     R1,[POINT 2,FILDI3,21] ;GET HIGH DATE BITS
  2692	017631'	137040	023660'	26060	        DPB     R1,[POINT 2,CNVDAT,23] ;SAVE HIGH CRE DATE BITS
  2693	017632'	135040	023661'	26070	        LDB     R1,[POINT 11,FILDI4,23] ;GET CREATION TIME
  2694	017633'	220040	013375'	26080	        IMUL    R1,JIFFPM       ;CONVERT MINUTES TO JIFFIES
  2695	017634'	202040	013366'	26090	        MOVEM   R1,CNVTIM       ;SAVE CREATION TIME
  2696	017635'	200040	023662'	26100	        MOVE    R1,[XWD 50,400020] ;CONVERT OLD TO NEW
  2697	017636'	202040	013367'	26110	        MOVEM   R1,CNVFMT       ;SAVE CONVERSION FORMAT
  2698	017637'	201040	013365'	26120	        MOVEI   R1,CNVDAT       ;GET ADDRESS OF CONVERSION TABLE
  2699	017640'	047040	777723	26130	        DATUUO  R1,             ;CONVERT DATE AND TIME
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-50
TAP.MAC	23-MAR-79 11:41	

  2700	017641'	024000	023672'	26140	        ERB [XWD[CURPPN],[ASCIZ "DATE CONV ERR ON _Z. CONTINUING..."]]
  2701	017642'	200040	013365'	26150	        MOVE    R1,CNVDAT       ;GET THE NEW CREATION DATE
  2702	017643'	137040	023656'	26160	        DPB     R1,[POINT 12,FILDI4,35]
  2703	017644'	135040	023660'	26170	        LDB     R1,[POINT 2,CNVDAT,23] ;GET HIGH CRE DATE BITS
  2704	017645'	137040	023657'	26180	        DPB     R1,[POINT 2,FILDI3,21] ;SAVE THE HIGH CRE DATE BITS
  2705	017646'	200040	013366'	26190	        MOVE    R1,CNVTIM       ;GET THE NEW CREATION TIME
  2706	017647'	202100	013366'	26200	        MOVEM   R2,CNVTIM       ;SAVE R2 IN TEMP CELL
  2707	017650'	230040	013375'	26210	        IDIV    R1,JIFFPM       ;CONVERT JIFFIES TO MINUTES
  2708	017651'	200100	013366'	26220	        MOVE    R2,CNVTIM       ;RESTORE R2
  2709	017652'	137040	023661'	26230	        DPB     R1,[POINT 11,FILDI4,23] ;SAVE THE CREATION TIME
  2710	017653'	135040	023673'	26240	        LDB     R1,[POINT 14,FILDI3,35]
  2711	017654'	202040	013365'	26250	        MOVEM   R1,CNVDAT       ;SAVE THE ACCESS DATE
  2712	017655'	402040	013366'	26260	        SETZM   R1,CNVTIM       ;ZERO THE ACCESS TIME
  2713	017656'	200040	023674'	26270	        MOVE    R1,[XWD 0,400000] ;CONVERT OLD TO NEW
  2714	017657'	202040	013367'	26280	        MOVEM   R1,CNVFMT       ;SAVE THE CONVERSION FORMAT
  2715	017660'	201040	013365'	26290	        MOVEI   R1,CNVDAT       ;GET ADDRESS OF THE CONVERSION TABLE
  2716	017661'	047040	777723	26300	        DATUUO  R1,             ;CONVERT THE ACCESS DATE
  2717	017662'	024000	023704'	26310	        ERB [XWD[CURPPN],[ASCIZ "DATE CONV ERR ON _J. CONTINUING..."]]
  2718	017663'	200040	013365'	26320	        MOVE    R1,CNVDAT       ;GET THE NEW ACCESS DATE
  2719	017664'	137040	023673'	26330	        DPB     R1,[POINT 14,FILDI3,35] ;SAVE THE ACCESS DATE
  2720	017665'	041300	000014	26340	DCDONE: INIT    FIL,BUFBIN
  2721	017666'	446353	000000	26350	        SIXBIT  /DSK/
  2722	017667'	013266'	000000	26360	        XWD     FILHED,0
  2723	017670'	015000	023705'	26370	        ERROR   [ASCIZ "DISC NOT AVAILABLE"]
  2724	017671'	201040	001135'	26380	        MOVEI   R1,FILBUF
  2725	017672'	202040	015151*	26390	        MOVEM   R1,JOBFF        ;FAKE OUT OUTBUF
  2726	017673'	065300	000007	26400	        OUTBUF  FIL,FILN
  2727	017674'	047040	000024	26410	        GETPPN  R1,             ;GET PPN OF TITO USER
  2728	017675'	601000	000000	26420	        TLN                     ;NOP
  2729	017676'	332000	021750'	26430	        SKIPE   GETFLG          ;SKIP IF GET COMMAND
  2730	017677'	200040	013520'	26440	        MOVE R1,FILDI1
  2731	017700'	332000	013705'	26450	        SKIPE PPN
  2732	017701'	200040	013705'	26460	        MOVE R1,PPN             ;TRANSLATE OPTION
  2733	017702'	202040	013520'	26470	        MOVEM   R1,FILDI1       ;REPLACE TAPE PPN WITH MINE
  2734	017703'	260740	021410'	26480	        PUSHJ   P,CKLIC
  2735	017704'	515040	020000	26490	        HRLZI   R1,RCHGBT       ;GET THE RIB CHANGED BIT
  2736	017705'	332000	013732'	26500	        SKIPE FLGOFF    ;SHOULD WE MARK FILE DUMPED
  2737	017706'	436040	013533'	26510	        IORM R1,FRBNCA  ;YES
  2738	017707'	336000	013732'	26520	        SKIPN FLGOFF    ;SHOULD WE MARK FILE NOT DUMPED
  2739	017710'	412040	013533'	26530	        ANDCAM R1,FRBNCA ;YES
  2740	017711'	200040	013536'	26540	        MOVE    R1,FRBSTS       ;GET STATUS WORD OF FILE ON TAPE
  2741	017712'	602040	000001	26550	        TRNE    R1,.RPBAD       ;SKIP IF FILE NOT BAD ON TAPE
  2742				26560	        ERB [XWD[FILDI1
  2743	017713'	024000	023724'	26570	XFER3D],[ASCIZ "NOT RESTORING _J.  IT IS BAD ON TAPE.$_E"]]
  2744	017714'	505040	013517'	26580	        HRLI    R1,FILDIR       ;SETUP SAVE
  2745	017715'	541040	013616'	26590	        HRRI    R1,SAVBUF       ;OF FILE PARAMETERS
  2746	017716'	251040	013662'	26600	        BLT     R1,SAVBUF+XLOOKN        ;IN "SAVBUF"
  2747	017717'	200040	013522'	26610	        MOVE R1,FILDI3 ;SAVE EXTENSION AND CONVERTED DATE
  2748	017720'	202040	013710'	26620	        MOVEM R1,SEXT   ;IN CASE OF ENTER ERROR RETURN
  2749				26630	;                               IN NEWEST FILE MODE SAVE
  2750				26640	;                               CREATION DATE.  REQUIRES EXTRA
  2751				26650	;                               LOOKUP.
  2752	017721'	200040	013520'	26660	        MOVE    R1,FILDI1       ;PICKUP FILE PPN
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-51
TAP.MAC	23-MAR-79 11:41	

  2753	017722'	135100	000000*	26670	        LDB     R2,MOPTR##      ;GET MODE FOR DISC FILE
  2754	017723'	316040	023725'	26680	        CAMN    R1,[XWD 1,4]    ;SKIP IF NOT SYS PPN
  2755	017724'	135100	000000*	26690	        LDB     R2,MSYPTR##     ;GET MODE FOR SYS FILES
  2756	017725'	306100	000000*	26700	        CAIN    R2,MOMNEW##     ;SKIP IF NEWEST FILE OPTION NOT SELECTED
  2757	017726'	254000	020025'	26710	        JRST    GCREDAT         ;GET CREATION DATE
  2758	017727'	336000	013707'	26720	UTRY:   SKIPN   UPDMOD  ;SKIP IF UPDATE MODE
  2759	017730'	332000	013313'	26730	        SKIPE   STRBLK  ;NO SKIP IF CONTINUED FILE
  2760	017731'	260740	020110'	26740	        PUSHJ   P,XFER4 ;DO LOOKUP AND MOVE TRBALC TO FRBALC
  2761	017732'	332000	013531'	26750	RTRY:   SKIPE   FRBPOS          ;BETTER BE ZERO
  2762	017733'	260740	020020'	26760	        PUSHJ P,RBER            ;REPORT AND FIX .RBPOS
  2763	017734'	332000	013731'	26770	        SKIPE PRAFLG
  2764	017735'	254000	017740'	26780	        JRST .+3
  2765	017736'	402000	013530'	26790	        SETZM FRBALC
  2766	017737'	402000	013527'	26800	        SETZM FRBEST
  2767	017740'	077300	013517'	26810	        ENTER   FIL,FILDIR      ;ATTEMPT ENTER
  2768	017741'	254000	017764'	26820	        JRST    CKER    ;EVALUATE ERROR
  2769				26830	;       MOVE R1,FRBALC
  2770				26840	;       CAMGE R1,TRBALC         ;BETTER BE ENOUGH
  2771				26850	;       JRST NOROOM             ;FILE TOO FAT
  2772	017742'	332000	013313'	26860	        SKIPE   STRBLK          ;SKIP IF FILE NOT SPLIT
  2773	017743'	260740	015337'	26870	        PUSHJ   P,FSTWRD        ;SET POSITION IN FILE
  2774	017744'	201040	000000	26880	        MOVEI   R1,0            ;ASSUME ZERO IN CASE FILE IS SPLIT
  2775	017745'	336000	021762'	26890	        SKIPN   OLDBLK          ;SKIP IF FILE NOT SPLIT
  2776				26900	;                               NO SKIP IF SECOND PART OF CONTINUED FILE
  2777	017746'	200040	013522'	26910	        MOVE    R1,FILDI3       ;GET OLD/NEW BIT FOR THIS FILE
  2778	017747'	602040	400000	26920	        TRNE    R1,400000       ;SKIP IF NEW FILE OR SPLIT FILE
  2779	017750'	254000	020047'	26930	        JRST    XFER3A          ;SEE IF HE REALLY WANTS TO WRITE FILE
  2780	017751'	332040	021762'	26940	XFER3C: SKIPE   R1,OLDBLK       ;CALCULATE
  2781	017752'	275040	000001	26950	        SUBI    R1,1            ;FIRST DATA BLOCK=BLOCK 1
  2782	017753'	242040	000007	26960	        LSH     R1,7            ;REMAINING
  2783	017754'	274040	013623'	26970	        SUB     R1,TRBSIZ       ;TAPE WORDCOUNT
  2784	017755'	212040	013713'	26980	        MOVNM  R1,TAPCNT       ;SAVE FOR USE AT XFER2B:
  2785	017756'	620400	000400	26990	        TRZ F,IGNFLG            ;RESET TO HANDLE DATA RECORDS
  2786	017757'	254000	017346'	27000	        JRST XFER1              ;NOW MOVE DATA TO DISC FILE
  2787
  2788				27020	; DIRECTORY. FAKE FILE OPENING.
  2789
  2790	017760'	251040	013522'	27040	FHDR5:  BLT R1,FILDIR+3         ;NEEDED AT CLTFI5
  2791	017761'	200042	000011	27050	        MOVE R1,11(R2)          ;FILE SIZE IN RIB
  2792	017762'	202040	013623'	27060	        MOVEM R1,TRBSIZ
  2793	017763'	254000	017751'	27070	        JRST XFER3C
  2794
  2795				27090	; ENTER FAILED.  PERHAPS DISC ALLOCATION WAS INSUFFICIENT.
  2796				27100	; IF WE ARE GOUGING FILE CHECK PROGRESS AND RETRY.
  2797
  2798	017764'	200040	013710'	27120	CKER:   MOVE R1,SEXT    ;RESTORE FILE EXTENSION
  2799	017765'	250040	013522'	27130	        EXCH    R1,FILDI3       ;DESTROYED BY ERROR CODE
  2800	017766'	501040	000000	27140	        HLLI    R1,
  2801	017767'	202040	013724'	27150	        MOVEM   R1,ERCODE       ;SAVE FOR THE CURIOUS
  2802	017770'	302040	000017	27160	        CAIE    R1,17   ;KLUDGE TO GET MORE SPACE IN UPDATE MODE
  2803	017771'	254000	020007'	27170	        JRST    TWHY    ;EXPLAIN TRANSGRESSIONS
  2804	017772'	200040	013530'	27180	        MOVE    R1,FRBALC       ;CHECK PROGRESS
  2805	017773'	316040	013711'	27190	        CAMN    R1,ORBALC       ;DID WE GET ANY
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-52
TAP.MAC	23-MAR-79 11:41	

  2806				27200	NOROOM: ERB [XWD[FILDI1
  2807	017774'	024000	023737'	27210	XFER3D],[ASCIZ"BYPASSING _J.  NOT ENOUGH DISC SPACE.$_E"]]
  2808	017775'	336000	013707'	27220	        SKIPN   UPDMOD  ;WAS FILE IN UPDATE MODE
  2809	017776'	332000	013313'	27230	        SKIPE   STRBLK  ;OR SPLIT
  2810	017777'	254000	020001'	27240	        JRST    .+2     ;TRY TO GET MORE SPACE
  2811	020000'	254000	017774'	27250	        JRST    NOROOM
  2812	020001'	202040	013711'	27260	        MOVEM   R1,ORBALC       ;MOVE FRBALC TO ORBALC
  2813	020002'	070300	000014	27270	        CLOSE   FIL,DLL!DNC
  2814	020003'	076300	013517'	27280	        LOOKUP  FIL,FILDIR
  2815	020004'	254000	017774'	27290	        JRST NOROOM
  2816	020005'	260740	020116'	27300	        PUSHJ P,FI      ;RESTORE PARAMETERS AND MOVE TRBALC TO FRBALC
  2817	020006'	254000	017732'	27310	        JRST    RTRY    ;TRY TO ENTER FILE
  2818	020007'	024000	023744'	27320	TWHY:   ERB [XWD[FILDI1],[ASCIZ"CANNOT ENTER _Z---"]]
  2819	020010'	260740	021165'	27330	        PUSHJ   P,WHY
  2820	020011'	254000	020064'	27340	        JRST    XFER3D
  2821
  2822				27360	; MONITOR VERSION P011.  HANDLE TAPES WRITTEN WITH TEX VER 12 OR LATER.
  2823
  2824	020012'	607400	010000	27380	RP11:   TLNN    F,T12FLG        ;SKIP IF NEW FORMAT TAPE
  2825	020013'	254000	017665'	27390	        JRST    DCDONE          ;OLD MONITOR AND OLD TAPE SO NO CONVERSION
  2826	020014'	400040	000000	27400	        SETZ    R1,             ;ZERO R1 FOR DEFAULT CRE AND ACC
  2827	020015'	137040	023745'	27410	        DPB     R1,[POINT 16,FILDI3,35] ;ACC DATE AND HIGH BITS OF CRE
  2828	020016'	137040	023746'	27420	        DPB     R1,[POINT 23,FILDI4,35] ;CRE TIME AND LOW BITS OF CRE DATE
  2829	020017'	254000	017665'	27430	        JRST    DCDONE          ;CONVERSION DONE - CURRENT DATES
  2830
  2831				27450	; PROGRAM ERROR - RBPOS IS NONZERO.  SET TO ZERO AND PROCEED.
  2832
  2833	020020'	024000	023761'	27470	RBER:   ERB [XWD[FILDI1],[ASCIZ"FILE _Z .RBPOS RESET TO ZERO$PROCEEDING O.K.$"]]
  2834	020021'	402000	013531'	27480	        SETZM FRBPOS
  2835	020022'	254000	017732'	27490	        JRST RTRY
  2836
  2837				27510	;ERROR WRITING TO DISC FILE
  2838
  2839	020023'	260740	021375'	27530	WRITER: PUSHJ P,DWHY    ;DECODE WHY WRITE FAILED
  2840	020024'	254000	020064'	27540	        JRST XFER3D     ;IGNORE REST OF FILE
  2841				27550	;GET CREATION DATE FOR NEWEST FILE MODE
  2842
  2843	020025'	076300	013517'	27570	GCREDAT: LOOKUP FIL,FILDIR      ;DO LOOKUP TO GET CRE DAT
  2844	020026'	254000	020043'	27580	        JRST REBTRY             ;NOT THERE--MUST BE NEW FILE
  2845	020027'	200040	013523'	27590	        MOVE R1,FILDI4
  2846	020030'	202040	013723'	27600	        MOVEM R1,SAVDI4         ;SAVE FOR XFER3N TIME CHECK
  2847	020031'	246040	777764	27610	        LSHC    R1,-14          ;POSITION LOW ORDER PT IN R2
  2848	020032'	135040	023657'	27620	        LDB     R1,[POINT 2,FILDI3,21]  ;GET HI ORDER PT
  2849	020033'	246040	000014	27630	        LSHC    R1,14
  2850	020034'	202040	013722'	27640	        MOVEM   R1,CREDSC       ;SAVE FOR USE IN XFER3N
  2851	020035'	336000	013313'	27650	        SKIPN   STRBLK          ;SKIP IF FILE SPLIT
  2852	020036'	336000	013707'	27660	        SKIPN   UPDMOD  ;SKIP IF UPDATE MODE
  2853	020037'	254000	020042'	27670	        JRST    .+3
  2854	020040'	260740	020114'	27680	        PUSHJ   P,FII        ;DO UPD MODE ONLY PART OF XFER4
  2855	020041'	254000	017732'	27690	        JRST    RTRY            ;SAVES DOING EXTRA LOOKUP
  2856	020042'	070300	000014	27700	        CLOSE   FIL,DNC!DLL
  2857	020043'	505040	013616'	27710	REBTRY: HRLI    R1,SAVBUF       ;RESTORE ENTER BUFFER
  2858	020044'	541040	013517'	27720	        HRRI    R1,FILDIR
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-53
TAP.MAC	23-MAR-79 11:41	

  2859	020045'	251040	013563'	27730	        BLT     R1,FILDIR+XLOOKN
  2860	020046'	254000	017727'	27740	        JRST    UTRY
  2861
  2862				27760	; CONFIRM WRITING OVER OLD FILE
  2863
  2864	020047'	200040	013520'	27780	XFER3A: MOVE    R1,FILDI1       ;GET PPN FOR THIS FILE
  2865	020050'	135100	017722*	27790	        LDB     R2,MOPTR##      ;GET MODE FOR DSK FILES
  2866	020051'	316040	023725'	27800	        CAMN    R1,[XWD 1,4]    ;SKIP IF NOT SYS FILE
  2867	020052'	135100	017724*	27810	        LDB     R2,MSYPTR##     ;GET MODE FOR SYS FILES
  2868	020053'	306100	000000*	27820	        CAIN    R2,MOMDIS##     ;DON'T SKIP IF WE SHOULD KEEP DISC FILE
  2869	020054'	254000	020063'	27830	        JRST    XFER3E          ;KEEP DISC FILE
  2870	020055'	306100	000000*	27840	        CAIN    R2,MOMTAP##     ;DON'T SKIP IF WE SHOULD KEEP TAPE FILE
  2871	020056'	254000	020067'	27850	        JRST    XFER3B          ;RESTORE FILE FROM TAPE
  2872	020057'	306100	017725*	27860	        CAIN    R2,MOMNEW##     ;DON'T SKIP IF WE SHOULD KEEP NEWEST FILE
  2873	020060'	254000	020071'	27870	        JRST    XFER3N          ;KEEP NEWEST FILE
  2874				27880	        ERT [XWD[FILDI1
  2875	020061'	023000	023772'	27890	        XFER3C],[ASCIZ "OK TO WRITE OVER _Z? _F_G"]]
  2876	020062'	334000	000000	27900	        SKIPA                   ;DON'T PRINT THE IGNORE MESSAGE
  2877	020063'	022000	024001'	27910	XFER3E: ERO     [XWD [FILDI1],[ASCIZ "NOT WRITING OVER FILE _Z.$"]]
  2878
  2879				27930	; BYPASS FILE ON TAPE, ALREADY OPENED
  2880
  2881	020064'	070300	000040	27950	XFER3D: CLOSE   FIL,RST         ;CLOSE FILE AND KEEP IT OUT OF DIR
  2882	020065'	660400	000400	27960	        TRO     F,IGNFLG        ;IGNORE REMAINDER OF FILE DATA
  2883	020066'	254000	017341'	27970	        JRST READTAP
  2884
  2885				27990	; WRITE OVER DISC FILE
  2886
  2887	020067'	022000	024007'	28010	XFER3B: ERO     [XWD [FILDI1],[ASCIZ "WRITING OVER FILE _Z.$"]]
  2888	020070'	254000	017751'	28020	        JRST    XFER3C          ;CONTINUE AS USUAL
  2889
  2890				28040	; COMPARE CREATION DATES IN NEWEST FILE MODE
  2891
  2892	020071'	200040	013523'	28060	XFER3N: MOVE    R1,FILDI4       ;GET CREATION DATE FROM TAPE FILE
  2893	020072'	246040	777764	28070	        LSHC    R1,-14          ;POSITION IN R2
  2894	020073'	135040	023657'	28080	        LDB     R1,[POINT 2,FILDI3,21]  ;GET HI ORDER BITS
  2895	020074'	246040	000014	28090	        LSHC    R1,14           ;REPOSITION IN R1
  2896	020075'	315040	013722'	28100	        CAMGE   R1,CREDSC       ;SKIP IF TAPE > (NEWER) DISC
  2897	020076'	254000	020063'	28110	        JRST    XFER3E          ;DON'T RESTORE FILE
  2898	020077'	312040	013722'	28120	        CAME    R1,CREDSC       ;SKIP IF DATES EQUAL
  2899	020100'	254000	020067'	28130	        JRST    XFER3B          ;RESTORE THE FILE FROM TAPE
  2900	020101'	200040	013723'	28140	        MOVE    R1,SAVDI4       ;GET CREATION DATE FROM DSK FILE
  2901	020102'	200100	013523'	28150	        MOVE    R2,FILDI4       ;GET CREATION DATE FROM TAP FILE
  2902	020103'	404040	024010'	28160	        AND     R1,[XWD 37,770000] ;THROW AWAY ALL BUT TIME BITS
  2903	020104'	404100	024010'	28170	        AND     R2,[XWD 37,770000] ;THROW AWAY ALL BUT TIME BITS
  2904	020105'	311040	000002	28180	        CAML    R1,R2           ;SKIP IF TAPE FILE NEWER
  2905	020106'	254000	020063'	28190	        JRST    XFER3E          ;DON'T RESTORE FILE
  2906	020107'	254000	020067'	28200	        JRST    XFER3B          ;RESTORE THE FILE FROM TAPE
  2907
  2908
  2909				28230	; HANDLE UPDATE MODE AND SPLIT FILES.  PERFORM LOOKUP
  2910
  2911	020110'	332000	013313'	28250	XFER4:	SKIPE	STRBLK     ;IF NOT SPLIT, MUST BE UPDATE MODE
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-54
TAP.MAC	23-MAR-79 11:41	

  2912	020111'	260740	020146'	28260	        PUSHJ P,XFER4E          ;CHECK FILE PPN AGAINST STRPPN, ETC.
  2913	020112'	076300	013517'	28270	        LOOKUP  FIL,FILDIR      ;OPEN FILE FOR INPUT
  2914	020113'	254000	020127'	28280	        JRST    XFER4C          ;SOME KIND OF LOOKUP PROBLEM
  2915	020114'	200040	013524'	28290	FII:    MOVE R1,FRBSIZ  ;SIZE OF FILE ON DISC
  2916	020115'	202040	013712'	28300	        MOVEM R1,ORBSIZ ;SAVE FOR USE BY TRUNCATE
  2917	020116'	505040	013616'	28310	FI:     HRLI    R1,SAVBUF       ;SETUP UNSAVE
  2918	020117'	541040	013517'	28320	        HRRI    R1,FILDIR       ;OF FILE PARAMETERS
  2919	020120'	251040	013563'	28330	        BLT     R1,FILDIR+XLOOKN        ;FROM SAVBUF TO FILDIR
  2920	020121'	200040	013715'	28340	        MOVE    R1,TRBALC       ;TRY TO GET ALLOCATED BLOCKS
  2921	020122'	202040	013530'	28350	        MOVEM   R1,FRBALC       ;FORCE ENTER TO GRAB THEM
  2922	020123'	402000	013527'	28360	        SETZM   FRBEST  ;NORMALLY IGNORED BY ENTER FOLLOWING LOOKUP
  2923	020124'	551040	400000	28370	        HRRZI   R1,400000       ;TURN ON OLD FILE BIT UNCONDITIONALLY
  2924	020125'	436040	013522'	28380	        IORM    R1,FILDI3       ;SINCE NOT DONE BY LOOKUP-ENTER
  2925	020126'	263740	000000	28390	        POPJ    P,              ;RETURN FROM XFER4
  2926				28400	; LOOKUP FAILURE IN UPDATE MODE.  MAYBE IT IS A NEW FILE.
  2927	020127'	200040	013710'	28410	XFER4C: MOVE R1,SEXT
  2928	020130'	250040	013522'	28420	        EXCH    R1,FILDI3
  2929	020131'	501040	000000	28430	        HLLI    R1,
  2930	020132'	202040	013724'	28440	        MOVEM   R1,ERCODE       ;SAVE TO DECODE
  2931	020133'	332000	013707'	28450	        SKIPE   UPDMOD          ;FILE NOT FOUND AND UPDATE MODE
  2932	020134'	302040	000000	28460	        CAIE    R1,0            ;YES, IS ERCODE RIGHT
  2933	020135'	254000	020143'	28470	        JRST    XFER4D          ;NO
  2934	020136'	402000	013707'	28480	        SETZM   UPDMOD          ;NEW FILE ON DISC
  2935				28490	;                               AND UPDATE MODE SWITCH SELECTED BY OPER.
  2936				28500	;                               OPEN USING ENTER.
  2937	020137'	505040	013616'	28510	        HRLI    R1,SAVBUF
  2938	020140'	541040	013517'	28520	        HRRI    R1,FILDIR
  2939	020141'	251040	013563'	28530	        BLT     R1,FILDIR+XLOOKN
  2940	020142'	263740	000000	28540	        POPJ    P,              ;TRY TO ENTER FILE
  2941	020143'	024000	024020'	28550	XFER4D: ERB [XWD[FILDI1],[ASCIZ"BYPASSING _Z, LOOKUP FAILURE--"]]
  2942	020144'	260740	021165'	28560	        PUSHJ   P,WHY
  2943	020145'	254000	020064'	28570	        JRST    XFER3D          ;BYPASS FILE
  2944
  2945				28590	; COMPARE TAPE FILENAME WITH STR FILENAME
  2946
  2947	020146'	200040	013316'	28610	XFER4E: MOVE R1,CURPPN
  2948	020147'	312040	013310'	28620	        CAME    R1,STRPPN       ;SKIP IF PPN OF SPLIT FILE
  2949				28630	XFER4A: ERT [XWD[STRPPN
  2950				28640	CURPPN
  2951	020150'	023000	024034'	28650	CLDSP],[ASCIZ "LOOKING FOR _J ON TAPE, BUT FOUND _J._E"]]
  2952	020151'	200040	013317'	28660	        MOVE    R1,CURFIL       ;GET FILE NAME FROM TAPE
  2953	020152'	312040	013311'	28670	        CAME    R1,STRFIL       ;SKIP IF NAME OF SPLIT FILE
  2954	020153'	254000	020150'	28680	        JRST    XFER4A          ;ERROR
  2955	020154'	510040	013320'	28690	        HLLZ    R1,CUREXT       ;GET EXTENSION FROM TAPE
  2956	020155'	312040	013312'	28700	        CAME    R1,STREXT       ;SKIP IF EXTENSION OF SPLIT FILE
  2957	020156'	254000	020150'	28710	        JRST    XFER4A          ;ERROR
  2958	020157'	402000	013310'	28720	        SETZM   STRPPN          ;ZERO STARTING PPN
  2959	020160'	402000	013311'	28730	        SETZM   STRFIL          ;ZERO STARTING FILE
  2960	020161'	402000	013312'	28740	        SETZM   STREXT          ;ZERO STARTING EXTENSION
  2961	020162'	263740	000000	28750	        POPJ P,
  2962
  2963				28770	; SPECIAL HANDLING OF PPN.UFD FILES IN [1,1].  SET UP UFDS.
  2964
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-55
TAP.MAC	23-MAR-79 11:41	

  2965				28790	;*DON'T CREATE UFD FOR GET COMMAND 6/9/73
  2966	020163'	202640	013520'	28800	SETST1: MOVEM U,FILDI1  ;NEEDED BY RPRTU
  2967	020164'	516040	013522'	28810	        HRLZM R1,FILDI3 ;NEEDED TO PRINT FILE EXTENSION
  2968	020165'	200042	000006	28820	        MOVE R1,6(R2)
  2969	020166'	202040	013521'	28830	        MOVEM R1,FILDI2 ;NEEDED TO PRINT FILENAME
  2970	020167'	607400	001000	28840	        TLNN F,DIRFLG           ;BYPASS IF DIR COMMAND
  2971	020170'	254000	020175'	28850	        JRST SETST5
  2972	020171'	602400	000001	28860	        TRNE F,NEWFLG
  2973	020172'	022000	024035'	28870	        ERO [XWD 0,[ASCIZ"$"]]  ;NO CHECKSUM PRINTED
  2974	020173'	260740	020620'	28880	SETST6: PUSHJ P,CLTFI2 ;*RESTORE DOES UNNECESSARY CLOSE OF FIL CHANNEL
  2975	020174'	254000	017341'	28890	        JRST READTAP
  2976	020175'	607400	000040	28900	SETST5: TLNN    F,UFDFLG        ;SKIP IF JL ST WF LIC SET
  2977	020176'	254000	017341'	28910	        JRST    READTAP          ;NOT ENOUGH LICENSE TO EXECUTE CODE
  2978	020177'	202640	013451'	28920	        MOVEM   U,UFDDI1        ;SAVE PPN FOR UFD LOOKUPS
  2979	020200'	200642	000006	28930	        MOVE    U,6(R2)         ;GET PPN FOR THIS USER
  2980	020201'	260740	015562'	28940	        PUSHJ   P,CKNPPN        ;SKIP IF USER SHOULD BE SET UP
  2981	020202'	254000	017341'	28950	        JRST    READTAP          ;IGNORE THIS UFD
  2982	020203'	200040	013766'	28960	        MOVE    R1,JBLIC        ;GET THE USER'S LICENSE
  2983	020204'	603040	001000	28970	        TLNE    R1,1000         ;SKIP IF JL NOT SET
  2984	020205'	254000	020211'	28980	        JRST    SETST4          ;EITHER REFRESH OR SOMEONE WITH JL
  2985	020206'	200000	000015	28990	        MOVE    R0,U            ;GET PPN IN R0 FOR CALL TO PPNUSR
  2986	020207'	260740	021511'	29000	        PUSHJ   P,PPNUSR        ;SKIP IF NAME IN DUL
  2987	020210'	254000	017341'	29010	        JRST    READTAP          ;DON'T SET UP UFD
  2988	020211'	041240	000014	29020	SETST4: INIT    UFD,BUFBIN
  2989	020212'	446353	000000	29030	        SIXBIT  /DSK/
  2990	020213'	000000	013263'	29040	        XWD     0,UFDHED        ;LOOKUPS ONLY
  2991	020214'	015000	024036'	29050	        ERROR   [ASCIZ "CANNOT ACCESS THE DISC."]
  2992	020215'	201040	000527'	29060	        MOVEI   R1,UFDBUF       ;USE THE UFD BUFFERS
  2993	020216'	202040	017672*	29070	        MOVEM   R1,JOBFF        ;TELL MONITOR WHERE TO PUT THE BUFFERS
  2994	020217'	064240	000002	29080	        INBUF   UFD,UFDN        ;SET UP THE BUFFERS
  2995	020220'	201040	000044	29090	        MOVEI   R1,XLOOKN       ;SET SPECS FOR LOOKUP
  2996	020221'	202040	013450'	29100	        MOVEM   R1,UFDDIR
  2997	020222'	202640	013452'	29110	        MOVEM   U,UFDDI2        ;SAVE PPN AS NAME OF FILE (UFD)
  2998	020223'	515040	654644	29120	        HRLZI   R1,(SIXBIT /UFD/);EXT=UFD
  2999	020224'	202040	013453'	29130	        MOVEM   R1,UFDDI3
  3000	020225'	202640	013364'	29140	        MOVEM   U,UFDBL2        ;SAVE THE PPN FOR INTERLOCK
  3001	020226'	200040	024043'	29150	        MOVE    R1,[SIXBIT /DSKB/]
  3002	020227'	400100	000000	29160	        SETZ    R2,             ;ZERO TO GET FIRST ENTRY ON SEARCH LIST
  3003	020230'	047100	000046	29170	        SYSSTR  R2,             ;GET NEXT STRUCTURE ON LIST
  3004	020231'	400100	000000	29180	        SETZ    R2,             ;ERROR RETURN SO FALL THROUGH BELOW
  3005	020232'	312040	000002	29190	        CAME    R1,R2           ;SKIP IF THIS IS THE RIGHT STRUCTURE
  3006	020233'	326100	020230'	29200	        JUMPN   R2,.-3          ;LOOP IF NOT DONE WITH LIST
  3007	020234'	326100	020237'	29210	        JUMPN   R2,.+3          ;JUMP IF WE FOUND THE STRUCTURE
  3008	020235'	047100	000046	29220	        SYSSTR  R2,             ;GET FIRST STRUCTURE ON THE LIST AS DEFAULT
  3009	020236'	015000	024044'	29230	        ERROR   [ASCIZ "CANNOT FIND A VALID FILE STRUCTURE."]
  3010	020237'	202100	013363'	29240	        MOVEM   R2,UFDBL1       ;SAVE STRUCTURE FOR INTERLOCK
  3011	020240'	260740	020306'	29250	        PUSHJ   P,SETJL         ;SET THE JL BIT
  3012	020241'	015000	024054'	29260	        ERROR   [ASCIZ "UNABLE TO SET JACCT-LOGIN BIT."]
  3013	020242'	260740	020327'	29270	        PUSHJ   P,SETINT        ;SET THE UFD INTERLOCK
  3014				29280	        ERB [XWD[UFDBL2
  3015	020243'	024000	024075'	29290	SETST3],[ASCIZ "UNABLE TO SET UFD INTERLOCK FOR _A.$_E"]]
  3016	020244'	076240	013450'	29300	        LOOKUP  UFD,UFDDIR      ;DOES THIS UFD ALREADY EXIST?
  3017	020245'	254000	020256'	29310	        JRST    FIXUFD          ;NO, MAKE ONE LIKE THE ORIGINAL
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-56
TAP.MAC	23-MAR-79 11:41	

  3018	020246'	260740	020326'	29320	SETST2: PUSHJ   P,RESINT        ;RESET THE UFD INTERLOCK
  3019				29330	        ERB [XWD[UFDBL2],[ASCIZ "UNABLE TO RESET UFD INTERLOCK FOR _A.  SOMETHING IS WRONG.$"]]
  3020	020247'	024000	024112'
  3021	020250'	260740	020305'	29340	        PUSHJ P,RESJL
  3022	020251'	254000	020254'	29350	        JRST SETST7
  3023	020252'	254000	020173'	29360	        JRST SETST6
  3024	020253'	260740	020305'	29370	SETST3: PUSHJ   P,RESJL         ;RESET THE JACCT-LOGIN BIT
  3025	020254'	015000	024113'	29380	SETST7: ERROR   [ASCIZ "UNABLE TO RESET THE JACCT-LOGIN BIT."]
  3026	020255'	254000	017341'	29390	        JRST    READTAP          ;SKIP TO NEXT UFD OR FILE
  3027
  3028				29410	;MAKE A UFD ON THIS STR WITH QUOTA FROM THE TAPE
  3029				29420	;*PERHAPS THIS SHOULD NOT BE DONE
  3030
  3031	020256'	200100	013255'	29440	FIXUFD: MOVE    R2,TAPHED       ;GET ADDR OF CURRENT BUFFER
  3032	020257'	041200	000014	29450	        INIT    MFD,BUFBIN
  3033	020260'	446353	000000	29460	        SIXBIT  /DSK/
  3034	020261'	013260'	000000	29470	        XWD     MFDHED,0
  3035	020262'	015000	024123'	29480	        ERROR   [ASCIZ "UNABLE TO ACCESS MFD"]
  3036	020263'	201040	013450'	29490	        MOVEI   R1,UFDDIR
  3037	020264'	505042	000004	29500	        HRLI    R1,4(R2)
  3038	020265'	251040	013514'	29510	        BLT     R1,UFDDIR+XLOOKN
  3039	020266'	200040	013461'	29520	        MOVE R1,URBALC
  3040	020267'	202040	013460'	29530	        MOVEM R1,URBEST
  3041	020270'	402000	013461'	29540	        SETZM URBALC
  3042	020271'	402000	013462'	29550	        SETZM   URBPOS
  3043	020272'	402000	013463'	29560	        SETZM   URBNXT
  3044	020273'	402000	013464'	29570	        SETZM   URBPRD
  3045	020274'	402000	013475'	29580	        SETZM   URBCSZ          ;ZERO CURRENT SIZE SINCE NO FILES
  3046	020275'	077200	013450'	29590	        ENTER   MFD,UFDDIR      ;CREATE THIS UFD
  3047	020276'	015000	024130'	29600	        ERROR   [ASCIZ "UNABLE TO OUTPUT TO MFD"]
  3048	020277'	075200	000002	29610	        USETO   MFD,2           ;MAKE ALL UFDS AT LEAST ONE BLOCK LONG
  3049	020300'	070200	000010	29620	        CLOSE   MFD,DNC         ;CLOSE THE MFD
  3050	020301'	071200	000000	29630	        RELEAS  MFD,            ;RELEASE THE MFD
  3051	020302'	070240	000010	29640	        CLOSE   UFD,DNC         ;CLOSE UFD
  3052	020303'	350000	013703'	29650	        AOS     UCOUNT          ;COUNT OF UFD'S SET UP
  3053	020304'	254000	020246'	29660	        JRST    SETST2          ;CLEAR JACCT AND UFD INTERLOCK & GET NEXT UFD
  3054
  3055	020305'	634100	000002	29680	RESJL:  TDZA    R2,R2           ;SET TO ZERO AND ALWAYS SKIP
  3056	020306'	205100	000001	29690	SETJL:  MOVSI   R2,1            ;SET THE JACCT-LOGIN BIT
  3057	020307'	205040	777777	29700	        MOVSI   R1,-1           ;GET BITS FOR THIS JOB
  3058	020310'	047040	000041	29710	        GETTAB  R1,             ;GET BITS SO WE DON'T DESTROY THEM
  3059	020311'	015000	024135'	29720	        ERROR   [ASCIZ "CANNOT DO A GETTAB FOR THIS JOB."]
  3060	020312'	621040	000001	29730	        TLZ     R1,1            ;ASSUME WE'RE RESETING THE BIT
  3061	020313'	603100	000001	29740	        TLNE    R2,1            ;SKIP IF BIT SHOULD BE RESET
  3062	020314'	661040	000001	29750	        TLO     R1,1            ;SET THE BIT
  3063	020315'	047040	777757	29760	        CALLI   R1,-21          ;FIX THE JAL BIT (SETJAL)
  3064	020316'	263740	000000	29770	        POPJ    P,              ;NOT ENOUGH LICENSE - FAIL RETURN
  3065	020317'	326100	016256'	29780	        JUMPN   R2,CPOPJ1       ;SUCCESS RETURN FROM SETJL
  3066	020320'	561040	777754	29790	        HRROI   R1,-24          ;GET TERMINAL BITS
  3067	020321'	047040	000041	29800	        GETTAB  R1,             ;WE WANT TO KNOW IF PHONE WAS HUNG UP
  3068	020322'	400040	000000	29810	        SETZ    R1,             ;DETACHED, SO PHONE WAS NOT HUNG
  3069	020323'	603040	200000	29820	        TLNE    R1,200000       ;SKIP IF PHONE NOT HUNG UP
  3070	020324'	047000	000012	29830	        EXIT                    ;GET OUT OF PROG AND MONITOR WILL LOGOUT
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-57
TAP.MAC	23-MAR-79 11:41	

  3071	020325'	254000	016256'	29840	        JRST    CPOPJ1          ;SUCCESS RETURN FROM RESJL
  3072
  3073	020326'	334040	024144'	29860	RESINT: SKIPA   R1,[7]          ;RESET UFD INTERLOCK
  3074	020327'	201040	000006	29870	SETINT: MOVEI   R1,6            ;  SET UFD INTERLOCK
  3075	020330'	202040	013362'	29880	        MOVEM   R1,UFDBLK       ;SAVE THE FUNCTION TO BE PERFORMED
  3076	020331'	201100	000550	29890	        MOVEI   R2,550          ;NUMBER OF TIMES TO TRY
  3077	020332'	200040	024145'	29900	RTRINT: MOVE    R1,[XWD 3,UFDBLK];POINTER TO PARAMETER TABLE
  3078	020333'	047040	000050	29910	        STRUUO  R1,             ;TEST AND SET/RESET UFD INTERLOCK
  3079	020334'	334000	000000	29920	        SKIPA                   ;FAILED - TRY AGAIN IN ONE SECOND
  3080	020335'	254000	016256'	29930	        JRST    CPOPJ1          ;SUCCESS RETURN FROM SETINT/RESINT
  3081	020336'	201040	000001	29940	        MOVEI   R1,1            ;NUMBER OF SECONDS TO SLEEP
  3082	020337'	047040	000031	29950	        SLEEP   R1,             ;DISMISS FOR A SECOND
  3083	020340'	367100	020332'	29960	        SOJG    R2,RTRINT       ;RETRY THE INTERLOCK
  3084	020341'	263740	000000	29970	        POPJ    P,              ;FAIL RETURN FROM SETINT/RESINT
  3085
  3086				29990	; TRAILER READ
  3087
  3088	020342'	620400	003000	30010	TRLRD:  TRZ F,HDRMSG+HDRFND     ;CANCEL SAVESET FLAGS
  3089	020343'	070240	000010	30020	        CLOSE UFD,DNC   ;SEE SETST1
  3090	020344'	071240	000000	30030	        RELEASE UFD,
  3091	020345'	200100	013255'	30040	        MOVE R2,TAPHED
  3092	020346'	331042	000005	30050	        SKIPL R1,5(R2)  ;IS TAPE CONTNUED
  3093	020347'	254000	020421'	30060	        JRST TRL6       ;NO
  3094	020350'	603040	100000	30070	        TLNE R1,FILCTD  ;IS FILE CONTINUED
  3095	020351'	254000	020404'	30080	        JRST TRL5       ;YES
  3096				30090	; IF FILE IN PROGRESS THEN FINISH UP
  3097	020352'	606400	000400	30100	        TRNN F,IGNFLG   
  3098	020353'	260740	020602'	30110	        PUSHJ P,CLTFIL  ;CLOSE, TRUNCATE, PRINT FILE NAME IF DESIRED
  3099	020354'	200100	013255'	30120	        MOVE R2,TAPHED
  3100	020355'	200042	000005	30130	        MOVE R1,5(R2)   ;GET CONTINUED BITS
  3101	020356'	607040	200000	30140	        TLNN R1,USRCTD  ;IS USER CONTINUED
  3102	020357'	254000	020402'	30150	        JRST TRL3       ;NO
  3103				30160	; USER CONTINUED
  3104	020360'	024000	024156'	30170	        ERB [XWD[CURPPN],[ASCIZ"_A WILL BE CONTINUED ON NEXT TAPE.$"]]
  3105				30180	; HAVE WE REACHED END OF SELECTED RANGE
  3106	020361'	200100	013255'	30190	TRL4:   MOVE R2,TAPHED
  3107	020362'	574042	000002	30200	        HLRE R1,2(R2)   ;GET VERSION
  3108	020363'	307040	000013	30210	        CAIG R1,13
  3109	020364'	254000	020377'	30220	        JRST TRL2       ;OLDER THAN 14--NO POS. NOS.
  3110	020365'	200040	013321'	30230	        MOVE R1,CURPOS
  3111	020366'	315040	017435*	30240	        CAMGE R1,RANLAS ;COMPARE WITH LAST FILE SCANNED BEFORE TRAILER
  3112	020367'	254000	020377'	30250	        JRST TRL2       ;GET NEXT TAPE MOUNTED
  3113
  3114				30270	; UNIVERSAL ABORT POINT
  3115
  3116	020370'			30290	EOT4:
  3117	020370'	260740	021123'	30300	TRL1:   PUSHJ P,RPRTU   ;PRINT USER TOTALS IF DESIRED
  3118				30310	; FINISHED--PRINT GRAND TOTALS
  3119	020371'	602400	000040	30320	        TRNE F,EOTFLG
  3120	020372'	024000	024166'	30330	        ERB [XWD 0,[ASCIZ"LOGICAL EOT--NO SAVE SETS FOLLOW.$"]]
  3121	020373'	024000	024176'	30340	        ERB [XWD[RCOUNT],[ASCIZ"$TOTAL _C FILES PROCESSED.$$"]]
  3122	020374'	260740	020772'	30350	        PUSHJ P,PFM     ;PRINT FILES MISSED
  3123	020375'	402000	013702'	30360	        SETZM RCOUNT
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-58
TAP.MAC	23-MAR-79 11:41	

  3124	020376'	254000	017272*	30370	        JRST CDISP
  3125				30380	; MORE FOLLOWS ON NEXT TAPE
  3126	020377'	402000	021762'	30390	TRL2:   SETZM OLDBLK
  3127	020400'	260740	016377'	30400	        PUSHJ P,NXTTAP  ;REWIND CURRENT TAPE, GET NEXT MTD
  3128	020401'	254000	017326'	30410	        JRST CONRES
  3129				30420	;USER NOT CONTINUED
  3130	020402'	260740	021123'	30430	TRL3:   PUSHJ P,RPRTU   ;PRINT USER TOTALS IF DESIRED
  3131	020403'	254000	020361'	30440	        JRST TRL4
  3132				30450	;FILE IS CONTINUED
  3133	020404'	606400	000400	30460	TRL5:   TRNN F,IGNFLG
  3134	020405'	260740	020576'	30470	        PUSHJ P,CLFIL   ;CLOSE FILE WITHOUT TRUNCATE OR DEALLOCATE
  3135	020406'	200040	013316'	30480	        MOVE R1,CURPPN
  3136	020407'	202040	013310'	30490	        MOVEM R1,STRPPN
  3137	020410'	200040	013317'	30500	        MOVE R1,CURFIL
  3138	020411'	202040	013311'	30510	        MOVEM R1,STRFIL
  3139	020412'	200040	013320'	30520	        MOVE R1,CUREXT
  3140	020413'	512040	013312'	30530	        HLLZM R1,STREXT ;SAVE FILENAME IN STR FILE
  3141	020414'	200040	021734'	30540	        MOVE R1,BLKCNT  ;COMPUTE BLOCK NO. IN FILE
  3142	020415'	270040	021762'	30550	        ADD R1,OLDBLK   ;BLOCKS FROM PREVIOUS TAPE
  3143	020416'	202040	013313'	30560	        MOVEM R1,STRBLK ;NEW BLOCK NO. TO POSITION TO
  3144	020417'	260740	020566'	30570	        PUSHJ P,PCFM    ;PRINT CONTINUED FILE MESSAGES
  3145	020420'	254000	020377'	30580	        JRST TRL2       ;NOTE TRL2 SETS OLDBLK=0
  3146				30590	; TAPE IS NOT CONTINUED
  3147	020421'	606400	000400	30600	TRL6:   TRNN F,IGNFLG
  3148	020422'	260740	020602'	30610	        PUSHJ P,CLTFIL  ;FINISH CURRENT FILE
  3149	020423'	607400	001000	30620	        TLNN F,DIRFLG   ;SKIP IF DIRECTORY COMMAND
  3150	020424'	254000	020431'	30630	        JRST TRL7
  3151				30640	; PRINT USER AND SAVE SET TOTALS HERE FOR DIRECTORY ONLY
  3152				30650	; RESTORE COMMAND WILL PRINT USER TOTALS AT NEXT FILE HDR OR LOGICAL EOT
  3153	020425'	260740	021123'	30660	        PUSHJ P,RPRTU
  3154	020426'	332000	013377'	30670	        SKIPE TOTCNT
  3155	020427'	022000	024207'	30680	        ERO [XWD[TOTCNT],[ASCIZ"$TOTAL _C FILES FOR SAVE SET.$$"]]
  3156	020430'	402000	013377'	30690	        SETZM TOTCNT
  3157				30700	; RESTORE MUST STOP ON TRAILER RECORD WHEN READING OLD TAPE SECTION,
  3158				30710	; TO PREVENT OVERWRITING FILES WHICH HAVE ALREADY BEEN RESTORED.
  3159	020431'	603400	021000	30720	TRL7:   TLNE F,CUTFLG+DIRFLG
  3160	020432'	254000	017341'	30730	        JRST READTAP    ;KEEP GOING FOR CUT OR DIR
  3161	020433'	200100	013255'	30740	        MOVE R2,TAPHED
  3162	020434'	574042	000002	30750	        HLRE R1,2(R2)   ;GET VERSION NO.
  3163	020435'	307040	000013	30760	        CAIG R1,13      ;SKIP IF 14 OR GREATER
  3164	020436'	602400	000014	30770	        TRNE F,RANFLG+FNDFLG    ;KEEP GOING ON OLD SECTION IF RESTORING NEW
  3165	020437'	254000	017341'	30780	        JRST READTAP    ;KEEP GOING UNTIL LOGICAL EOT
  3166	020440'	254000	020370'	30790	        JRST TRL1       ;FINISH TAPE(S)
  3167
  3168				30810	; TAPE HEADER READ
  3169
  3170	020441'	260740	020471'	30830	HDRRD:  PUSHJ P,VERFLG  ;GET VERSION FLAGS
  3171	020442'	024000	024215'	30840	        ERB [XWD[READTAP],[ASCIZ"BAD HEADER FOUND_E"]]
  3172	020443'	350040	021745'	30850	        AOS R1,DIRSSC
  3173				30860	; SAVE INFO. FROM LAST HEADER READ
  3174				30870	;       PRINT LATER IF WE FIND SOMETHING
  3175	020444'	202040	021753'	30880	        MOVEM R1,HDRSSC#        ;SAVE SET NO.
  3176	020445'	200040	013304'	30890	        MOVE R1,FIRBL2
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-59
TAP.MAC	23-MAR-79 11:41	

  3177	020446'	202040	021754'	30900	        MOVEM R1,HDRTAP#        ;TAPE NO. IN SAVE SET
  3178	020447'	200040	013305'	30910	        MOVE R1,FIRBL3
  3179	020450'	202040	021752'	30920	        MOVEM R1,HDRDAT#        ;DATE RECORDED
  3180	020451'	200042	000005	30930	        MOVE R1,5(R2)   ;GET CONTINUED BITS
  3181	020452'	201100	022037'	30940	        MOVEI R2,[ASCIZ""]     ;NULL STRING
  3182	020453'	603040	400000	30950	        TLNE R1,TAPCTD
  3183	020454'	201100	024216'	30960	        MOVEI R2,[ASCIZ"THIS IS A CONTINUATION TAPE.$"]
  3184	020455'	603040	200000	30970	        TLNE R1,USRCTD
  3185	020456'	201100	024224'	30980	        MOVEI R2,[ASCIZ"USER CONTINUED FROM PRECEDING TAPE.$"]
  3186	020457'	603040	100000	30990	        TLNE R1,FILCTD
  3187	020460'	201100	024234'	31000	        MOVEI R2,[ASCIZ"FILE CONTINUED FROM PRECEDING TAPE.$"]
  3188	020461'	202100	021741'	31010	        MOVEM R2,CTDMSG#
  3189	020462'	620400	001000	31020	        TRZ F,HDRMSG            ;NEED TO PRINT HEADER MESSAGES
  3190	020463'	660400	002000	31030	        TRO F,HDRFND            ;HEADER FOUND
  3191	020464'	254000	017341'	31040	        JRST READTAP
  3192
  3193	020465'	661400	400000	31060	FSTROU::TLO     F,FAIFLG        ;TAPE DIRECTORY IN FAILSAFE FORMAT
  3194	020466'	254000	020376*	31070	        JRST    CDISP
  3195
  3196	020467'	621400	400000	31090	FCRROU::TLZ     F,FAIFLG        ;TAPE DIRECTORY IN TITO FORMAT
  3197	020470'	254000	020466*	31100	        JRST    CDISP
  3198
  3199				31120	; GET VERSION FLAGS FROM HEADER OR TRAILER
  3200
  3201	020471'	603400	400000	31140	VERFLG: TLNE    F,FAIFLG        ;TAPE IN FAILSAFE FORMAT?
  3202				31150	        JRST    [TLZ F,T12FLG
  3203				31160	                 TRZ F,NEWFLG
  3204	020472'	254000	024244'	31170	                 JRST CPOPJ1]   ;IF SO, ASSUME PRE-P012 & PRE-VER14
  3205	020473'	200100	013255'	31180	        MOVE R2,TAPHED
  3206	020474'	574042	000002	31190	        HLRE R1,2(R2)   ;GET VERSION
  3207	020475'	661400	010000	31200	        TLO F,T12FLG    ;ASSUME TAPE CREATED VER. 12 OR LATER
  3208	020476'	620400	000001	31210	        TRZ F,NEWFLG    ;ASSUME OLD TAPE IF HEADER BAD
  3209	020477'	307040	000000	31220	        CAIG R1,0       ;INSIST ON POS. VER NO
  3210	020500'	263740	000000	31230	        POPJ P,
  3211	020501'	305040	000011	31240	        CAIGE R1,11
  3212	020502'	621400	010000	31250	        TLZ F,T12FLG    ;TAPE WRITTEN BY MONITOR BEFORE P012.
  3213	020503'	660400	000001	31260	        TRO F,NEWFLG    ;ASSUME VER 14 OR LATER
  3214	020504'	307040	000013	31270	        CAIG R1,13
  3215	020505'	620400	000001	31280	        TRZ F,NEWFLG
  3216	020506'	254000	016256'	31290	        JRST CPOPJ1
  3217
  3218
  3219				31320	; PRINT HEADER MESSAGES (DELAYED)
  3220
  3221	020507'	662400	001000	31340	HDRPRI: TROE F,HDRMSG   ;SUPPRESS FURTHER SAVESET HEADER MESSAGES
  3222	020510'	263740	000000	31350	        POPJ P,
  3223	020511'	602400	000001	31360	        TRNE F,NEWFLG   ;NEW TAPE
  3224	020512'	602400	002000	31370	        TRNE F,HDRFND   ;HEADER RECORD FOUND
  3225	020513'	254000	020527'	31380	        JRST HDRP2      ;OLD TAPE OR ACTUAL HEADER FOUND
  3226				31390	; NEW TAPE.  FAKE HEADER IF MISSING.  HEADER IS IMPLIED IF DATE
  3227				31400	; TAPE WRITTEN CHANGES FROM PREVIOUS FILE.
  3228	020514'	200040	013326'	31410	        MOVE R1,CURDAT
  3229	020515'	316040	013342'	31420	        CAMN R1,LSTDAT
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-60
TAP.MAC	23-MAR-79 11:41	

  3230	020516'	254000	020521'	31430	        JRST HDRP1
  3231	020517'	350040	021745'	31440	        AOS R1,DIRSSC
  3232	020520'	202040	021753'	31450	        MOVEM R1,HDRSSC ;INCREMENT SAVESET NO.
  3233	020521'	200000	013330'	31460	HDRP1:  MOVE CURNUM
  3234	020522'	202000	021754'	31470	        MOVEM HDRTAP
  3235	020523'	200000	013326'	31480	        MOVE CURDAT
  3236	020524'	202000	021752'	31490	        MOVEM HDRDAT
  3237	020525'	201000	022037'	31500	        MOVEI R0,[ASCIZ""]
  3238	020526'	202000	021741'	31510	        MOVEM CTDMSG
  3239	020527'	022000	024252'	31520	HDRP2:  ERO [XWD 0,[ASCIZ"$$THIS IS "]]
  3240	020530'	602400	000200	31530	        TRNE F,SSCFLG
  3241	020531'	022000	024261'	31540	        ERO [XWD[HDRSSC],[ASCIZ"SAVE SET NO. _C (D),$"]]
  3242				31550	        ERO [XWD[HDRTAP
  3243	020532'	022000	024271'	31560	HDRDAT],[ASCIZ"TAPE NO. _C RECORDED _L$"]]
  3244	020533'	606400	000001	31570	        TRNN F,NEWFLG
  3245	020534'	254000	020554'	31580	        JRST HDRP3
  3246	020535'	200000	013255'	31590	        MOVE TAPHED
  3247	020536'	271000	000074	31600	        ADDI R0,XHDR-5-1 ;ADDR. OF STRING - 1
  3248	020537'	505000	000712	31610	        HRLI R0,0712    ;MAKE SEVENBIT POINTER-10 CHARS
  3249	020540'	202000	021755'	31620	        MOVEM ID#
  3250	020541'	200040	013325'	31630	        MOVE R1,CURVER
  3251	020542'	541000	024272'	31640	        HRRI R0,[ASCIZ"SYSTEM _P DRIVE _S _O$"]
  3252	020543'	307040	000014	31650	        CAIG R1,14
  3253	020544'	541000	024277'	31660	        HRRI R0,[ASCIZ"SYSTEM _P DRIVE _C _O$"]
  3254				31670	        HRLI R0,[ID
  3255				31680	TMP2
  3256	020545'	505000	024304'	31690	CURTRK]
  3257	020546'	202000	022003'	31700	        MOVEM TMP
  3258	020547'	200000	013327'	31710	        MOVE CURSER
  3259	020550'	307040	000014	31720	        CAIG R1,14
  3260	020551'	550000	013327'	31730	        HRRZ CURSER
  3261	020552'	202000	022004'	31740	        MOVEM TMP2#
  3262	020553'	022000	022003'	31750	        ERO TMP
  3263	020554'	602400	000200	31760	HDRP3:  TRNE F,SSCFLG
  3264	020555'	022000	021741'	31770	        ERO CTDMSG
  3265	020556'	263740	000000	31780	        POPJ P,
  3266
  3267
  3268				31810	; EOF READ
  3269
  3270	020557'	606400	000040	31830	EOFRD:  TRNN F,EOTFLG   ;TWO IN A ROW
  3271	020560'	254000	017341'	31840	        JRST READTAP    ;NO, IGNORE EOF
  3272	020561'	606400	000400	31850	        TRNN F,IGNFLG   ;WERE WE PROCESSING A FILE
  3273	020562'	260740	020602'	31860	        PUSHJ P,CLTFIL  ;YES, FINISH IT
  3274	020563'	256012	013775'	31870	        XCT MF7(UNIT)   ;BACK OVER ONE OF THE EOF'S
  3275	020564'	256012	013771'	31880	        XCT MF0(UNIT)   ;WAIT FOR COMPLETION
  3276	020565'	254000	020370'	31890	        JRST TRL1
  3277
  3278				31910	; SET UP PARTIAL CHECKSUM AND PRINT CONTINUED FILE MESSAGE FOR SPLIT FILE
  3279
  3280	020566'	200000	021764'	31930	PCFM:   MOVE PCKSUM
  3281	020567'	202000	013663'	31940	        MOVEM CKSUM     ;SET CHECKSUM BACK TO LAST COMPLETE BLOCK
  3282	020570'	556000	021736'	31950	        HLRZM R0,C1#
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-61
TAP.MAC	23-MAR-79 11:41	

  3283	020571'	552000	021737'	31960	        HRRZM R0,C2#
  3284	020572'	024000	024320'	31970	        ERB [XWD[STRPPN],[ASCIZ"$FILE _J WILL BE CONTINUED ON NEXT TAPE$"]]
  3285	020573'	332000	013313'	31980	        SKIPE STRBLK    ;SKIP IF ZERO (FILE NOT BEING PROCESSED)
  3286				31990	        ERB [XWD[STRBLK
  3287				32000	C1
  3288	020574'	024000	024336'	32010	C2],[ASCIZ"STARTING WITH BLOCK _C.  PARTIAL CKSUM: _H,,_H$"]]
  3289	020575'	263740	000000	32020	        POPJ P,
  3290
  3291				32040	; CLOSE FILE SPLIT BETWEEN TAPES.  DO NOT DEALLOCATE.
  3292
  3293	020576'	607400	001000	32060	CLFIL:  TLNN F,DIRFLG
  3294	020577'	070300	000014	32070	        CLOSE FIL,DNC!DLL
  3295	020600'	660400	000400	32080	        TRO F,IGNFLG
  3296	020601'	263740	000000	32090	        POPJ P,
  3297
  3298				32110	; CLOSE AND FINISH FILE.  PRINT FILENAME IF DESIRED.  TRUNCATE
  3299				32120	; FILE IF UPDATE MODE OR CONTINUED FILE AND DISC FILE WAS BIGGER
  3300				32130	; THAN TAPE FILE.  VERIFY CHECKSUM.  SET FILE NOT IN PROGRESS.
  3301				32140	; DIRECTORY DOES NOT WRITE ON THE FILE BUT DOES CONFIRM THE CHECKSUM
  3302
  3303	020602'	332040	013713'	32160	CLTFIL: SKIPE R1,TAPCNT         ;EOF--CHECK EXPECTED WORDCOUNT
  3304	020603'	254000	020646'	32170	        JRST CLTFI3             ;TOO MUCH OR TOO LITTLE DATA
  3305	020604'	332040	021762'	32180	CLTFI1: SKIPE   R1,OLDBLK       ;BLOCKCOUNT FROM PRECEDING TAPE(S)
  3306	020605'	275040	000001	32190	        SUBI    R1,1            ;BLOCKCOUNT STARTS WITH 1
  3307	020606'	242040	000007	32200	        LSH     R1,7            ;CALCULATE WORDS READ
  3308	020607'	270040	013714'	32210	        ADD     R1,WDCNT        ;TOTAL
  3309	020610'	402000	021762'	32220	        SETZM   OLDBLK          ;FINISHED THIS FILE
  3310	020611'	603400	001000	32230	        TLNE F,DIRFLG
  3311	020612'	254000	020620'	32240	        JRST CLTFI2             ;BYPASS TRUNCATION CHECKS
  3312	020613'	315040	013712'	32250	        CAMGE   R1,ORBSIZ       ;COMPARE WITH FILE WE WROTE OVER
  3313	020614'	254000	020702'	32260	        JRST TRUNCATE           ;NEED TO SHRINK SOME
  3314				32270	; RETURN EXCESS ALLOCATED SPACE TO THE SYSTEM
  3315	020615'	200000	013715'	32280	        MOVE TRBALC
  3316	020616'	315000	013530'	32290	        CAMGE FRBALC
  3317	020617'	254000	020676'	32300	        JRST CLTFI9             ;EXCESS
  3318	020620'	350000	013376'	32310	CLTFI2: AOS     FILCNT          ;INCR. FILES RESTORED THIS USER
  3319	020621'	350000	013702'	32320	        AOS     RCOUNT          ;INCR. TOTAL FILES RESTORED
  3320	020622'	201000	000001	32330	        MOVEI R0,1
  3321	020623'	333040	021740'	32340	        SKIPLE R1,CKNFP
  3322	020624'	137000	024337'	32350	        DPB R0,[XWD SUCS+R1,2]  ;MATCH ON PARTICULAR FILENAME
  3323	020625'	476000	021740'	32360	        SETOM CKNFP
  3324				32370	;                               SEE CKNFIL TO SEE HOW FILENAME IS
  3325				32380	;                               TAGGED.
  3326	020626'	660400	000400	32390	        TRO F,IGNFLG    ;IGNORE SUBSEQUENT DATA
  3327	020627'	603400	001000	32400	        TLNE F,DIRFLG
  3328	020630'	263740	000000	32410	        POPJ P,         ;FORGET CLOSE
  3329	020631'	201040	000000*	32420	        MOVEI   R1,MRPTR##      ;GET RESTORE MODE
  3330	020632'	135041	000000	32430	        LDB     R1,(R1)
  3331	020633'	606040	000001	32440	        TRNN    R1,1            ;PRINT FILENAME IF DESIRED
  3332	020634'	254000	020640'	32450	        JRST CLTFI6     ;MOD RES F NOT SET
  3333	020635'	332000	021767'	32460	        SKIPE POSITION
  3334				32470	        ERO [XWD[POSITION
  3335	020636'	022000	024343'	32480	XWD 10,5],[ASCIZ"_N  "]]
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-62
TAP.MAC	23-MAR-79 11:41	

  3336	020637'	022000	024345'	32490	        ERO [XWD[FILDI1],[ASCIZ"_Z$"]]
  3337	020640'	336000	013731'	32500	CLTFI6: SKIPN PRAFLG    ;DID WE PREALLOCATE
  3338	020641'	254000	020644'	32510	        JRST .+3        ;NO
  3339	020642'	070300	000014	32520	        CLOSE FIL,DNC!DLL ;CLOSE WITHOUT DEALLOCATION
  3340	020643'	263740	000000	32530	        POPJ P,
  3341	020644'	070300	000010	32540	        CLOSE FIL,DNC
  3342	020645'	263740	000000	32550	        POPJ P,
  3343	020646'	607040	400000	32560	CLTFI3: TLNN R1,400000  ;INSUFFICIENT
  3344				32570	        ERB [XWD[FILDI1
  3345	020647'	024000	024361'	32580	CLTFI1],[ASCIZ"$FILE _J HAD TOO LITTLE DATA ON TAPE.$_E"]]
  3346	020650'	606400	000001	32590	        TRNN F,NEWFLG
  3347				32600	        ERB [XWD[FILDI1
  3348	020651'	024000	024372'	32610	CLTFI1],[ASCIZ"$FILE _J HAD TOO MUCH DATA ON TAPE.$_E"]]
  3349	020652'	200040	021777'	32620	        MOVE R1,TAPCK           ;LAST WORD WRITTEN PAST DATA
  3350	020653'	312040	013663'	32630	        CAME R1,CKSUM           ;CHECKSUM COMPUTED WHILST READING TAPE
  3351	020654'	254000	020665'	32640	        JRST CLTFI5             ;MISCOMPARE
  3352	020655'	607400	001000	32650	        TLNN F,DIRFLG
  3353	020656'	254000	020604'	32660	        JRST CLTFI1
  3354	020657'	022000	024373'	32670	        ERO [XWD 0,[ASCIZ""]]   ;FORCE OUTPUT TO COF FILE
  3355				32680	; PRINT CHECKSUM EXPECTED
  3356	020660'	621040	400000	32690	CLTFI4: TLZ R1,400000
  3357	020661'	260740	020746'	32700	        PUSHJ P,TRIGR   ;FIRST 3 CHARS
  3358	020662'	260740	020746'	32710	        PUSHJ P,TRIGR   ;SECOND 3 CHARS
  3359	020663'	010000	022041'	32720	        TCO [CRCHR]
  3360	020664'	254000	020604'	32730	        JRST CLTFI1
  3361	020665'	603400	001000	32740	CLTFI5: TLNE F,DIRFLG   ;DON'T PRINT FILENAME FOR DIR
  3362	020666'	331000	000002*	32750	        SKIPL COUT      ;UNLESS THERE IS A TOUT FILE
  3363	020667'	254000	020673'	32760	        JRST CLTFI8     ;NOT DIR OR TOUT TERMINAL
  3364	020670'	023000	024376'	32770	        ERT [XWD[FILDI1],[ASCIZ"FILE _J "]] ;THIS PART COMES TO TER ONLY
  3365	020671'	024000	024403'	32780	CLTFI7: ERB [XWD 0,[ASCIZ"EXPECTED CHECKSUM "]]
  3366	020672'	254000	020660'	32790	        JRST CLTFI4
  3367	020673'	607400	001000	32800	CLTFI8: TLNN F,DIRFLG
  3368	020674'	024000	024376'	32810	        ERB [XWD[FILDI1],[ASCIZ"FILE _J "]]
  3369	020675'	254000	020671'	32820	        JRST CLTFI7
  3370
  3371				32840	; TRBALC < FRBALC.  RETURN EXCESS
  3372
  3373	020676'	202000	013530'	32860	CLTFI9: MOVEM FRBALC
  3374	020677'	055300	013517'	32870	        RENAME FIL,FILDIR
  3375	020700'	260740	020737'	32880	        PUSHJ P,TRCERR
  3376	020701'	254000	020620'	32890	        JRST CLTFI2
  3377
  3378				32910	; TRUNCATE FILE WHEN DISC FILE SIZE EXCEEDS TAPE FILE SIZE
  3379
  3380	020702'	271040	000177	32930	TRUNCATE: ADDI R1,177   ;CALC. NO. OF BLOCKS WE WROTE
  3381	020703'	242040	777771	32940	        LSH R1,-7       ;INCLUDING LAST PARTIAL BLOCK
  3382	020704'	202040	013530'	32950	        MOVEM   R1,FRBALC ;SET TO TRUNCATE FILE
  3383	020705'	202040	013717'	32960	        MOVEM   R1,FILPOS       ;SAVE FOR REPOSITION
  3384	020706'	200040	013266'	32970	        MOVE R1,FILHED ;SAVE BUFFER ADDR
  3385	020707'	202040	013720'	32980	        MOVEM R1,SAVHED ;FOR USE IN WRITING LAST PARTIAL BLOCK AGAIN
  3386	020710'	200040	013267'	32990	        MOVE    R1,FILHD1 ;SAVE BYTE PTR
  3387	020711'	202040	013721'	33000	        MOVEM R1,SAVBYT ;DITTO
  3388	020712'	055300	013517'	33010	        RENAME FIL,FILDIR       ;RENAME AND TRUNCATE
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-63
TAP.MAC	23-MAR-79 11:41	

  3389	020713'	254000	020735'	33020	        JRST TRCER      ;RENAME FAILURE
  3390	020714'	076300	013517'	33030	        LOOKUP FIL,FILDIR
  3391	020715'	254000	020735'	33040	        JRST TRCER
  3392	020716'	077300	013517'	33050	        ENTER FIL,FILDIR
  3393	020717'	254000	020735'	33060	        JRST TRCER
  3394	020720'	200040	013717'	33070	        MOVE    R1,FILPOS
  3395	020721'	075301	000000	33080	        USETO   FIL,(R1)        ;POSITION TO LAST BLOCK
  3396	020722'	057300	000000	33090	        OUT     FIL,            ;VACUOUS WRITE, RING ADVANCED BY CLOSE
  3397	020723'	254000	020725'	33100	        JRST    TRUNC2
  3398	020724'	254000	020732'	33110	        JRST    TRUNC3  ;SOME KIND OF ERROR
  3399	020725'	200040	013721'	33120	TRUNC2: MOVE R1,SAVBYT
  3400	020726'	202040	013267'	33130	        MOVEM R1,FILHD1         ;RESTORE BYTE PTR
  3401	020727'	200040	013720'	33140	        MOVE R1,SAVHED
  3402	020730'	057301	000000	33150	        OUT     FIL,(R1)        ;SWITCH TO PREVIOUS BUFFER IN RING
  3403	020731'	254000	020620'	33160	        JRST CLTFI2
  3404	020732'	024000	024411'	33170	TRUNC3: ERB [XWD[FILDI1],[ASCIZ"TROUBLE TRUNCATING _Z--"]]
  3405	020733'	260740	021375'	33180	        PUSHJ P,DWHY
  3406	020734'	254000	020620'	33190	        JRST CLTFI2
  3407	020735'	260740	020737'	33200	TRCER:  PUSHJ P,TRCERR
  3408	020736'	254000	020620'	33210	        JRST CLTFI2
  3409
  3410	020737'	200040	013710'	33230	TRCERR: MOVE R1,SEXT
  3411	020740'	250040	013522'	33240	        EXCH R1,FILDI3
  3412	020741'	501040	000000	33250	        HLLI    R1,
  3413	020742'	202040	013724'	33260	        MOVEM   R1,ERCODE       ;SAVE ERROR CODE
  3414	020743'	024000	024417'	33270	        ERB [XWD[FILDI1],[ASCIZ"CANNOT TRUNCATE _Z---"]]
  3415	020744'	260740	021165'	33280	        PUSHJ P,WHY
  3416	020745'	263740	000000	33290	        POPJ P,
  3417
  3418				33310	; ROUTINE TO PRINT CHECKSUMS IN EASYSPEAK
  3419				33320	; NOTE THAT THE TCO'S IN THIS ROUTINE OUTPUT TO COF FILE OR TO
  3420				33330	; BOTH TERMINAL AND COF FILE, DEPENDING ON WHERE TRIGR WAS CALLED
  3421
  3422	020746'	260740	020752'	33350	TRIGR:  PUSHJ P,CONS
  3423	020747'	231040	000005	33360	        IDIVI R1,5
  3424	020750'	200002	020765'	33370	        MOVE R0,VOWT(R2)
  3425	020751'	010000	000000	33380	        TCO R0
  3426	020752'	201140	000025	33390	CONS:   MOVEI R3,25
  3427	020753'	230040	000003	33400	        IDIV R1,R3
  3428	020754'	201002	000101	33410	        MOVEI R0,101(R2)
  3429	020755'	205200	777773	33420	        MOVSI CH,-5
  3430	020756'	316004	020765'	33430	CONS1:  CAMN R0,VOWT(CH)
  3431	020757'	254000	020762'	33440	        JRST CONS2
  3432	020760'	253200	020756'	33450	        AOBJN CH,CONS1
  3433	020761'	254000	020763'	33460	        JRST CONS3
  3434	020762'	201004	000126	33470	CONS2:  MOVEI R0,126(CH)
  3435	020763'	010000	000000	33480	CONS3:  TCO R0
  3436	020764'	263740	000000	33490	        POPJ P,
  3437	020765'	000000	000101	33500	VOWT: 101
  3438	020766'	000000	000105	33510	 105
  3439	020767'	000000	000111	33520	 111
  3440	020770'	000000	000117	33530	 117
  3441	020771'	000000	000125	33540	 125
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-64
TAP.MAC	23-MAR-79 11:41	

  3442
  3443
  3444				33570	; REPORT MISSING FILES.  SEARCH COMMAND LIST FOR ENTRIES
  3445				33580	; WHICH HAVE NOT BEEN PROCESSED.  THIS ROUTINE HAS TROUBLE
  3446				33590	; WITH FILENAMES WHICH WERE NOT MATCHED BY CKNFIL DUE TO
  3447				33600	; REDUNDANCY IN COMMAND LIST.
  3448
  3449	020772'	476000	021765'	33620	PFM:    SETOM PFMSW#    ;HEADING SWITCH FOR PFM
  3450	020773'	201040	000002	33630	        MOVEI R1,2
  3451	020774'	200041	017445*	33640	        MOVE R1,CTABL2(R1)
  3452	020775'	317040	022116'	33650	        CAMG R1,[2,,777777]
  3453	020776'	263740	000000	33660	        POPJ P,         ;NOT STATE 3 (INDIVIDUAL FILES)
  3454	020777'	135100	022117'	33670	        LDB R2,[XWD CNTFP+R1,0]
  3455	021000'	302100	000002	33680	        CAIE R2,CNTFT   ;LOOK FOR TERMINATOR AFTER PPN
  3456	021001'	344040	020777'	33690	        AOJA R1,.-2
  3457	021002'	550641	000000	33700	        HRRZ U,(R1)     ;FETCH UUN
  3458	021003'	135100	022575'	33710	        LDB R2,[XWD TRTF+R1,0]
  3459	021004'	306100	000001	33720	        CAIN R2,1
  3460	021005'	254000	021023'	33730	        JRST PFM2
  3461	021006'	260740	021610'	33740	        PUSHJ P,FINGAN  ;DO A LUD LOOKUP
  3462	021007'	202640	013520'	33750	PFM0:   MOVEM U,FILDI1  ;SAVE FULL PPN
  3463	021010'	204101	000001	33760	PFM1:   MOVS R2,1(R1)   ;FETCH FILENAME BACKWARDS
  3464	021011'	306100	415454	33770	        CAIN R2,(SIXBIT /ALL/)
  3465	021012'	263740	000000	33780	        POPJ P,         ;LIST ENDS WITH ALL
  3466	021013'	135100	024337'	33790	        LDB R2,[XWD SUCS+R1,2]  ;FETCH SUCCESS BIT IN EXT. WD
  3467	021014'	302100	000001	33800	        CAIE R2,1       ;ONE IF CKNFIL SUCCESS ON THIS NAME
  3468	021015'	260740	021033'	33810	        PUSHJ P,PFMM    ;REPORT
  3469	021016'	350000	000001	33820	        AOS R1
  3470	021017'	135100	022135'	33830	        LDB R2,[XWD CNTFP+R1,1]
  3471	021020'	302100	000002	33840	        CAIE R2,CNTFT
  3472	021021'	344040	021010'	33850	        AOJA R1,PFM1
  3473	021022'	263740	000000	33860	        POPJ P,         ;LIST ENDS WITH TERMINATOR
  3474				33870	; TRANSLATE OPTION.  RH OF COMMAND LIST POINTS INTO TRANSLATION TABLE.
  3475	021023'	200015	000001	33880	PFM2:   MOVE R0,1(U)
  3476	021024'	202000	013336'	33890	        MOVEM LSTUN1
  3477	021025'	200015	000002	33900	        MOVE R0,2(U)
  3478	021026'	202000	013337'	33910	        MOVEM LSTUN2
  3479	021027'	201000	000015	33920	        MOVEI R0,VERSION
  3480	021030'	202000	013341'	33930	        MOVEM LSTVER
  3481	021031'	202640	013332'	33940	        MOVEM U,LSTPPN ;FAKE PPN FOR THE TAPE NAME.  GAN IS ZERO SO
  3482				33950	;                       THERE CAN BE NO CONFUSION WITH A REAL PPN.
  3483	021032'	254000	021007'	33960	        JRST PFM0
  3484
  3485				33980	; PRINT FILENAME SUSPECTED TO BE MISSING
  3486
  3487	021033'	200101	000001	34000	PFMM:   MOVE R2,1(R1)
  3488	021034'	202100	013521'	34010	        MOVEM R2,FILDI2 ;FILENAME
  3489	021035'	514101	000002	34020	        HRLZ R2,2(R1)
  3490	021036'	202100	013522'	34030	        MOVEM R2,FILDI3 ;EXTENSION
  3491	021037'	357000	021765'	34040	        AOSG PFMSW      ;PRINT HEADING ONCE
  3492				34050	        TYPE [ASCIZ"$FILENAMES UNSATISFIED: (MISSING ON TAPE OR
  3493	021040'	012000	024420'	34060	DUPLICATED IN LIST)$"]
  3494	021041'	023000	024436'	34070	        ERT [XWD[FILDI1],[ASCIZ"_J$"]]
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-65
TAP.MAC	23-MAR-79 11:41	

  3495	021042'	263740	000000	34080	        POPJ P,
  3496
  3497				34100	; CHECK FOR AN EMPTY COMMAND LIST AND SKIP IF NOT EMPTY.  A LIST
  3498				34110	; WHICH DOES NOT CONSIST OF INDIVIDUAL FILENAMES OR
  3499				34120	; WHICH CONTAINS WILD CARDS WILL NEVER BE EMPTY.
  3500				34130	; THE SWITCH "NULSW" = 0 THE FIRST TIME THROUGH
  3501				34140	; THEREAFTER, NULSW = 1 IF WILD CARDS WERE FOUND AND = 2 IF NOT
  3502
  3503	021043'	201040	000002	34160	CKNNUL: MOVEI R1,2
  3504	021044'	200041	020774*	34170	        MOVE R1,CTABL2(R1)
  3505	021045'	317040	022116'	34180	        CAMG R1,[2,,777777]
  3506	021046'	254000	016256'	34190	        JRST CPOPJ1     ;LIST NOT EMPTY
  3507	021047'	135100	022117'	34200	        LDB R2,[XWD CNTFP+R1,0]
  3508	021050'	302100	000002	34210	        CAIE R2,CNTFT   ;SKIP IF TERMINATOR ON UUN
  3509	021051'	344040	021047'	34220	        AOJA R1,.-2
  3510	021052'	200100	021757'	34230	        MOVE R2,NULSW
  3511	021053'	307100	000000	34240	        CAIG R2,0               ;SKIP IF NOT FIRST TIME THROUGH
  3512	021054'	254000	021067'	34250	        JRST CKNN3A     ;LOOK FOR WILD CARDS
  3513	021055'	307100	000001	34260	        CAIG R2,1       ;SKIP IF NO WILD CARDS WERE FOUND
  3514	021056'	254000	016256'	34270	        JRST CPOPJ1
  3515	021057'	350000	000001	34280	CKNN2:  AOS R1
  3516	021060'	135100	024437'	34290	        LDB R2,[XWD SUCS+R1,1]  ;LOOK AT SUCCESS BIT
  3517	021061'	302100	000001	34300	        CAIE R2,1               ;SKIP IF WE PROCESSED THIS FILE
  3518	021062'	254000	016256'	34310	        JRST CPOPJ1
  3519	021063'	135100	022135'	34320	        LDB R2,[XWD CNTFP+R1,1] ;LOOK AT TERMINATOR
  3520	021064'	302100	000002	34330	        CAIE R2,CNTFT           ;SKIP IF END
  3521	021065'	344040	021057'	34340	        AOJA R1,CKNN2           ;GET NEXT FILENAME
  3522	021066'	263740	000000	34350	        POPJ P,                 ;NONSKIP RETURN IF LIST EMPTY
  3523	021067'	350000	021757'	34360	CKNN3A: AOS NULSW               ;MARK AS NOT FIRST TIME
  3524	021070'	200000	000001	34370	        MOVE R0,R1              ;SAVE R1
  3525	021071'	201140	000011	34380	CKNN3:  MOVEI   R3,11
  3526	021072'	202140	022003'	34390	        MOVEM   R3,TMP#         ;COUNT OF CHARS TO EXAMINE
  3527	021073'	514141	000002	34400	        HRLZ    R3,2(R1)        ;FETCH EXTENSION (RH OF COMMAND WD)
  3528	021074'	204101	000001	34410	        MOVS    R2,1(R1)        ;FETCH FILENAME BACKWARDS
  3529	021075'	306100	415454	34420	        CAIN    R2,(SIXBIT/ALL/)
  3530	021076'	254000	016256'	34430	        JRST CPOPJ1             ;LIST ENDS WITH "ALL"
  3531	021077'	430100	022124'	34440	CKNN3B: XOR     R2,[SIXBIT /#/]
  3532	021100'	607100	770000	34450	        TLNN    R2,770000
  3533	021101'	254000	016256'	34460	        JRST    CPOPJ1          ;BYPASS FILE WITH WILD CARD
  3534	021102'	430100	022125'	34470	        XOR     R2,[BYTE (6)34] ;XOR OF "#" AND "?"
  3535	021103'	607100	770000	34480	        TLNN    R2,770000
  3536	021104'	254000	016256'	34490	        JRST    CPOPJ1          ;FOUND QM
  3537	021105'	430100	022126'	34500	        XOR     R2,[BYTE (6)25] ;XOR OF "?" AND "*"
  3538	021106'	607100	770000	34510	        TLNN    R2,770000
  3539	021107'	254000	016256'	34520	        JRST    CPOPJ1          ;FOUND ASTERISK
  3540	021110'	246100	000006	34530	        LSHC    R2,6
  3541	021111'	372000	022003'	34540	        SOSE    TMP
  3542	021112'	254000	021077'	34550	        JRST    CKNN3B
  3543	021113'	350000	000001	34560	        AOS R1
  3544	021114'	135100	022135'	34570	        LDB     R2,[XWD CNTFP+R1,1]
  3545	021115'	302100	000002	34580	        CAIE    R2,CNTFT        ;CHECK FOR TERMINATOR
  3546	021116'	344040	021071'	34590	        AOJA    R1,CKNN3        ;MORE TO EXAMINE
  3547	021117'	200040	000000	34600	        MOVE R1,R0
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-66
TAP.MAC	23-MAR-79 11:41	

  3548	021120'	350000	021757'	34610	        AOS NULSW               ;MARK AS NO WILD CARDS PRESENT
  3549	021121'	254000	021057'	34620	        JRST CKNN2
  3550
  3551				34640	; TOTAL FILES FOR USER
  3552
  3553	021122'	334040	024440'	34660	SPRTU:  SKIPA   R1,[MSPTR]      ;GET POINTER FOR STORE MODE
  3554	021123'	201040	020631*	34670	RPRTU:  MOVEI   R1,MRPTR##      ;GET POINTER FOR RESTORE MODE
  3555	021124'	620400	000100	34680	        TRZ F,UNMFLG            ;RESET SO TITLE FOR NEXT USER WILL
  3556				34690	;                               BE PRINTED AT NEXT DIR RECORD
  3557	021125'	336000	013703'	34700	        SKIPN UCOUNT
  3558	021126'	254000	021131'	34710	        JRST .+3
  3559	021127'	024000	024447'	34720	        ERB [XWD[UCOUNT],[ASCIZ"$TOTAL _C UFD'S SET UP.$"]]
  3560	021130'	402000	013703'	34730	        SETZM UCOUNT
  3561	021131'	336000	013376'	34740	        SKIPN   FILCNT          ;SKIP IF FILES TRANSFERED FOR USER
  3562	021132'	263740	000000	34750	        POPJ    P,              ;RETURN FROM SPRTU/RPRTU
  3563	021133'	135041	000000	34760	        LDB     R1,(R1)         ;GET BYTE FOR STORE OR RESTORE
  3564	021134'	607400	001000	34770	        TLNN    F,DIRFLG        ;SKIP IF DIRECTORY CMD AND PRINT USER TOT
  3565	021135'	602040	000002	34780	        TRNE    R1,2            ;SKIP IF USER NAMES SHOULD NOT BE PRINTED
  3566	021136'	254000	021146'	34790	        JRST    RPRTA           ;PRINT USER TOTAL
  3567	021137'	200040	013376'	34800	RPRTB:  MOVE    R1,FILCNT       ;GET NUMBER OF FILES FOR THIS USER
  3568	021140'	402000	013376'	34810	        SETZM   FILCNT          ;ZERO NUMBER OF FILES FOR NEXT USER
  3569	021141'	272040	013377'	34820	        ADDM    R1,TOTCNT       ;ADD TO TOTAL FOR THIS SAVE SET
  3570	021142'	200040	022005'	34830	        MOVE R1,TOTBLK
  3571	021143'	402000	022005'	34840	        SETZM TOTBLK
  3572	021144'	272040	021751'	34850	        ADDM R1,GTBLOCK#        ;GRAND TOTAL BLOCKS
  3573	021145'	263740	000000	34860	        POPJ    P,              ;RETURN FROM SPRTU/RPRTU
  3574	021146'	603400	000400	34870	RPRTA:  TLNE F,STOFLG           ;IS THIS "STORE" COMMAND
  3575	021147'	254000	021163'	34880	        JRST    RPRTC           ;YES--USE LSTPPN
  3576	021150'	603400	001000	34890	        TLNE F,DIRFLG
  3577	021151'	254000	021154'	34900	        JRST .+3
  3578				34910	        ERO [XWD[FILDI1
  3579	021152'	022000	024456'	34920	FILCNT],[ASCIZ"_Y  _C FILES.$$"]]
  3580	021153'	254000	021137'	34930	        JRST    RPRTB
  3581	021154'	200040	013520'	34940	        MOVE R1,FILDI1
  3582	021155'	552040	021746'	34950	        HRRZM R1,DUUN#
  3583	021156'	556040	021744'	34960	        HLRZM R1,DGAN#
  3584	021157'	201040	013513'	34970	        MOVEI R1,FILDI1-5
  3585	021160'	202040	022003'	34980	        MOVEM R1,TMP#
  3586				34990	        ERO [XWD[FILCNT
  3587				35000	XWD 12,5
  3588				35010	TMP
  3589				35020	DGAN
  3590				35030	XWD 10,6
  3591				35040	DUUN
  3592				35050	XWD 10,6
  3593				35060	TOTBLK#
  3594	021161'	022000	024503'	35070	XWD 12,6],[ASCIZ"TOTAL_N FILES  FOR     _M  [_N,_N]                _N$$"]]
  3595	021162'	254000	021137'	35080	        JRST RPRTB
  3596				35090	RPRTC:  ERO [XWD[LSTPPN
  3597	021163'	022000	024512'	35100	FILCNT],[ASCIZ"_A  _C FILES.$$"]]
  3598	021164'	254000	021137'	35110	        JRST    RPRTB
  3599
  3600				35130	; INTERPRET ERCODE ON LOOKUP OR ENTER FAILURES.
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-67
TAP.MAC	23-MAR-79 11:41	

  3601
  3602	021165'	571040	777777	35150	WHY:    HRREI   R1,-1
  3603	021166'	250040	013724'	35160	        EXCH    R1,ERCODE
  3604	021167'	200041	021175'	35170	        MOVE    R1,ENTTAB(R1)
  3605	021170'	202040	022003'	35180	        MOVEM R1,TMP
  3606	021171'	024000	022003'	35190	        ERB TMP
  3607	021172'	010000	022041'	35200	        TCO [CRCHR]
  3608	021173'	263740	000000	35210	        POPJ    P,
  3609
  3610				35230	; TABLE OF ERROR MESSAGES FOR LOOKUP AND ENTER
  3611
  3612	021174'	000000	021232'	35250	        EXP EMM1
  3613	021175'	000000	021234'	35260	ENTTAB: EXP EM0,EM1,EM2,EM3,EM4,EM5,EM6,EM30
	021176'	000000	021237'
	021177'	000000	021242'
	021200'	000000	021246'
	021201'	000000	021252'
	021202'	000000	021257'
	021203'	000000	021263'
	021204'	000000	021353'
  3614	021205'	000000	021353'	35270	        EXP EM30,EM30,EM30,EM30
	021206'	000000	021353'
	021207'	000000	021353'
	021210'	000000	021353'
  3615	021211'	000000	021267'	35280	        EXP EM14,EM15,EM16,EM17,EM20,EM21,EM22,EM23
	021212'	000000	021273'
	021213'	000000	021277'
	021214'	000000	021305'
	021215'	000000	021312'
	021216'	000000	021315'
	021217'	000000	021324'
	021220'	000000	021332'
  3616	021221'	000000	021337'	35290	        EXP EM24,EM25,EM26,EM30,EM30A
	021222'	000000	021343'
	021223'	000000	021347'
	021224'	000000	021353'
	021225'	000000	021356'
  3617	021226'	000000	021353'	35300	        EXP EM30,EM32,EM33,EM34
	021227'	000000	021362'
	021230'	000000	021365'
	021231'	000000	021372'
  3618	021232'	472364	042644	35310	EMM1:   ASCIZ"NO ERROR"
	021233'	512372	200000
  3619	021234'	432231	442500	35320	EM0:    ASCIZ"FILE NOT FOUND"
	021235'	472372	420214
	021236'	476531	642000
  3620	021237'	446352	640630	35330	EM1:    ASCIZ"INVALID PPN"
	021240'	446104	050240
	021241'	470000	000000
  3621	021242'	502451	752212	35340	EM2:    ASCIZ"PROTECTION FAILURE"
	021243'	416511	147634
	021244'	202150	144630
	021245'	526450	500000
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-68
TAP.MAC	23-MAR-79 11:41	

  3622	021246'	432231	442500	35350	EM3:    ASCIZ"FILE BEING MODIFIED"
	021247'	412131	147216
	021250'	202331	742222
	021251'	432230	542000
  3623	021252'	432231	442634	35360	EM4:    ASCIZ"FILENAME ALREADY EXISTS"
	021253'	406330	520202
	021254'	462450	540610
	021255'	545010	554222
	021256'	516512	300000
  3624	021257'	446311	427100	35370	EM5:    ASCIZ"ILL. UUO SEQUENCE"
	021260'	526531	720246
	021261'	426432	542634
	021262'	416120	000000
  3625	021263'	426452	247644	35380	EM6:    ASCIZ"ERROR IN UFD RIB"
	021264'	202231	620252
	021265'	432104	051222
	021266'	410000	000000
  3626	021267'	476550	551210	35390	EM14:   ASCIZ"OVERDRAWN UFD QUOTA"
	021270'	512032	747100
	021271'	526150	420242
	021272'	526372	440400
  3627	021273'	536451	152212	35400	EM15:   ASCIZ"WRITE-LOCK ERROR"
	021274'	266311	741626
	021275'	202132	251236
	021276'	510000	000000
  3628	021277'	466371	644650	35410	EM16:   ASCIZ"MONITOR OUT OF TABLE SPACE"
	021300'	476444	047652
	021301'	521011	743100
	021302'	522030	246212
	021303'	202472	040606
	021304'	424000	000000
  3629	021305'	502032	252222	35420	EM17:   ASCIZ"PARTIAL ALLOCATION ONLY"
	021306'	406304	040630
	021307'	462370	340650
	021310'	446371	620236
	021311'	472313	100000
  3630	021312'	412311	741626	35430	EM20:   ASCIZ"BLOCK NOT FREE"
	021313'	202351	752100
	021314'	432450	542400
  3631	021315'	416031	647236	35440	EM21:   ASCIZ"CANNOT SUPERSEDE EXISTING DIR."
	021316'	521012	352640
	021317'	426452	342610
	021320'	425010	554222
	021321'	516511	147216
	021322'	202111	151134
	021323'	000000	000000
  3632	021324'	416031	647236	35450	EM22:   ASCIZ"CANNOT DELETE NON-EMPTY DIR."
	021325'	521010	442630
	021326'	426510	520234
	021327'	476345	542632
	021330'	502513	120210
	021331'	446445	600000
  3633	021332'	516530	242222	35460	EM23:   ASCIZ"SUBDIRECTORY NOT FOUND"
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-69
TAP.MAC	23-MAR-79 11:41	

	021333'	512130	352236
	021334'	512624	047236
	021335'	521010	647652
	021336'	472100	000000
  3634	021337'	516130	151206	35470	EM24:   ASCIZ"SEARCH LIST EMPTY"
	021340'	441011	444646
	021341'	521010	546640
	021342'	522620	000000
  3635	021343'	516150	420234	35480	EM25:   ASCIZ"SFD NESTED TOO DEEP"
	021344'	426472	442610
	021345'	202511	747500
	021346'	422130	550000
  3636	021347'	472364	043222	35490	EM26:   ASCIZ"NO FILE STRUCTURE?"
	021350'	462124	051650
	021351'	512530	352252
	021352'	512127	700000
  3637	021353'	422371	623650	35500	EM30:   ASCIZ"DON'T KNOW WHY"
	021354'	202271	647656
	021355'	202571	054400
  3638	021356'	472152	320236	35510	EM30A:  ASCIZ"NFS OR BDA BIT ON"
	021357'	511010	242202
	021360'	202051	152100
	021361'	476340	000000
  3639	021362'	472372	420206	35520	EM32:   ASCIZ"NOT CHANGED"
	021363'	442031	643612
	021364'	420000	000000
  3640	021365'	416450	540650	35530	EM33:   ASCIZ"CREATION DATE CHANGED"
	021366'	446371	620210
	021367'	406510	520206
	021370'	442031	643612
	021371'	420000	000000
  3641	021372'	472372	420246	35540	EM34:   ASCIZ"NOT SELECTED"
	021373'	426310	541650
	021374'	426100	000000
  3642
  3643				35560	; INTERPRET DISC ERRORS
  3644
  3645	021375'	062300	013716'	35580	DWHY::  GETSTS FIL,FILCOD
  3646	021376'	200040	013716'	35590	        MOVE R1,FILCOD
  3647	021377'	602040	400000	35600	        TRNE R1,400000
  3648	021400'	024000	024522'	35610	        ERB [XWD 0,[ASCIZ"FILE SOFTWARE WRITE PROTECTED.$"]]
  3649	021401'	602040	200000	35620	        TRNE R1,200000
  3650	021402'	024000	024526'	35630	        ERB [XWD 0,[ASCIZ"SEARCH ERROR.$"]]
  3651	021403'	602040	100000	35640	        TRNE R1,100000
  3652	021404'	024000	024533'	35650	        ERB [XWD 0,[ASCIZ"DISC PARITY ERROR.$"]]
  3653	021405'	602040	040000	35660	        TRNE R1,40000
  3654	021406'	024000	024541'	35670	        ERB [XWD 0,[ASCIZ"CANNOT ALLOCATE DISC.$"]]
  3655	021407'	263740	000000	35680	        POPJ P,
  3656
  3657				35700	; SETUP FILE LICENSE
  3658
  3659	021410'	550040	013533'	35720	CKLIC:  HRRZ    R1,FRBNCA       ;GET LICENSE THE FILE HAD
  3660	021411'	322040	016257'	35730	        JUMPE   R1,CPOPJ        ;RETURN FROM CKLIC IF NO LICENSE
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-70
TAP.MAC	23-MAR-79 11:41	

  3661	021412'	202040	013400'	35740	        MOVEM   R1,CKLICT       ;SAVE THE DESIRED LICENSE
  3662	021413'	332000	021750'	35750		SKIPE	GETFLG		;IF IN GET MODE, SAVE LOGGED IN PPN
  3663	021414'	334040	013316'	35760		SKIPA	R1,CURPPN	;IF NOT, SAVE CURRENT PPN
  3664	021415'	047040	000024	35770		GETPPN	R1,
  3665	021416'	202040	013725'	35780		MOVEM	R1,EXTPPN
  3666	021417'	200040	013317'	35790		MOVE	R1,CURFIL
  3667	021420'	202040	013726'	35800		MOVEM	R1,EXTFIL
  3668	021421'	200040	013320'	35810		MOVE	R1,CUREXT
  3669	021422'	512040	013727'	35820		HLLZM	R1,EXTEXT
  3670	021423'	200040	013766'	35830	        MOVE    R1,JBLIC        ;GET LICENSE OF CURRENT JOB
  3671	021424'	202040	013401'	35840	        MOVEM   R1,CKLICT+1     ;SAVE JOB'S LICENSE
  3672	021425'	200100	013255'	35850	        MOVE    R2,TAPHED       ;ADDR OF CURRENT BUFFER
  3673	021426'	332042	000005	35860	        SKIPE   R1,5(R2)        ;SKIP IF FILE'S PPN IS ZERO (GET CMD)
  3674	021427'	430040	013767'	35870	        XOR     R1,JBPPN        ;EXCLUSIVE OR OF JOB AND FILE PPNS
  3675	021430'	202040	013402'	35880	        MOVEM   R1,CKLICT+2     ;SAVE XOR OF PPNS
  3676	021431'	201040	013400'	35890	        MOVEI   R1,CKLICT       ;ADDR OF TABLE
  3677	021432'	505040	000003	35900	        HRLI    R1,3            ;BIT 17 FOR LIC FROM TAB/BIT 16 FOR FILE
  3678	021433'	047040	777747	35910	        CALLI   R1,-31          ;CHKLIC - RETURN ALLOWABLE LICENSE
  3679	021434'	316040	013400'	35920	        CAMN    R1,CKLICT       ;SKIP IF NOT ALL LICENSE ALLOWABLE
  3680				35930	        ERO     [XWD [EXTPPN
  3681	021435'	022000	024551'	35940	                PRLIC],[ASCIZ "FILE _Z GIVEN LICENSE _E"]]
  3682	021436'	513040	013533'	35950	        HLLZS   R1,FRBNCA       ;ZERO THE LICENSE
  3683	021437'	024000	024562'	35960	        ERB [XWD[EXTPPN],[ASCIZ "*********** FILE _Z NOT GIVEN LICENSE "]]
  3684				35970	; PRINT LICENSES FROM CKLICT
  3685	021440'	200000	024563'	35980	PRLIC:  MOVE [POINT 12,LIC-1,35]
  3686	021441'	202000	022002'	35990	        MOVEM TLIC#
  3687	021442'	200140	024564'	36000	        MOVE R3,[-13,,0] ;BITS 18-28 INDICATE 11 UNIQUE LICENSES
  3688	021443'	200100	013400'	36010	        MOVE R2,CKLICT
  3689	021444'	134000	022002'	36020	        ILDB R0,TLIC
  3690	021445'	602100	400000	36030	        TRNE R2,400000
  3691	021446'	260740	021463'	36040	        PUSHJ P,PLIC
  3692	021447'	242100	000001	36050	        LSH R2,1
  3693	021450'	253140	021444'	36060	        AOBJN R3,.-4
  3694	021451'	135040	024565'	36070	        LDB R1,[POINT 2,CKLICT,33]
  3695	021452'	200000	021507'	36080	        MOVE READL
  3696	021453'	256001	021503'	36090	        XCT ILIC(R1)
  3697	021454'	260740	021463'	36100	        PUSHJ P,PLIC
  3698	021455'	135040	024566'	36110	        LDB R1,[POINT 2,CKLICT,35]
  3699	021456'	200000	021510'	36120	        MOVE WRITL
  3700	021457'	256001	021503'	36130	        XCT ILIC(R1)
  3701	021460'	260740	021463'	36140	        PUSHJ P,PLIC
  3702	021461'	010000	022041'	36150	        TCO [CRCHR]
  3703	021462'	263740	000000	36160	        POPJ P,
  3704	021463'	405000	007777	36170	PLIC:   ANDI 7777
  3705	021464'	606000	007777	36180	        TRNN 7777
  3706	021465'	263740	000000	36190	        POPJ P,
  3707	021466'	246000	777772	36200	        LSHC R0,-6
  3708	021467'	271000	000040	36210	        ADDI 40
  3709	021470'	010000	000000	36220	        TCO R0
  3710	021471'	246000	000006	36230	        LSHC R0,6
  3711	021472'	405000	000077	36240	        ANDI 77
  3712	021473'	271000	000040	36250	        ADDI 40
  3713	021474'	010000	000000	36260	        TCO R0
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-71
TAP.MAC	23-MAR-79 11:41	

  3714	021475'	010000	024567'	36270	        TCO [40]
  3715	021476'	263740	000000	36280	        POPJ P,
  3716	021477'	674362	435760	36290	LIC: SIXBIT /WCRCOPSYGDTDSTHFJLACXC/
	021500'	637147	446444
	021501'	636450	465254
	021502'	414370	430000
  3717	021503'	400000	000000	36300	ILIC:   SETZ R0,
  3718	021504'	242000	777750	36310	        LSH -30
  3719	021505'	242000	777764	36320	        LSH -14
  3720	021506'	600000	000000	36330	        TRN
  3721	021507'	626062	466241	36340	READL: SIXBIT /RPRFRA/
  3722	021510'	676067	466741	36350	WRITL: SIXBIT /WPWFWA/
  3723
  3724				36370	;PPNUSR CONVERTS A PPN TO A USER NAME BY LOOKING IN THE DUL
  3725				36380	;  CALL WITH PPN IN R0
  3726				36390	;  NON-SKIP RETURN IF USER NAME NOT FOUND. R0 PRESERVED IN THIS CASE
  3727				36400	;  SKIP RETURN IF USER NAME FOUND.  USER NAME RETURNED IN R0 & R1
  3728				36410	;  ALL REGISTERS OTHER THAN R0 & R1 ARE PRESERVED.
  3729
  3730	021511'	607400	000200	36430	PPNUSR::TLNN    F,DULFLG        ;SKIP IF THE DUL HAS BEEN OPENED
  3731	021512'	260740	021716'	36440	        PUSHJ   P,GETDUL        ;TRY TO OPEN THE DUL
  3732	021513'	607400	000200	36450	        TLNN    F,DULFLG        ;SKIP IF THE DUL HAS BEEN OPENED
  3733	021514'	263740	000000	36460	        POPJ    P,              ;FAIL RETURN FROM PPNUSR
  3734	021515'	261740	000002	36470	        PUSH    P,R2            ;SAVE R2 IN STACK
  3735	021516'	261740	000003	36480	        PUSH    P,R3            ;SAVE R3 IN STACK
  3736	021517'	260740	021525'	36490	        PUSHJ   P,FINPPN        ;FIND PPN IN THE DUL AND RET USR NAME
  3737	021520'	334000	000000	36500	        SKIPA                   ;ERROR RETURN  USER NAME NOT FOUND
  3738	021521'	350017	777776	36510	        AOS     -2(P)           ;SKIP RETURN WHEN WE RETURN
  3739	021522'	262740	000003	36520	        POP     P,R3            ;RESTORE R3 FROM STACK
  3740	021523'	262740	000002	36530	        POP     P,R2            ;RESTORE R2 FROM STACK
  3741	021524'	263740	000000	36540	        POPJ    P,              ;RETURN USER NAME IN R0 AND R1
  3742
  3743	021525'	200140	000000	36560	FINPPN: MOVE    R3,R0           ;SAVE PPN IN R3
  3744	021526'	231000	000145	36570	        IDIVI   R0,^D101        ;DIVIDE BY 101 FOR BLOCK NUMBER
  3745	021527'	271040	000001	36580	        ADDI    R1,1            ;REMAINDER PLUS ONE IS BLOCK NUMBER
  3746	021530'	316040	013254'	36590	        CAMN R1,DULL
  3747	021531'	254000	021537'	36600	        JRST PPN2
  3748	021532'	074460	000001	36610	PPN3:   USETI   DUL,@R1         ;SET FILE TO INPUT AT PROPER BLOCK
  3749	021533'	066440	013052'	36620	        INPUT   DUL,DULLST      ;INPUT THE BLOCK
  3750	021534'	063440	760000	36630	        STATZ   DUL,760000      ;SKIP IF NO ERRORS
  3751	021535'	015000	024570'	36640	        ERROR   [ASCIZ "ERROR IN DUL.$"]
  3752	021536'	202040	013254'	36650	        MOVEM R1,DULL           ;SAVE DUL LOCATOR
  3753	021537'	400100	000000	36660	PPN2:   SETZ    R2,             ;INITIALIZE INDEX TO ZERO
  3754	021540'	200000	000003	36670	        MOVE    R0,R3           ;RESTORE PPN IN R0 IN CASE OF FAILURE
  3755	021541'	336002	013054'	36680	PPN1:   SKIPN   DULBLK(R2)
  3756	021542'	263740	000000	36690	        POPJ    P,              ;FAIL RETURN FROM PPNUSR
  3757	021543'	550042	013054'	36700	        HRRZ    R1,DULBLK(R2)
  3758	021544'	337002	013054'	36710	        SKIPG   DULBLK(R2)
  3759	021545'	254000	021532'	36720	        JRST    PPN3
  3760	021546'	200002	013055'	36730	        MOVE    R0,DULBLK+1(R2) ;GET 1ST HALF OF NAME IN CASE WE'RE DONE
  3761	021547'	200042	013056'	36740	        MOVE    R1,DULBLK+2(R2) ;GET 2ND HALF OF NAME IN CASE WE'RE DONE
  3762	021550'	316142	013054'	36750	        CAMN    R3,DULBLK(R2)
  3763	021551'	254000	016256'	36760	        JRST    CPOPJ1          ;SUCCESS RETURN FROM PPNUSR
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-72
TAP.MAC	23-MAR-79 11:41	

  3764	021552'	200000	000003	36770	        MOVE    R0,R3           ;RESTORE PPN IN R0 IN CASE OF FAILURE
  3765	021553'	271100	000003	36780	        ADDI    R2,3
  3766	021554'	305100	000200	36790	        CAIGE   R2,200
  3767	021555'	254000	021541'	36800	        JRST    PPN1            ;LOOP
  3768	021556'	263740	000000	36810	        POPJ    P,              ;FAIL RETURN FROM PPNUSR
  3769
  3770				36830	;USRPPN CONVERTS A USER NAME TO A PPN
  3771				36840	;  CALL WITH USER NAME IN R0 AND R1
  3772				36850	;  SKIP RETURN WITH PPN IN R0 IF SUCCESSFUL
  3773				36860	;  NON-SKIP RETURN IN UNSUCCESSFUL
  3774				36870	;  R1, R2, AND R3 ARE NOT PRESERVED. R0 NOT PRESERVED ON FAILURE
  3775	021557'	607400	000100	36880	USRPPN::TLNN    F,LUDFLG        ;SKIP IF THE LUD HAS BEEN OPENED
  3776	021560'	260740	021725'	36890	        PUSHJ   P,GETLUD        ;TRY TO OPEN THE LUD
  3777	021561'	607400	000100	36900	        TLNN    F,LUDFLG        ;SKIP IF THE LUD HAS BEEN OPENED
  3778	021562'	263740	000000	36910	        POPJ    P,              ;FAIL RETURN FROM USRPPN
  3779	021563'	260740	021646'	36920	        PUSHJ   P,HASHER        ;HASH THE USER NAME
  3780	021564'	260740	021572'	36930	        PUSHJ   P,FINNAM        ;FIND NAME IN LUD
  3781	021565'	263740	000000	36940	        POPJ    P,              ;FAIL RETURN
  3782	021566'	200002	012641'	36950	        MOVE    R0,LUDBLK(R2)   ;GET PPN
  3783	021567'	254000	016256'	36960	        JRST    CPOPJ1          ;RETURN PPN IN R0
  3784
  3785				36980	;RETURN IF NOT FOUND
  3786				36990	;RETURN+1 IF NOT FOUND BUT USER WAS THERE(DELETED IN LUD)
  3787				37000	;RETURN+2 IF FOUND
  3788	021570'	336042	012641'	37010	TYP1:   SKIPN   R1,LUDBLK(R2)
  3789	021571'	263740	000000	37020	        POPJ    P,              ;FAIL RETURN FROM USRPPN
  3790	021572'	316040	013041'	37030	FINNAM: CAMN R1,LUDL
  3791	021573'	254000	021601'	37040	        JRST TYP2
  3792	021574'	074420	000001	37050	        USETI   LUD,@R1
  3793	021575'	066400	012637'	37060	        INPUT   LUD,LUDLST
  3794	021576'	063400	760000	37070	        STATZ   LUD,760000
  3795	021577'	015000	024573'	37080	        ERROR   [ASCIZ "ERROR IN LUD.$"]
  3796	021600'	202040	013041'	37090	        MOVEM   R1,LUDL         ;SAVE LUD LOCATOR
  3797	021601'	400100	000000	37100	TYP2:   SETZ    R2,
  3798	021602'	323040	021570'	37110	TYP3:   JUMPLE  R1,TYP1
  3799	021603'	316002	012645'	37120	        CAMN    R0,LUDBLK+4(R2)
  3800	021604'	254000	016256'	37130	        JRST    CPOPJ1          ;SUCCESS RETURN FROM USRPPN
  3801	021605'	135040	024576'	37140	        LDB     R1,[POINT 7,LUDBLK+2(R2),35]
  3802	021606'	270100	000001	37150	        ADD     R2,R1
  3803	021607'	254000	021602'	37160	        JRST    TYP3
  3804	021610'	200000	013704'	37170	FINGAN::MOVE CPPN       ;LAST PPN REFERENCED IN COMMAND DISPATCHER
  3805	021611'	430000	000015	37180	        XOR R0,U        ;U CONTAINS UUN IN RH ONLY
  3806	021612'	602000	777777	37190	        TRNE R0,777777
  3807	021613'	254000	021616'	37200	        JRST .+3
  3808	021614'	500640	000000	37210	        HLL U,R0        ;COMPLETE PPN
  3809	021615'	263740	000000	37220	        POPJ P,
  3810	021616'	607400	000100	37230	        TLNN     F,LUDFLG
  3811	021617'	260740	021725'	37240	        PUSHJ   P,GETLUD
  3812	021620'	607400	000100	37250	        TLNN    F,LUDFLG
  3813	021621'	015000	024577'	37260	        ERROR   [ASCIZ"CANNOT OPEN LUD"]
  3814	021622'	135100	024603'	37270	        LDB     R2,[XWD LUDLC+R1,0]
  3815	021623'	316100	013041'	37280	        CAMN R2,LUDL
  3816	021624'	254000	021632'	37290	        JRST FING2
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-73
TAP.MAC	23-MAR-79 11:41	

  3817	021625'	074420	000002	37300	        USETI   LUD,@R2
  3818	021626'	066400	012637'	37310	        INPUT   LUD,LUDLST
  3819	021627'	063400	760000	37320	        STATZ   LUD,760000
  3820	021630'	015000	024604'	37330	        ERROR   [ASCIZ"ERROR IN LUD"]
  3821	021631'	202100	013041'	37340	        MOVEM R2,LUDL
  3822	021632'	400100	000000	37350	FING2:  SETZ    R2,
  3823	021633'	200002	012641'	37360	FING1:  MOVE    R0,LUDBLK(R2)
  3824	021634'	430000	000015	37370	        XOR     R0,U            ;LOOK FOR MATCHING UUN
  3825	021635'	602000	777777	37380	        TRNE    R0,777777
  3826	021636'	254000	021641'	37390	        JRST    .+3
  3827	021637'	500640	000000	37400	        HLL     U,R0
  3828	021640'	263740	000000	37410	        POPJ    P,
  3829	021641'	135000	024576'	37420	        LDB     R0,[POINT 7,LUDBLK+2(R2),35]
  3830	021642'	307000	000000	37430	        CAIG    R0,
  3831	021643'	015000	024607'	37440	        ERROR   [ASCIZ"PROG. ERROR-FING1"]
  3832	021644'	270100	000000	37450	        ADD     R2,R0
  3833	021645'	254000	021633'	37460	        JRST FING1
  3834
  3835	021646'	261740	000005	37480	HASHER: PUSH    P,HA
  3836	021647'	261740	000006	37490	        PUSH    P,HB
  3837	021650'	261740	000007	37500	        PUSH    P,HC
  3838	021651'	261740	000010	37510	        PUSH    P,HD
  3839	021652'	261740	000011	37520	        PUSH    P,HE
  3840	021653'	201300	000000	37530	        MOVEI   HB,0
  3841	021654'	200340	024613'	37540	        MOVE    HC,[555555555555]
  3842	021655'	200400	024614'	37550	        MOVE    HD,[361275431652]
  3843	021656'	200440	024615'	37560	        MOVE    HE,[612754316523]
  3844	021657'	260740	021700'	37570	        PUSHJ   P,RND
  3845	021660'	260740	021700'	37580	        PUSHJ   P,RND
  3846	021661'	260740	021700'	37590	        PUSHJ   P,RND
  3847	021662'	260740	021700'	37600	        PUSHJ   P,RND
  3848	021663'	430440	000010	37610	        XOR     HE,HD
  3849	021664'	200000	000011	37620	        MOVE    R0,HE
  3850	021665'	621000	400000	37630	        TLZ     R0,400000
  3851	021666'	231000	001567	37640	        IDIVI   R0,^D887
  3852	021667'	200000	000011	37650	        MOVE    R0,HE
  3853	021670'	430000	000007	37660	        XOR     R0,HC
  3854	021671'	271040	000001	37670	        ADDI    R1,1
  3855	021672'	262740	000011	37680	        POP     P,HE
  3856	021673'	262740	000010	37690	        POP     P,HD
  3857	021674'	262740	000007	37700	        POP     P,HC
  3858	021675'	262740	000006	37710	        POP     P,HB
  3859	021676'	262740	000005	37720	        POP     P,HA
  3860	021677'	263740	000000	37730	        POPJ    P,
  3861	021700'	270400	000000	37740	RND:    ADD     HD,R0
  3862	021701'	245000	777756	37750	        ROTC    R0,-22
  3863	021702'	201240	000005	37760	        MOVEI   HA,5
  3864	021703'	200106	000010	37770	RND1:   MOVE    R2,HC+1(HB)
  3865	021704'	224100	024616'	37780	        MUL     R2,[5*5*5*5*5*5*5*5*5*5*5*5*5*5*5]
  3866	021705'	272146	000011	37790	        ADDM    R3,HD+1(HB)
  3867	021706'	342300	021714'	37800	        AOJE    HB,RND2
  3868	021707'	211300	000001	37810	        MOVNI   HB,1
  3869	021710'	602400	000001	37820	        TRNE    HD,1
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 1-74
TAP.MAC	23-MAR-79 11:41	

  3870	021711'	331000	000011	37830	        SKIPL   HE
  3871	021712'	201300	000000	37840	        MOVEI   HB,0
  3872	021713'	250340	000011	37850	        EXCH    HC,HE
  3873	021714'	367240	021703'	37860	RND2:   SOJG    HA,RND1
  3874	021715'	263740	000000	37870	        POPJ    P,
  3875
  3876	021716'	050440	013042'	37890	GETDUL: OPEN    DUL,DULTAB      ;INIT THE DEVICE SYS
  3877	021717'	015000	024617'	37900	        ERROR   [ASCIZ "CANNOT ACCESS SYS.$"]
  3878	021720'	076440	013045'	37910	        LOOKUP  DUL,LOKDUL      ;LOOKUP THE DUL
  3879	021721'	263740	000000	37920	        POPJ    P,              ;FAIL RETURN FROM GETDUL
  3880	021722'	476000	013254'	37930	        SETOM DULL              ;NOTHING IN BUFFER YET
  3881	021723'	661400	000200	37940	        TLO     F,DULFLG        ;MARK DUL AS OPENED
  3882	021724'	263740	000000	37950	        POPJ    P,              ;SUCCESS RETURN FROM GETDUL
  3883
  3884	021725'	050400	012627'	37970	GETLUD: OPEN    LUD,LUDTAB      ;INIT THE DEVICE SYS
  3885	021726'	015000	024617'	37980	        ERROR   [ASCIZ "CANNOT ACCESS SYS.$"]
  3886	021727'	076400	012632'	37990	        LOOKUP  LUD,LOKLUD      ;LOOKUP THE LUD
  3887	021730'	263740	000000	38000	        POPJ    P,              ;FAIL RETURN FROM GETLUD
  3888	021731'	476000	013041'	38010	        SETOM LUDL              ;NOTHING IN BUFFER YET
  3889	021732'	661400	000100	38020	        TLO     F,LUDFLG        ;MARK LUD AS OPENED
  3890	021733'	263740	000000	38030	        POPJ    P,              ;SUCCESS RETURN FROM GETLUD
  3891
  3892			000000'	38050	        END     START
  3893
NO ERRORS DETECTED
PROGRAM BREAK IS 024623
8K CORE USED
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 2
TAP.MAC	23-MAR-79 11:41		SYMBOL TABLE

ABORTA		022567'	EXT	CLRTAP		016067'		CPOPJ		016257'	INT	DEVR2A		016545'	
AGUFO		015433'		CLSUSR		015655'		CPOPJ1		016256'		DEVR3		016552'	
AL		000001		CLTFI1		020604'		CPOPJ2		016255'		DEVR4		016554'	
ALLFSW		013733'	INT	CLTFI2		020620'		CPPN		013704'	INT	DEVR4A		016556'	
ALLLST		015443'	INT	CLTFI3		020646'		CRCHR		000015		DEVR4B		016562'	
APPROU		016331'	EXT	CLTFI4		020660'		CREDAT		013370'	INT	DEVR5		016565'	
AS		000006		CLTFI5		020665'		CREDSC		013722'		DEVROU		016500'	INT
AT		000010		CLTFI6		020640'		CRETIM		013371'	INT	DEVTBL		016614'	
BADTAP		015412'		CLTFI7		020671'		CRLS		017306'	EXT	DEVTX		021743'	
BARROW		000137		CLTFI8		020673'		CRTION		013372'		DGAN		021744'	
BLKCNT		021734'		CLTFI9		020676'		CSTATE		013677'		DIRBLT		015715'	
BLKSIZ		021735'		CLTFIL		020602'		CT		000007	SPD	DIRENT		017305'	
BOTBIT		004000	SPD	CMPLP		014555'		CTABL2		021044'	EXT	DIRFLG		001000	SPD
BOTFLG		000004	SPD	CMPLP1		014634'		CTDFLG		000020	SPD	DIRROU		017273'	INT
BPI		013665'		CMPLP2		014606'		CTDMSG		021741'		DIRSSC		021745'	
BPI1		013664'	INT	CMPLP3		014622'		CURDAT		013326'		DISABL	017000	000000	
BPICOD		016765'		CMPLP4		014655'		CUREXT		013320'		DLL		000004	SPD
BTL		040000	SPD	CMPLP5		014643'		CURFIL		013317'		DNC		000010	SPD
BUFBIN		000014	SPD	CMPLP6		014573'		CURNUM		013330'		DOTCHR		000056	
C1		021736'		CNTFC		000000	SIN	CURPOS		013321'		DSKSIZ		000203	SPD
C2		021737'		CNTFCR		015601'		CURPPN		013316'	INT	DUL		000011	SPD
CDISP		020470'	EXT	CNTFD		000001	SIN	CURSER		013327'		DULBLK		013054'	
CH		000004	SPD	CNTFDR		015605'		CURTRK		013324'		DULBUF		012424'	
CHANGD		013373'	INT	CNTFN		000003	SIN	CURUN1		013322'	INT	DULFLG		000200	SPD
CHARC		000020		CNTFNR		015577'		CURUN2		013323'	INT	DULHED		013277'	
CKER		017764'		CNTFP		420200	SIN	CURVER		013325'	INT	DULL		013254'	INT
CKLIC		021410'		CNTFT		000002	SIN	CUTFLG		020000	SPD	DULLST		013052'	
CKLICT		013400'		CNTFTR		015621'		CUTPPN		013346'		DULN		000001	SPD
CKNCHG		015512'		CNTFTT		015614'		CUTROU		017225'	INT	DULTAB		013042'	
CKNCHR		015466'		CNTTAB		015437'		CUTS		000001	SPD	DUUN		021746'	
CKNCRE		015501'		CNVDAT		013365'	INT	CUTT0		017231'		DVMTA		000020	SPD
CKNFIL		015520'		CNVFMT		013367'	INT	CUTT2		017250'		DWHY		021375'	INT
CKNFP		021740'		CNVTIM		013366'	INT	CUTT5		017250'		ECHR		017165'	EXT
CKNN2		021057'		CO		000011		CUTT5A		017252'		EM0		021234'	
CKNN3		021071'		COFHD1		013272'	INT	CUTT6		017256'		EM1		021237'	
CKNN3A		021067'		COFHD2		013273'	INT	CUTTIM		013361'	SPD	EM14		021267'	
CKNN3B		021077'		COFHED		013271'	INT	DA		000017		EM15		021273'	
CKNNUL		021043'		COFRLS		016350'	EXT	DATE		000014	SPD	EM16		021277'	
CKNNX1		015531'		COMMA		000054		DATTIM		013331'		EM17		021305'	
CKNNXT		015556'		COMP2A		017043'		DATUUO	047000	777723		EM2		021242'	
CKNPPN		015562'		COMPA		017026'		DAYTIM		013765'		EM20		021312'	
CKNRAN		017210'		COMPA1		017034'		DCDONE		017665'		EM21		021315'	
CKSUM		013663'	INT	COMPA2		017044'		DDI		016777'	INT	EM22		021324'	
CKTR		015444'		COMPA3		017054'		DDI1		017002'		EM23		021332'	
CKTR1		015462'		COMPA4		017062'		DDI2		017012'		EM24		021337'	
CKTR2		015464'		COMPA5		017063'		DEC	011000	000000		EM25		021343'	
CKTY3		014134'		CONRES		017326'		DEN		021742'		EM26		021347'	
CKTY3A		014170'		CONS		020752'		DENTAB		016772'		EM3		021246'	
CKTY3B		014145'		CONS1		020756'		DEVCHR		000004	SPD	EM30		021353'	
CKTY3C		014174'		CONS2		020762'		DEVERR		016572'		EM30A		021356'	
CLDSP		024023'	EXT	CONS3		020763'		DEVR1		016532'		EM32		021362'	
CLFIL		020576'		CONSTO		014104'		DEVR1A		016541'		EM33		021365'	
CLRIN	013000	000000		COUT		020666'	EXT	DEVR2		016544'		EM34		021372'	
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 2-2
TAP.MAC	23-MAR-79 11:41		SYMBOL TABLE

EM4		021252'		FHDR9		017457'		GCD	005000	000000		JIFFPS		013374'	INT
EM5		021257'		FI		020116'		GCI	004000	000000		JOBFF		020216'	EXT
EM6		021263'		FII		020114'		GCREDA		020025'		LABBLT		015630'	
EMM1		021232'		FIL		000006	SPD	GDC		016734'		LBRACK		000133	
ENABLE	016000	000000		FILBUF		001135'	INT	GDC1		016743'		LIC		021477'	
ENDUFD		015233'		FILCNT		013376'	INT	GDC2		016745'		LOKDUL		013045'	
ENTTAB		021175'		FILCOD		013716'		GDC3		016757'		LOKLUD		012632'	
EOFFLG		000020	SPD	FILCTD		100000	SPD	GETDUL		021716'		LP		000005	
EOFFND		000002	SPD	FILDI1		013520'	INT	GETFLG		021750'		LPAREN		000050	SPD
EOFRD		020557'		FILDI2		013521'	INT	GETLUD		021725'		LPTFLG		100000	SIN
EOLIT		000000	SPD	FILDI3		013522'	INT	GETPPN	047000	000024		LSTDAT		013342'	
EOT4		020370'		FILDI4		013523'		GETROU		017277'	INT	LSTEXT		013334'	
EOTFLG		000040	SIN	FILDIR		013517'	INT	GETTAB	047000	000041		LSTFIL		013333'	
EOTFND		000001	SPD	FILDM1		013516'		GMFD		014723'		LSTNUM		013344'	
ERB	024000	000000		FILFND		000010	SPD	GMFD1		014732'		LSTPOS		013335'	
ERC		013706'		FILHD1		013267'	SIN	GMFD2		014754'		LSTPPN		013332'	INT
ERCODE		013724'		FILHD2		013270'	SIN	GMFD3		014761'		LSTSER		013343'	
ERO	022000	000000		FILHED		013266'	INT	GMFD4		014771'		LSTTIM		013345'	
EROSW		000004'	EXT	FILIN		015247'		GMFD5		014772'		LSTTRK		013340'	
ERROR	015000	000000		FILIN0		015260'		GMFD6		014775'		LSTUN1		013336'	INT
ERRPPN		021747'		FILIN1		015271'		GTBLOC		021751'		LSTUN2		013337'	INT
ERRSTP		013675'	INT	FILL		015313'		HA		000005	SPD	LSTVER		013341'	INT
ERRTIN		016145'		FILMRK		013515'		HASHER		021646'		LUD		000010	SPD
ERT	023000	000000		FILN		000007	SIN	HB		000006	SPD	LUDBLK		012641'	
ESCDI		013673'	INT	FILPOS		013717'		HC		000007	SPD	LUDBUF		012221'	
ETBRET		015741'		FIND1		016600'		HD		000010	SPD	LUDFLG		000100	SPD
ETIDIR		016160'		FIND2		016611'		HDRDAT		021752'		LUDHED		013274'	
ETIEOF		016164'		FIND3		016612'		HDRFLG		000002	SPD	LUDL		013041'	INT
ETNF		015406'		FINDEV		016577'		HDRFND		002000	SPD	LUDLC		221200	SIN
ETNF1		015403'		FING1		021633'		HDRMSG		001000	SPD	LUDLST		012637'	
ETNF2		015374'		FING2		021632'		HDRP1		020521'		LUDN		000001	SPD
EX		000007		FINGAN		021610'	INT	HDRP2		020527'		LUDTAB		012627'	
EXIT	047000	000012		FINNAM		021572'		HDRP3		020554'		MCHNL1		014023'	
EXTEXT		013727'		FINPPN		021525'		HDRPRI		020507'		MCLOS		014017'	INT
EXTFIL		013726'		FINUN		017451'	EXT	HDRRD		020441'		MF0		013771'	
EXTPPN		013725'		FIRBL2		013304'		HDRSSC		021753'		MF1		013773'	
F		000010		FIRBL3		013305'		HDRTAP		021754'		MF11		013777'	
FAIFLG		400000	SPD	FIRBLK		013302'		HE		000011	SPD	MF13		014001'	
FAKERR		016152'		FIXUFD		020256'		HTDRD		017410'		MF17		014003'	
FCRROU		020467'	INT	FLGOFF		013732'	INT	IC		000000		MF7		013775'	
FF2		015523'	EXT	FLGROU		016335'	INT	ID		021755'		MFD		000004	SPD
FHDR0		017417'		FNDFLG		000004	SPD	IG		000004		MFD2		015015'	
FHDR1		017441'		FRBALC		013530'		IGNFLG		000400	SPD	MFD3		015050'	
FHDR1A		017533'		FRBEST		013527'		ILIC		021503'		MFDARG		013737'	
FHDR2		017546'		FRBNCA		013533'		INIFLG		002000	SIN	MFDBUF		000121'	
FHDR3		017547'		FRBNXT		013532'		INOUT		016061'		MFDDI1		013404'	
FHDR5		017760'		FRBPOS		013531'		IOBAD		740000	SPD	MFDDI3		013406'	
FHDR6		017517'		FRBSIZ		013524'		IOBUF		013736'		MFDDIR		013403'	
FHDR7		017467'		FRBSTS		013536'		IOEND		020000	SPD	MFDEND		015060'	
FHDR7A		017477'		FS6BIT		016060'		IOTEND		002000	SPD	MFDHD1		013261'	
FHDR7B		017511'		FSTFLG		200000	SIN	JBLIC		013766'		MFDHD2		013262'	
FHDR7C		017514'		FSTROU		020465'	INT	JBPPN		013767'		MFDHED		013260'	
FHDR8		017455'		FSTWRD		015337'		JIFFPM		013375'	INT	MFDMON		013743'	
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 2-3
TAP.MAC	23-MAR-79 11:41		SYMBOL TABLE

MFDN		000002	SPD	NXTT1		016411'		QU		000015		RPRTC		021163'	
MFDSPK		013734'		NXTT1A		016415'		QUIROU		016350'	INT	RPRTU		021123'	
MFDTAB		013747'		NXTT2		016436'		R0		000000		RPTCNT		013700'	INT
MGET1		014027'		NXTT3		016440'		R1		000001		RPTFIL		100000	SIN
MGET2		014031'		NXTT4		016455'		R2		000002		RPTFLG		040000	SIN
MIN		014011'		NXTT4A		016456'		R3		000003		RSB		020000	SPD
MINPUT		014013'		NXTT5		016472'		RAN		017112'		RST		000040	SPD
MOMDIS		020053'	EXT	NXTTAP		016377'		RAN1		017125'		RTRINT		020332'	
MOMNEW		020057'	EXT	OFS6		021760'		RAN2		017135'		RTRY		017732'	
MOMTAP		020055'	EXT	OINOUT		021761'		RAN3		017140'		RWNROU		016355'	INT
MOPEN		014021'		OLDBLK		021762'		RAN3A		017142'		SAV2		021771'	
MOPTR		020050'	EXT	OPNMFD		014703'		RAN4		017145'		SAVBUF		013616'	
MORE1		014176'		ORBALC		013711'		RAN5		017151'		SAVBYT		013721'	
MORE2		014200'		ORBSIZ		013712'		RAN5A		017160'		SAVDI4		013723'	
MORE3		014205'		OSCON		000100	SIN	RAN6		017171'		SAVHED		013720'	
MORE4		014223'		OSDSK		000040	SIN	RAN7		017173'		SCDISP		000116'	EXT
MOUT		014005'		OSMSK		000170	SPD	RAN8		017200'		SCOUNT		013701'	INT
MOUTPU		014007'		OSNEW		000010	SIN	RAN9		017203'		SENTAB		016775'	INT
MRELS		014015'		OSTAP		000020	SIN	RANCMD		004000	SIN	SER		021772'	
MRPTR		021123'	EXT	OUNIT		021763'		RANFLG		000010	SPD	SERROU		016723'	
MSET1		014033'		P		000017		RANFST		017106'	EXT	SETB		000107'	
MSET2		014035'		P12FLG		004000	INT	RANGE		017213'	EXT	SETBPI		016653'	INT
MSKCTD		700000	SPD	PCFM		020566'		RANLAS		020366'	EXT	SETBUF		016062'	
MSPTR		024440'	EXT	PCKSUM		021764'		RANO		017201'	EXT	SETC		000117'	
MSTALL		014047'		PFM		020772'		RANSIZ		000000	EXT	SETDEN		016644'	
MSTEOT		014043'		PFM0		021007'		RANZ		017124'	EXT	SETIN		016022'	
MSTERR		014045'		PFM1		021010'		RBER		020020'		SETINT		020327'	
MSTIME		000023	SPD	PFM2		021023'		RBRACK		000135		SETJL		020306'	
MSTOEN		014051'		PFMM		021033'		RCD		040000	SPD	SETLIC	047000	777770	
MSTPDE		014037'		PFMSW		021765'		RCHGBT		020000	SPD	SETN12		017146'	EXT
MSTWRL		014041'		PFN		016167'		RCOUNT		013702'	INT	SETOUT		016024'	
MSYPTR		020052'	EXT	PFNE		021766'		RDDNUM		017014'	EXT	SETST1		020163'	
MTCLS		015666'	INT	PLIC		021463'		RDLINE	003000	000000		SETST2		020246'	
MTWAIT		014053'		PO		000014		RDONUM		017151'	EXT	SETST3		020253'	
MUGETF		014025'		POSITI		021767'		RDUNI		016520'	EXT	SETST4		020211'	
N1		017126'	EXT	POST1		017070'		READL		021507'		SETST5		020175'	
N2		017145'	EXT	POST2		017072'		READTA		017341'		SETST6		020173'	
NDEV		000010	SPD	POST3		017106'		REBTRY		020043'		SETST7		020254'	
NEWFLG		000001	SPD	POSTAP		017064'		RESET		000000	SPD	SETSTR		015725'	
NEWR1A		017144'	EXT	PPN		013705'	INT	RESINT		020326'		SETTP		016037'	
NFLROU		016334'	INT	PPN1		021541'		RESJL		020305'		SETTTY	014000	000000	
NHDAT		015776'		PPN2		021537'		RESROU		017303'	INT	SEXT		013710'	
NOCNT		000020	SPD	PPN3		021532'		REWROU		016353'	INT	SHFTUN		015004'	
NOROOM		017774'		PPNUSR		021511'	INT	REWTAP		016364'		SKI2		016330'	EXT
NOTDMP		015313'		PRAFLG		013731'	INT	REWWAI		016374'	INT	SKICNT		021773'	
NOTWRD		021756'		PRIME		000047		RND		021700'		SKIEO		016320'	
NPRROU		016340'	INT	PRLIC		021440'		RND1		021703'		SKIEOT		016316'	
NU		000002		PRPFLG		200000	SPD	RND2		021714'		SKINI		016322'	
NULSW		021757'		PRROU		016341'	INT	RP		000003		SKITIN		016267'	
NULTAP		015656'		PSW		021770'		RP11		020012'		SKITRL		016302'	
NULUFD		015243'		PTRK		016726'		RPAREN		000051	SPD	SKITRM		016260'	INT
NUPROU		016344'	INT	PU		000016		RPRTA		021146'		SLEEP	047000	000031	
NWFLG		400000	SIN	QCHR		000121		RPRTB		021137'		SP		000013	
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 2-4
TAP.MAC	23-MAR-79 11:41		SYMBOL TABLE

SPACE		000040		TAPSIZ		007237	SPD	TRUNC3		020732'		URBSIZ		013455'	
SPLIT		015401'		TCI	001000	000000		TRUNCA		020702'		URBSTS		013467'	
SPRTU		021122'		TCL	002000	000000		TWHY		020007'		USRCMP		014671'	
SRFIL		000001	SIN	TCO	010000	000000		TYP1		021570'		USRCTD		200000	SPD
SRMSK		000007	SPD	TE		000012		TYP2		021601'		USRGPT		014240'	
SRTOT		000004	SIN	TIND1		016243'		TYP3		021602'		USROVF		014247'	
SRUSR		000002	SIN	TINDIR		016201'		TYPE	012000	000000		USRPPN		021557'	INT
SSCFLG		000200	SPD	TLIC		022002'		U		000015		USRPTR		014241'	
SSKE	020000	000000		TMP		022003'		UCHGBT		200000	SPD	USRSC		000100	SPD
STACK		000000'	EXT	TMP2		022004'		UCOUNT		013703'		USRSRE		014243'	
START		000000'		TMPPPN		014237'		UFD		000005	SPD	USRSRS		014242'	
STAT01		014175'		TMPUSR		014235'		UFD2		015103'		USRTAB		014252'	
STAT02		014175'		TOFCHR		000014		UFD2A		015144'		USRTBE		014552'	
STO23		013676'		TOTBLK		022005'		UFD3		015210'		UTRY		017727'	
STOBPI		016710'	INT	TOTCNT		013377'	INT	UFD4		015211'		VERFLG		020471'	
STODON		015065'		TP0		000012	SPD	UFD5		015212'		VERLOC		000137	
STOFLG		000400	SPD	TP1		000013	SPD	UFD6		015213'		VERPAT		000013	SPD
STOROU		014055'	INT	TPDEN		013612'	INT	UFD7		015214'		VERSIO		000015	SPD
STOSTP		021774'		TPID		016011'		UFDARG		013751'		VERTMP		013770'	
STRBLK		013313'	INT	TPID1		013610'		UFDBL1		013363'		VOWT		020765'	
STRER		021775'		TPID2		013611'		UFDBL2		013364'		W		000016	
STREXT		013312'	INT	TPPOS		013615'		UFDBLK		013362'		WAIT		000010	SPD
STRFIL		013311'	INT	TPROC		015364'		UFDBTS		013764'		WCD	007000	000000	
STRJNK		021776'		TPSER		013613'		UFDBUF		000527'		WCI	006000	000000	
STRPPN		013310'	INT	TPSZM2		013670'		UFDCRE		013763'		WDCNT		013714'	
STRUSR		013314'		TPSZM3		013671'		UFDDI1		013451'		WHERE		017220'	
STRUUO	047000	000050		TPSZM4		013672'		UFDDI2		013452'		WHEROU		017216'	INT
SUCS		410100	SIN	TPTIM		013614'		UFDDI3		013453'		WHY		021165'	
SYNCIN		000040	SPD	TPUN1		013606'		UFDDI4		013454'		WPREP		015752'	
SYSPP		013307'		TPUN2		013607'		UFDDIR		013450'		WRITER		020023'	
SYSSTR	047000	000046		TRBALC		013715'		UFDEND		015225'		WRITL		021510'	
T12FLG		010000	INT	TRBSIZ		013623'		UFDFLG		000040	SPD	X		000024	SPD
TAB	021000	000000		TRCER		020735'		UFDHD1		013264'		XFER1		017346'	
TAPBUF		002762'		TRCERR		020737'		UFDHD2		013265'		XFER2		017350'	
TAPCK		021777'		TRCL		016247'		UFDHED		013263'		XFER2A		017354'	
TAPCNT		013713'		TRIGR		020746'		UFDMON		013755'		XFER2B		017365'	
TAPCON		015425'		TRK		013666'		UFDN		000002	SPD	XFER2C		017374'	
TAPCTD		400000	SPD	TRK1		013667'		UFDTAB		013761'		XFER2D		017367'	
TAPERR		022000'		TRKSW		022006'		UNIROU		000070'		XFER2E		017400'	
TAPHD1		013256'		TRL1		020370'		UNISW		013674'	INT	XFER2F		017406'	
TAPHD2		013257'		TRL2		020377'		UNIT		000012	SPD	XFER3A		020047'	
TAPHED		013255'	INT	TRL3		020402'		UNLROU		016357'	INT	XFER3B		020067'	
TAPIN		016074'		TRL4		020361'		UNLTAP		016362'		XFER3C		017751'	
TAPIN2		016110'		TRL5		020404'		UNMFLG		000100	SPD	XFER3D		020064'	
TAPINE		016077'		TRL6		020421'		UPDFLG		013730'	INT	XFER3E		020063'	
TAPN		000001	SPD	TRL7		020431'		UPDMOD		013707'		XFER3N		020071'	
TAPNUM		022001'		TRLOUT		015625'		UPDROU		016345'	INT	XFER4		020110'	
TAPNWR		015424'		TRLRD		020342'		URBALC		013461'		XFER4A		020150'	
TAPOPN		016057'		TRTF		400100	SIN	URBCSZ		013475'		XFER4C		020127'	
TAPOU1		015360'		TRTFG2		020000	SIN	URBEST		013460'		XFER4D		020143'	
TAPOU3		015662'		TRTFG3		040000	SIN	URBNXT		013463'		XFER4E		020146'	
TAPOUT		015351'		TRTFLG		010000	SIN	URBPOS		013462'		XHDR		000102	SPD
TAPPDE		015422'		TRUNC2		020725'		URBPRD		013464'		XHDRN		000100	SPD
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81 PAGE 2-5
TAP.MAC	23-MAR-79 11:41		SYMBOL TABLE

XLOOKN		000044	SPD	

TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81
TAP.MAC	23-MAR-79 11:41		Symbol cross reference

ABORTA	  1248	  1847%	  1847
AGUFO	  1250#	  1374	  1378	  1390
AL	    73#
ALLFSW	   275	   559#	   971	   994
ALLLST	  1146	  1271#
APPROU	  1771%	  1771
AS	    73#
AT	    73#
BADTAP	  1206	  1230#
BARROW	    26#
BLKCNT	  1011#	  1011	  1133	  1227	  1481	  2477	  2497	  2650	  3141
BLKSIZ	  2615#	  2615	  2623	  2634
BOTBIT	   173#
BOTFLG	   195#	  1565	  1575	  1808	  2445
BPI	   521#	  1824	  2015	  2038
BPI1	   312	   520#	  1825	  1903	  1930	  1950	  2009	  2120
BPICOD	  2092	  2095#
BTL	   176#	  1100
BUFBIN	   168#	   561	   684	   955	  1044	  1581	  2720	  2988	  3032
C1	  3282#	  3282	  3287
C2	  3283#	  3283	  3288
CDISP	   746%	   746	  1224	  1773	  1780	  1785	  1789	  1795	  1800	  1942	  1966	  2310	  2401	  3124
	  3194	  3197
CH	     8#	  1957	  1960	  2228	  2231	  2233	  2259	  2268	  2270	  2288	  2291	  3429	  3430	  3432
	  3434
CHANGD	   452#	  1142	  1315
CHARC	    73#	    73
CKER	  2768	  2798#
CKLIC	  2734	  3659#
CKLICT	   457#	  3661	  3671	  3675	  3676	  3679	  3688	  3694	  3698
CKNCHG	  1036	  1315#
CKNCHR	  1293#	  1302	  1340	  1348
CKNCRE	  1034	  1306#
CKNFIL	  1032	  1322#	  2552
CKNFP	  1322	  1350#	  1350	  3321	  3323
CKNN2	  3515#	  3521	  3549
CKNN3	  3525#	  3546
CKNN3A	  3512	  3523#
CKNN3B	  3531#	  3542
CKNNUL	  2521	  3503#
CKNNX1	  1331#	  1356
CKNNXT	  1341	  1349	  1353#
CKNPPN	   910	  1358#	  2547	  2980
CKNRAN	  2300#	  2532
CKSUM	   519#	   728	   738	   742	  1131	  1162	  2464	  2468	  2596	  3281	  3350
CKTR	  1252	  1253	  1273#
CKTR1	  1281	  1284	  1289#
CKTR2	  1275	  1291#
CKTY3	   688#	   719
CKTY3A	   699	   702	   705	   712	   716#
CKTY3B	   697#	   708
CKTY3C	   693	   720#
CLDSP	   715	   792	   849	  1106%	  1106	  2951
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81
TAP.MAC	23-MAR-79 11:41		Symbol cross reference

CLFIL	  3134	  3293#
CLRTAP	  1595#	  1615	  2213	  2440
CLSUSR	  1109	  1426#
CLTFI1	  3305#	  3345	  3348	  3353	  3360
CLTFI2	  2974	  3311	  3318#	  3376	  3403	  3406	  3408
CLTFI3	  3304	  3343#
CLTFI4	  3356#	  3366
CLTFI5	  3351	  3361#
CLTFI6	  3332	  3337#
CLTFI7	  3365#	  3369
CLTFI8	  3363	  3367#
CLTFI9	  3317	  3373#
CLTFIL	  2513	  3098	  3148	  3273	  3303#
CMPLP	   779#	   948
CMPLP1	   827#	   843
CMPLP2	   805#	   829
CMPLP3	   804	   817#	   826
CMPLP4	   822	   844#
CMPLP5	   834#	   841
CMPLP6	   789	   794#
CNTFC	  1266#
CNTFCR	  1266	  1374#
CNTFD	  1267#
CNTFDR	  1267	  1378#
CNTFN	  1269#
CNTFNR	  1269	  1372#
CNTFP	   678	   717	   924	   932	  1264#	  1328	  1353	  1363	  1385	  2324	  2328	  3454	  3470	  3507
	  3519	  3544
CNTFT	   679	   718	   925	   933	  1268#	  1271	  1329	  1354	  1387	  2325	  2329	  3455	  3471	  3508
	  3520	  3545
CNTFTR	  1268	  1390#
CNTFTT	  1381	  1385#
CNTTAB	  1265#	  1266	  1267	  1268	  1269	  1365
CNVDAT	   272	   276	   446#	  2690	  2692	  2698	  2701	  2703	  2711	  2715	  2718
CNVFMT	   274	   448#	  2697	  2714
CNVTIM	   273	   447#	  2695	  2705	  2706	  2708	  2712
CO	    73#	  2238	  2265
COFHD1	   388#
COFHD2	   389#
COFHED	   387#	   388	   389
COFRLS	   246	  1791%	  1791
COMMA	   117#
COMP2A	  2156	  2160#
COMPA	  1745	  2138#	  2527
COMPA1	  2140	  2144	  2149#
COMPA2	  2152	  2162#
COMPA3	  2166	  2172	  2177#
COMPA4	  2179	  2183	  2187#
COMPA5	  2147	  2159	  2175	  2186	  2188#
CONRES	  2434	  2441#	  3128
CONS	  3422	  3426#
CONS1	  3430#	  3432
CONS2	  3431	  3434#
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81
TAP.MAC	23-MAR-79 11:41		Symbol cross reference

CONS3	  3433	  3435#
CONSTO	   658	   664#	  1496
COUT	   245%	   245	  3362
CPOPJ	   784	  1370	  1728#	  3660
CPOPJ1	   781	   856	   912	   986	  1083	  1135	  1303	  1308	  1313	  1316	  1326	  1334	  1352	  1362
	  1384	  1393	  1647	  1665	  1717	  1727#	  3065	  3071	  3080	  3204	  3216	  3506	  3514	  3518
	  3530	  3533	  3536	  3539	  3763	  3783	  3800
CPOPJ2	  1629	  1661	  1726#
CPPN	   536#	  3804
CRCHR	    23#	   299	  1677	  1836	  3359	  3607	  3702
CREDAT	   449#	  1148	  1307	  1309
CREDSC	   550#	  2850	  2896	  2898
CRETIM	   450#	  1312
CRLS	   641%	   641	  2424
CRTION	   451#	  1022	  1306	  1311
CSTATE	   531#	   672	   921
CT	     9#	   660	  1911	  1914	  1921	  1924	  1928	  1957	  1958	  1960	  2118	  2228	  2229	  2238
	  2240	  2242	  2261	  2263	  2265	  2270	  2288	  2291	  2292
CTABL2	   671	  1145	  1324	  1327	  1360%	  1360	  2320	  2539	  3451	  3504
CTDFLG	   197#	  1643	  1645
CTDMSG	  3188#	  3188	  3238	  3264
CURDAT	   422#	  1702	  2182	  2633	  3228	  3235
CUREXT	   416#	  1073	  1479	  1684	  2955	  3139	  3668
CURFIL	   415#	  1074	  1477	  2127	  2952	  3137	  3666
CURNUM	   424#	  1699	  2628	  3233
CURPOS	   417#	  1004	  1066	  1068	  1177	  1700	  1768	  2165	  2170	  2202	  2311	  2312	  2313	  2529
	  2626	  2639	  3110
CURPPN	   414#	   750	  1076	  1126	  1137	  1155	  1179	  1185	  1219	  1232	  1233	  1242	  1475	  1608
	  1664	  1683	  1719	  1721	  1723	  1764	  2126	  2127	  2141	  2153	  2167	  2180	  2380	  2389
	  2515	  2606	  2700	  2717	  2947	  2950	  3104	  3135	  3663
CURSER	   423#	  1707	  3258	  3260
CURTRK	   420#	  1709	  2139	  2143	  2149	  2154	  3256
CURUN1	   418#	  1080	  1280	  1711
CURUN2	   419#	  1082	  1283	  1713
CURVER	   421#	  1078	  1686	  1697	  3250
CUTFLG	   206#	   651	  1503	  1568	  2248	  2336	  2414	  2422	  2555	  2564	  3159
CUTPPN	   440#	   441	  2380	  2389
CUTROU	  2319#
CUTS	   191#	  1566	  2340	  2402
CUTT0	  2323#	  2331
CUTT2	  2339#	  2556
CUTT5	  2380#
CUTT5A	  2382#	  2385
CUTT6	  2383	  2384	  2387#
CUTTIM	   441#	  2381
DA	    73#	  2240	  2261
DATE	   143#
DATTIM	   425#	  1687	  1703	  1705	  2178	  2390
DAYTIM	   294#	   294	  1062	  1405	  1515	  1527	  1532
DCDONE	  2688	  2720#	  2825	  2829
DDI	   325	  1943	  2103#
DDI1	  2106#	  2114
DDI2	  2108	  2114#
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81
TAP.MAC	23-MAR-79 11:41		Symbol cross reference

DEN	  1996	  2031#	  2031
DENTAB	  2008	  2083	  2087	  2093	  2096#	  2106
DEVCHR	   140#
DEVERR	  1906	  1962#
DEVR1	  1915	  1926#
DEVR1A	  1933#	  1951
DEVR2	  1932	  1936#	  1955
DEVR2A	  1935	  1937#	  1944
DEVR3	  1938	  1943#
DEVR4	  1912	  1945#
DEVR4A	  1948#	  1956
DEVR4B	  1922	  1954#
DEVR5	  1913	  1923	  1957#
DEVROU	  1900#
DEVTBL	   250	   251	   252	   253	  1973	  1991#
DEVTX	  1984#	  1984	  2037
DGAN	  3583#	  3583	  3589
DIRBLT	   729	  1463#
DIRENT	  2337	  2416	  2423#
DIRFLG	   202#	   651	  2335	  2415	  2422	  2471	  2571	  2587	  2597	  2666	  2970	  3149	  3159	  3293
	  3310	  3327	  3352	  3361	  3367	  3564	  3576
DIRROU	  2413#
DIRSSC	  1813#	  1813	  2450	  3172	  3231
DLL	   177#	  2813	  2856	  3294	  3339
DNC	   178#	   711	   915	   990	  1114	  1170	  1490	  1492	  2813	  2856	  3049	  3051	  3089	  3294
	  3339	  3341
DOTCHR	    21#
DSKSIZ	   165#	   332	   333	   334	   336	   337
DUL	   151#	  3748	  3749	  3750	  3876	  3878
DULBLK	   364	   366#	  3755	  3757	  3758	  3760	  3761	  3762
DULBUF	   337#
DULFLG	   200#	  3730	  3732	  3881
DULHED	   392#
DULL	   367#	  3746	  3752	  3880
DULLST	   364#	  3749
DULN	   161#	   337
DULTAB	   354#	  3876
DUUN	  3582#	  3582	  3591
DVMTA	   169#	  1557
DWHY	  2839	  3405	  3645#
ECHR	  2259%	  2259	  2268
EM0	  3613	  3619#
EM1	  3613	  3620#
EM14	  3615	  3626#
EM15	  3615	  3627#
EM16	  3615	  3628#
EM17	  3615	  3629#
EM2	  3613	  3621#
EM20	  3615	  3630#
EM21	  3615	  3631#
EM22	  3615	  3632#
EM23	  3615	  3633#
EM24	  3616	  3634#
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81
TAP.MAC	23-MAR-79 11:41		Symbol cross reference

EM25	  3616	  3635#
EM26	  3616	  3636#
EM3	  3613	  3622#
EM30	  3613	  3614	  3616	  3617	  3637#
EM30A	  3616	  3638#
EM32	  3617	  3639#
EM33	  3617	  3640#
EM34	  3617	  3641#
EM4	  3613	  3623#
EM5	  3613	  3624#
EM6	  3613	  3625#
EMM1	  3612	  3618#
ENDUFD	  1099	  1104#
ENTTAB	  3604	  3613#
EOFFLG	   216#	  1616	  1618	  1621	  1733	  1811	  2206	  2444
EOFFND	   194#	  1013	  1166	  1211
EOFRD	  2456	  3270#
EOLIT	    25#
EOT4	  2522	  2528	  2531	  2586	  3116#
EOTFLG	   217#	  1003	  1399	  1507	  1617	  1734	  1762	  1811	  2206	  2433	  2444	  3119	  3270
EOTFND	   193#	  1209	  1220	  1222	  1504	  1565	  1577	  1625	  1807	  2397
ERC	   538#	   667	  1213	  2442
ERCODE	   552#	  1094	  2801	  2930	  3413	  3603
EROSW	   247%	   247
ERRPPN	  1609#	  1609	  1672	  1675	  1715
ERRSTP	   303	   529#	  1835	  1908
ERRTIN	  1614	  1651#
ESCDI	   527#	  1826	  1881	  1905
ETBRET	  1221	  1488#
ETIDIR	  1659	  1662#
ETIEOF	  1658	  1666#
ETNF	  1212	  1225#
ETNF1	  1222#	  1226
ETNF2	  1215#	  1228
EX	    73#
EXTEXT	   555#	  3669
EXTFIL	   554#	  3667
EXTPPN	   553#	  3665	  3680	  3683
F	    12#	   249	   263	   266	   277	   279	   642	   644	   647	   651	   652	   722	   744	   977
	   995	  1003	  1013	  1014	  1058	  1064	  1107	  1120	  1140	  1166	  1209	  1211	  1220	  1222
	  1243	  1399	  1415	  1503	  1504	  1507	  1523	  1565	  1568	  1575	  1577	  1616	  1617	  1618
	  1621	  1625	  1643	  1645	  1685	  1695	  1696	  1733	  1734	  1743	  1762	  1765	  1767	  1772
	  1799	  1807	  1808	  1811	  1812	  2196	  2198	  2206	  2217	  2222	  2247	  2248	  2335	  2336
	  2397	  2414	  2415	  2422	  2425	  2426	  2433	  2444	  2445	  2446	  2447	  2448	  2461	  2471
	  2484	  2507	  2512	  2524	  2541	  2555	  2563	  2564	  2566	  2570	  2571	  2575	  2582	  2583
	  2587	  2590	  2597	  2610	  2618	  2638	  2656	  2666	  2685	  2687	  2785	  2824	  2882	  2970
	  2972	  2976	  3088	  3097	  3119	  3133	  3147	  3149	  3159	  3164	  3189	  3190	  3193	  3196
	  3201	  3202	  3203	  3207	  3208	  3212	  3213	  3215	  3221	  3223	  3224	  3240	  3244	  3263
	  3270	  3272	  3293	  3295	  3310	  3326	  3327	  3346	  3352	  3361	  3367	  3555	  3564	  3574
	  3576	  3730	  3732	  3775	  3777	  3810	  3812	  3881	  3889
FAIFLG	   210#	  3193	  3196	  3201
FAKERR	  1649	  1656#
FCRROU	  3196#
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81
TAP.MAC	23-MAR-79 11:41		Symbol cross reference

FF2	  1325%	  1325
FHDR0	  2508	  2512#
FHDR1	  2535#	  2584	  2589
FHDR1A	  2603	  2610#
FHDR2	  2619	  2626#
FHDR3	  2598	  2625	  2637#
FHDR5	  2667	  2790#
FHDR6	  2557	  2595#
FHDR7	  2525	  2563#
FHDR7A	  2575#	  2593
FHDR7B	  2576	  2587#
FHDR7C	  2569	  2590#
FHDR8	  2542	  2547#
FHDR9	  2546	  2549#
FI	  2816	  2917#
FII	  2854	  2915#
FIL	    17#	   684	   709	   711	   714	   720	  1044	  1050	  1051	  1134	  1136	  1154	  1170	  1171
	  1189	  1492	  1493	  2476	  2720	  2726	  2767	  2813	  2814	  2843	  2856	  2881	  2913	  3294
	  3339	  3341	  3374	  3388	  3390	  3392	  3395	  3396	  3402	  3645
FILBUF	   334#	  1048	  2724
FILCNT	   455#	   656	   751	  1172	  2430	  3318	  3561	  3567	  3568	  3579	  3586	  3597
FILCOD	   546#	  3645	  3646
FILCTD	   134#	   137	  1412	  3094	  3186
FILDI1	   492#	   683	   713	  1043	  1052	  2478	  2730	  2733	  2742	  2752	  2806	  2818	  2833	  2864
	  2874	  2877	  2887	  2941	  2966	  3336	  3344	  3347	  3364	  3368	  3404	  3414	  3462	  3494
	  3578	  3581	  3584
FILDI2	   493#	   695	  1040	  2969	  3488
FILDI3	   494#	   696	  1041	  2691	  2704	  2710	  2719	  2747	  2777	  2799	  2827	  2848	  2894	  2924
	  2928	  2967	  3411	  3490
FILDI4	   495#	  2689	  2693	  2702	  2709	  2828	  2845	  2892	  2901
FILDIR	   491#	   668	   709	  1039	  1051	  1154	  2664	  2669	  2744	  2767	  2790	  2814	  2843	  2858
	  2859	  2913	  2918	  2919	  2938	  2939	  3374	  3388	  3390	  3392
FILDM1	   490#	   506	  1519
FILFND	   196#	   977	  1064	  1107
FILHD1	   384#	   736	  2481	  3386	  3400
FILHD2	   385#	   730	  2473	  2492	  2496	  2651
FILHED	   383#	   384	   385	  1046	  2722	  3384
FILIN	   732	  1120#
FILIN0	  1125	  1129#
FILIN1	  1128	  1138#
FILL	  1158#	  1165
FILMRK	   489#	  1463
FILN	   159#	   334	  1050	  2726
FILPOS	   547#	  3383	  3394
FIND1	  1974#	  1981
FIND2	  1976	  1983#
FIND3	  1978	  1984#
FINDEV	   313	  1867	  1931	  1946	  1954	  1973#
FING1	  3823#	  3833
FING2	  3816	  3822#
FINGAN	   682	   920	  3461	  3804#
FINNAM	  3780	  3790#
FINPPN	  3736	  3743#
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81
TAP.MAC	23-MAR-79 11:41		Symbol cross reference

FINUN	  2543%	  2543
FIRBL2	   397#	  1398	  1512	  1634	  1635	  3176
FIRBL3	   399#	  1413	  1637	  1766	  3178
FIRBLK	   395#	  1416	  1417
FIXUFD	  3017	  3031#
FLGOFF	   558#	  1779	  2736	  2738
FLGROU	  1778#
FNDFLG	   214#	  2198	  2217	  2444	  2570	  3164
FRBALC	   499#	  2677	  2678	  2679	  2680	  2765	  2804	  2921	  3316	  3373	  3382
FRBEST	   498#	  2681	  2766	  2922
FRBNCA	   502#	  1151	  1153	  2737	  2739	  3659	  3682
FRBNXT	   501#	  2673
FRBPOS	   500#	  2672	  2761	  2834
FRBSIZ	   496#	  2674	  2915
FRBSTS	   505#	  1054	  2740
FS6BIT	   305	  1582#	  1827	  1859	  1886	  1909	  1917	  1963	  1975	  2045	  2051
FSTFLG	   230#
FSTROU	  3193#
FSTWRD	  1130	  1182#	  2773
GCREDA	  2757	  2843#
GDC	   308	  1863	  1920	  2068#
GDC1	  2075#	  2078
GDC2	  2077#	  2094
GDC3	  2076	  2089#
GETDUL	   254	  3731	  3876#
GETFLG	  2423#	  2423	  2729	  3662
GETLUD	  3776	  3811	  3884#
GETROU	  2417#
GMFD	   821	   888#	   896	   900	   909	   911
GMFD1	   895#	   929	   936
GMFD2	   889	   913#
GMFD3	   914	   918#
GMFD4	   926#
GMFD5	   927#	   934
GMFD6	   923	   930#
GTBLOC	  2427	  3572#	  3572
HA	   108#	   109	   110	   111	   112	  3835	  3859	  3863	  3873
HASHER	  3779	  3835#
HB	   109#	  3836	  3840	  3858	  3864	  3866	  3867	  3868	  3871
HC	   110#	  3837	  3841	  3853	  3857	  3864	  3872
HD	   111#	  3838	  3842	  3848	  3856	  3861	  3866	  3869
HDRDAT	  3179#	  3179	  3236	  3243
HDRFLG	   213#
HDRFND	   224#	  1733	  1811	  2206	  2444	  2575	  2582	  3088	  3190	  3224
HDRMSG	   223#	  1733	  1811	  2206	  2444	  2582	  3088	  3189	  3221
HDRP1	  3230	  3233#
HDRP2	  3225	  3239#
HDRP3	  3245	  3263#
HDRPRI	  2588	  2601	  3221#
HDRRD	  2505	  3170#
HDRSSC	  3175#	  3175	  3232	  3241
HDRTAP	  3177#	  3177	  3234	  3242
HE	   112#	  3839	  3843	  3848	  3849	  3852	  3855	  3870	  3872
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81
TAP.MAC	23-MAR-79 11:41		Symbol cross reference

HTDRD	  2457	  2503#
IC	    73#
ID	   297	   298	  3249#	  3249	  3254
IG	    73#
IGNFLG	   221#	  2447	  2461	  2512	  2785	  2882	  3097	  3133	  3147	  3272	  3295	  3326
ILIC	  3696	  3700	  3717#
INIFLG	   203#	   647	  1772	  2448
INOUT	  1453	  1552	  1583#	  1830
IOBAD	   175#	   988	  1098	  1136
IOBUF	   563#	   870
IOEND	   172#	   635	   636
IOTEND	   174#	   629	   630	  1624
JBLIC	   258#	   258	  2417	  2982	  3670
JBPPN	   271#	   271	  3674
JIFFPM	   285	   454#	  1531	  2694	  2707
JIFFPS	   283	   453#
JOBFF	   874%	   874	   960	  1049	  2725	  2993
LABBLT	  1063	  1405#
LBRACK	   118#
LIC	  3685	  3716#
LOKDUL	   358#	  3878
LOKLUD	   343#	  3886
LP	    73#
LPAREN	    19#
LPTFLG	   229#
LSTDAT	   435#	  2181	  3229
LSTEXT	   429#
LSTFIL	   428#
LSTNUM	   437#
LSTPOS	   430#	  2162	  2164	  2168
LSTPPN	   427#	  1218	  1714	  1721	  2516	  2517	  3481	  3596
LSTSER	   436#
LSTTIM	   438#	  1722	  2128	  2177
LSTTRK	   433#	  2138	  2142
LSTUN1	   431#	  3476
LSTUN2	   432#	  3478
LSTVER	   434#	  3480
LUD	   150#	  3792	  3793	  3794	  3817	  3818	  3819	  3884	  3886
LUDBLK	   349	   351#	  3782	  3788	  3799	  3801	  3823	  3829
LUDBUF	   336#
LUDFLG	   199#	  3775	  3777	  3810	  3812	  3889
LUDHED	   391#
LUDL	   352#	  3790	  3796	  3815	  3821	  3888
LUDLC	  1263#	  3814
LUDLST	   349#	  3793	  3818
LUDN	   160#	   336
LUDTAB	   339#	  3884
MCHNL1	   613#	  1555
MCLOS	   609#	  1437	  1559	  1595
MF0	   587#	   999	  1001	  1510	  1761	  1818	  2212	  2388	  2439	  3275
MF1	   589#	  1806
MF11	   593#	  1803	  1856
MF13	   595#	  1509
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81
TAP.MAC	23-MAR-79 11:41		Symbol cross reference

MF17	   597#	  1760	  2209	  2210	  2211	  2437	  2438
MF7	   591#	  1000	  2387	  3274
MFD	   147#	   871	   875	   881	   890	   915	   916	   988	   990	   991	  1490	  1491	  3032	  3046
	  3048	  3049	  3050
MFD2	   723	   948#	   970	   976	   982	  1223
MFD3	   972	   977#
MFDARG	   566#	   891
MFDBUF	   332#	   873
MFDDI1	   462#	   880
MFDDI3	   464#	   877
MFDDIR	   461#	   466	   878	   881
MFDEND	   892	   988#
MFDHD1	   376#
MFDHD2	   377#
MFDHED	   375#	   376	   377	   869	  3034
MFDMON	   570#	   883
MFDN	   157#	   332	   875
MFDSPK	   561#	   871
MFDTAB	   566	   571#	   893	   894
MGET1	   617#	  1439	  1567	  1596	  1651
MGET2	   619#	  1244	  1995
MIN	   603#	  1611
MINPUT	   605#	  1458
MOMDIS	  2868%	  2868
MOMNEW	  2756%	  2756	  2872%	  2872
MOMTAP	  2870%	  2870
MOPEN	   611#	  1553
MOPTR	  2753%	  2753	  2865%	  2865
MORE1	   723#	   726
MORE2	   725#	   733
MORE3	   730#	   743
MORE4	   724	   744#
MOUT	   599#	  1203
MOUTPU	   601#	  1456	  1501
MRELS	   607#	  1560	  1918
MRPTR	  3329%	  3329	  3554%	  3554
MSET1	   621#	  1449	  1570	  1598	  1655	  2000
MSET2	   623#	  1246
MSKCTD	   137#	  1406
MSPTR	  1174%	  1174	  3553
MSTALL	   633#
MSTEOT	   629#	  1207
MSTERR	   631#	  1205
MSTIME	   144#
MSTOEN	   635#	  1613
MSTPDE	   625#	  1234
MSTWRL	   627#	  1230
MSYPTR	  2755%	  2755	  2867%	  2867
MTCLS	  1426	  1437#
MTWAIT	   637#	  1438	  2208
MUGETF	   615#	  1572
N1	  2237%	  2237
N2	  2244%	  2244	  2252
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81
TAP.MAC	23-MAR-79 11:41		Symbol cross reference

NDEV	   122#	   253	  1973	  1991
NEWFLG	   212#	  1685	  1695	  1743	  1765	  1767	  2484	  2507	  2524	  2618	  2638	  2656	  2972	  3203
	  3208	  3213	  3215	  3223	  3244	  3346
NEWR1A	  2251%	  2251
NFLROU	  1777#
NHDAT	   286	  1513	  1523#
NOCNT	   170#	  1581
NOROOM	  2806#	  2811	  2815
NOTDMP	  1123	  1143	  1149	  1152	  1156#
NOTWRD	  1358#	  1358	  1369	  1372
NPRROU	  1782#
NU	    73#	  1914	  1924
NULSW	  2449#	  2449	  3510	  3523	  3548
NULTAP	  1113	  1198	  1427#
NULUFD	  1108	  1113#
NUPROU	  1786#
NWFLG	   231#	  1799
NXTT1	  1833#	  1854	  1890
NXTT1A	  1837#	  1857
NXTT2	  1842	  1844	  1856#
NXTT3	  1849	  1859#
NXTT4	  1868	  1872#
NXTT4A	  1871	  1873#
NXTT5	  1833	  1885#
NXTTAP	  1494	  1823#	  3127
OFS6	  1828	  1885	  1910#	  1910	  1962
OINOUT	  1831#	  1831	  1875
OLDBLK	  1122	  1138	  1187#	  1187	  1482	  2608	  2616	  2775	  2780	  3126	  3142	  3305	  3309
OPNMFD	   803	   869#
ORBALC	   541#	  2805	  2812
ORBSIZ	   542#	  2653	  2916	  3312
OSCON	   240#	   241
OSDSK	   239#	   241
OSMSK	   241#
OSNEW	   237#	   241
OSTAP	   238#	   241
OUNIT	  1829	  1887#	  1887
P	    15#	   243	   246	   254	   286	   295	   303	   304	   306	   308	   309	   313	   315	   325
	   641	   650	   659	   682	   723	   725	   729	   732	   735	   790	   793	   803	   821	   825
	   836	   862	   863	   866	   867	   884	   899	   901	   908	   910	   917	   920	   946	   948
	   980	   992	  1002	  1007	  1032	  1034	  1036	  1060	  1063	  1065	  1095	  1103	  1109	  1110
	  1111	  1113	  1116	  1130	  1159	  1169	  1180	  1182	  1183	  1190	  1191	  1192	  1215	  1223
	  1225	  1252	  1253	  1288	  1290	  1292	  1300	  1310	  1314	  1319	  1320	  1340	  1348	  1355
	  1365	  1373	  1376	  1377	  1388	  1389	  1425	  1426	  1434	  1441	  1457	  1459	  1473	  1485
	  1486	  1488	  1489	  1494	  1495	  1500	  1502	  1513	  1520	  1521	  1533	  1545	  1564	  1578
	  1579	  1590	  1599	  1615	  1619	  1657	  1660	  1662	  1666	  1668	  1678	  1680	  1720	  1724
	  1726	  1727	  1728	  1732	  1736	  1737	  1745	  1748	  1750	  1756	  1791	  1794	  1796	  1798
	  1810	  1814	  1817	  1819	  1823	  1835	  1838	  1861	  1863	  1867	  1872	  1873	  1882	  1884
	  1889	  1908	  1913	  1916	  1919	  1920	  1923	  1926	  1931	  1936	  1937	  1943	  1946	  1954
	  1959	  1965	  1983	  1985	  2001	  2012	  2027	  2032	  2034	  2035	  2047	  2053	  2062	  2088
	  2116	  2121	  2129	  2187	  2188	  2197	  2200	  2201	  2207	  2213	  2214	  2216	  2235	  2236
	  2245	  2249	  2253	  2256	  2289	  2294	  2304	  2305	  2309	  2315	  2382	  2396	  2399	  2424
	  2436	  2440	  2443	  2451	  2455	  2509	  2513	  2519	  2521	  2527	  2532	  2543	  2547	  2552
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81
TAP.MAC	23-MAR-79 11:41		Symbol cross reference

	  2585	  2588	  2601	  2604	  2734	  2760	  2762	  2773	  2816	  2819	  2839	  2854	  2912	  2925	  2940
	  2942	  2961	  2974	  2980	  2986	  3011	  3013	  3018	  3021	  3024	  3064	  3084	  3098	  3117
	  3122	  3127	  3130	  3134	  3144	  3148	  3153	  3170	  3210	  3222	  3265	  3273	  3289	  3296
	  3328	  3340	  3342	  3357	  3358	  3375	  3405	  3407	  3415	  3416	  3422	  3436	  3453	  3461
	  3465	  3468	  3473	  3495	  3522	  3562	  3573	  3608	  3655	  3691	  3697	  3701	  3703	  3706
	  3715	  3731	  3733	  3734	  3735	  3736	  3738	  3739	  3740	  3741	  3756	  3768	  3776	  3778
	  3779	  3780	  3781	  3789	  3809	  3811	  3828	  3835	  3836	  3837	  3838	  3839	  3844	  3845
	  3846	  3847	  3855	  3856	  3857	  3858	  3859	  3860	  3874	  3879	  3882	  3887	  3890
P12FLG	   204#	   277	   279	  1415	  2685
PCFM	  1485	  3144	  3280#
PCKSUM	  1132#	  1132	  2475	  2494	  3280
PFM	  3122	  3449#
PFM0	  3462#	  3483
PFM1	  3463#	  3472
PFM2	  3460	  3475#
PFMM	  3468	  3487#
PFMSW	  3449#	  3449	  3491
PFN	  1660	  1662	  1666	  1669#
PFNE	  1674#	  1674	  1676
PLIC	  3691	  3697	  3701	  3704#
PO	    73#
POSITI	  2640#	  2640	  3333	  3334
POST1	  2200#	  2218
POST2	  2199	  2202#
POST3	  2204	  2215#
POSTAP	  2196#	  2509
PPN	   537#	  1286	  2535	  2545	  2731	  2732
PPN1	  3755#	  3767
PPN2	  3747	  3753#
PPN3	  3748#	  3759
PPNUSR	   790	   899	   980	  2986	  3730#
PRAFLG	   557#	  1784	  2763	  3337
PRIME	   116#
PRLIC	  3681	  3685#
PRPFLG	   209#	   722	   995	  1058	  1064
PRROU	  1783#
PSW	  1900#	  1900	  1939	  1948
PTRK	   309	  1872	  1936	  2057#
PU	    73#
QCHR	   115#
QU	    73#
QUIROU	  1791#
R0	     4#	   296	   662	   663	   739	   740	   741	   782	   784	   789	   794	   858	   859	   861
	   864	   865	   898	   902	   939	   941	   943	   944	   979	  1163	  1276	  1279	  1282	  1285
	  1287	  1289	  1364	  1375	  1380	  1382	  1383	  1386	  1391	  1517	  1518	  1537	  1538	  1539
	  1541	  1542	  1543	  1608	  1609	  1610	  1656	  1669	  1670	  1730	  1839	  1840	  1841	  1843
	  1845	  1846	  1848	  1859	  1869	  1876	  1927	  1933	  1949	  1974	  1975	  1977	  2059	  2060
	  2069	  2071	  2092	  2093	  2117	  2257	  2260	  2267	  2301	  2303	  2464	  2468	  2488	  2489
	  2490	  2637	  2985	  3237	  3247	  3248	  3251	  3253	  3254	  3282	  3283	  3320	  3322	  3424
	  3425	  3428	  3430	  3434	  3435	  3475	  3477	  3479	  3524	  3547	  3689	  3707	  3709	  3710
	  3713	  3717	  3743	  3744	  3754	  3760	  3764	  3782	  3799	  3805	  3806	  3808	  3823	  3824
	  3825	  3827	  3829	  3830	  3832	  3849	  3850	  3851	  3852	  3853	  3861	  3862
R1	     5#	   251	   252	   255	   256	   257	   258	   259	   260	   261	   264	   265	   267	   268
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81
TAP.MAC	23-MAR-79 11:41		Symbol cross reference

	   269	   270	   271	   276	   278	   280	   281	   282	   283	   284	   285	   288	   289	   291	   301
	   302	   310	   311	   613	   614	   617	   618	   621	   622	   653	   658	   666	   667	   668
	   670	   671	   672	   673	   675	   676	   678	   680	   681	   690	   691	   716	   717	   719
	   736	   737	   740	   779	   780	   785	   786	   787	   788	   795	   797	   798	   799	   800
	   801	   802	   805	   806	   807	   809	   810	   811	   812	   813	   814	   815	   816	   817
	   818	   819	   820	   823	   827	   828	   829	   830	   831	   832	   834	   839	   840	   842
	   844	   846	   847	   850	   851	   852	   853	   854	   855	   858	   864	   869	   870	   873
	   874	   876	   877	   878	   879	   880	   888	   890	   891	   903	   904	   913	   919	   924
	   927	   928	   932	   945	   950	   951	   952	   953	   959	   960	   962	   963	   964	   965
	   973	   974	   984	  1016	  1017	  1021	  1022	  1025	  1026	  1027	  1030	  1038	  1039	  1042
	  1043	  1048	  1049	  1054	  1055	  1068	  1069	  1071	  1072	  1075	  1076	  1077	  1078	  1139
	  1141	  1144	  1145	  1146	  1147	  1148	  1149	  1150	  1151	  1153	  1174	  1175	  1176	  1182
	  1186	  1187	  1189	  1191	  1199	  1200	  1202	  1273	  1306	  1307	  1309	  1311	  1312	  1317
	  1318	  1323	  1324	  1327	  1328	  1330	  1331	  1332	  1341	  1342	  1349	  1350	  1353	  1356
	  1359	  1360	  1361	  1362	  1363	  1364	  1366	  1379	  1382	  1385	  1397	  1398	  1405	  1406
	  1408	  1410	  1412	  1413	  1414	  1416	  1417	  1418	  1419	  1420	  1422	  1423	  1427	  1428
	  1429	  1430	  1431	  1432	  1433	  1440	  1442	  1444	  1446	  1448	  1450	  1451	  1452	  1453
	  1454	  1463	  1464	  1465	  1466	  1468	  1472	  1475	  1476	  1477	  1478	  1479	  1480	  1481
	  1482	  1483	  1511	  1512	  1524	  1525	  1526	  1527	  1528	  1529	  1530	  1531	  1532	  1549
	  1551	  1552	  1556	  1557	  1562	  1563	  1569	  1573	  1574	  1576	  1586	  1588	  1589	  1597
	  1622	  1623	  1624	  1630	  1633	  1634	  1636	  1637	  1638	  1639	  1642	  1644	  1646	  1652
	  1654	  1663	  1681	  1682	  1688	  1691	  1698	  1701	  1706	  1708	  1710	  1712	  1714	  1715
	  1716	  1721	  1722	  1739	  1777	  1778	  1779	  1782	  1783	  1784	  1786	  1787	  1788	  1833
	  1834	  1869	  1933	  1949	  1973	  1974	  1979	  1980	  1981	  1984	  1996	  1997	  1998	  1999
	  2008	  2009	  2015	  2017	  2019	  2038	  2039	  2040	  2041	  2042	  2043	  2044	  2045	  2046
	  2068	  2070	  2075	  2077	  2083	  2084	  2085	  2087	  2106	  2107	  2111	  2112	  2127	  2128
	  2138	  2139	  2149	  2151	  2162	  2163	  2165	  2177	  2178	  2202	  2203	  2215	  2300	  2303
	  2319	  2320	  2322	  2324	  2326	  2327	  2328	  2329	  2334	  2380	  2381	  2389	  2390	  2413
	  2417	  2418	  2420	  2421	  2423	  2441	  2442	  2470	  2481	  2485	  2489	  2503	  2515	  2517
	  2529	  2530	  2538	  2539	  2540	  2607	  2608	  2613	  2614	  2615	  2617	  2643	  2645	  2655
	  2657	  2658	  2659	  2660	  2663	  2664	  2669	  2670	  2671	  2674	  2675	  2676	  2677	  2678
	  2679	  2681	  2682	  2684	  2689	  2690	  2691	  2692	  2693	  2694	  2695	  2696	  2697	  2698
	  2699	  2701	  2702	  2703	  2704	  2705	  2707	  2709	  2710	  2711	  2712	  2713	  2714	  2715
	  2716	  2718	  2719	  2724	  2725	  2727	  2730	  2732	  2733	  2735	  2737	  2739	  2740	  2741
	  2744	  2745	  2746	  2747	  2748	  2752	  2754	  2774	  2777	  2778	  2780	  2781	  2782	  2783
	  2784	  2790	  2791	  2792	  2798	  2799	  2800	  2801	  2802	  2804	  2805	  2812	  2826	  2827
	  2828	  2845	  2846	  2847	  2848	  2849	  2850	  2857	  2858	  2859	  2864	  2866	  2892	  2893
	  2894	  2895	  2896	  2898	  2900	  2902	  2904	  2915	  2916	  2917	  2918	  2919	  2920	  2921
	  2923	  2924	  2927	  2928	  2929	  2930	  2932	  2937	  2938	  2939	  2947	  2948	  2952	  2953
	  2955	  2956	  2967	  2968	  2969	  2982	  2983	  2992	  2993	  2995	  2996	  2998	  2999	  3001
	  3005	  3036	  3037	  3038	  3039	  3040	  3057	  3058	  3060	  3062	  3063	  3066	  3067	  3068
	  3069	  3073	  3074	  3075	  3077	  3078	  3081	  3082	  3092	  3094	  3100	  3101	  3107	  3108
	  3110	  3111	  3135	  3136	  3137	  3138	  3139	  3140	  3141	  3142	  3143	  3162	  3163	  3172
	  3175	  3176	  3177	  3178	  3179	  3180	  3182	  3184	  3186	  3206	  3209	  3211	  3214	  3228
	  3229	  3231	  3232	  3250	  3252	  3259	  3303	  3305	  3306	  3307	  3308	  3312	  3321	  3322
	  3329	  3330	  3331	  3343	  3349	  3350	  3356	  3380	  3381	  3382	  3383	  3384	  3385	  3386
	  3387	  3394	  3395	  3399	  3400	  3401	  3402	  3410	  3411	  3412	  3413	  3423	  3427	  3450
	  3451	  3452	  3454	  3456	  3457	  3458	  3463	  3466	  3469	  3470	  3472	  3487	  3489	  3503
	  3504	  3505	  3507	  3509	  3515	  3516	  3519	  3521	  3524	  3527	  3528	  3543	  3544	  3546
	  3547	  3553	  3554	  3563	  3565	  3567	  3569	  3570	  3572	  3581	  3582	  3583	  3584	  3585
	  3602	  3603	  3604	  3605	  3646	  3647	  3649	  3651	  3653	  3659	  3660	  3661	  3663	  3664
	  3665	  3666	  3667	  3668	  3669	  3670	  3671	  3673	  3674	  3675	  3676	  3677	  3678	  3679
	  3682	  3694	  3696	  3698	  3700	  3745	  3746	  3748	  3752	  3757	  3761	  3788	  3790	  3792
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81
TAP.MAC	23-MAR-79 11:41		Symbol cross reference

	  3796	  3798	  3801	  3802	  3814	  3854
R2	     6#	   619	   620	   623	   624	   678	   679	   691	   692	   694	   695	   697	   698	   700
	   701	   703	   704	   706	   717	   718	   808	   809	   811	   812	   824	   833	   859	   861
	   865	   905	   921	   922	   924	   925	   930	   932	   933	   938	   940	   942	   943	  1160
	  1161	  1164	  1183	  1190	  1196	  1197	  1198	  1200	  1201	  1202	  1245	  1250	  1251	  1273
	  1274	  1276	  1279	  1282	  1285	  1287	  1289	  1291	  1293	  1294	  1296	  1297	  1301	  1324
	  1325	  1328	  1329	  1331	  1334	  1338	  1345	  1347	  1353	  1354	  1363	  1365	  1367	  1368
	  1369	  1370	  1375	  1380	  1383	  1385	  1387	  1391	  1392	  1419	  1420	  1421	  1465	  1466
	  1467	  1626	  1628	  1629	  1631	  1640	  1647	  1672	  1673	  1674	  1682	  1683	  1684	  1688
	  1689	  1691	  1692	  1693	  1697	  1698	  1699	  1700	  1701	  1702	  1703	  1704	  1705	  1706
	  1707	  1708	  1709	  1710	  1711	  1712	  1713	  1731	  1769	  1770	  1771	  1997	  1999	  2007
	  2008	  2011	  2028	  2029	  2030	  2031	  2037	  2041	  2044	  2046	  2073	  2078	  2092	  2104
	  2106	  2114	  2302	  2324	  2325	  2327	  2330	  2495	  2496	  2536	  2537	  2549	  2550	  2551
	  2641	  2642	  2643	  2662	  2663	  2706	  2708	  2753	  2755	  2756	  2791	  2865	  2867	  2868
	  2870	  2872	  2901	  2903	  2904	  2968	  2979	  3002	  3003	  3004	  3005	  3006	  3007	  3008
	  3010	  3031	  3037	  3055	  3056	  3061	  3065	  3076	  3083	  3091	  3092	  3099	  3100	  3106
	  3107	  3161	  3162	  3180	  3181	  3183	  3185	  3187	  3188	  3205	  3206	  3424	  3428	  3454
	  3455	  3458	  3459	  3463	  3464	  3466	  3467	  3470	  3471	  3487	  3488	  3489	  3490	  3507
	  3508	  3510	  3511	  3513	  3516	  3517	  3519	  3520	  3528	  3529	  3531	  3532	  3534	  3535
	  3537	  3538	  3540	  3544	  3545	  3672	  3673	  3688	  3690	  3692	  3734	  3740	  3753	  3755
	  3757	  3758	  3760	  3761	  3762	  3765	  3766	  3782	  3788	  3797	  3799	  3801	  3802	  3814
	  3815	  3817	  3821	  3822	  3823	  3829	  3832	  3864	  3865
R3	     7#	   688	   689	   690	   696	   835	   837	   838	   840	   842	  1295	  1298	  1299	  1302
	  1332	  1333	  1335	  1336	  1337	  1338	  1339	  1342	  1343	  1344	  1345	  1346	  1361	  1374
	  1378	  1390	  2074	  2081	  2083	  2086	  2089	  2090	  2093	  2105	  2107	  2109	  2111	  3426
	  3427	  3525	  3526	  3527	  3687	  3693	  3735	  3739	  3743	  3754	  3762	  3764	  3866
RAN	  2197	  2222#	  2273	  2295
RAN1	  2236#	  2255
RAN2	  2244#	  2264
RAN3	  2223	  2247#	  2290
RAN3A	  2249#	  2250
RAN4	  2239	  2252#	  2266
RAN5	  2241	  2256#
RAN5A	  2263#	  2271
RAN6	  2243	  2246	  2254	  2262	  2269	  2272#	  2287
RAN7	  2232	  2274#
RAN8	  2230	  2288#
RAN9	  2234	  2291#	  2293
RANCMD	   225#	   642	  2222	  2590
RANFLG	   215#	  2196	  2247	  2444	  2566	  3164
RANFST	  2203%	  2203	  2215
RANGE	  2303%	  2303
RANLAS	  2530%	  2530	  3111
RANO	  2289%	  2289
RANSIZ	  1069	  2260%	  2260	  2267
RANZ	  2235%	  2235
RBER	  2762	  2833#
RBRACK	   119#
RCD	   182#	   577
RCHGBT	   133#	  1150	  2735
RCOUNT	   534#	  2432	  3121	  3123	  3319
RDDNUM	   659%	   659	  1926	  2116
RDONUM	  2236%	  2236	  2256
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81
TAP.MAC	23-MAR-79 11:41		Symbol cross reference

RDUNI	   304%	   304	  1838	  1916
READL	  3695	  3721#
READTA	  2455#	  2462	  2469	  2510	  2533	  2544	  2548	  2553	  2565	  2572	  2591	  2883	  2975	  2977
	  2981	  2987	  3026	  3160	  3165	  3171	  3191	  3271
REBTRY	  2844	  2857#
RESET	   141#	   244	  1792
RESINT	  3018	  3073#
RESJL	  3021	  3024	  3055#
RESROU	  2421#
REWROU	  1794#
REWTAP	  1796	  1804	  1806#	  1817	  1823
REWWAI	  1794	  1817#	  1882	  2585
RND	  3844	  3845	  3846	  3847	  3861#
RND1	  3864#	  3873
RND2	  3867	  3873#
RP	    73#
RP11	  2686	  2824#
RPAREN	    20#
RPRTA	  3566	  3574#
RPRTB	  3567#	  3580	  3595	  3598
RPRTC	  3575	  3596#
RPRTU	  2519	  3117	  3130	  3153	  3554#
RPTCNT	   532#	   745	  1141
RPTFIL	   208#	  1014	  1120	  1243
RPTFLG	   207#	   744	  1140
RSB	   183#	   577
RST	    18#	  2881
RTRINT	  3077#	  3083
RTRY	  2761#	  2817	  2835	  2855
RWNROU	  1796#
SAV2	  1731#	  1731	  1769
SAVBUF	   515#	   516	  2745	  2746	  2857	  2917	  2937
SAVBYT	   549#	  3387	  3399
SAVDI4	   551#	  2846	  2900
SAVHED	   548#	  3385	  3401
SCDISP	   324%	   324
SCOUNT	   533#	   655	  1005	  1006	  1173
SENTAB	   317	   320	   615	   616	  1573	  1877	  2068	  2097#	  2332
SER	   307	  1862	  1870	  1904	  1934	  1940	  2033	  2042	  2052#	  2052
SERROU	  2034	  2051#
SETB	   315#	   326
SETBPI	   315	  1873	  1937	  2007#
SETBUF	  1564	  1586#	  2027
SETC	   316	   325#
SETDEN	  1578	  1995#	  2032
SETIN	   306	  1549#	  1732	  1861	  1889	  1919	  1965	  2436	  2443
SETINT	  3013	  3074#
SETJL	  3011	  3056#
SETN12	  2245%	  2245	  2253
SETOUT	  1500	  1551#
SETST1	  2647	  2966#
SETST2	  3018#	  3053
SETST3	  3015	  3024#
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81
TAP.MAC	23-MAR-79 11:41		Symbol cross reference

SETST4	  2984	  2988#
SETST5	  2971	  2976#
SETST6	  2974#	  3023
SETST7	  3022	  3025#
SETSTR	  1215	  1475#
SETTP	  1558	  1562#
SEXT	   540#	  2748	  2798	  2927	  3410
SHFTUN	   793	   901	   938#
SKI2	  1770%	  1770
SKICNT	  1730#	  1730	  1754
SKIEO	  1735	  1762#
SKIEOT	  1757	  1760#
SKINI	  1755	  1764#
SKITIN	  1737#	  1738	  1740	  1742	  1744	  1747	  1749	  1758	  1759
SKITRL	  1741	  1748#
SKITRM	  1730#
SP	    73#	  1911	  1921	  1958
SPACE	    24#
SPLIT	  1217	  1220#
SPRTU	  1111	  3553#
SRFIL	   235#	   236
SRMSK	   236#
SRTOT	   233#	   236
SRUSR	   234#	   236
SSCFLG	   219#	  1733	  1812	  2206	  2444	  2446	  3240	  3263
STACK	   243%	   243
START	   243#	  3892
STAT01	   674	   721#
STAT02	   677	   722#
STO23	   530#	   669	   675	   888	   928	   935
STOBPI	  2037#
STODON	   949	   994#
STOFLG	   201#	   652	  2335	  2414	  2422	  3574
STOROU	   641#	   753
STOSTP	   650#	   650	  1495
STRBLK	   409#	   727	   749	  1088	  1091	  1129	  1184	  1186	  1188	  1216	  1411	  1483	  1484	  2394
	  2595	  2602	  2605	  2607	  2609	  2759	  2772	  2809	  2851	  2911	  3143	  3285	  3286
STRER	  1012#	  1012	  1084	  1085	  1086	  1087	  1092
STREXT	   408#	  1025	  1480	  2956	  2960	  3140
STRFIL	   407#	   748	  1027	  1029	  1031	  1104	  1105	  1409	  1478	  2321	  2393	  2953	  2959	  3138
STRJNK	  1026#	  1026	  1028
STRPPN	   406#	   646	   653	   747	   782	   791	   845	   847	   848	   851	   906	   997	  1407	  1476
	  2392	  2948	  2949	  2958	  3136	  3284
STRUSR	   410#	   794	   795	   904
SUCS	  1262#	  3322	  3466	  3516
SYNCIN	   171#	  1569	  1581
SYSPP	   404#	   876	   962	  1127	  2644
T12FLG	   205#	  1523	  1696	  2583	  2687	  2824	  3202	  3207	  3212
TAPBUF	   335#	  1451	  1562	  1587	  1588	  1589
TAPCK	  2485#	  2485	  2652	  3349
TAPCNT	   543#	  2480	  2482	  2498	  2784	  3303
TAPCON	  1237	  1240	  1242#
TAPCTD	   136#	   137	  1408	  3182
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81
TAP.MAC	23-MAR-79 11:41		Symbol cross reference

TAPERR	  1670#	  1670	  1671
TAPHD1	   372#	   737	  1163	  1418	  1421	  1430	  1433	  1464	  1467	  1626	  2470	  2658
TAPHD2	   373#	   734	  1158	  1161	  1167	  1197	  1423	  1424	  1432	  1472	  1627	  2465	  2466	  2660
TAPHED	   371#	   372	   373	  1199	  1428	  1452	  1549	  1551	  1563	  1622	  1630	  1638	  1681	  2536
	  2549	  2613	  2620	  2621	  2622	  2630	  2631	  2632	  2641	  2662	  3031	  3091	  3099	  3106
	  3161	  3205	  3246	  3672
TAPIN	  1608#	  1737	  1750	  1756	  2382	  2455
TAPIN2	  1612	  1621#	  1653
TAPINE	  1611#	  1656	  1657
TAPN	   156#	   335
TAPNUM	   657	   663#	   663	  1061	  1071	  1397	  1511	  2395
TAPNWR	  1231	  1241#
TAPOPN	   611	   612	  1581#
TAPOU1	  1203#
TAPOU3	  1204	  1208	  1210	  1214	  1431#	  1488	  1502
TAPOUT	   735	  1159	  1169	  1196#	  1425
TAPPDE	  1235	  1238#
TAPSIZ	   164#	   335
TE	    73#	   660	  1928	  2118	  2229	  2242	  2263	  2292
TIND1	  1690	  1694	  1714#
TINDIR	  1632	  1680#
TLIC	  3686#	  3686	  3689
TMP	   689#	   689	   707	  2112	  2113	  3257	  3262	  3526#	  3526	  3541	  3585#	  3585	  3588	  3605
	  3606
TMP2	  3255	  3261#	  3261
TMPPPN	   764#	   897	   898
TMPUSR	   763#	   810	   823	   833	   902	   903	   905
TOFCHR	    22#
TOTBLK	  2431	  2617	  3570	  3571	  3593#	  3593
TOTCNT	   456#	   752	  2429	  3154	  3155	  3156	  3569
TP0	   152#	   587	   589	   591	   593	   595	   597	   599	   601	   603	   605	   607	   609	   611
	   613	   615	   617	   619	   621	   623	   625	   627	   629	   631	   633	   635	   637
TP1	   153#	   588	   590	   592	   594	   596	   598	   600	   602	   604	   606	   608	   610	   612
	   614	   616	   618	   620	   622	   624	   626	   628	   630	   632	   634	   636	   638
TPDEN	   511#	  1941	  2040	  2151	  2155
TPID	   295	  1520	  1537#
TPID1	   296	   509#	  1540
TPID2	   510#	  1544
TPPOS	   514#	  1072
TPROC	  1207#	  1247
TPSER	   512#	  2043
TPSZM2	   524#	  1586	  2022
TPSZM3	   525#	  1160	  2024
TPSZM4	   526#	  1196	  1431	  2026
TPTIM	   513#	  1516
TPUN1	   507#	   983	  1079
TPUN2	   508#	   984	  1081
TRBALC	   545#	  2684	  2920	  3315
TRBSIZ	   516#	  2783	  2792
TRCER	  3389	  3391	  3393	  3407#
TRCERR	  3375	  3407	  3410#
TRCL	  1065	  1110	  1680	  1719#
TRIGR	  3357	  3358	  3422#
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81
TAP.MAC	23-MAR-79 11:41		Symbol cross reference

TRK	   311	   522#	  1865	  1901	  2014	  2039
TRK1	   310	   523#	  1864	  1902	  2013	  2058	  2072#	  2072
TRKSW	  2150	  2160#	  2160
TRL1	  3117#	  3166	  3276
TRL2	  3109	  3112	  3126#	  3145
TRL3	  3102	  3130#
TRL4	  3106#	  3131
TRL5	  3095	  3133#
TRL6	  3093	  3147#
TRL7	  3150	  3159#
TRLOUT	  1002	  1397#	  1489	  2399
TRLRD	  2504	  3088#
TRTF	  1259#	  1273	  3458
TRTFG2	   227#	   644	  2425
TRTFG3	   228#
TRTFLG	   226#	  2426	  2541	  2563
TRUNC2	  3397	  3399#
TRUNC3	  3398	  3404#
TRUNCA	  3313	  3380#
TWHY	  2803	  2818#
TYP1	  3788#	  3798
TYP2	  3791	  3797#
TYP3	  3798#	  3803
U	    13#	   681	   683	   893	   897	   919	   951	   966	   979	  1019	  1029	  1040	  1074	  1251
	  1291	  1336	  1339	  2537	  2550	  2642	  2644	  2966	  2978	  2979	  2985	  2997	  3000	  3457
	  3462	  3475	  3477	  3481	  3805	  3808	  3824	  3827
UCHGBT	   132#	  1318
UCOUNT	   535#	  2428	  3052	  3557	  3559	  3560
UFD	   148#	   955	   961	   968	  1016	  1098	  1100	  1114	  1115	  2988	  2994	  3016	  3051	  3089
	  3090
UFD2	   725	  1011#	  1024	  1030	  1089	  1225
UFD2A	  1015	  1044#
UFD3	  1033	  1084#
UFD4	  1035	  1085#
UFD5	  1037	  1086#
UFD6	  1053	  1087#
UFD7	  1056	  1088#
UFDARG	   574#	  1017
UFDBL1	   443#	  3010
UFDBL2	   444#	  3000	  3014	  3019
UFDBLK	   442#	  3075	  3077
UFDBTS	   582#	  1317
UFDBUF	   333#	   959	  2992
UFDCRE	   581#	  1021
UFDDI1	   469#	   963	  2978
UFDDI2	   470#	   966	   969	   975	   981	  1042	  1075	  1102	  2997
UFDDI3	   471#	   967	  2999
UFDDI4	   472#
UFDDIR	   468#	   484	   965	   968	  2996	  3016	  3036	  3038	  3046
UFDEND	  1018	  1098#
UFDFLG	   198#	   263	   266	  2976
UFDHD1	   380#
UFDHD2	   381#
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81
TAP.MAC	23-MAR-79 11:41		Symbol cross reference

UFDHED	   379#	   380	   381	   957	  2990
UFDMON	   578#	   985
UFDN	   158#	   333	   961	  2994
UFDTAB	   574	   579#	  1019	  1020
UNIROU	   299#	   301
UNISW	   302	   323	   528#	  1834	  1880	  1888	  1907	  1964
UNIT	    16#	   248	   999	  1000	  1001	  1203	  1205	  1207	  1230	  1234	  1244	  1246	  1437	  1438
	  1439	  1449	  1456	  1458	  1501	  1509	  1510	  1553	  1555	  1559	  1560	  1567	  1570	  1572
	  1595	  1596	  1598	  1611	  1613	  1651	  1655	  1760	  1761	  1803	  1806	  1818	  1829	  1856
	  1860	  1887	  1918	  1995	  2000	  2208	  2209	  2210	  2211	  2212	  2387	  2388	  2437	  2438
	  2439	  3274	  3275
UNLROU	  1798#
UNLTAP	  1798	  1803#
UNMFLG	   218#	  1733	  1811	  2206	  2444	  2610	  3555
UPDFLG	   556#	  1788	  2670
UPDMOD	   539#	  2671	  2683	  2758	  2808	  2852	  2931	  2934
UPDROU	  1787#
URBALC	   476#	  3039	  3041
URBCSZ	   483#	  3045
URBEST	   475#	  3040
URBNXT	   478#	  3043
URBPOS	   477#	  3042
URBPRD	   479#	  3044
URBSIZ	   473#
URBSTS	   481#	   973
USRCMP	   825	   836	   858#	   908
USRCTD	   135#	   137	  1410	  3101	  3184
USRGPT	   665	   768#	   779	   786	   950	   953
USROVF	   774#	   796	   798	   799	   800	   801	   814	   824	   850
USRPPN	  3775#
USRPTR	   664	   769#	   780	   783	   787	   805	   813	   816	   817	   852	   853	   855
USRSC	   766#	   776
USRSRE	   771#	   820	   827	   835	   838
USRSRS	   770#	   808	   818	   828	   832	   837
USRTAB	   776#	   854
USRTBE	   777#	   785	   802	   819	   844
UTRY	  2758#	  2860
UUOFLG	    28	    33	    34	    35	    36	    37	    38	    39	    40	    41	    42	    43	    44	    45
	    46	    47	    48	    49	    50	    51	    52
VERFLG	  1748	  3170	  3201#
VERLOC	   100#	   101	   288
VERPAT	     3#	   102
VERSIO	     2#	   102	   395	  1077	  1517	  3479
VERTMP	   289#	   289	   290	   291	   292	   293
VOWT	  3424	  3430	  3437#
W	   107#	   894	   895	   918	   954	   967	  1020	  1023	  1028	  1041	  1073	  1124	  1344	  1346
	  2551
WAIT	   142#	   637	   638
WDCNT	   544#	  2487	  2649	  3308
WHERE	  2294	  2309	  2311#
WHEROU	  2309#
WHY	  1095	  2819	  2942	  3415	  3602#
WPREP	  1060	  1500#	  2396
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81
TAP.MAC	23-MAR-79 11:41		Symbol cross reference

WRITER	  2479	  2839#
WRITL	  3699	  3722#
X	    32#	    33	    33#	    34	    34#	    35	    35#	    36	    36#	    37	    37#	    38	    38#	    39
	    39#	    40	    40#	    41	    41#	    42	    42#	    43	    43#	    44	    44#	    45	    45#	    46
	    46#	    47	    47#	    48	    48#	    49	    49#	    50	    50#	    51	    51#	    52	    52#
XFER1	  2464#	  2786
XFER2	  2466#	  2486	  2490
XFER2A	  2467	  2470#
XFER2B	  2474	  2480#
XFER2C	  2483	  2487#
XFER2D	  2482#	  2499
XFER2E	  2472	  2492#
XFER2F	  2493	  2498#
XFER3A	  2779	  2864#
XFER3B	  2871	  2887#	  2899	  2906
XFER3C	  2780#	  2793	  2875	  2888
XFER3D	  2743	  2807	  2820	  2840	  2881#	  2943
XFER3E	  2869	  2877#	  2897	  2905
XFER3N	  2873	  2892#
XFER4	  2760	  2911#
XFER4A	  2949#	  2954	  2957
XFER4C	  2914	  2927#
XFER4D	  2933	  2941#
XFER4E	  2604	  2912	  2947#
XHDR	   131#	  1698	  1701	  1706	  1708	  1710	  1712	  3247
XHDRN	   124#	   131	   489	   506	  1465	  1468	  2657
XLOOKN	   123#	   466	   484	   515	   964	  1038	  2669	  2746	  2859	  2919	  2939	  2995	  3038
ZPOS	  1736	  1810	  2126#	  2207	  2451
.RPBAD	   187#	  1055	  2741
.RPNFS	   186#	   974	  1055
TAP     03/26/74	MACRO 12.5-46.0 17:23 13-JAN-81
TAP.MAC	23-MAR-79 11:41		Macro/Opdef cross reference

CHARDO	    54#	    73
CHRDEF	    71#	    73
CLRIN	    43#	  1850	  2119	  2272
CNTF	  1255#	  1266	  1267	  1268	  1269
DATUUO	   278	  2699	  2716
DEC	    41#
DISABL	    47#
ENABLE	    46#
ERB	    52#	   969	   975	   981	  1005	  1052	  1061	  1101	  1102	  1137	  1155	  1184	  1218	  1219
	  1233	  1236	  1238	  1443	  1445	  1447	  1648	  1664	  1667	  1671	  1676	  2478	  2605	  2700
	  2717	  2742	  2806	  2818	  2833	  2941	  3014	  3019	  3104	  3120	  3121	  3171	  3284	  3286
	  3344	  3347	  3365	  3368	  3404	  3414	  3559	  3606	  3648	  3650	  3652	  3654	  3683
ERO	    50#	  1177	  1883	  2584	  2611	  2620	  2626	  2877	  2887	  2973	  3155	  3239	  3241	  3242
	  3262	  3264	  3334	  3336	  3354	  3578	  3586	  3596	  3680
ERROR	    45#	   643	   645	   649	   661	   687	   872	   882	   926	   931	   958	   989	   996	   998
	  1047	  1070	  1096	  1241	  1506	  1554	  1561	  1641	  1746	  1753	  1866	  1874	  1879	  1925
	  1929	  1947	  1982	  2082	  2091	  2323	  2333	  2419	  2723	  2991	  3009	  3012	  3025	  3035
	  3047	  3059	  3751	  3795	  3813	  3820	  3831	  3877	  3885
ERT	    51#	   290	   293	   294	   298	   713	   791	   848	  1004	  1090	  1105	  1247	  1749	  1764
	  1766	  1768	  1940	  2113	  2141	  2142	  2153	  2154	  2167	  2168	  2180	  2181	  2250	  2312
	  2874	  2949	  3364	  3494
EXIT	  1793	  3070
GCD	    37#
GCI	    36#
GETPPN	  2727	  3664
GETTAB	   256	   269	   281	  1525	  1529	  1538	  1542	  3058	  3067
OPD	    29#	    33	    34	    35	    36	    37	    38	    39	    40	    41	    42	    43	    44	    45
	    46	    47	    48	    49	    50	    51	    52
RDLINE	    35#
SETLIC	   267
SETTTY	    44#
SLEEP	  3082
SSKE	    48#
STRUUO	  3078
SYSSTR	  3003	  3008
TAB	    49#
TCI	    33#	  1960	  2270	  2288	  2291
TCL	    34#	  1957	  2228
TCO	    40#	   299	  1677	  1836	  2060	  2061	  2110	  3359	  3425	  3435	  3607	  3702	  3709	  3713
	  3714
TYPE	    42#	   262	   287	   300	   318	   321	   654	  1763	  1832	  1837	  1851	  1853	  2057	  2103
	  2115	  2227	  2274	  2279	  2281	  2284	  2314	  2400	  2577	  2579	  2581	  3492
WCD	    39#
WCI	    38#  M 7